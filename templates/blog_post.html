{% extends "base.html" %}

{% block title %}{{ post.title }} | {{ site_name }}{% endblock %}

{% block content %}

{# JSON-LD Structured Data for SEO - TechArticle for GEO/AEO #}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "headline": "{{ post.title }}",
  "description": "{{ meta_description }}",
  "image": {
    "@type": "ImageObject",
    "url": "{{ og_image }}",
    "width": 1200,
    "height": 630
  },
  "author": {
    "@type": "Person",
    "name": "David Swann",
    "url": "{{ SITE_URL }}/about/",
    "description": "Azure Architect specializing in enterprise cloud infrastructure",
    "jobTitle": "Azure Architect",
    "sameAs": [
      "https://github.com/dswann101164",
      "https://www.linkedin.com/in/intikiswann/"
    ],
    "worksFor": {
      "@type": "Organization",
      "name": "Synovus"
    }
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ site_name }}",
    "url": "{{ SITE_URL }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ SITE_URL }}/static/images/logo.png"
    }
  },
  "datePublished": "{{ date_published_iso }}",
  "dateModified": "{{ date_modified_iso }}",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ canonical_url }}"
  },
  "keywords": "{{ post.tags|join(', ') }}",
  "articleSection": "{{ post.tags[0] if post.tags else 'Azure' }}",
  "wordCount": "{{ word_count }}",
  "timeRequired": "PT{{ reading_min }}M",
  "inLanguage": "en-US",
  "isAccessibleForFree": "True",
  "proficiencyLevel": "{{ post.proficiency_level or 'Intermediate' }}",
  {% if post.dependencies %}"dependencies": "{{ post.dependencies }}",{% endif %}
  "about": {
    "@type": "Thing",
    "name": "{{ post.tags[0] if post.tags else 'Microsoft Azure' }}"
  }
}
</script>

{# BreadcrumbList Schema - NEW FOR RICH RESULTS #}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ SITE_URL }}"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": "{{ SITE_URL }}/blog/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{ post.title }}",
      "item": "{{ canonical_url }}"
    }
  ]
}
</script>

{# Speakable Schema - For voice assistants and AI audio extraction #}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "speakable": {
    "@type": "SpeakableSpecification",
    "cssSelector": [".summary", ".post-header h1", ".post-body h2", ".post-body p:first-of-type"]
  },
  "url": "{{ canonical_url }}"
}
</script>

{# HowTo Schema - For tutorial/walkthrough posts #}
{% if post.is_howto %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "HowTo",
  "name": "{{ post.title }}",
  "description": "{{ meta_description }}",
  "totalTime": "PT{{ reading_min }}M",
  "image": "{{ og_image }}",
  "author": {
    "@type": "Person",
    "name": "David Swann"
  }
}
</script>
{% endif %}

{# FAQ Schema - If post has common questions (optional) #}
{% if post.faq %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {% for faq in post.faq %}
    {
      "@type": "Question",
      "name": "{{ faq.question }}",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "{{ faq.answer }}"
      }
    }{% if not loop.last %},{% endif %}
    {% endfor %}
  ]
}
</script>
{% endif %}

{# FAQ Schema - Auto-load from JSON file if faq_schema is true #}
{% if post.faq_schema and faq_schema_json %}
{{ faq_schema_json|safe }}
{% endif %}

<article class="post">

  {# --- HERO IMAGE --- #}
  {% if post.animated_hero %}
    {# Animated hero for special posts #}
    <link rel="stylesheet" href="{{ url_for('static', filename='hero-animated.css') }}">
    <div class="hero-animated">
      <div class="grid-bg"></div>
      <div class="glow"></div>
      <div class="glow"></div>
      
      <div class="question-mark">?</div>
      <div class="question-mark">?</div>
      <div class="question-mark">?</div>
      
      <div class="arrow"></div>
      <div class="arrow"></div>
      <div class="arrow"></div>
      <div class="arrow"></div>
      
      <div class="tool-badge wsus">WSUS</div>
      <div class="tool-badge sccm">SCCM</div>
      <div class="tool-badge azure">Azure Update Manager</div>
      <div class="tool-badge intune">Intune</div>
      
      <div class="content">
        <div class="question">Three Microsoft reps, three different answers</div>
        <h1>Which One?</h1>
        <div class="subtitle">
          SCCM, WSUS, Azure Update Manager, Intune‚Äî<br>
          <span class="highlight">nobody will tell you which tool to actually use</span>
        </div>
      </div>
    </div>
  {% elif cover_url %}
    {# Static hero image #}
    <div class="hero">
      <img src="{{ url_for('static', filename=cover_url.lstrip('/').replace('static/', '')) }}" alt="{{ post.title }}" loading="eager">
    </div>
  {% endif %}

  <header class="post-header">
    <h1>{{ post.title }}</h1>
    <p class="muted">
      {{ post.date|ymd }} ¬∑ ~{{ reading_min }} min read
      {% if date_modified_iso != date_published_iso %}
        ¬∑ Updated {{ post.modified|ymd }}
      {% endif %}
    </p>
    
    {% if post.tags and post.tags|length %}
    <ul class="tags-list">
      {% for tag in post.tags %}
      <li><a href="{{ url_for('tag_posts', tag=tag|slugify_tag) }}" class="tag-badge">{{ tag }}</a></li>
      {% endfor %}
    </ul>
    {% endif %}
    
    {% if post.summary %}
      <p class="summary">{{ post.summary }}</p>
    {% endif %}
  </header>

  {# ---- POST ACTIONS (print/share) ---- #}
  <p class="post-actions" style="margin:.5rem 0 0; text-align: center;">
    <button class="btn"
            onclick="window.print(); return false;"
            title="Print this page"
            aria-label="Print this page"
            style="cursor: pointer; background: none; border: 2px solid var(--azure-blue);">
      üñ®Ô∏è Print this page
    </button>
  </p>

  {# ---- MAIN POST BODY ---- #}
  <div class="post-body">
    {{ content|safe }}
  </div>

  {# ---- STARTER KIT CTA ---- #}
  <section class="starter-kit-callout" style="
    max-width: 800px;
    margin: 3rem auto 2rem;
    padding: 2rem;
    border-radius: 12px;
    background: var(--bg-light);
    border: 1px solid var(--border);
    text-align: left;
  ">
    <h3 style="margin-top: 0;">Azure Admin Starter Kit (Free Download)</h3>
    <p style="margin-bottom: 1rem;">
      Get my KQL cheat sheet, 50 Windows + 50 Linux commands, and an Azure RACI template in one free bundle.
    </p>
    <a href="/blog/starter-kit/" class="btn">Get the Starter Kit ‚Üí</a>
  </section>



  {# ---- RELATED POSTS ---- #}
  {% if related_posts %}
  <aside class="related-posts" style="max-width: 800px; margin: 3rem auto; padding: 2rem; background: var(--bg-light); border-radius: 12px;">
    <h3 style="margin-top: 0;">Related Posts</h3>
    <ul style="list-style: none; padding: 0;">
      {% for related in related_posts %}
      <li style="margin: 1rem 0;">
        <a href="{{ url_for('blog_post', slug=related.slug) }}" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">{{ related.title }}</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">{{ related.date|ymd }}</span>
        </a>
      </li>
      {% endfor %}
    </ul>
  </aside>
  {% endif %}

  {# ---- CONTENT-SPECIFIC CTA ---- #}
  {% set post_tags_lower = post.tags|map('lower')|list %}
  {% if 'migration' in post_tags_lower or 'cloud migration' in post_tags_lower %}
    {% include 'partials/cta-migration.html' %}
  {% elif 'kql' in post_tags_lower or 'query' in post_tags_lower or 'log analytics' in post_tags_lower %}
    {% include 'partials/cta-kql.html' %}
  {% elif 'finops' in post_tags_lower or 'cost' in post_tags_lower or 'cost management' in post_tags_lower %}
    {% include 'partials/cta-finops.html' %}
  {% else %}
    {% include 'partials/cta-general.html' %}
  {% endif %}

  {# ---- PREV/NEXT ---- #}
  <nav class="post-nav">
    {% if prev_post %}
      <a href="{{ url_for('blog_post', slug=prev_post.slug) }}">
        <span style="opacity: 0.7; font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">‚Üê Previous</span>
        <strong>{{ prev_post.title }}</strong>
      </a>
    {% else %}
      <span></span>
    {% endif %}
    {% if next_post %}
      <a href="{{ url_for('blog_post', slug=next_post.slug) }}" style="text-align: right;">
        <span style="opacity: 0.7; font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">Next ‚Üí</span>
        <strong>{{ next_post.title }}</strong>
      </a>
    {% endif %}
  </nav>

</article>
{% endblock %}
