<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  

  <!-- Primary SEO -->
  <title>Azure Private DNS Resolver Alternative | Fix Private Endpoint DNS in Hybrid Environments ¬∑ Azure Noob</title>
  <meta name="description" content="Azure Private DNS Resolver alternative for hybrid environments. Fix private endpoint DNS resolution by duplicating zones in on-prem AD instead of...">
  
  <link rel="canonical" href="https://azure-noob.com/blog/private-endpoint-dns-hybrid-ad" />

  <!-- Favicons -->
  <link rel="icon" href="/static/images/logo.png">

  <!-- Open Graph -->
  <meta property="og:title" content="Azure Private DNS Resolver Alternative | Fix Private Endpoint DNS in Hybrid Environments">
  <meta property="og:description" content="Azure Private DNS Resolver alternative for hybrid environments. Fix private endpoint DNS resolution by duplicating zones in on-prem AD instead of...">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://azure-noob.com/blog/private-endpoint-dns-hybrid-ad">
  <meta property="og:image" content="https://azure-noob.com/static/images/hero/private-endpoint-dns.png">

  
    <meta property="article:published_time" content="2025-10-06T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-10-06T00:00:00+00:00">
    <meta property="article:author" content="David Swann">
    
      
        <meta property="article:tag" content="azure">
      
        <meta property="article:tag" content="private-dns">
      
        <meta property="article:tag" content="dns-resolver">
      
        <meta property="article:tag" content="private-endpoints">
      
        <meta property="article:tag" content="hybrid-cloud">
      
        <meta property="article:tag" content="networking">
      
    
  

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Azure Private DNS Resolver Alternative | Fix Private Endpoint DNS in Hybrid Environments">
  <meta name="twitter:description" content="Azure Private DNS Resolver alternative for hybrid environments. Fix private endpoint DNS resolution by duplicating zones in on-prem AD instead of...">
  <meta name="twitter:image" content="https://azure-noob.com/static/images/hero/private-endpoint-dns.png">

  <!-- Styles -->
  <link rel="stylesheet" href="/static/styles.css">

  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="Azure Noob RSS Feed" href="https://azure-noob.com/rss.xml">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZNHGEB0BNZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-ZNHGEB0BNZ');
  </script>
</head>
<body>
  <header class="site-header">
    <div class="wrap nav-wrap">
      <div class="brand-block">
        <a href="/" class="brand-link">
          <img src="/static/images/logo.png" alt="Azure Noob logo" class="logo">
        </a>
        <span class="brand-text">
          <small>Official Website of</small>
          <strong>Azure Noob</strong>
        </span>
      </div>
      <nav class="nav">
        <a href="/">Home</a>
        <a href="/blog/">Blog</a>
        <a href="/hubs/" style="font-weight: 700;">Content Hubs</a>
        <a href="/products" style="font-weight: 700; color: #ff6b6b;">Products</a>
        <a href="/start-here">Start Here</a>
        <a href="/blog/starter-kit/">Starter Kit</a>
        <a href="/about">About</a>
        <a href="/tags/">Tags</a>
        <a href="https://github.com/dswann101164" target="_blank" rel="noopener">GitHub</a>
        <a href="/search">Search</a>
      </nav>
    </div>
  </header>

  <main class="site-content">
    <div class="wrap">
      


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Azure Private DNS Resolver Alternative | Fix Private Endpoint DNS in Hybrid Environments",
  "description": "Azure Private DNS Resolver alternative for hybrid environments. Fix private endpoint DNS resolution by duplicating zones in on-prem AD instead of...",
  "image": {
    "@type": "ImageObject",
    "url": "https://azure-noob.com/static/images/hero/private-endpoint-dns.png",
    "width": 1200,
    "height": 630
  },
  "author": {
    "@type": "Person",
    "name": "David Swann",
    "url": "https://azure-noob.com/about/",
    "description": "Azure Architect specializing in enterprise cloud infrastructure",
    "jobTitle": "Azure Architect",
    "worksFor": {
      "@type": "Organization",
      "name": "Synovus"
    }
  },
  "publisher": {
    "@type": "Organization",
    "name": "Azure Noob",
    "url": "https://azure-noob.com",
    "logo": {
      "@type": "ImageObject",
      "url": "https://azure-noob.com/static/images/logo.png"
    }
  },
  "datePublished": "2025-10-06T00:00:00+00:00",
  "dateModified": "2025-10-06T00:00:00+00:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://azure-noob.com/blog/private-endpoint-dns-hybrid-ad"
  },
  "keywords": "azure, private-dns, dns-resolver, private-endpoints, hybrid-cloud, networking",
  "articleSection": "azure",
  "wordCount": "2074",
  "timeRequired": "PT10M",
  "inLanguage": "en-US",
  "isAccessibleForFree": "True",
  "about": {
    "@type": "Thing",
    "name": "azure"
  }
}
</script>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://azure-noob.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": "https://azure-noob.com/blog/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Azure Private DNS Resolver Alternative | Fix Private Endpoint DNS in Hybrid Environments",
      "item": "https://azure-noob.com/blog/private-endpoint-dns-hybrid-ad"
    }
  ]
}
</script>







<article class="post">

  
  
    
    <div class="hero">
      <img src="/static/images/hero/private-endpoint-dns.png" alt="Azure Private DNS Resolver Alternative | Fix Private Endpoint DNS in Hybrid Environments" loading="eager">
    </div>
  

  <header class="post-header">
    <h1>Azure Private DNS Resolver Alternative | Fix Private Endpoint DNS in Hybrid Environments</h1>
    <p class="muted">
      2025-10-06 ¬∑ ~10 min read
      
    </p>
    
    
    <ul class="tags-list">
      
      <li><a href="/tags/azure" class="tag-badge">azure</a></li>
      
      <li><a href="/tags/private-dns" class="tag-badge">private-dns</a></li>
      
      <li><a href="/tags/dns-resolver" class="tag-badge">dns-resolver</a></li>
      
      <li><a href="/tags/private-endpoints" class="tag-badge">private-endpoints</a></li>
      
      <li><a href="/tags/hybrid-cloud" class="tag-badge">hybrid-cloud</a></li>
      
      <li><a href="/tags/networking" class="tag-badge">networking</a></li>
      
    </ul>
    
    
    
      <p class="summary">Azure Private DNS Resolver alternative for hybrid environments. Fix private endpoint DNS resolution by duplicating zones in on-prem AD instead of forwarders. Real-world solution managing 1,500+ private endpoints.</p>
    
  </header>

  
  <p class="post-actions" style="margin:.5rem 0 0; text-align: center;">
    <button class="btn"
            onclick="window.print(); return false;"
            title="Print this page"
            aria-label="Print this page"
            style="cursor: pointer; background: none; border: 2px solid var(--azure-blue);">
      üñ®Ô∏è Print this page
    </button>
  </p>

  
  <div class="post-body">
    <p>Microsoft's documentation for private endpoint DNS resolution in hybrid environments is comprehensive. It's also complicated.</p>
<p>This guide is part of our <a href="/hub/governance/">Azure Governance hub</a> covering policy enforcement, compliance frameworks, and enterprise controls.</p>
<p>Conditional forwarders. Azure Private Resolver. DNS forwarding rulesets. Virtual machines running DNS services. Multiple hops between on-prem and Azure.</p>
<p>We don't do any of that.</p>
<p>We duplicate the DNS zones in both places and move on.</p>
<h2>The Problem Microsoft Solves (Correctly)</h2>
<p>When you create a private endpoint in Azure, it needs DNS resolution to work:</p>
<ul>
<li><strong>Azure workloads</strong> need to resolve <code>storage123.privatelink.blob.core.windows.net</code> ‚Üí <code>10.5.2.45</code></li>
<li><strong>On-prem workloads</strong> need to resolve the same FQDN ‚Üí same private IP</li>
</ul>
<p>Microsoft's solution:<br />
1. Azure Private DNS zones linked to VNets (Azure side resolves correctly)<br />
2. On-prem DNS has conditional forwarders pointing to Azure Private Resolver or DNS forwarder VM<br />
3. DNS queries flow: On-prem ‚Üí Conditional forwarder ‚Üí Azure DNS forwarder ‚Üí Azure Private DNS ‚Üí Response</p>
<p>This works. It's architecturally correct. It's what Microsoft documents.</p>
<p>It's also more complex than necessary if you have existing Active Directory DNS infrastructure.</p>
<h2>Our Pattern: Duplicate the Zones</h2>
<p>We create the same <code>privatelink.*</code> zones in both Azure Private DNS and on-prem Active Directory DNS.</p>
<p><strong>Azure side:</strong><br />
- Private endpoint created<br />
- Azure Private DNS zone: <code>privatelink.blob.core.windows.net</code><br />
- A record added automatically: <code>storage123.privatelink.blob.core.windows.net</code> ‚Üí <code>10.5.2.45</code><br />
- Azure VMs resolve through Azure DNS (168.63.129.16)</p>
<p><strong>On-prem side:</strong><br />
- AD DNS zone created: <code>privatelink.blob.core.windows.net</code><br />
- Same A record added manually: <code>storage123.privatelink.blob.core.windows.net</code> ‚Üí <code>10.5.2.45</code><br />
- Domain-joined machines resolve through AD DNS</p>
<p>No forwarders. No cross-environment dependencies. Each side maintains its own zones.</p>
<h2>Why This Works Better for Enterprises</h2>
<h3><strong>1. Clear Team Ownership</strong></h3>
<p>Our environment has separate teams:</p>
<p><strong>Azure infrastructure team:</strong><br />
- Builds VMs, joins to domain<br />
- Creates private endpoints<br />
- Documents what was created (FQDN, IP, target resource)<br />
- Hands off to AD team via ticket</p>
<p><strong>Active Directory team:</strong><br />
- Manages on-prem DNS infrastructure<br />
- Adds A records to AD DNS based on Azure team documentation<br />
- Maintains DNS records lifecycle</p>
<p>No shared infrastructure to manage. No cross-team coordination on DNS forwarders or Azure Private Resolver deployments.</p>
<h3><strong>2. Simpler Architecture</strong></h3>
<p>Microsoft's recommended pattern requires:<br />
- Azure Private Resolver (managed service with costs)<br />
- OR DNS forwarder VM in Azure (more infrastructure to manage)<br />
- Conditional forwarders configured on-prem DNS<br />
- DNS forwarding rulesets<br />
- Multiple network hops for resolution</p>
<p>Our pattern requires:<br />
- Azure Private DNS zones (already created with private endpoints)<br />
- Matching zones in on-prem AD DNS<br />
- A records replicated between them</p>
<p>One less layer. One less thing to troubleshoot.</p>
<h3><strong>3. Works With Existing AD Infrastructure</strong></h3>
<p>Enterprise AD DNS already manages thousands of records. Adding a few more <code>privatelink.*</code> zones is not a burden.</p>
<p>Most enterprises already have:<br />
- Mature change control processes for DNS<br />
- Backup and DR for AD DNS<br />
- Monitoring and alerting for DNS services<br />
- Trained staff managing AD infrastructure</p>
<p>Why introduce a new DNS layer (Azure Private Resolver) when existing infrastructure works?</p>
<h3><strong>4. No Shared Dependencies</strong></h3>
<p>With conditional forwarders, both teams depend on:<br />
- Azure Private Resolver availability<br />
- Network connectivity between on-prem and Azure for DNS queries<br />
- Proper configuration of forwarding rules<br />
- Shared responsibility for troubleshooting</p>
<p>With duplicated zones:<br />
- Azure team owns Azure Private DNS<br />
- AD team owns on-prem AD DNS<br />
- Each works independently<br />
- Failures don't cascade across environments</p>
<h2>The Operational Reality</h2>
<p><strong>How many private endpoints does this pattern scale to?</strong></p>
<p>We checked using Resource Graph:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Resources</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;microsoft.network/privateendpoints&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">summarize</span><span class="w"> </span><span class="n">PrivateEndpointCount</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">count</span><span class="p">()</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">subscriptionId</span>
<span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">PrivateEndpointCount</span><span class="w"> </span><span class="n">desc</span>
</code></pre></div>

<p><strong>Result: Over 1,000 private endpoints across multiple subscriptions</strong></p>
<p>Breakdown by resource type:<br />
- Storage Accounts (largest portion)<br />
- App Services (second largest)<br />
- Key Vaults<br />
- Data Factory instances<br />
- Plus Synapse, AKS, SQL, Recovery Services Vaults, etc.</p>
<p><strong>Created over several years.</strong></p>
<p>Most are created in batches during planned deployments:<br />
- Storage account migrations: dozens of endpoints in one week<br />
- App Service consolidations: 50-100 endpoints in one month<br />
- Not evenly distributed</p>
<p><strong>Time to maintain AD DNS records:</strong><br />
- 5 minutes per private endpoint (add A record via change ticket)<br />
- Part of normal deployment process<br />
- Manageable within existing change control workflows</p>
<p>Not overwhelming. Not automated. Just normal enterprise change management.</p>
<h2>When Does This Pattern Break Down?</h2>
<p>This pattern works when:<br />
- ‚úÖ You have mature AD DNS infrastructure<br />
- ‚úÖ Private endpoints created through controlled deployments<br />
- ‚úÖ Separate teams with clear handoff processes<br />
- ‚úÖ Change control is acceptable overhead</p>
<p>This pattern struggles when:<br />
- ‚ùå Private endpoints created constantly by developers (self-service)<br />
- ‚ùå Need real-time automation (no manual steps)<br />
- ‚ùå No on-prem AD infrastructure (cloud-native startup)<br />
- ‚ùå Hundreds of subscriptions with autonomous teams</p>
<p>For cloud-native environments or massive scale, Microsoft's automation-first approach makes more sense.</p>
<p>For enterprises with legacy AD infrastructure and controlled deployments, duplicating zones is simpler.</p>
<h2>The Resource Graph Query</h2>
<p>Here's the complete query to inventory all your private endpoints:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Resources</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;microsoft.network/privateendpoints&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span>
<span class="w">    </span><span class="n">PrivateEndpointName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
<span class="w">    </span><span class="n">ResourceGroup</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">resourceGroup</span><span class="p">,</span>
<span class="w">    </span><span class="n">Location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">location</span><span class="p">,</span>
<span class="w">    </span><span class="n">SubscriptionName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">subscriptionId</span><span class="p">,</span>
<span class="w">    </span><span class="n">PrivateIP</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">properties</span><span class="err">.</span><span class="n">customDnsConfigs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="err">.</span><span class="n">ipAddresses</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="w">    </span><span class="n">FQDN</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">properties</span><span class="err">.</span><span class="n">customDnsConfigs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="err">.</span><span class="n">fqdn</span><span class="p">,</span>
<span class="w">    </span><span class="n">TargetResource</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">properties</span><span class="err">.</span><span class="n">privateLinkServiceConnections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="err">.</span><span class="n">properties</span><span class="err">.</span><span class="n">privateLinkServiceId</span><span class="p">,</span>
<span class="w">    </span><span class="n">ConnectionState</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">properties</span><span class="err">.</span><span class="n">privateLinkServiceConnections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="err">.</span><span class="n">properties</span><span class="err">.</span><span class="n">privateLinkServiceConnectionState</span><span class="err">.</span><span class="n">status</span><span class="p">,</span>
<span class="w">    </span><span class="n">Subnet</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">properties</span><span class="err">.</span><span class="n">subnet</span><span class="err">.</span><span class="n">id</span>
<span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span>
<span class="w">    </span><span class="n">PrivateEndpointName</span><span class="p">,</span>
<span class="w">    </span><span class="n">SubscriptionName</span><span class="p">,</span>
<span class="w">    </span><span class="n">ResourceGroup</span><span class="p">,</span>
<span class="w">    </span><span class="n">Location</span><span class="p">,</span>
<span class="w">    </span><span class="n">PrivateIP</span><span class="p">,</span>
<span class="w">    </span><span class="n">FQDN</span><span class="p">,</span>
<span class="w">    </span><span class="n">TargetResource</span><span class="p">,</span>
<span class="w">    </span><span class="n">ConnectionState</span><span class="p">,</span>
<span class="w">    </span><span class="n">Subnet</span>
<span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">PrivateEndpointName</span><span class="w"> </span><span class="n">asc</span>
</code></pre></div>

<p>Run this to see:<br />
- All private endpoints across all subscriptions<br />
- The private IP each one uses<br />
- The FQDN that needs DNS resolution<br />
- What resource it connects to</p>
<p>Export to CSV. Hand to AD team. They have everything needed to add records.</p>
<h2>The Handoff Process</h2>
<p><strong>Azure team creates private endpoint:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Private endpoint for storage account</span>
<span class="nv">$pe</span> <span class="p">=</span> <span class="nb">New-AzPrivateEndpoint</span> <span class="p">`</span>
    <span class="n">-Name</span> <span class="s2">&quot;pe-storage-prod&quot;</span> <span class="p">`</span>
    <span class="n">-ResourceGroupName</span> <span class="s2">&quot;rg-networking&quot;</span> <span class="p">`</span>
    <span class="n">-Location</span> <span class="s2">&quot;eastus&quot;</span> <span class="p">`</span>
    <span class="n">-Subnet</span> <span class="nv">$subnet</span> <span class="p">`</span>
    <span class="n">-PrivateLinkServiceConnection</span> <span class="nv">$connection</span> <span class="p">`</span>
    <span class="n">-PrivateDnsZone</span> <span class="nv">$azurePrivateDnsZone</span>

<span class="c"># Document what was created</span>
<span class="nv">$documentation</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="n">FQDN</span> <span class="p">=</span> <span class="s2">&quot;storage123.privatelink.blob.core.windows.net&quot;</span>
    <span class="n">PrivateIP</span> <span class="p">=</span> <span class="nv">$pe</span><span class="p">.</span><span class="n">CustomDnsConfigs</span><span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="n">IpAddresses</span><span class="p">[</span><span class="n">0</span><span class="p">]</span>
    <span class="n">TargetResource</span> <span class="p">=</span> <span class="s2">&quot;storage123 (storageAccounts)&quot;</span>
    <span class="n">Zone</span> <span class="p">=</span> <span class="s2">&quot;privatelink.blob.core.windows.net&quot;</span>
    <span class="n">CreatedDate</span> <span class="p">=</span> <span class="nb">Get-Date</span>
    <span class="n">CreatedBy</span> <span class="p">=</span> <span class="nv">$env:USERNAME</span>
<span class="p">}</span>

<span class="c"># Export for AD team</span>
<span class="nv">$documentation</span> <span class="p">|</span> <span class="nb">Export-Csv</span> <span class="n">-Path</span> <span class="s2">&quot;privateendpoint-handoff.csv&quot;</span> <span class="n">-Append</span>
</code></pre></div>

<p><strong>AD team adds record to on-prem DNS:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Add A record to on-prem AD DNS</span>
<span class="nb">Add-DnsServerResourceRecordA</span> <span class="p">`</span>
    <span class="n">-ZoneName</span> <span class="s2">&quot;privatelink.blob.core.windows.net&quot;</span> <span class="p">`</span>
    <span class="n">-Name</span> <span class="s2">&quot;storage123&quot;</span> <span class="p">`</span>
    <span class="n">-IPv4Address</span> <span class="s2">&quot;10.5.2.45&quot;</span> <span class="p">`</span>
    <span class="n">-ComputerName</span> <span class="s2">&quot;dc01.contoso.com&quot;</span>
</code></pre></div>

<p>Done. Azure resolves through Azure Private DNS. On-prem resolves through AD DNS. No forwarders needed.</p>
<h2>What About DNS Synchronization?</h2>
<p>"But what if DNS records get out of sync?"</p>
<p>Valid concern. Here's how we handle it:</p>
<p><strong>Private endpoint lifecycle is tied to tickets:</strong><br />
- Private endpoint creation = deployment ticket<br />
- Ticket includes DNS record addition<br />
- Private endpoint deletion = change ticket<br />
- Ticket includes DNS record removal</p>
<p><strong>If records drift:</strong><br />
- Resource Graph query shows truth (what exists in Azure)<br />
- Compare against AD DNS records<br />
- Remediate discrepancies during change windows</p>
<p><strong>Automation option:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Weekly sync check (read-only)</span>
<span class="nv">$azureEndpoints</span> <span class="p">=</span> <span class="nb">Get-AzPrivateEndpoint</span> <span class="n">-ResourceGroupName</span> <span class="p">*</span> <span class="p">|</span> 
    <span class="nb">Select-Object</span> <span class="n">Name</span><span class="p">,</span> <span class="p">@{</span><span class="n">N</span><span class="p">=</span><span class="s1">&#39;FQDN&#39;</span><span class="p">;</span><span class="n">E</span><span class="p">={</span><span class="nv">$_</span><span class="p">.</span><span class="n">CustomDnsConfigs</span><span class="p">.</span><span class="n">Fqdn</span><span class="p">}},</span> 
                  <span class="p">@{</span><span class="n">N</span><span class="p">=</span><span class="s1">&#39;IP&#39;</span><span class="p">;</span><span class="n">E</span><span class="p">={</span><span class="nv">$_</span><span class="p">.</span><span class="n">CustomDnsConfigs</span><span class="p">.</span><span class="n">IpAddresses</span><span class="p">}}</span>

<span class="nv">$adRecords</span> <span class="p">=</span> <span class="nb">Get-DnsServerResourceRecord</span> <span class="n">-ZoneName</span> <span class="s2">&quot;privatelink.blob.core.windows.net&quot;</span> <span class="n">-ComputerName</span> <span class="s2">&quot;dc01&quot;</span>

<span class="c"># Compare and report drift</span>
<span class="nb">Compare-Object</span> <span class="nv">$azureEndpoints</span> <span class="nv">$adRecords</span> <span class="n">-Property</span> <span class="n">FQDN</span><span class="p">,</span> <span class="n">IP</span>
</code></pre></div>

<p>Run weekly. Email discrepancies. Fix during next change window.</p>
<p>Not real-time. Not fully automated. But sufficient for controlled enterprise environments.</p>
<h2>Why Microsoft Doesn't Document This</h2>
<p>Microsoft's private endpoint DNS documentation assumes:<br />
- Greenfield deployments (no legacy infrastructure)<br />
- Automation-first mindset (minimal manual processes)<br />
- Single team managing both Azure and networking<br />
- Scale requires real-time synchronization</p>
<p>Enterprise reality:<br />
- Legacy AD infrastructure already in place<br />
- Change control processes are acceptable<br />
- Separate teams with clear boundaries<br />
- Controlled deployments, not constant churn</p>
<p>Microsoft can't document every enterprise pattern. Their docs cover the general case.</p>
<p>This pattern is the enterprise-specific case.</p>
<h2>The Bottom Line</h2>
<p>We've managed over 1,000 private endpoints over several years using duplicated DNS zones.</p>
<p>Azure team creates endpoints. AD team maintains on-prem DNS records. No forwarders. No Azure Private Resolver. No shared infrastructure.</p>
<p>Time investment: Manageable within existing change control workflows.</p>
<p>Alternative (Microsoft's way): Deploy Azure Private Resolver, configure conditional forwarders, train both teams on new architecture, troubleshoot DNS forwarding issues, maintain shared infrastructure.</p>
<p>For us, duplicating zones is simpler.</p>
<p>If you have existing AD DNS infrastructure and controlled deployment processes, it might be simpler for you too.</p>
<p>Not what Microsoft documents. But it works.</p>
<hr />
<h2>Resource Graph Queries</h2>
<p><strong>Count private endpoints by subscription:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">Resources</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;microsoft.network/privateendpoints&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">summarize</span><span class="w"> </span><span class="n">Count</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">count</span><span class="p">()</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">subscriptionId</span>
<span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">Count</span><span class="w"> </span><span class="n">desc</span>
</code></pre></div>

<p><strong>Find private endpoints by resource type:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">Resources</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;microsoft.network/privateendpoints&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">TargetType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">split</span><span class="p">(</span><span class="n">properties</span><span class="err">.</span><span class="n">privateLinkServiceConnections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="err">.</span><span class="n">properties</span><span class="err">.</span><span class="n">privateLinkServiceId</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="mi">7</span><span class="p">]</span>
<span class="p">|</span><span class="w"> </span><span class="k">summarize</span><span class="w"> </span><span class="n">Count</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">count</span><span class="p">()</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">TargetType</span>
<span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">Count</span><span class="w"> </span><span class="n">desc</span>
</code></pre></div>

<p><strong>List all privatelink DNS zones needed:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">Resources</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;microsoft.network/privateendpoints&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">FQDN</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">properties</span><span class="err">.</span><span class="n">customDnsConfigs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="err">.</span><span class="n">fqdn</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">Zone</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">substring</span><span class="p">(</span><span class="n">FQDN</span><span class="p">,</span><span class="w"> </span><span class="n">indexof</span><span class="p">(</span><span class="n">FQDN</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="p">|</span><span class="w"> </span><span class="k">summarize</span><span class="w"> </span><span class="n">EndpointCount</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">count</span><span class="p">()</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">Zone</span>
<span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">EndpointCount</span><span class="w"> </span><span class="n">desc</span>
</code></pre></div>

<p>Use these to understand what DNS zones you actually need before creating them.</p>
<hr />
<p><em>Managing hybrid Azure environments? Check out our <a href="/blog/azure-ipam-tool/">Azure IPAM Tool</a> for cross-subscription IP visibility, or our <a href="/blog/it-roles-responsibilities-matrix/">CAF Roles Matrix</a> for practical Azure governance.</em></p>
  </div>

  
  <section class="starter-kit-callout" style="
    max-width: 800px;
    margin: 3rem auto 2rem;
    padding: 2rem;
    border-radius: 12px;
    background: var(--bg-light);
    border: 1px solid var(--border);
    text-align: left;
  ">
    <h3 style="margin-top: 0;">Azure Admin Starter Kit (Free Download)</h3>
    <p style="margin-bottom: 1rem;">
      Get my KQL cheat sheet, 50 Windows + 50 Linux commands, and an Azure RACI template in one free bundle.
    </p>
    <a href="/blog/starter-kit/" class="btn">Get the Starter Kit ‚Üí</a>
  </section>

  
  <aside class="email-capture" style="max-width: 800px; margin: 4rem auto; padding: 3rem; background: linear-gradient(135deg, #0078d4 0%, #005a9e 100%); border-radius: 12px; text-align: center; color: white;">
    <h3 style="margin-top: 0; color: white; font-size: 1.75rem;">Get Azure operational guides in your inbox</h3>
    <p style="margin: 1rem 0 2rem; font-size: 1.1rem; color: white;">Weekly tips from managing 44 Azure subscriptions. No marketing BS.</p>
    
    <form action="https://app.kit.com/forms/8896829/subscriptions" method="post" style="max-width: 500px; margin: 0 auto; display: flex; gap: 0.75rem; flex-wrap: wrap; justify-content: center;">
      <input type="email" 
             name="email_address" 
             placeholder="your@email.com" 
             required 
             style="flex: 1; min-width: 250px; padding: 0.875rem 1rem; border: none; border-radius: 8px; font-size: 1rem; color: #333;">
      <button type="submit" 
              style="padding: 0.875rem 2rem; background: white; color: #0078d4; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; white-space: nowrap; font-size: 1rem; transition: all 0.2s;">
        Subscribe
      </button>
    </form>
    
    <p style="margin: 1.5rem 0 0; font-size: 0.9rem; opacity: 0.9; color: white;">
      Join 500+ Azure admins. Unsubscribe anytime.
    </p>
  </aside>

  
  
  <aside class="related-posts" style="max-width: 800px; margin: 3rem auto; padding: 2rem; background: var(--bg-light); border-radius: 12px;">
    <h3 style="margin-top: 0;">Related Posts</h3>
    <ul style="list-style: none; padding: 0;">
      
      <li style="margin: 1rem 0;">
        <a href="/blog/azure-osi-model-for-admins" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">The OSI Model for Azure Admins: How to Troubleshoot the Cloud Like a Network Engineer</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-11-03</span>
        </a>
      </li>
      
      <li style="margin: 1rem 0;">
        <a href="/blog/azure-finops-complete-guide" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">Azure FinOps 2025: The 31,000 Resource Guide to Cost Accountability</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-12-10</span>
        </a>
      </li>
      
      <li style="margin: 1rem 0;">
        <a href="/blog/starter-kit" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">Azure Admin Starter Kit (Free Download)</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-12-10</span>
        </a>
      </li>
      
    </ul>
  </aside>
  

  
  
  
    <!-- CTA: General Email Capture (KIT INLINE FORM) -->
<div class="cta-block" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: 2rem; border-radius: 12px; margin: 3rem 0; text-align: center; color: white;">
  <h3 style="margin: 0 0 0.5rem; font-size: 1.5rem; color: white;">Get Azure operational guides in your inbox</h3>
  <p style="margin: 0 0 1.5rem; font-size: 1rem; line-height: 1.5; color: white;">
    Weekly tips from managing 44 Azure subscriptions. No marketing BS.
  </p>
  
  <!-- Kit inline form - no JavaScript conflicts -->
  <form action="https://app.kit.com/forms/7867186/subscriptions" method="post" style="max-width: 500px; margin: 0 auto; display: flex; gap: 0.5rem; flex-wrap: wrap; justify-content: center;">
    <input type="email" 
           name="email_address" 
           placeholder="your@email.com" 
           required 
           style="flex: 1; min-width: 250px; padding: 0.75rem 1rem; border: none; border-radius: 6px; font-size: 1rem; color: #333;">
    <button type="submit" 
            style="padding: 0.75rem 1.5rem; background: white; color: #4facfe; border: none; border-radius: 6px; font-weight: 700; cursor: pointer; white-space: nowrap; font-size: 1rem;">
      Subscribe
    </button>
  </form>
  
  <p style="margin: 1rem 0 0; font-size: 0.85rem; opacity: 0.9; color: white;">
    Join 500+ Azure admins. Unsubscribe anytime.
  </p>
</div>
  

  
  <nav class="post-nav">
    
      <a href="/blog/stop-reading-caf">
        <span style="opacity: 0.7; font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">‚Üê Previous</span>
        <strong>Azure Cloud Adoption Framework Explained: 3 Layers That Actually Matter</strong>
      </a>
    
    
      <a href="/blog/onenote-azure-admin-tool" style="text-align: right;">
        <span style="opacity: 0.7; font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">Next ‚Üí</span>
        <strong>OneNote: The Azure Admin Tool Nobody Tells You About</strong>
      </a>
    
  </nav>

</article>

    </div>
  </main>

  <footer class="site-footer">
    <div class="wrap">
      <p>&copy; 2025 Azure Noob ‚Äî Don&#39;t be a Noob</p>
      <p style="margin-top: 0.5rem; font-size: 0.9rem;">
        <a href="/rss.xml" title="Subscribe via RSS">RSS Feed</a> ¬∑ 
        <a href="https://github.com/dswann101164" target="_blank" rel="noopener">GitHub</a>
      </p>
      <p style="margin-top: 1.5rem; font-size: 0.85rem; opacity: 0.7; font-style: italic;">
        "Trust in the Lord with all your heart, and lean not on your own understanding;<br>
        in all your ways acknowledge Him, and He will make your paths straight" ‚Äî Proverbs 3:5-6
      </p>
    </div>
  </footer>

  <!-- Copy code functionality -->
  <script src="/static/copy-code.js"></script>

  <!-- Exit-Intent Popup -->
  <div id="exit-popup" class="exit-popup" style="display: none;">
    <div class="exit-popup-content">
      <button class="exit-popup-close" onclick="closeExitPopup()">&times;</button>
      <h2>Wait! Before You Go...</h2>
      <p class="exit-popup-subtitle">Get the <strong>FREE Azure Admin Starter Kit</strong></p>
      <ul class="exit-popup-benefits">
        <li>‚úì 15 Essential KQL Queries</li>
        <li>‚úì 50 Windows Commands</li>
        <li>‚úì 50 Linux Commands</li>
      </ul>
      <form id="exit-popup-form" class="exit-popup-form">
        <input type="email" id="popup-email" placeholder="Enter your email" required>
        <button type="submit" class="exit-popup-submit">Send Me The Free Kit</button>
      </form>
      <p class="exit-popup-privacy">We'll also notify you about new tools & guides. Unsubscribe anytime.</p>
    </div>
  </div>

  <style>
  .exit-popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .exit-popup-content {
    background: white;
    padding: 2.5rem;
    border-radius: 12px;
    max-width: 500px;
    width: 90%;
    position: relative;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: slideUp 0.3s ease;
  }

  @keyframes slideUp {
    from { transform: translateY(50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .exit-popup-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    font-size: 2rem;
    cursor: pointer;
    color: #999;
    line-height: 1;
  }

  .exit-popup-close:hover {
    color: #333;
  }

  .exit-popup h2 {
    margin: 0 0 0.5rem 0;
    color: #0078d4;
    font-size: 2rem;
  }

  .exit-popup-subtitle {
    font-size: 1.2rem;
    margin: 0 0 1.5rem 0;
  }

  .exit-popup-benefits {
    list-style: none;
    padding: 0;
    margin: 1.5rem 0;
  }

  .exit-popup-benefits li {
    padding: 0.5rem 0;
    font-size: 1.1rem;
  }

  .exit-popup-form {
    margin: 1.5rem 0;
  }

  .exit-popup-form input[type="email"] {
    width: 100%;
    padding: 1rem;
    border: 2px solid #ddd;
    border-radius: 6px;
    font-size: 1rem;
    margin-bottom: 1rem;
  }

  .exit-popup-form input[type="email"]:focus {
    outline: none;
    border-color: #0078d4;
  }

  .exit-popup-submit {
    width: 100%;
    padding: 1rem 2rem;
    background: #0078d4;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 1.1rem;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s;
  }

  .exit-popup-submit:hover {
    background: #005a9e;
  }

  .exit-popup-privacy {
    font-size: 0.85rem;
    color: #666;
    margin-top: 1rem;
    text-align: center;
  }
  </style>

  <script>
  // Exit-intent detection
  let exitPopupShown = false;
  let mouseY = 0;

  document.addEventListener('mousemove', (e) => {
    mouseY = e.clientY;
  });

  document.addEventListener('mouseout', (e) => {
    // If mouse leaves through top of viewport and popup hasn't been shown
    if (!exitPopupShown && e.clientY <= 0 && mouseY <= 100) {
      // Check if user has seen it before (session storage)
      if (!sessionStorage.getItem('exitPopupSeen')) {
        showExitPopup();
      }
    }
  });

  function showExitPopup() {
    exitPopupShown = true;
    document.getElementById('exit-popup').style.display = 'flex';
    sessionStorage.setItem('exitPopupSeen', 'true');
  }

  function closeExitPopup() {
    document.getElementById('exit-popup').style.display = 'none';
  }

  // Handle form submission
  document.getElementById('exit-popup-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('popup-email').value;
    
    // Send to Kit (ConvertKit)
    try {
      const FORM_ID = '8896829'; // Your Kit Form ID
      
      const response = await fetch(`https://api.convertkit.com/v3/forms/${FORM_ID}/subscribe`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          email: email
        })
      });
      
      if (response.ok) {
        console.log('‚úÖ Email captured to Kit:', email);
      }
      
      closeExitPopup();
      
      // Track in Google Analytics
      if (typeof gtag !== 'undefined') {
        gtag('event', 'signup', {
          'event_category': 'email',
          'event_label': 'exit_popup',
          'value': email
        });
      }
      
      // Redirect to starter kit page
      window.location.href = '/blog/starter-kit/';
      
    } catch (error) {
      console.error('Error:', error);
      // Still redirect even if tracking fails
      window.location.href = '/blog/starter-kit/';
    }
  });

  // Close on background click
  document.getElementById('exit-popup').addEventListener('click', (e) => {
    if (e.target.id === 'exit-popup') {
      closeExitPopup();
    }
  });
  </script>
</body>
</html>