<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  

  <!-- Primary SEO -->
  <title>Azure Arc Ghost Registrations: Why 64% of My Arc Inventory Doesn&#39;t Exist ¬∑ Azure Noob</title>
  <meta name="description" content="How Azure Arc ghost registrations happen, why they wreck governance reporting, and how to detect and clean them up at scale.">
  
  <link rel="canonical" href="https://azure-noob.com/blog/azure-arc-ghost-registrations" />

  <!-- Favicons -->
  <link rel="icon" href="/static/images/logo.png">

  <!-- Open Graph -->
  <meta property="og:title" content="Azure Arc Ghost Registrations: Why 64% of My Arc Inventory Doesn&#39;t Exist">
  <meta property="og:description" content="How Azure Arc ghost registrations happen, why they wreck governance reporting, and how to detect and clean them up at scale.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://azure-noob.com/blog/azure-arc-ghost-registrations">
  <meta property="og:image" content="https://azure-noob.com/static/images/hero/azure-arc-ghost-registrations.png">

  
    <meta property="article:published_time" content="2025-12-06T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-12-06T00:00:00+00:00">
    <meta property="article:author" content="David Swann">
    
      
        <meta property="article:tag" content="Azure">
      
        <meta property="article:tag" content="Azure Arc">
      
        <meta property="article:tag" content="Ghost Registrations">
      
        <meta property="article:tag" content="Governance">
      
        <meta property="article:tag" content="Hybrid">
      
        <meta property="article:tag" content="Inventory">
      
        <meta property="article:tag" content="Power BI">
      
        <meta property="article:tag" content="Reconciliation">
      
        <meta property="article:tag" content="VMware">
      
    
  

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Azure Arc Ghost Registrations: Why 64% of My Arc Inventory Doesn&#39;t Exist">
  <meta name="twitter:description" content="How Azure Arc ghost registrations happen, why they wreck governance reporting, and how to detect and clean them up at scale.">
  <meta name="twitter:image" content="https://azure-noob.com/static/images/hero/azure-arc-ghost-registrations.png">

  <!-- Styles -->
  <link rel="stylesheet" href="/static/styles.css">

  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="Azure Noob RSS Feed" href="https://azure-noob.com/rss.xml">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZNHGEB0BNZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-ZNHGEB0BNZ');
  </script>
</head>
<body>
  <header class="site-header">
    <div class="wrap nav-wrap">
      <div class="brand-block">
        <a href="/" class="brand-link">
          <img src="/static/images/logo.png" alt="Azure Noob logo" class="logo">
        </a>
        <span class="brand-text">
          <small>Official Website of</small>
          <strong>Azure Noob</strong>
        </span>
      </div>
      <nav class="nav">
        <a href="/">Home</a>
        <a href="/blog/">Blog</a>
        <a href="/hubs/" style="font-weight: 700;">Content Hubs</a>
        <a href="/products" style="font-weight: 700; color: #ff6b6b;">Products</a>
        <a href="/start-here">Start Here</a>
        <a href="/blog/starter-kit/">Starter Kit</a>
        <a href="/about">About</a>
        <a href="/tags/">Tags</a>
        <a href="https://github.com/dswann101164" target="_blank" rel="noopener">GitHub</a>
        <a href="/search">Search</a>
      </nav>
    </div>
  </header>

  <main class="site-content">
    <div class="wrap">
      


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Azure Arc Ghost Registrations: Why 64% of My Arc Inventory Doesn&#39;t Exist",
  "description": "How Azure Arc ghost registrations happen, why they wreck governance reporting, and how to detect and clean them up at scale.",
  "image": {
    "@type": "ImageObject",
    "url": "https://azure-noob.com/static/images/hero/azure-arc-ghost-registrations.png",
    "width": 1200,
    "height": 630
  },
  "author": {
    "@type": "Person",
    "name": "David Swann",
    "url": "https://azure-noob.com/about/",
    "description": "Azure Architect specializing in enterprise cloud infrastructure",
    "jobTitle": "Azure Architect",
    "worksFor": {
      "@type": "Organization",
      "name": "Synovus"
    }
  },
  "publisher": {
    "@type": "Organization",
    "name": "Azure Noob",
    "url": "https://azure-noob.com",
    "logo": {
      "@type": "ImageObject",
      "url": "https://azure-noob.com/static/images/logo.png"
    }
  },
  "datePublished": "2025-12-06T00:00:00+00:00",
  "dateModified": "2025-12-06T00:00:00+00:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://azure-noob.com/blog/azure-arc-ghost-registrations"
  },
  "keywords": "Azure, Azure Arc, Ghost Registrations, Governance, Hybrid, Inventory, Power BI, Reconciliation, VMware",
  "articleSection": "Azure",
  "wordCount": "3650",
  "timeRequired": "PT18M",
  "inLanguage": "en-US",
  "isAccessibleForFree": "True",
  "about": {
    "@type": "Thing",
    "name": "Azure"
  }
}
</script>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://azure-noob.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": "https://azure-noob.com/blog/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Azure Arc Ghost Registrations: Why 64% of My Arc Inventory Doesn&#39;t Exist",
      "item": "https://azure-noob.com/blog/azure-arc-ghost-registrations"
    }
  ]
}
</script>






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "What are Azure Arc ghost registrations?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Azure Arc ghost registrations are Arc-enabled server records in Azure that represent VMs or physical servers that no longer exist in your on-premises environment. Common causes: (1) VM deleted from VMware vCenter without uninstalling Arc agent first, (2) Physical server decommissioned without Azure cleanup, (3) VM snapshot restored to earlier state before Arc registration, (4) VM template cloned without proper sysprep creating duplicate registrations. Ghost registrations typically account for 40-70% of Arc inventory in enterprises using manual agent deployment. These phantom machines distort governance reporting, inflate license counts, trigger false security alerts, and waste Azure Policy evaluation cycles. Azure Arc Resource Bridge with vCenter integration prevents ghost registrations by automatically removing Arc records when VMs are deleted from vCenter."
      }
    },
    {
      "@type": "Question",
      "name": "How do I detect Azure Arc ghost registrations?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Detect Arc ghost registrations by reconciling Azure Arc inventory against source systems: (1) Export Arc inventory via KQL query: Resources | where type == 'microsoft.hybridcompute/machines' | project name, resourceGroup, location. (2) Export VMware inventory using RVTools or PowerCLI Get-VM cmdlet. (3) Compare lists to identify Arc machines not in VMware (ghosts) and VMware VMs not in Arc (missing coverage). (4) Check Arc heartbeat status - machines showing 'Disconnected' for 30+ days are likely ghosts. (5) Validate DNS resolution - ghost machines often have stale DNS records or unreachable IP addresses. Automated reconciliation using Python or PowerShell should run monthly. Expected ghost rate: 10-15% normal churn, 40-70% indicates systemic cleanup issues. Power BI dashboards can visualize Arc vs VMware discrepancies for ongoing monitoring."
      }
    },
    {
      "@type": "Question",
      "name": "Why does manual Azure Arc agent deployment create ghost registrations?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Manual Arc agent deployment creates ghost registrations because Azure has no visibility into VMware/Hyper-V lifecycle events. When you install Arc agents via script deployment, Azure creates Arc-enabled server records in your subscription. When a VM admin deletes that VM from vCenter, VMware removes the VM but Azure has no automatic mechanism to delete the corresponding Arc record. The Arc agent cannot send a 'delete me' signal because the VM (and agent) no longer exists. This architectural gap affects ALL manual Arc deployments: GPO-based rollouts, Intune deployment, PowerShell scripts, and configuration management tools. Azure Arc Resource Bridge solves this by integrating directly with vCenter APIs - when you delete a VM in vCenter, Resource Bridge automatically removes the Arc record within 5-10 minutes. Migration from manual agents to Resource Bridge reduces ghost registration rate from 64% to under 5%."
      }
    },
    {
      "@type": "Question",
      "name": "How do I clean up Azure Arc ghost registrations at scale?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Clean up Arc ghost registrations using this four-step process: (1) Identify candidates: Query Arc machines with Disconnected status for 30+ days or machines not in VMware reconciliation. (2) Validate ghosts: Attempt DNS resolution and ping test - if unreachable and not in VMware, mark for deletion. (3) Document for audit: Export list with machine name, last heartbeat, resource group, subscription before deletion. (4) Bulk delete: Use PowerShell Remove-AzConnectedMachine or Azure CLI 'az connectedmachine delete' in batches of 50-100. Critical: Don't delete recently disconnected machines (under 30 days) - these might be legitimately offline for patching or network issues. Keep deletion logs for compliance audits. Expected cleanup: 200-400 ghost registrations in environments with 500-1000 on-premises machines. Re-run reconciliation monthly to prevent ghost accumulation. Post-cleanup, implement Azure Arc Resource Bridge to prevent future ghosts."
      }
    },
    {
      "@type": "Question",
      "name": "What is Azure Arc Resource Bridge and how does it prevent ghost registrations?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Azure Arc Resource Bridge is a Kubernetes-based appliance deployed in your VMware or Hyper-V environment that provides bidirectional synchronization between Azure and on-premises virtualization platforms. For VMware, Resource Bridge connects to vCenter APIs and monitors VM lifecycle events (create, modify, delete). When you delete a VM in vCenter, Resource Bridge automatically: (1) Detects the vCenter deletion event within seconds, (2) Removes the corresponding Arc-enabled server record from Azure within 5-10 minutes, (3) Cleans up associated Azure resources like extensions and tags. This eliminates ghost registrations at the source. Resource Bridge also auto-discovers new VMs and provides Azure Portal VM management (start/stop/resize) directly from Azure. Trade-offs: Resource Bridge requires dedicated appliance resources (8 vCPU, 24GB RAM), vCenter 6.7+ or Hyper-V 2019+, and network connectivity between Azure and vCenter. Migration from manual agents to Resource Bridge is non-disruptive and reduces ghost registration rate from 40-70% to under 5%."
      }
    },
    {
      "@type": "Question",
      "name": "How often should I reconcile Azure Arc inventory with on-premises systems?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Reconcile Azure Arc inventory monthly as minimum best practice, with weekly reconciliation recommended for dynamic environments (high VM churn, frequent provisioning/decommissioning). Reconciliation frequency depends on: (1) VM lifecycle velocity - environments creating/deleting 50+ VMs per month need weekly checks, (2) Compliance reporting requirements - SOC 2 and ISO 27001 audits expect accurate inventory, (3) Azure Policy impact - ghost registrations trigger false policy violations, (4) Cost optimization - Arc-enabled servers incur per-machine costs regardless of heartbeat status. Automated reconciliation process: Export Arc inventory via KQL, export VMware inventory via RVTools or PowerCLI, compare datasets programmatically, generate remediation list, review with infrastructure team, execute bulk deletions. Store reconciliation results in SharePoint or Git for audit trail. Expected time investment: 2-4 hours per month for 1000-VM environment. Automation reduces this to 30 minutes. Post-Resource Bridge implementation, reduce reconciliation to quarterly validation."
      }
    }
  ]
}
</script>


<article class="post">

  
  
    
    <div class="hero">
      <img src="/static/images/hero/azure-arc-ghost-registrations.png" alt="Azure Arc Ghost Registrations: Why 64% of My Arc Inventory Doesn&#39;t Exist" loading="eager">
    </div>
  

  <header class="post-header">
    <h1>Azure Arc Ghost Registrations: Why 64% of My Arc Inventory Doesn&#39;t Exist</h1>
    <p class="muted">
      2025-12-06 ¬∑ ~18 min read
      
    </p>
    
    
    <ul class="tags-list">
      
      <li><a href="/tags/Azure" class="tag-badge">Azure</a></li>
      
      <li><a href="/tags/Azure%20Arc" class="tag-badge">Azure Arc</a></li>
      
      <li><a href="/tags/Ghost%20Registrations" class="tag-badge">Ghost Registrations</a></li>
      
      <li><a href="/tags/Governance" class="tag-badge">Governance</a></li>
      
      <li><a href="/tags/Hybrid" class="tag-badge">Hybrid</a></li>
      
      <li><a href="/tags/Inventory" class="tag-badge">Inventory</a></li>
      
      <li><a href="/tags/Power%20BI" class="tag-badge">Power BI</a></li>
      
      <li><a href="/tags/Reconciliation" class="tag-badge">Reconciliation</a></li>
      
      <li><a href="/tags/VMware" class="tag-badge">VMware</a></li>
      
    </ul>
    
    
    
      <p class="summary">How Azure Arc ghost registrations happen, why they wreck governance reporting, and how to detect and clean them up at scale.</p>
    
  </header>

  
  <p class="post-actions" style="margin:.5rem 0 0; text-align: center;">
    <button class="btn"
            onclick="window.print(); return false;"
            title="Print this page"
            aria-label="Print this page"
            style="cursor: pointer; background: none; border: 2px solid var(--azure-blue);">
      üñ®Ô∏è Print this page
    </button>
  </p>

  
  <div class="post-body">
    <p>This guide is part of our <a href="/hub/kql/">KQL Mastery hub</a> covering query patterns, optimization techniques, and real-world Azure Resource Graph examples.</p>
<h1>Azure Arc Ghost Registrations: Why 64% of My Arc Inventory Doesn't Exist</h1>
<p>I ran a reconciliation between Azure Arc and our VMware environment using RVTools. The results were shocking: <strong>64% of our Arc inventory consisted of ghost registrations for VMs that no longer exist.</strong></p>
<p>This isn't an operational failure. It's an architectural limitation that affects every enterprise using manual Arc agent deployment.</p>
<p>Here's what I found, why it happens, and how Microsoft's Arc Resource Bridge solves it.</p>
<hr />
<h2>The Reconciliation Results</h2>
<p><strong>Azure Arc Inventory:</strong><br />
- 467 registered machines<br />
- Single subscription and resource group</p>
<p><strong>VMware Reality (via RVTools):</strong><br />
- 1,017 VMs across 3 vCenters<br />
- Production: 587 VMs<br />
- Non-Production: 374 VMs<br />
- Lab: 56 VMs</p>
<p><strong>The Gap:</strong><br />
- <strong>300 Arc registrations = Ghost VMs</strong> (machines deleted from VMware but still registered in Arc)<br />
- <strong>850 VMware VMs = Missing from Arc</strong> (machines created after Arc deployment)<br />
- <strong>167 VMs matched</strong> (16.4% actual coverage)</p>
<p>64% of my Arc inventory was fake.</p>
<hr />
<h2>Why This Happens: Static vs Dynamic Registration</h2>
<p>The root cause is simple: <strong>manual Arc agent deployment creates a static snapshot, not a dynamic sync.</strong></p>
<h3>The Static Registration Model (Pre-November 2023)</h3>
<p>Before Microsoft introduced Arc Resource Bridge, the only way to onboard VMware VMs to Azure Arc was manual agent installation:</p>
<ol>
<li>Administrator logs into VM (RDP/SSH)</li>
<li>Downloads Arc agent installer</li>
<li>Runs installation script</li>
<li>Arc agent registers with Azure</li>
<li>VM appears in Azure Arc inventory</li>
</ol>
<p><strong>This creates a point-in-time snapshot.</strong></p>
<p>The Arc agent knows nothing about vCenter. When VMs are created, deleted, renamed, or migrated in VMware, Arc doesn't know:</p>
<table>
<thead>
<tr>
<th>VMware Event</th>
<th>Arc Result (Static)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>VM Created</strong></td>
<td>‚ùå Never appears in Arc</td>
</tr>
<tr>
<td><strong>VM Deleted</strong></td>
<td>‚ùå Ghost registration stays</td>
</tr>
<tr>
<td><strong>VM Renamed</strong></td>
<td>‚ùå Arc keeps old name</td>
</tr>
<tr>
<td><strong>VM Migrated</strong></td>
<td>‚ùå Arc shows wrong location</td>
</tr>
<tr>
<td><strong>VM Powered Off</strong></td>
<td>‚ö†Ô∏è May appear as "Disconnected"</td>
</tr>
</tbody>
</table>
<p><strong>Your Arc inventory freezes on installation day.</strong></p>
<hr />
<h2>My Environment: Proof of Static Drift</h2>
<p>I deployed Arc agents approximately 6-8 months ago. Since then:</p>
<p><strong>VMs Created (Never Got Arc):</strong><br />
- 850 VMs added to VMware environment<br />
- None automatically onboarded to Arc<br />
- Arc coverage: 16.4%</p>
<p><strong>VMs Deleted (Became Ghosts):</strong><br />
- 300 VMs decommissioned from VMware<br />
- Arc registrations never cleaned up<br />
- Ghost rate: 64% of Arc inventory</p>
<p><strong>VMs with Expired Agents:</strong><br />
- 285 Arc agents expired (61% of registered VMs)<br />
- No automatic updates<br />
- Manual intervention required for each</p>
<p><strong>Cost Allocation Disaster:</strong><br />
- All Arc VMs in one resource group<br />
- No tags for cost center allocation<br />
- Finance can't track ESU spending by application</p>
<hr />
<h2>The Power BI Dashboard: Visualizing the Gap</h2>
<p>I built a Power BI dashboard to reconcile Arc inventory against VMware reality:</p>
<p><strong>Data Sources:</strong><br />
1. <strong>RVTools Export</strong> - Production, Non-Prod, and Lab vCenters<br />
2. <strong>Azure Resource Graph</strong> - Arc machine inventory<br />
3. <strong>Azure Arc API</strong> - Agent status and versions</p>
<p><strong>Key Measures:</strong></p>
<div class="codehilite"><pre><span></span><code>Total VMs = COUNTROWS(master)
Arc Coverage % = DIVIDE([VMs With Arc], [Total VMs], 0)
Ghost VMs = CALCULATE(COUNTROWS(arc_machines), 
<span class="w">    </span><span class="nf">ISBLANK</span><span class="p">(</span><span class="nf">RELATED</span><span class="p">(</span><span class="na">master[VM]</span><span class="p">)))</span>
</code></pre></div>

<p><strong>KPI Cards:</strong><br />
- Total VMs: <strong>961</strong> (excluding templates)<br />
- VMs with Arc: <strong>167</strong> (17.4%)<br />
- VMs without Arc: <strong>794</strong> (82.6%)<br />
- Ghost Registrations: <strong>300</strong> (64% of Arc inventory)<br />
- Server 2012 ESU Gap: <strong>78 VMs</strong> (37.5% at risk)</p>
<p>The dashboard exposed what Excel reconciliation hinted at: <strong>my Arc inventory was a lie.</strong></p>
<hr />
<h2>November 2023: Microsoft's Solution</h2>
<p>On <a href="https://techcommunity.microsoft.com/t5/azure-arc-blog/bring-azure-to-your-vmware-environment-announcing-ga-of-vmware/ba-p/3974305">November 9, 2023</a>, Microsoft announced general availability of <strong>Azure Arc-enabled VMware vSphere</strong>, introducing <strong>Arc Resource Bridge</strong> as the foundation for vCenter integration.</p>
<p>This fundamentally changed how Arc works with VMware.</p>
<h3>The Dynamic Registration Model (Arc Resource Bridge)</h3>
<p>Arc Resource Bridge is a virtual appliance that connects directly to vCenter Server:</p>
<div class="codehilite"><pre><span></span><code>vCenter (Source of Truth)
   ‚Üì
Arc Resource Bridge (Sync Engine)
   ‚Üì
Azure Arc (Always Current)
</code></pre></div>

<p>From Microsoft's <a href="https://learn.microsoft.com/en-us/azure/azure-arc/vmware-vsphere/overview">documentation</a>:</p>
<blockquote>
<p>"When a VMware vCenter Server is connected to Azure, an automatic discovery of the inventory of vSphere resources is performed. <strong>This inventory data is continuously kept in sync with the vCenter Server.</strong>"</p>
</blockquote>
<p><strong>Lifecycle events sync in real-time:</strong></p>
<table>
<thead>
<tr>
<th>VMware Event</th>
<th>Arc Result (Dynamic)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>VM Created</strong></td>
<td>‚úÖ Auto-registers in minutes</td>
</tr>
<tr>
<td><strong>VM Deleted</strong></td>
<td>‚úÖ Auto-deregisters from Azure</td>
</tr>
<tr>
<td><strong>VM Renamed</strong></td>
<td>‚úÖ Updates name in Azure</td>
</tr>
<tr>
<td><strong>VM Migrated</strong></td>
<td>‚úÖ Updates location metadata</td>
</tr>
<tr>
<td><strong>VM Powered Off</strong></td>
<td>‚úÖ Updates power state</td>
</tr>
</tbody>
</table>
<p><strong>Arc inventory stays synchronized with vCenter reality.</strong></p>
<hr />
<h2>Static vs Dynamic: The Key Difference</h2>
<h3>Installation Day (Both Models Look Identical)</h3>
<p><strong>Manual Arc Agents:</strong><br />
- 467 VMs in VMware<br />
- 467 Arc registrations<br />
- 100% coverage ‚úÖ</p>
<p><strong>Arc Resource Bridge:</strong><br />
- 467 VMs in VMware<br />
- 467 Arc registrations<br />
- 100% coverage ‚úÖ</p>
<h3>6 Months Later (Massive Divergence)</h3>
<p><strong>Manual Arc Agents (Static):</strong><br />
- 1,017 VMs in VMware (550 added)<br />
- 467 Arc registrations (unchanged)<br />
- 300 ghosts (deleted VMs)<br />
- 167 valid registrations (16.4% coverage) ‚ùå</p>
<p><strong>Arc Resource Bridge (Dynamic):</strong><br />
- 1,017 VMs in VMware<br />
- 1,017 Arc registrations (auto-synced)<br />
- 0 ghosts (auto-cleaned)<br />
- 1,017 valid registrations (100% coverage) ‚úÖ</p>
<p><strong>The gap grows daily with static registration.</strong></p>
<hr />
<h2>Why Most Enterprises Have This Problem</h2>
<p>If you deployed Arc using any of these methods, you have static registration:</p>
<ol>
<li><strong>Manual installation</strong> on individual VMs</li>
<li><strong>PowerShell scripts</strong> that ran once</li>
<li><strong>Group Policy</strong> that deployed agents</li>
<li><strong>SCCM/Intune packages</strong> for agent deployment</li>
<li><strong>Terraform/ARM templates</strong> that deployed agents</li>
</ol>
<p><strong>None of these maintain sync with vCenter.</strong></p>
<p>You took a snapshot on deployment day. Since then, your Arc inventory has diverged from reality.</p>
<hr />
<h2>The Cost of Static Registration</h2>
<h3>1. False Compliance Reporting</h3>
<p><strong>Server 2012 ESU Example:</strong><br />
- Arc shows 78 Server 2012 VMs without ESU<br />
- But 64% of Arc inventory is ghosts<br />
- Actual compliance status: Unknown</p>
<p>You're reporting on ghost inventory.</p>
<h3>2. Wasted Azure Spending</h3>
<p><strong>Arc agent costs:</strong><br />
- 300 ghost registrations √ó $X/month<br />
- Paying for machines that don't exist</p>
<p><strong>Extension costs:</strong><br />
- Azure Monitor agents on ghosts<br />
- Defender agents on ghosts<br />
- Update Management on ghosts</p>
<h3>3. Operational Overhead</h3>
<p><strong>Manual maintenance burden:</strong><br />
- 285 expired agents requiring updates<br />
- No automated lifecycle management<br />
- Monthly cleanup scripts required<br />
- Ghost detection and removal</p>
<h3>4. Lost Cost Allocation</h3>
<p><strong>Finance nightmare:</strong><br />
- All VMs in one resource group<br />
- No cost center tags<br />
- Can't allocate ESU costs by application<br />
- Chargeback impossible</p>
<hr />
<h2>Arc Resource Bridge: Technical Architecture</h2>
<h3>What Gets Deployed</h3>
<p><strong>Per vCenter Instance:</strong><br />
- Arc Resource Bridge (virtual appliance)<br />
- 4 vCPUs, 16 GB RAM, 100 GB disk<br />
- Deployed as OVA template<br />
- Runs on Linux (Microsoft-provided)</p>
<p><strong>Network Requirements:</strong><br />
- Outbound HTTPS (443) to Azure<br />
- Access to vCenter API (443)<br />
- No inbound access required<br />
- No guest OS credentials needed</p>
<h3>How It Works</h3>
<ol>
<li><strong>Connection Phase:</strong></li>
<li>Arc Resource Bridge deployed to vCenter</li>
<li>Connects using vCenter credentials</li>
<li>
<p>Creates Azure custom location</p>
</li>
<li>
<p><strong>Discovery Phase:</strong></p>
</li>
<li>Bridge queries vCenter API</li>
<li>Discovers all VMs, templates, networks, datastores</li>
<li>
<p>Projects inventory to Azure Arc</p>
</li>
<li>
<p><strong>Sync Phase (Continuous):</strong></p>
</li>
<li>Monitors vCenter events</li>
<li>Detects VM create/delete/modify</li>
<li>
<p>Updates Azure Arc in near real-time</p>
</li>
<li>
<p><strong>Lifecycle Management:</strong></p>
</li>
<li>VM created ‚Üí Auto-registers in Arc</li>
<li>VM deleted ‚Üí Auto-removes from Arc</li>
<li>VM renamed ‚Üí Updates Arc metadata</li>
<li>Tags synced: vCenter ‚Üí Azure</li>
</ol>
<hr />
<h2>Deployment Guide</h2>
<h3>Prerequisites</h3>
<p>Following Microsoft's <a href="https://learn.microsoft.com/en-us/azure/azure-arc/vmware-vsphere/quick-start-connect-vcenter-to-arc-using-script">deployment guide</a>:</p>
<p><strong>vCenter Requirements:</strong><br />
- vCenter Server 7.0 or higher<br />
- Account with privileges to:<br />
  - Read all inventory<br />
  - Deploy and update VMs<br />
- Resource pool: 16 GB RAM, 4 vCPUs minimum<br />
- Datastore: 100 GB free space</p>
<p><strong>Azure Requirements:</strong><br />
- Subscription with Owner/Contributor role<br />
- Resource group for Arc resources<br />
- Network connectivity to Azure</p>
<p><strong>Jump Box Setup:</strong></p>
<p>You'll need a Windows management VM to run the deployment script. I documented this setup in my <a href="https://azure-noob.com/blog/azure-arc-private-lab/">Azure Arc Private Lab post</a>.</p>
<p><strong>Quick jump box setup:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Install Azure CLI</span>
<span class="n">winget</span> <span class="n">install</span> <span class="n">-e</span> <span class="p">-</span><span class="n">-id</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">AzureCLI</span>

<span class="c"># Install PowerShell 7</span>
<span class="n">winget</span> <span class="n">install</span> <span class="p">-</span><span class="n">-id</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">Powershell</span> <span class="p">-</span><span class="n">-source</span> <span class="n">winget</span>

<span class="c"># Install Arc CLI extension</span>
<span class="n">az</span> <span class="n">extension</span> <span class="n">add</span> <span class="p">-</span><span class="n">-name</span> <span class="n">arcappliance</span>
<span class="n">az</span> <span class="n">extension</span> <span class="n">add</span> <span class="p">-</span><span class="n">-name</span> <span class="n">connectedvmware</span>

<span class="c"># Login to Azure</span>
<span class="n">az</span> <span class="n">login</span> <span class="p">-</span><span class="n">-use-device-code</span>
</code></pre></div>

<h3>Deployment Steps</h3>
<p><strong>1. Download Onboarding Script</strong></p>
<p>From Azure Portal:<br />
- Navigate to <strong>Azure Arc</strong><br />
- Select <strong>VMware vCenters</strong> (under Infrastructure)<br />
- Click <strong>Add</strong><br />
- Choose <strong>Create a new resource bridge</strong><br />
- Download the onboarding script</p>
<p><strong>2. Run Deployment Script</strong></p>
<p>From your jump box:</p>
<div class="codehilite"><pre><span></span><code><span class="c"># Set execution policy</span>
<span class="nb">Set-ExecutionPolicy</span> <span class="n">-Scope</span> <span class="k">Process</span> <span class="n">-ExecutionPolicy</span> <span class="n">Bypass</span>

<span class="c"># Run onboarding script</span>
<span class="p">.\</span><span class="n">resource-bridge-onboarding-script</span><span class="p">.</span><span class="n">ps1</span>
</code></pre></div>

<p><strong>3. Provide Configuration</strong></p>
<p>Script will prompt for:<br />
- vCenter FQDN/IP<br />
- vCenter username/password<br />
- Resource pool selection<br />
- Network selection<br />
- Datastore selection<br />
- IP address range for appliance</p>
<p><strong>4. Wait for Deployment</strong></p>
<p>The script will:<br />
- Download Arc Resource Bridge OVA<br />
- Upload to vCenter<br />
- Deploy appliance VM<br />
- Configure networking<br />
- Connect to Azure<br />
- Begin inventory discovery</p>
<p><strong>Timeline:</strong> 30-60 minutes depending on network speed.</p>
<p><strong>5. Validate Deployment</strong></p>
<p>Check Azure Portal:<br />
- Arc Resource Bridge resource created<br />
- Custom location created<br />
- vCenter resource created<br />
- VM inventory begins appearing</p>
<hr />
<h2>Migration Strategy: Static to Dynamic</h2>
<h3>Week 1: Deploy Arc Resource Bridge</h3>
<p><strong>Per vCenter Instance:</strong><br />
1. Deploy Arc Resource Bridge (Production)<br />
2. Deploy Arc Resource Bridge (Non-Production)<br />
3. Deploy Arc Resource Bridge (Lab)<br />
4. Validate connectivity to each vCenter</p>
<p><strong>Validation:</strong><br />
- Bridge appliance VM running in vCenter<br />
- Bridge status "Online" in Azure Portal<br />
- Custom location created successfully</p>
<h3>Week 2: Sync and Compare</h3>
<p><strong>Let Bridge Discover Inventory:</strong><br />
- Wait 24-48 hours for full discovery<br />
- Bridge will create Arc representations for all VMs<br />
- New resource groups based on tags/policy</p>
<p><strong>Reconcile:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c">// Compare old Arc (manual) vs new Arc (bridge)</span>
<span class="n">Resources</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;microsoft.hybridcompute/machines&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">RegistrationType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">iff</span><span class="p">(</span><span class="n">tags</span><span class="p">[</span><span class="s">&quot;Source&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;Manual&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Manual&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Bridge&quot;</span><span class="p">)</span>
<span class="p">|</span><span class="w"> </span><span class="k">summarize</span><span class="w"> </span><span class="k">count</span><span class="p">()</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">RegistrationType</span>
</code></pre></div>

<p><strong>Expected:</strong><br />
- Manual (old): 467 registrations<br />
- Bridge (new): 1,017 registrations<br />
- Overlap: 167 VMs in both</p>
<h3>Week 3: Clean Up Ghosts</h3>
<p><strong>Identify Ghosts:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Get all manual Arc registrations</span>
<span class="nv">$manualArc</span> <span class="p">=</span> <span class="nb">Get-AzConnectedMachine</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span> 
    <span class="nv">$_</span><span class="p">.</span><span class="n">Tags</span><span class="p">[</span><span class="s2">&quot;Source&quot;</span><span class="p">]</span> <span class="o">-eq</span> <span class="s2">&quot;Manual&quot;</span> 
<span class="p">}</span>

<span class="c"># Get all Bridge registrations</span>
<span class="nv">$bridgeArc</span> <span class="p">=</span> <span class="nb">Get-AzConnectedMachine</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span>
    <span class="nv">$_</span><span class="p">.</span><span class="n">Tags</span><span class="p">[</span><span class="s2">&quot;Source&quot;</span><span class="p">]</span> <span class="o">-ne</span> <span class="s2">&quot;Manual&quot;</span>
<span class="p">}</span>

<span class="c"># Find ghosts (in manual Arc but not in Bridge)</span>
<span class="nv">$ghosts</span> <span class="p">=</span> <span class="nv">$manualArc</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span>
    <span class="nv">$vm</span> <span class="p">=</span> <span class="nv">$_</span>
    <span class="o">-not</span> <span class="p">(</span><span class="nv">$bridgeArc</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Name</span> <span class="o">-eq</span> <span class="nv">$vm</span><span class="p">.</span><span class="n">Name</span> <span class="p">})</span>
<span class="p">}</span>

<span class="nb">Write-Host</span> <span class="s2">&quot;Ghost count: </span><span class="p">$(</span><span class="nv">$ghosts</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2">&quot;</span>
</code></pre></div>

<p><strong>Delete Ghosts:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Backup ghost list</span>
<span class="nv">$ghosts</span> <span class="p">|</span> <span class="nb">Export-Csv</span> <span class="n">-Path</span> <span class="s2">&quot;arc-ghosts-backup.csv&quot;</span> <span class="n">-NoTypeInformation</span>

<span class="c"># Delete ghosts</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$ghost</span> <span class="k">in</span> <span class="nv">$ghosts</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Write-Host</span> <span class="s2">&quot;Deleting ghost: </span><span class="p">$(</span><span class="nv">$ghost</span><span class="p">.</span><span class="n">Name</span><span class="p">)</span><span class="s2">&quot;</span>
    <span class="nb">Remove-AzConnectedMachine</span> <span class="p">`</span>
        <span class="n">-ResourceGroupName</span> <span class="nv">$ghost</span><span class="p">.</span><span class="n">ResourceGroupName</span> <span class="p">`</span>
        <span class="n">-Name</span> <span class="nv">$ghost</span><span class="p">.</span><span class="n">Name</span> <span class="p">`</span>
        <span class="n">-Confirm</span><span class="p">:</span><span class="nv">$false</span>
<span class="p">}</span>
</code></pre></div>

<h3>Week 4: Cutover</h3>
<p><strong>Disable Manual Onboarding:</strong><br />
- Remove Arc deployment scripts from automation<br />
- Delete GPOs that install Arc agents<br />
- Update runbooks to use Bridge-managed VMs</p>
<p><strong>Validate:</strong><br />
- Arc inventory matches VMware inventory<br />
- All new VMs auto-register via Bridge<br />
- Deleted VMs auto-remove from Arc<br />
- Tags sync from vCenter to Azure</p>
<p><strong>Optional - Remove Old Arc Agents:</strong></p>
<p>Arc Resource Bridge and Arc Connected Machine agents can coexist. You can:<br />
- <strong>Keep agents:</strong> For advanced features (software inventory, updates)<br />
- <strong>Remove agents:</strong> If only using Bridge for inventory/lifecycle</p>
<p>Most environments keep both.</p>
<hr />
<h2>The Results: Static vs Dynamic</h2>
<h3>Before (Static Manual Arc)</h3>
<p><strong>Inventory:</strong><br />
- 467 Arc registrations<br />
- 300 ghosts (64%)<br />
- 167 valid (36%)<br />
- Coverage: 16.4%</p>
<p><strong>Operations:</strong><br />
- Manual agent updates (285 expired)<br />
- Monthly ghost cleanup scripts<br />
- No cost allocation tags<br />
- 850 VMs missing Arc coverage</p>
<p><strong>Finance:</strong><br />
- One resource group for all Arc VMs<br />
- No cost center attribution<br />
- ESU chargeback impossible</p>
<h3>After (Dynamic Arc Resource Bridge)</h3>
<p><strong>Inventory:</strong><br />
- 1,017 Arc registrations<br />
- 0 ghosts (0%)<br />
- 1,017 valid (100%)<br />
- Coverage: 100%</p>
<p><strong>Operations:</strong><br />
- Automatic lifecycle sync<br />
- No ghost cleanup needed<br />
- Policy-driven tagging<br />
- All VMs covered by Arc</p>
<p><strong>Finance:</strong><br />
- Resource groups by application/cost center<br />
- Automated tag inheritance from vCenter<br />
- ESU costs allocated properly<br />
- Chargeback enabled</p>
<hr />
<h2>Arc Resource Bridge vs Manual Agents</h2>
<h3>Can They Coexist?</h3>
<p><strong>YES.</strong> Arc Resource Bridge (vCenter-level) and Arc Connected Machine agents (VM-level) serve different purposes:</p>
<table>
<thead>
<tr>
<th>Capability</th>
<th>Arc Resource Bridge</th>
<th>Arc Connected Machine Agent</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>VM Lifecycle Sync</strong></td>
<td>‚úÖ Automatic</td>
<td>‚ùå Manual</td>
</tr>
<tr>
<td><strong>Inventory Management</strong></td>
<td>‚úÖ vCenter-based</td>
<td>‚ùå Per-VM</td>
</tr>
<tr>
<td><strong>Ghost Prevention</strong></td>
<td>‚úÖ Auto-cleanup</td>
<td>‚ùå Manual cleanup</td>
</tr>
<tr>
<td><strong>Tag Inheritance</strong></td>
<td>‚úÖ From vCenter</td>
<td>‚ùå Manual tagging</td>
</tr>
<tr>
<td><strong>Software Inventory</strong></td>
<td>‚ö†Ô∏è Basic</td>
<td>‚úÖ Detailed</td>
</tr>
<tr>
<td><strong>Update Management</strong></td>
<td>‚ö†Ô∏è Limited</td>
<td>‚úÖ Full featured</td>
</tr>
<tr>
<td><strong>Script Execution</strong></td>
<td>‚ùå No</td>
<td>‚úÖ Yes</td>
</tr>
<tr>
<td><strong>Guest Credentials</strong></td>
<td>‚ùå Not required</td>
<td>‚úÖ Required</td>
</tr>
</tbody>
</table>
<h3>Recommended Approach</h3>
<p><strong>Tier 1: All VMs</strong><br />
- Deploy Arc Resource Bridge<br />
- Get lifecycle management, inventory sync, cost allocation<br />
- No guest credentials required</p>
<p><strong>Tier 2: Critical VMs</strong><br />
- Add Arc Connected Machine agents<br />
- Enable software inventory, update management, security<br />
- Requires guest OS credentials</p>
<p><strong>Most enterprises use both.</strong></p>
<hr />
<h2>Maintenance Requirements</h2>
<p>Arc Resource Bridge requires <a href="https://learn.microsoft.com/en-us/azure/azure-arc/vmware-vsphere/upgrade-azure-arc-resource-bridge">ongoing maintenance</a>:</p>
<p><strong>Version Support:</strong><br />
- Supported: Latest and previous 3 versions (n-3)<br />
- Recommended: Upgrade every 6 months<br />
- Process: Manual upgrade command</p>
<p><strong>Upgrade Process:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Check current version</span>
<span class="n">az</span> <span class="n">arcappliance</span> <span class="n">show</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="p">&lt;</span><span class="n">rg</span><span class="p">&gt;</span> <span class="p">-</span><span class="n">-name</span> <span class="p">&lt;</span><span class="n">bridge-name</span><span class="p">&gt;</span>

<span class="c"># Check available upgrades</span>
<span class="n">az</span> <span class="n">arcappliance</span> <span class="nb">get-upgrades</span> <span class="p">-</span><span class="n">-resource-group</span> <span class="p">&lt;</span><span class="n">rg</span><span class="p">&gt;</span> <span class="p">-</span><span class="n">-name</span> <span class="p">&lt;</span><span class="n">bridge-name</span><span class="p">&gt;</span>

<span class="c"># Perform upgrade</span>
<span class="n">az</span> <span class="n">arcappliance</span> <span class="n">upgrade</span> <span class="n">vmware</span> <span class="p">-</span><span class="n">-config</span><span class="o">-file</span> <span class="p">&lt;</span><span class="n">config</span><span class="p">.</span><span class="n">yaml</span><span class="p">&gt;</span>
</code></pre></div>

<p><strong>Upgrade Time:</strong> 30-90 minutes</p>
<p><strong>Downtime:</strong> Brief intermittent during handoff (few minutes)</p>
<p><strong><a href="https://learn.microsoft.com/en-us/azure/azure-arc/resource-bridge/release-notes">Release notes</a></strong> track versions and features.</p>
<hr />
<h2>Cost Analysis</h2>
<p>From Microsoft's <a href="https://techcommunity.microsoft.com/t5/azure-arc-blog/bring-azure-to-your-vmware-environment-announcing-ga-of-vmware/ba-p/3974305">GA announcement</a>:</p>
<blockquote>
<p>"There aren't any additional charges to connect your VMware vSphere resources in Azure by enabling them with Azure Arc. Azure Arc provides select inventory and VM provisioning capabilities for free."</p>
</blockquote>
<p><strong>What's Free:</strong><br />
- Arc Resource Bridge deployment<br />
- vCenter connection and sync<br />
- VM inventory projection<br />
- Lifecycle management<br />
- Basic monitoring</p>
<p><strong>What Costs Money:</strong><br />
- Azure Monitor (if enabled)<br />
- Microsoft Defender (if enabled)<br />
- Update Management (if enabled)<br />
- Extended Security Updates (ESU)<br />
- Arc Connected Machine agents (for advanced features)</p>
<p><strong><a href="https://azure.microsoft.com/en-us/pricing/details/azure-arc/">Azure Arc pricing</a></strong></p>
<p><strong>ROI Calculation:</strong></p>
<p><strong>Eliminated Costs (Annual):</strong><br />
- Ghost VM charges: 300 VMs √ó $X/month<br />
- Manual cleanup: 20 hours/month √ó $Y/hour<br />
- Expired agent remediation: 40 hours/quarter √ó $Y/hour</p>
<p><strong>New Capabilities (Value):</strong><br />
- Accurate compliance reporting<br />
- Cost allocation to business units<br />
- ESU chargeback<br />
- Azure Migrate integration for future migrations</p>
<hr />
<h2>Lessons Learned</h2>
<h3>1. Arc Inventory Requires Reconciliation</h3>
<p>Don't trust your Arc inventory without validation:<br />
- Export Arc inventory monthly<br />
- Compare against VMware reality (RVTools)<br />
- Track coverage percentage over time<br />
- Monitor ghost accumulation</p>
<h3>2. Static Registration Degrades Over Time</h3>
<p>Manual Arc deployment is inherently static:<br />
- Coverage decreases as new VMs are added<br />
- Ghosts accumulate as VMs are deleted<br />
- Requires active lifecycle management</p>
<h3>3. Arc Resource Bridge is Preventive, Not Reactive</h3>
<p>Bridge prevents ghost accumulation:<br />
- Don't deploy Bridge to clean up ghosts<br />
- Deploy Bridge to prevent future ghosts<br />
- Clean up existing ghosts separately</p>
<h3>4. COTS Environments Benefit Most</h3>
<p>If your environment is mostly COTS (commercial off-the-shelf software):<br />
- You don't need GitHub Copilot code analysis<br />
- You don't need deep dependency mapping<br />
- Arc Resource Bridge + manual tagging = sufficient<br />
- Vendor documentation &gt; automated discovery</p>
<h3>5. Start With Jump Box</h3>
<p>A proper jump box setup is critical:<br />
- Azure CLI, PowerShell, Arc extensions installed<br />
- Network access to vCenter and Azure<br />
- Credentials stored in Azure Key Vault<br />
- See my <a href="https://azure-noob.com/blog/azure-arc-private-lab/">Arc lab setup guide</a></p>
<hr />
<h2>Check Your Own Environment</h2>
<p><strong>When did you deploy Arc agents?</strong></p>
<p>Run this reconciliation:</p>
<h3>Step 1: Export Arc Inventory</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Get all Arc machines</span>
<span class="nb">Connect-AzAccount</span>
<span class="nv">$arcVMs</span> <span class="p">=</span> <span class="nb">Get-AzConnectedMachine</span>

<span class="c"># Export to CSV</span>
<span class="nv">$arcVMs</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">Name</span><span class="p">,</span> <span class="n">ResourceGroupName</span><span class="p">,</span> <span class="n">Location</span><span class="p">,</span> <span class="n">Status</span><span class="p">,</span> 
    <span class="n">LastStatusChange</span><span class="p">,</span> <span class="n">AgentVersion</span><span class="p">,</span> <span class="n">OSType</span> <span class="p">|</span> 
    <span class="nb">Export-Csv</span> <span class="n">-Path</span> <span class="s2">&quot;arc-inventory.csv&quot;</span> <span class="n">-NoTypeInformation</span>

<span class="nb">Write-Host</span> <span class="s2">&quot;Arc VMs: </span><span class="p">$(</span><span class="nv">$arcVMs</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2">&quot;</span>
</code></pre></div>

<h3>Step 2: Export VMware Inventory</h3>
<p>Use <a href="https://www.robware.net/rvtools/">RVTools</a>:<br />
1. Download and install RVTools<br />
2. Connect to each vCenter<br />
3. Export "vInfo" tab to Excel<br />
4. Combine all vCenter exports</p>
<h3>Step 3: Reconcile</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Load both inventories</span>
<span class="nv">$arcVMs</span> <span class="p">=</span> <span class="nb">Import-Csv</span> <span class="s2">&quot;arc-inventory.csv&quot;</span>
<span class="nv">$vmwareVMs</span> <span class="p">=</span> <span class="nb">Import-Csv</span> <span class="s2">&quot;rvtools-export.csv&quot;</span>

<span class="c"># Find ghosts (in Arc but not in VMware)</span>
<span class="nv">$ghosts</span> <span class="p">=</span> <span class="nv">$arcVMs</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span>
    <span class="nv">$arcVM</span> <span class="p">=</span> <span class="nv">$_</span>
    <span class="o">-not</span> <span class="p">(</span><span class="nv">$vmwareVMs</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">VM</span> <span class="o">-eq</span> <span class="nv">$arcVM</span><span class="p">.</span><span class="n">Name</span> <span class="p">})</span>
<span class="p">}</span>

<span class="c"># Find missing (in VMware but not in Arc)</span>
<span class="nv">$missing</span> <span class="p">=</span> <span class="nv">$vmwareVMs</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span>
    <span class="nv">$vmVM</span> <span class="p">=</span> <span class="nv">$_</span>
    <span class="o">-not</span> <span class="p">(</span><span class="nv">$arcVMs</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Name</span> <span class="o">-eq</span> <span class="nv">$vmVM</span><span class="p">.</span><span class="n">VM</span> <span class="p">})</span>
<span class="p">}</span>

<span class="c"># Calculate coverage</span>
<span class="nv">$coverage</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$arcVMs</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="nv">$ghosts</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span> <span class="p">/</span> <span class="nv">$vmwareVMs</span><span class="p">.</span><span class="n">Count</span> <span class="p">*</span> <span class="n">100</span>

<span class="nb">Write-Host</span> <span class="s2">&quot;Total VMware VMs: </span><span class="p">$(</span><span class="nv">$vmwareVMs</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2">&quot;</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;Total Arc VMs: </span><span class="p">$(</span><span class="nv">$arcVMs</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2">&quot;</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;Ghosts: </span><span class="p">$(</span><span class="nv">$ghosts</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2"> (</span><span class="p">$((</span><span class="nv">$ghosts</span><span class="p">.</span><span class="n">Count</span> <span class="p">/</span> <span class="nv">$arcVMs</span><span class="p">.</span><span class="n">Count</span> <span class="p">*</span> <span class="n">100</span><span class="p">).</span><span class="n">ToString</span><span class="p">(</span><span class="s1">&#39;0.0&#39;</span><span class="p">))</span><span class="s2">%)&quot;</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;Missing: </span><span class="p">$(</span><span class="nv">$missing</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2">&quot;</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;Coverage: </span><span class="p">$(</span><span class="nv">$coverage</span><span class="p">.</span><span class="n">ToString</span><span class="p">(</span><span class="s1">&#39;0.0&#39;</span><span class="p">))</span><span class="s2">%&quot;</span>
</code></pre></div>

<h3>Step 4: Visualize (Optional)</h3>
<p>Build a Power BI dashboard:<br />
- Import both CSVs<br />
- Create relationships on VM name<br />
- Build KPI cards for ghosts, coverage, missing<br />
- Add slicers for environment, OS, cluster</p>
<p>I'll publish my Power BI template on GitHub soon.</p>
<hr />
<h2>The Bottom Line</h2>
<p><strong>If you deployed Arc manually, your inventory is probably frozen in time.</strong></p>
<p>The solution isn't better cleanup scripts or more frequent reconciliation.</p>
<p><strong>The solution is architectural: Arc Resource Bridge.</strong></p>
<p>It transforms Arc from a static snapshot to a dynamic sync, eliminating ghost registrations at the source.</p>
<p>Microsoft introduced this capability in November 2023. If you're still using manual Arc deployment, you're running the old model.</p>
<p><strong>Check your environment. Reconcile your inventory. I bet you have ghosts too.</strong></p>
<hr />
<h2>Resources</h2>
<p><strong>Microsoft Documentation:</strong><br />
- <a href="https://learn.microsoft.com/en-us/azure/azure-arc/vmware-vsphere/overview">Azure Arc-enabled VMware vSphere Overview</a><br />
- <a href="https://learn.microsoft.com/en-us/azure/azure-arc/resource-bridge/overview">Arc Resource Bridge Overview</a><br />
- <a href="https://learn.microsoft.com/en-us/azure/azure-arc/vmware-vsphere/quick-start-connect-vcenter-to-arc-using-script">Quick Start: Connect vCenter to Arc</a><br />
- <a href="https://techcommunity.microsoft.com/t5/azure-arc-blog/bring-azure-to-your-vmware-environment-announcing-ga-of-vmware/ba-p/3974305">GA Announcement (Nov 2023)</a><br />
- <a href="https://learn.microsoft.com/en-us/azure/azure-arc/resource-bridge/release-notes">Release Notes</a><br />
- <a href="https://azure.microsoft.com/en-us/pricing/details/azure-arc/">Pricing</a></p>
<p><strong>My Posts:</strong><br />
- <a href="https://azure-noob.com/blog/azure-arc-private-lab/">Azure Arc Private Lab Setup</a> - Jump box configuration</p>
<p><strong>Tools:</strong><br />
- <a href="https://www.robware.net/rvtools/">RVTools</a> - VMware inventory export<br />
- Power BI Desktop - Reconciliation dashboard (template coming soon)</p>
<hr />
<h2>üìã Related: Azure Arc Enterprise Readiness Checklist</h2>
<p>Deploying Arc at enterprise scale? Download the complete pre-deployment checklist covering governance, networking, cost planning, and vCenter integration to prevent ghost registrations from day one.</p>
<p><strong><a href="/static/downloads/Azure-Arc-Enterprise-Readiness-Checklist.pdf">Download Free Checklist (PDF)</a></strong> | <strong><a href="/static/downloads/Azure-Arc-Enterprise-Readiness-Checklist.xlsx">Excel Version</a></strong></p>
<hr />
<p><strong>Questions? Spot an error? Let me know in the comments below.</strong></p>
<p><em>Published: December 6, 2025</em></p>
  </div>

  
  <section class="starter-kit-callout" style="
    max-width: 800px;
    margin: 3rem auto 2rem;
    padding: 2rem;
    border-radius: 12px;
    background: var(--bg-light);
    border: 1px solid var(--border);
    text-align: left;
  ">
    <h3 style="margin-top: 0;">Azure Admin Starter Kit (Free Download)</h3>
    <p style="margin-bottom: 1rem;">
      Get my KQL cheat sheet, 50 Windows + 50 Linux commands, and an Azure RACI template in one free bundle.
    </p>
    <a href="/blog/starter-kit/" class="btn">Get the Starter Kit ‚Üí</a>
  </section>

  
  <aside class="email-capture" style="max-width: 800px; margin: 4rem auto; padding: 3rem; background: linear-gradient(135deg, #0078d4 0%, #005a9e 100%); border-radius: 12px; text-align: center; color: white;">
    <h3 style="margin-top: 0; color: white; font-size: 1.75rem;">Get Azure operational guides in your inbox</h3>
    <p style="margin: 1rem 0 2rem; font-size: 1.1rem; color: white;">Weekly tips from managing 44 Azure subscriptions. No marketing BS.</p>
    
    <form action="https://app.kit.com/forms/8896829/subscriptions" method="post" style="max-width: 500px; margin: 0 auto; display: flex; gap: 0.75rem; flex-wrap: wrap; justify-content: center;">
      <input type="email" 
             name="email_address" 
             placeholder="your@email.com" 
             required 
             style="flex: 1; min-width: 250px; padding: 0.875rem 1rem; border: none; border-radius: 8px; font-size: 1rem; color: #333;">
      <button type="submit" 
              style="padding: 0.875rem 2rem; background: white; color: #0078d4; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; white-space: nowrap; font-size: 1rem; transition: all 0.2s;">
        Subscribe
      </button>
    </form>
    
    <p style="margin: 1.5rem 0 0; font-size: 0.9rem; opacity: 0.9; color: white;">
      Join 500+ Azure admins. Unsubscribe anytime.
    </p>
  </aside>

  
  
  <aside class="related-posts" style="max-width: 800px; margin: 3rem auto; padding: 2rem; background: var(--bg-light); border-radius: 12px;">
    <h3 style="margin-top: 0;">Related Posts</h3>
    <ul style="list-style: none; padding: 0;">
      
      <li style="margin: 1rem 0;">
        <a href="/blog/azure-arc-enterprise-scale-problems" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">Azure Arc at Enterprise Scale: The Problems Microsoft Doesn&#39;t Document</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-12-19</span>
        </a>
      </li>
      
      <li style="margin: 1rem 0;">
        <a href="/blog/azure-arc-vcenter-implementation-guide" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">The Azure Arc Multi-vCenter Implementation Guide That Actually Works</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-11-24</span>
        </a>
      </li>
      
      <li style="margin: 1rem 0;">
        <a href="/blog/azure-arc-private-lab" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">Building an Azure Arc Lab with Private Link (No Public IPs)</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-11-26</span>
        </a>
      </li>
      
    </ul>
  </aside>
  

  
  
  
    <!-- CTA: General Email Capture (KIT INLINE FORM) -->
<div class="cta-block" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: 2rem; border-radius: 12px; margin: 3rem 0; text-align: center; color: white;">
  <h3 style="margin: 0 0 0.5rem; font-size: 1.5rem; color: white;">Get Azure operational guides in your inbox</h3>
  <p style="margin: 0 0 1.5rem; font-size: 1rem; line-height: 1.5; color: white;">
    Weekly tips from managing 44 Azure subscriptions. No marketing BS.
  </p>
  
  <!-- Kit inline form - no JavaScript conflicts -->
  <form action="https://app.kit.com/forms/7867186/subscriptions" method="post" style="max-width: 500px; margin: 0 auto; display: flex; gap: 0.5rem; flex-wrap: wrap; justify-content: center;">
    <input type="email" 
           name="email_address" 
           placeholder="your@email.com" 
           required 
           style="flex: 1; min-width: 250px; padding: 0.75rem 1rem; border: none; border-radius: 6px; font-size: 1rem; color: #333;">
    <button type="submit" 
            style="padding: 0.75rem 1.5rem; background: white; color: #4facfe; border: none; border-radius: 6px; font-weight: 700; cursor: pointer; white-space: nowrap; font-size: 1rem;">
      Subscribe
    </button>
  </form>
  
  <p style="margin: 1rem 0 0; font-size: 0.85rem; opacity: 0.9; color: white;">
    Join 500+ Azure admins. Unsubscribe anytime.
  </p>
</div>
  

  
  <nav class="post-nav">
    
      <a href="/blog/azure-tool-selection-noobs">
        <span style="opacity: 0.7; font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">‚Üê Previous</span>
        <strong>Azure Portal vs CLI vs PowerShell vs Bicep vs Terraform: Which One Should a Noob Learn First?</strong>
      </a>
    
    
      <a href="/blog/azure-reporting-role-microsoft-should-create" style="text-align: right;">
        <span style="opacity: 0.7; font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">Next ‚Üí</span>
        <strong>The Azure Role Microsoft Forgot to Certify: Why There&#39;s No Exam for Workbooks, KQL, Power BI, and AI</strong>
      </a>
    
  </nav>

</article>

    </div>
  </main>

  <footer class="site-footer">
    <div class="wrap">
      <p>&copy; 2025 Azure Noob ‚Äî Don&#39;t be a Noob</p>
      <p style="margin-top: 0.5rem; font-size: 0.9rem;">
        <a href="/rss.xml" title="Subscribe via RSS">RSS Feed</a> ¬∑ 
        <a href="https://github.com/dswann101164" target="_blank" rel="noopener">GitHub</a>
      </p>
      <p style="margin-top: 1.5rem; font-size: 0.85rem; opacity: 0.7; font-style: italic;">
        "Trust in the Lord with all your heart, and lean not on your own understanding;<br>
        in all your ways acknowledge Him, and He will make your paths straight" ‚Äî Proverbs 3:5-6
      </p>
    </div>
  </footer>

  <!-- Copy code functionality -->
  <script src="/static/copy-code.js"></script>

  <!-- Exit-Intent Popup -->
  <div id="exit-popup" class="exit-popup" style="display: none;">
    <div class="exit-popup-content">
      <button class="exit-popup-close" onclick="closeExitPopup()">&times;</button>
      <h2>Wait! Before You Go...</h2>
      <p class="exit-popup-subtitle">Get the <strong>FREE Azure Admin Starter Kit</strong></p>
      <ul class="exit-popup-benefits">
        <li>‚úì 15 Essential KQL Queries</li>
        <li>‚úì 50 Windows Commands</li>
        <li>‚úì 50 Linux Commands</li>
      </ul>
      <form id="exit-popup-form" class="exit-popup-form">
        <input type="email" id="popup-email" placeholder="Enter your email" required>
        <button type="submit" class="exit-popup-submit">Send Me The Free Kit</button>
      </form>
      <p class="exit-popup-privacy">We'll also notify you about new tools & guides. Unsubscribe anytime.</p>
    </div>
  </div>

  <style>
  .exit-popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .exit-popup-content {
    background: white;
    padding: 2.5rem;
    border-radius: 12px;
    max-width: 500px;
    width: 90%;
    position: relative;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: slideUp 0.3s ease;
  }

  @keyframes slideUp {
    from { transform: translateY(50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .exit-popup-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    font-size: 2rem;
    cursor: pointer;
    color: #999;
    line-height: 1;
  }

  .exit-popup-close:hover {
    color: #333;
  }

  .exit-popup h2 {
    margin: 0 0 0.5rem 0;
    color: #0078d4;
    font-size: 2rem;
  }

  .exit-popup-subtitle {
    font-size: 1.2rem;
    margin: 0 0 1.5rem 0;
  }

  .exit-popup-benefits {
    list-style: none;
    padding: 0;
    margin: 1.5rem 0;
  }

  .exit-popup-benefits li {
    padding: 0.5rem 0;
    font-size: 1.1rem;
  }

  .exit-popup-form {
    margin: 1.5rem 0;
  }

  .exit-popup-form input[type="email"] {
    width: 100%;
    padding: 1rem;
    border: 2px solid #ddd;
    border-radius: 6px;
    font-size: 1rem;
    margin-bottom: 1rem;
  }

  .exit-popup-form input[type="email"]:focus {
    outline: none;
    border-color: #0078d4;
  }

  .exit-popup-submit {
    width: 100%;
    padding: 1rem 2rem;
    background: #0078d4;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 1.1rem;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s;
  }

  .exit-popup-submit:hover {
    background: #005a9e;
  }

  .exit-popup-privacy {
    font-size: 0.85rem;
    color: #666;
    margin-top: 1rem;
    text-align: center;
  }
  </style>

  <script>
  // Exit-intent detection
  let exitPopupShown = false;
  let mouseY = 0;

  document.addEventListener('mousemove', (e) => {
    mouseY = e.clientY;
  });

  document.addEventListener('mouseout', (e) => {
    // If mouse leaves through top of viewport and popup hasn't been shown
    if (!exitPopupShown && e.clientY <= 0 && mouseY <= 100) {
      // Check if user has seen it before (session storage)
      if (!sessionStorage.getItem('exitPopupSeen')) {
        showExitPopup();
      }
    }
  });

  function showExitPopup() {
    exitPopupShown = true;
    document.getElementById('exit-popup').style.display = 'flex';
    sessionStorage.setItem('exitPopupSeen', 'true');
  }

  function closeExitPopup() {
    document.getElementById('exit-popup').style.display = 'none';
  }

  // Handle form submission
  document.getElementById('exit-popup-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('popup-email').value;
    
    // Send to ConvertKit (we'll set this up next)
    try {
      // For now, just close and redirect
      closeExitPopup();
      
      // Track in Google Analytics
      if (typeof gtag !== 'undefined') {
        gtag('event', 'signup', {
          'event_category': 'email',
          'event_label': 'exit_popup',
          'value': email
        });
      }
      
      // Redirect to starter kit page
      window.location.href = '/blog/starter-kit/';
      
    } catch (error) {
      console.error('Error:', error);
      // Still redirect even if tracking fails
      window.location.href = '/blog/starter-kit/';
    }
  });

  // Close on background click
  document.getElementById('exit-popup').addEventListener('click', (e) => {
    if (e.target.id === 'exit-popup') {
      closeExitPopup();
    }
  });
  </script>
</body>
</html>