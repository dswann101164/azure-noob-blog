<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  

  <!-- Primary SEO -->
  <title>Azure Noob</title>
  <meta name="description" content="Don&#39;t be a Noob">
  <link rel="canonical" href="https://azure-noob.com" />

  <!-- Favicons -->
  <link rel="icon" href="../../static/images/logo.png">

  <!-- Open Graph -->
  <meta property="og:title" content="Azure Noob">
  <meta property="og:description" content="Don&#39;t be a Noob">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://azure-noob.com">
  <meta property="og:image" content="../../static/images/hero/cloud-wars.png">

  

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Azure Noob">
  <meta name="twitter:description" content="Don&#39;t be a Noob">
  <meta name="twitter:image" content="../../static/images/hero/cloud-wars.png">

  <!-- Styles -->
  <link rel="stylesheet" href="../../static/styles.css">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZNHGEB0BNZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-ZNHGEB0BNZ');
  </script>
</head>
<body>
  <header class="site-header">
    <div class="wrap nav-wrap">
      <div class="brand-block">
        <a href="../../index.html" class="brand-link">
          <img src="../../static/images/logo.png" alt="Azure Noob logo" class="logo">
        </a>
        <span class="brand-text">
          <small>Official Website of</small>
          <strong>Azure Noob</strong>
        </span>
      </div>
      <nav class="nav">
        <a href="../../index.html">Home</a>
        <a href="../index.html">Blog</a>
        <a href="../../start-here/index.html">Start Here</a>
        <a href="../../about/index.html">About</a>
        <a href="../../tags/index.html">Tags</a>
        <a href="/static/azure-icons-table.html">Icons</a>
        <a href="../../search/index.html">Search</a>
      </nav>
    </div>
  </header>

  <main class="site-content">
    <div class="wrap">
      
<article class="post">

  
  
    
    <div class="hero">
      <img src="../../static/images/hero/azure-update-manager.png" alt="Azure Update Manager Reality Check: Why 77% of Your VMs Are Unsupported">
    </div>
  

  <header class="post-header">
    <h1>Azure Update Manager Reality Check: Why 77% of Your VMs Are Unsupported</h1>
    <p class="muted">
      2025-09-24 ¬∑ ~7 min read
    </p>
    
    
    <ul class="tags-list">
      
      <li><a href="../../tags/Azure/index.html" class="tag-badge">Azure</a></li>
      
      <li><a href="../../tags/Update%20Manager/index.html" class="tag-badge">Update Manager</a></li>
      
      <li><a href="../../tags/KQL/index.html" class="tag-badge">KQL</a></li>
      
      <li><a href="../../tags/Azure%20Governance/index.html" class="tag-badge">Azure Governance</a></li>
      
      <li><a href="../../tags/VM%20Management/index.html" class="tag-badge">VM Management</a></li>
      
    </ul>
    
    
    
      <p class="summary">Opened Azure Update Manager and saw 1,791 VMs that need updates? Here&#39;s the uncomfortable truth about what that number really means and the KQL queries to find your real target.</p>
    
  </header>

  
  <p class="post-actions" style="margin:.5rem 0 0; text-align: center;">
    <button class="btn"
            onclick="window.print(); return false;"
            title="Print this page"
            aria-label="Print this page"
            style="cursor: pointer; background: none; border: 2px solid var(--azure-blue);">
      üñ®Ô∏è Print this page
    </button>
  </p>

  
  <div class="post-body">
    <h1>Azure Update Manager Reality Check: Why 77% of Your VMs Are Unsupported</h1>
<p>When I first opened Azure Update Manager, I nearly had a heart attack. The dashboard cheerfully informed me that <strong>1,791 virtual machines</strong> needed attention. As someone responsible for keeping our Azure environment secure and compliant, seeing that number felt like staring down an impossible task.</p>
<p>Here's what I wish someone had told me on day one: <strong>that number is completely misleading</strong>.</p>
<p>After digging deep into our environment, running queries, and actually understanding what Azure Update Manager can and can't handle, I discovered the uncomfortable truth: <strong>only 348 of those 1,791 VMs should actually be managed by Azure Update Manager</strong>. That's 77% of our environment that shouldn't be there in the first place.</p>
<p>If you're facing a similar shock when you open Azure Update Manager, this post will save you weeks of confusion and help you focus on what actually matters.</p>
<h2>The Problem: Azure Update Manager Shows Everything</h2>
<p>Azure Update Manager has a dirty little secret: it displays every single VM it can see, regardless of whether it should manage that VM or not. It doesn't understand that your environment is complex. It doesn't know about your Citrix VDI infrastructure, your Databricks clusters, or your security appliances that should never be touched by automated updates.</p>
<p><img alt="Azure Update Manager Dashboard showing 1,791 VMs" src="/static/images/azure-update-manager-before.png" /></p>
<p>Looking at this dashboard, my first instinct was panic. How could we possibly manage updates for nearly 1,800 virtual machines? Where do we even start?</p>
<p>The answer: we don't. Because most of these VMs are being managed by other tools, are specialized appliances, or simply aren't suitable for Azure Update Manager.</p>
<h2>The Reality: Most VMs Have Better Update Methods</h2>
<p>Here's the breakdown of our "1,791 VMs that need updates":</p>
<table>
<thead>
<tr>
<th>Platform Type</th>
<th>Count</th>
<th>Update Method</th>
<th>Responsible Team</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Citrix VDI</strong></td>
<td>~900 VMs</td>
<td>Intune</td>
<td>Citrix Team</td>
</tr>
<tr>
<td><strong>Azure Databricks</strong></td>
<td>~170 VMs</td>
<td>Azure Databricks Solution</td>
<td>Databricks Team</td>
</tr>
<tr>
<td><strong>Windows Desktop OS</strong></td>
<td>44 VMs</td>
<td>Intune</td>
<td>Desktop Team</td>
</tr>
<tr>
<td><strong>Security Appliances</strong></td>
<td>46 VMs</td>
<td>Vendor Updates</td>
<td>Security Team</td>
</tr>
<tr>
<td><strong>Network Appliances</strong></td>
<td>20 VMs</td>
<td>Vendor Updates</td>
<td>Network Team</td>
</tr>
<tr>
<td><strong>Other Appliances</strong></td>
<td>7 VMs</td>
<td>Vendor Updates</td>
<td>Various Teams</td>
</tr>
<tr>
<td><strong>TOTAL UNSUPPORTED</strong></td>
<td><strong>~1,187 VMs</strong></td>
<td><strong>Various Methods</strong></td>
<td><strong>Multiple Teams</strong></td>
</tr>
</tbody>
</table>
<p><strong>The real number of VMs that should use Azure Update Manager? 348.</strong></p>
<p>That's a 77% reduction from what the dashboard initially showed us. Suddenly, the task went from "impossible" to "manageable."</p>
<h2>Why This Happens: Azure Update Manager Doesn't Understand Context</h2>
<p>Azure Update Manager is designed to be simple: "Hey, there are VMs here, they probably need updates!" But enterprise environments are anything but simple.</p>
<p><strong>Citrix VDI Systems (900 VMs):</strong> These are managed through Intune with carefully orchestrated update schedules that coordinate with user sessions. Azure Update Manager would break this process.</p>
<p><strong>Azure Databricks (170 VMs):</strong> These are ephemeral compute clusters managed by the Databricks service itself. They get updated as part of the cluster lifecycle, not through traditional patching.</p>
<p><strong>Security Appliances (46 VMs):</strong> Firewalls, intrusion detection systems, and other security tools require vendor-specific update procedures. One wrong automatic update could take down your entire network security posture.</p>
<p><strong>Desktop VMs (44 VMs):</strong> Windows 10/11 virtual desktops are managed through Intune with different policies than servers. They need user-focused update schedules, not server maintenance windows.</p>
<p><strong>The lesson:</strong> Just because Azure Update Manager can see a VM doesn't mean it should manage that VM.</p>
<h2>The Solution: KQL Queries to Find Your Real Targets</h2>
<p>Instead of trying to manage all 1,791 VMs, I used Azure Resource Graph queries to identify which systems should actually be excluded from Azure Update Manager.</p>
<h3>Query 1: Identify Unsupported Systems</h3>
<p>This query finds all the VMs that should be managed by other tools:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Resources</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;microsoft.compute/virtualmachines&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">publisher</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tostring</span><span class="p">(</span><span class="n">properties</span><span class="err">.</span><span class="n">storageProfile</span><span class="err">.</span><span class="n">imageReference</span><span class="err">.</span><span class="n">publisher</span><span class="p">)</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">rgName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tostring</span><span class="p">(</span><span class="n">resourceGroup</span><span class="p">)</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">publisher</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;AzureDatabricks&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;tenable&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;paloaltonetworks&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MicrosoftWindowsDesktop&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">or</span>
<span class="w">        </span><span class="n">subscriptionDisplayName</span><span class="w"> </span><span class="k">contains</span><span class="w"> </span><span class="s">&quot;Citrix&quot;</span><span class="w"> </span><span class="k">or</span>
<span class="w">        </span><span class="n">rgName</span><span class="w"> </span><span class="k">contains</span><span class="w"> </span><span class="s">&quot;citrix&quot;</span><span class="w"> </span><span class="k">or</span>
<span class="w">        </span><span class="n">rgName</span><span class="w"> </span><span class="k">contains</span><span class="w"> </span><span class="s">&quot;databricks&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">VMName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">Publisher</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">publisher</span><span class="p">,</span><span class="w"> </span><span class="n">Subscription</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">subscriptionDisplayName</span><span class="p">,</span><span class="w"> </span><span class="n">ResourceGroup</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">rgName</span>
<span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">Subscription</span><span class="p">,</span><span class="w"> </span><span class="n">ResourceGroup</span><span class="p">,</span><span class="w"> </span><span class="n">VMName</span>
</code></pre></div>

<p>This query identified our 1,187 unsupported systems by looking for:<br />
- <strong>Publisher patterns</strong>: Databricks VMs, security appliances, Windows Desktop images<br />
- <strong>Subscription patterns</strong>: Anything with "Citrix" in the subscription name<br />
- <strong>Resource group patterns</strong>: Groups containing "citrix" or "databricks"</p>
<h3>Query 2: Count Unsupported Systems by Type</h3>
<p>To understand the scope of what we're excluding:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Resources</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;microsoft.compute/virtualmachines&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">publisher</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tostring</span><span class="p">(</span><span class="n">properties</span><span class="err">.</span><span class="n">storageProfile</span><span class="err">.</span><span class="n">imageReference</span><span class="err">.</span><span class="n">publisher</span><span class="p">)</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">rgName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tostring</span><span class="p">(</span><span class="n">resourceGroup</span><span class="p">)</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">publisher</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;AzureDatabricks&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;tenable&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;paloaltonetworks&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MicrosoftWindowsDesktop&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">or</span>
<span class="w">        </span><span class="n">subscriptionDisplayName</span><span class="w"> </span><span class="k">contains</span><span class="w"> </span><span class="s">&quot;Citrix&quot;</span><span class="w"> </span><span class="k">or</span>
<span class="w">        </span><span class="n">rgName</span><span class="w"> </span><span class="k">contains</span><span class="w"> </span><span class="s">&quot;citrix&quot;</span><span class="w"> </span><span class="k">or</span>
<span class="w">        </span><span class="n">rgName</span><span class="w"> </span><span class="k">contains</span><span class="w"> </span><span class="s">&quot;databricks&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">summarize</span><span class="w"> </span><span class="n">VMCount</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">count</span><span class="p">(),</span><span class="w"> </span><span class="n">VMNames</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">make_list</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">publisher</span><span class="p">,</span><span class="w"> </span><span class="n">subscriptionDisplayName</span><span class="p">,</span><span class="w"> </span><span class="n">rgName</span>
<span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">VMCount</span><span class="w"> </span><span class="n">desc</span>
</code></pre></div>

<p>This showed us exactly where our unsupported VMs were concentrated and helped validate our filtering logic.</p>
<h2>The Filter Effect: From Chaos to Clarity</h2>
<p>After applying these filters in Azure Update Manager (by excluding the problematic resource groups and subscriptions), the dashboard transformation was dramatic:</p>
<p><strong>Before filtering:</strong> 1,791 VMs<br />
<strong>After filtering:</strong> 348 VMs</p>
<p><img alt="Azure Update Manager Dashboard after filtering" src="/static/images/azure-update-manager-after.png" /></p>
<p>Suddenly, Azure Update Manager became a useful tool instead of an overwhelming problem. We went from "How do we handle 1,800 VMs?" to "Here are the 348 VMs we actually need to focus on."</p>
<h2>The Business Impact: Focus on What Matters</h2>
<p>This filtering approach delivered immediate business value:</p>
<p><strong>Risk Reduction:</strong> We eliminated the risk of accidentally updating critical appliances or breaking carefully managed VDI environments.</p>
<p><strong>Resource Optimization:</strong> Our team could focus on 348 VMs instead of trying to understand 1,791 different systems.</p>
<p><strong>Clear Accountability:</strong> Each system type has a clear owner and update methodology. No more confusion about who's responsible for what.</p>
<p><strong>Realistic Planning:</strong> Update schedules and maintenance windows became manageable when scoped to the right systems.</p>
<h2>Key Takeaways for Your Environment</h2>
<p><strong>Don't trust the initial numbers:</strong> Azure Update Manager will show you every VM it can see. Most of them probably shouldn't be there.</p>
<p><strong>Understand your ecosystem:</strong> Map out which tools are already managing updates for different system types. Don't create duplicate or conflicting processes.</p>
<p><strong>Use filtering aggressively:</strong> Azure Update Manager works best when it's focused on systems that actually belong there.</p>
<p><strong>Document your exclusions:</strong> Keep track of why certain VMs are excluded so future team members understand the decisions.</p>
<h2>What's Next: Making the 348 VMs Actually Automated</h2>
<p>Having identified our real target VMs is just the first step. In my next post, I'll show you why those 348 VMs still aren't being updated automatically, even with Azure Update Manager policies in place, and the missing piece that most Azure documentation doesn't tell you about.</p>
<p>The short version: policies configure VMs for automation, but they don't actually schedule when updates happen. That requires maintenance configurations, and there's a gap between the two that catches most administrators off guard.</p>
<hr />
<p><strong>Want to audit your own environment?</strong> Copy the KQL queries above and run them in Azure Resource Graph Explorer. You might be surprised by how many of your "problem VMs" are actually being managed perfectly well by other tools.</p>
<p><em>Next in this series: "The Azure Update Manager Automation Gap (And How to Fix It)"</em></p>
  </div>

  
  
  <aside class="related-posts" style="max-width: 800px; margin: 3rem auto; padding: 2rem; background: var(--bg-light); border-radius: 12px;">
    <h3 style="margin-top: 0;">Related Posts</h3>
    <ul style="list-style: none; padding: 0;">
      
      <li style="margin: 1rem 0;">
        <a href="../kql-query-library-git/index.html" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">Stop Losing Your KQL Queries: The Git-Based Query Library Nobody Told You About</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-10-28</span>
        </a>
      </li>
      
      <li style="margin: 1rem 0;">
        <a href="../commenting-for-continuity/index.html" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">Commenting for Continuity: Why My Code Comments Don&#39;t Look Like Yours (On Purpose)</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-10-27</span>
        </a>
      </li>
      
      <li style="margin: 1rem 0;">
        <a href="../azure-audit-gap-nobody-talks-about/index.html" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">The Azure Audit Gap Nobody Talks About: Why Your 90-Day Logs Won&#39;t Survive a 7-Year Audit</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-10-26</span>
        </a>
      </li>
      
    </ul>
  </aside>
  

  
  <nav class="post-nav">
    
      <a href="../why-most-azure-migrations-fail/index.html">
        <span style="opacity: 0.7; font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">‚Üê Previous</span>
        <strong>Why Most Azure Migrations Fail: The Institutional Knowledge Problem</strong>
      </a>
    
    
      <a href="../azure-cost-reports-business-reality/index.html" style="text-align: right;">
        <span style="opacity: 0.7; font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">Next ‚Üí</span>
        <strong>Why Your Azure Cost Reports Don&#39;t Match Your Business Reality</strong>
      </a>
    
  </nav>

</article>

    </div>
  </main>

  <!-- EMAIL CAPTURE SECTION -->
  <section class="email-signup" id="subscribe">
    <div class="wrap">
      <h3>Get Azure tips in your inbox</h3>
      <p>Join Azure pros getting practical KQL queries, cost optimization tips, and real-world solutions.</p>
      <script async data-uid="3dfad5c743" src="https://azure-noob.kit.com/3dfad5c743/index.js"></script>
    </div>
  </section>

  <footer class="site-footer">
    <div class="wrap">
      <p>&copy; 2025 Azure Noob ‚Äî Don&#39;t be a Noob</p>
    </div>
  </footer>

  <!-- Copy code functionality -->
  <script src="../../static/copy-code.js"></script>
</body>
</html>