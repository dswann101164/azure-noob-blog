<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  
  

  <!-- Primary SEO -->
  <title>Azure Marketplace VMs Ship with Broken winget - Use Chocolatey Instead | Azure Noob</title>
  <meta name="description" content="Fresh Windows 11 Enterprise N VMs from Azure Marketplace have broken winget dependencies. Here&#39;s the Chocolatey automation that actually works.">
  
  <link rel="canonical" href="https://azure-noob.com/blog/azure-marketplace-vms-broken-winget-chocolatey-fix/" />

  <!-- Favicons -->
  <link rel="icon" href="/static/images/logo.png">

  <!-- Open Graph -->
  <meta property="og:title" content="Azure Marketplace VMs Ship with Broken winget - Use Chocolatey Instead">
  <meta property="og:description" content="Fresh Windows 11 Enterprise N VMs from Azure Marketplace have broken winget dependencies. Here&#39;s the Chocolatey automation that actually works.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://azure-noob.com/blog/azure-marketplace-vms-broken-winget-chocolatey-fix/">
  <meta property="og:image" content="https://azure-noob.com/static/images/hero/azure-marketplace-vms-broken-winget-chocolatey-fix.png">

  
    <meta property="article:published_time" content="2026-01-22T00:00:00+00:00">
    <meta property="article:modified_time" content="2026-01-22T00:00:00+00:00">
    <meta property="article:author" content="David Swann">
    
      
        <meta property="article:tag" content="automation">
      
        <meta property="article:tag" content="powershell">
      
        <meta property="article:tag" content="azure-vms">
      
        <meta property="article:tag" content="devops">
      
    
  

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Azure Marketplace VMs Ship with Broken winget - Use Chocolatey Instead">
  <meta name="twitter:description" content="Fresh Windows 11 Enterprise N VMs from Azure Marketplace have broken winget dependencies. Here&#39;s the Chocolatey automation that actually works.">
  <meta name="twitter:image" content="https://azure-noob.com/static/images/hero/azure-marketplace-vms-broken-winget-chocolatey-fix.png">

  <!-- Organization Schema for GEO/AEO entity recognition -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Azure Noob",
    "url": "https://azure-noob.com",
    "logo": "https://azure-noob.com/static/images/logo.png",
    "description": "Practical Azure cloud tutorials and guides from managing 31,000+ resources across 44 subscriptions in regulated enterprise environments.",
    "founder": {
      "@type": "Person",
      "name": "David Swann",
      "jobTitle": "Azure Architect",
      "sameAs": [
        "https://github.com/dswann101164",
        "https://www.linkedin.com/in/intikiswann/"
      ]
    },
    "sameAs": [
      "https://github.com/dswann101164"
    ]
  }
  </script>

  <!-- Styles -->
  <link rel="stylesheet" href="/static/styles.css">

  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="Azure Noob RSS Feed" href="https://azure-noob.com/feed.xml">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZNHGEB0BNZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-ZNHGEB0BNZ');
  </script>
</head>
<body>
  <header class="site-header">
    <div class="wrap nav-wrap">
      <div class="brand-block">
        <a href="/" class="brand-link">
          <img src="/static/images/logo.png" alt="Azure Noob logo" class="logo">
        </a>
        <span class="brand-text">
          <small>Official Website of</small>
          <strong>Azure Noob</strong>
        </span>
      </div>
      <nav class="nav">
        <a href="/">Home</a>
        <a href="/blog/">Blog</a>
        <a href="/hubs/">Content Hubs</a>
        <a href="/tools/">Tools</a>
        <a href="/start-here/">Start Here</a>
        <a href="/about/">About</a>
        <a href="/tags/">Tags</a>
        <a href="https://github.com/dswann101164" target="_blank" rel="noopener">GitHub</a>
        <a href="/search/">Search</a>
      </nav>
    </div>
  </header>

  <main class="site-content">
    <div class="wrap">
      


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "headline": "Azure Marketplace VMs Ship with Broken winget - Use Chocolatey Instead",
  "description": "Fresh Windows 11 Enterprise N VMs from Azure Marketplace have broken winget dependencies. Here&#39;s the Chocolatey automation that actually works.",
  "image": {
    "@type": "ImageObject",
    "url": "https://azure-noob.com/static/images/hero/azure-marketplace-vms-broken-winget-chocolatey-fix.png",
    "width": 1200,
    "height": 630
  },
  "author": {
    "@type": "Person",
    "name": "David Swann",
    "url": "https://azure-noob.com/about/",
    "description": "Azure Architect specializing in enterprise cloud infrastructure",
    "jobTitle": "Azure Architect",
    "sameAs": [
      "https://github.com/dswann101164",
      "https://www.linkedin.com/in/intikiswann/"
    ],
    "worksFor": {
      "@type": "Organization",
      "name": "Synovus"
    }
  },
  "publisher": {
    "@type": "Organization",
    "name": "Azure Noob",
    "url": "https://azure-noob.com",
    "logo": {
      "@type": "ImageObject",
      "url": "https://azure-noob.com/static/images/logo.png"
    }
  },
  "datePublished": "2026-01-22T00:00:00+00:00",
  "dateModified": "2026-01-22T00:00:00+00:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://azure-noob.com/blog/azure-marketplace-vms-broken-winget-chocolatey-fix/"
  },
  "keywords": "automation, powershell, azure-vms, devops",
  "articleSection": "automation",
  "wordCount": "3651",
  "timeRequired": "PT18M",
  "inLanguage": "en-US",
  "isAccessibleForFree": "True",
  "proficiencyLevel": "Intermediate",
  
  "about": {
    "@type": "Thing",
    "name": "automation"
  }
}
</script>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://azure-noob.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": "https://azure-noob.com/blog/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Azure Marketplace VMs Ship with Broken winget - Use Chocolatey Instead",
      "item": "https://azure-noob.com/blog/azure-marketplace-vms-broken-winget-chocolatey-fix/"
    }
  ]
}
</script>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "speakable": {
    "@type": "SpeakableSpecification",
    "cssSelector": [".summary", ".post-header h1", ".post-body h2", ".post-body p:first-of-type"]
  },
  "url": "https://azure-noob.com/blog/azure-marketplace-vms-broken-winget-chocolatey-fix/"
}
</script>










<article class="post">

  
  
    
    <div class="hero">
      <img src="/static/images/hero/azure-marketplace-vms-broken-winget-chocolatey-fix.png" alt="Azure Marketplace VMs Ship with Broken winget - Use Chocolatey Instead" loading="eager">
    </div>
  

  <header class="post-header">
    <h1>Azure Marketplace VMs Ship with Broken winget - Use Chocolatey Instead</h1>
    <p class="muted">
      2026-01-22 ¬∑ ~18 min read
      
    </p>
    
    
    <ul class="tags-list">
      
      <li><a href="/tags/automation/" class="tag-badge">automation</a></li>
      
      <li><a href="/tags/powershell/" class="tag-badge">powershell</a></li>
      
      <li><a href="/tags/azure-vms/" class="tag-badge">azure-vms</a></li>
      
      <li><a href="/tags/devops/" class="tag-badge">devops</a></li>
      
    </ul>
    
    
    
      <p class="summary">Fresh Windows 11 Enterprise N VMs from Azure Marketplace have broken winget dependencies. Here&#39;s the Chocolatey automation that actually works.</p>
    
  </header>

  
  <p class="post-actions" style="margin:.5rem 0 0; text-align: center;">
    <button class="btn"
            onclick="window.print(); return false;"
            title="Print this page"
            aria-label="Print this page"
            style="cursor: pointer; background: none; border: 2px solid var(--azure-blue);">
      üñ®Ô∏è Print this page
    </button>
  </p>

  
  <div class="post-body">
    <h2 id="short-answer">Short Answer</h2>
<p>Fresh Windows 11 Enterprise N VMs from Azure Marketplace ship with winget v1.19 and VCLibs 14.0.30704.0, which creates an unresolvable dependency loop. You can't use winget to install packages on a fresh marketplace VM. The solution: use Chocolatey instead. It bypasses all Microsoft dependency issues and works immediately on fresh VMs.</p>
<p><strong>Get the complete automation script:</strong> <a href="https://github.com/dswann101164/azure-admin-workstation-setup">‚≠ê GitHub: azure-admin-workstation-setup</a></p>
<hr />
<h2 id="the-problem-microsoft-s-dependency-loop">The Problem: Microsoft's Dependency Loop</h2>
<p>You spin up a fresh Windows 11 Enterprise N VM from Azure Marketplace. You try to install PowerShell 7 with winget:</p>
<div class="codehilite"><pre><span></span><code><span class="n">winget</span> <span class="n">install</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">PowerShell</span>
</code></pre></div>

<p><strong>Error:</strong> Certificate validation failures.</p>
<p>You check the versions:</p>
<div class="codehilite"><pre><span></span><code><span class="n">winget</span> <span class="p">-</span><span class="n">-version</span>
<span class="c"># v1.19.21121.1</span>

<span class="nb">Get-AppxPackage</span> <span class="p">*</span><span class="n">VCLibs</span><span class="p">*</span> <span class="p">|</span> <span class="nb">Select </span><span class="n">Name</span><span class="p">,</span> <span class="n">Version</span>
<span class="c"># Microsoft.VCLibs.140.00  14.0.30704.0</span>
</code></pre></div>

<p>The dependency chain:<br />
- Your VM has winget v1.19 (ships with marketplace image)<br />
- winget v1.19 has broken certificate validation<br />
- To fix it, you need to update App Installer<br />
- App Installer requires VCLibs 14.0.33728.0 or higher<br />
- Your VM has VCLibs 14.0.30704.0<br />
- Microsoft's download URLs only provide VCLibs 14.0.33321.0<br />
- Even if you manually install that, it's still too old</p>
<p><strong>You're stuck in a dependency loop on a fresh Azure VM.</strong></p>
<p>This affects every Windows 11 Enterprise N VM from Azure Marketplace. It's been broken since late 2024.</p>
<hr />
<h2 id="why-this-matters-you-can-t-bootstrap-powershell-7">Why This Matters: You Can't Bootstrap PowerShell 7</h2>
<p>Here's the catch-22 that makes this dependency hell worse:</p>
<p><strong>You need PowerShell 7 for modern Azure automation.</strong> Microsoft recommends it. Every new Azure CLI example uses it. PowerShell ISE is deprecated. Windows PowerShell 5.1 is in maintenance mode.</p>
<p><strong>But you can't install PowerShell 7 on a fresh Azure VM using winget</strong> because winget is broken on fresh marketplace VMs.</p>
<p>The irony:<br />
- Your VM ships with PowerShell 5.1 (Windows PowerShell)<br />
- You try to install PowerShell 7 with: <code>winget install Microsoft.PowerShell</code><br />
- winget fails with certificate errors<br />
- You're stuck on PowerShell 5.1<br />
- Your modern Azure scripts don't work</p>
<p><strong>Most Azure admins are still using PowerShell 5.1 and ISE because they can't easily bootstrap PowerShell 7 on fresh VMs.</strong></p>
<p>This isn't just an inconvenience. It's blocking the entire Azure admin community from adopting modern tooling.</p>
<h3 id="powershell-5-1-vs-powershell-7-what-you-re-missing">PowerShell 5.1 vs PowerShell 7: What You're Missing</h3>
<p><strong>PowerShell 5.1 (Windows PowerShell):</strong><br />
- Ships with Windows<br />
- Last major update: 2016<br />
- Windows-only<br />
- ISE as default editor (deprecated)<br />
- Missing modern features</p>
<p><strong>PowerShell 7 (PowerShell Core):</strong><br />
- Cross-platform (Windows, Linux, macOS)<br />
- Active development<br />
- Parallel installation (doesn't replace 5.1)<br />
- VSCode integration<br />
- Modern syntax (ternary operators, null coalescing, pipeline chain operators)<br />
- Better performance<br />
- Required for new Azure modules</p>
<p><strong>Microsoft's guidance:</strong> Use PowerShell 7 for all new Azure work.</p>
<p><strong>Enterprise reality:</strong> Most admins are stuck on 5.1 because provisioning fresh VMs with PowerShell 7 is unnecessarily difficult.</p>
<h3 id="the-bootstrap-problem">The Bootstrap Problem</h3>
<p>On a fresh Azure Marketplace VM:</p>
<div class="codehilite"><pre><span></span><code><span class="c"># You start here (PowerShell 5.1)</span>
<span class="nv">$PSVersionTable</span><span class="p">.</span><span class="n">PSVersion</span>
<span class="c"># Major: 5, Minor: 1</span>

<span class="c"># You try to install PowerShell 7</span>
<span class="n">winget</span> <span class="n">install</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">PowerShell</span>
<span class="c"># ERROR: Certificate validation failed</span>

<span class="c"># You try manual download</span>
<span class="nb">Invoke-WebRequest</span> <span class="n">-Uri</span> <span class="s2">&quot;https://github.com/PowerShell/PowerShell/releases/download/v7.4.1/PowerShell-7.4.1-win-x64.msi&quot;</span> <span class="n">-OutFile</span> <span class="s2">&quot;PowerShell-7.msi&quot;</span>
<span class="nb">Start-Process</span> <span class="n">msiexec</span><span class="p">.</span><span class="n">exe</span> <span class="n">-ArgumentList</span> <span class="s2">&quot;/i PowerShell-7.msi /quiet&quot;</span> <span class="n">-Wait</span>

<span class="c"># This works, but now you need to do this for every other tool manually</span>
<span class="c"># VS Code? Manual download.</span>
<span class="c"># Git? Manual download.</span>
<span class="c"># Azure CLI? Manual download.</span>
<span class="c"># Terraform? Manual download.</span>
</code></pre></div>

<p><strong>You end up spending 2-3 hours manually downloading and installing tools on every new admin workstation.</strong></p>
<p>This is why Chocolatey matters. It solves the bootstrap problem.</p>
<hr />
<h2 id="why-this-happens">Why This Happens</h2>
<p><strong>Microsoft's assumption:</strong> You're running Windows on physical hardware with Windows Update enabled.</p>
<p><strong>Enterprise reality:</strong> You're running isolated VMs in Azure with Windows Update managed by WSUS or disabled entirely during initial provisioning.</p>
<p>The marketplace images are built months before you deploy them. By the time you provision a VM, the included winget version is outdated and the certificate chain has changed.</p>
<p>Microsoft provides no automated way to bootstrap the dependency chain on a fresh VM. You're expected to manually download and install components in the correct order.</p>
<p><strong>This breaks infrastructure-as-code.</strong></p>
<hr />
<h2 id="what-microsoft-expects-you-to-do">What Microsoft Expects You to Do</h2>
<p>The "official" fix according to various GitHub issues and forums:</p>
<ol>
<li>Manually download VCLibs from Microsoft's site</li>
<li>Install it with <code>Add-AppxPackage</code></li>
<li>Download App Installer</li>
<li>Install it</li>
<li>Download Desktop Runtime</li>
<li>Install it</li>
<li>Restart</li>
<li>Try winget again</li>
<li>(It still doesn't work)</li>
</ol>
<p>I spent 4 hours going down this path. Every manual fix led to another dependency error.</p>
<hr />
<h2 id="the-solution-chocolatey">The Solution: Chocolatey</h2>
<p>Chocolatey is a Windows package manager that:<br />
- Doesn't depend on App Installer<br />
- Doesn't require VCLibs<br />
- Works on fresh marketplace VMs with zero prerequisites<br />
- Has been stable for 10+ years</p>
<p>Install Chocolatey:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">Set-ExecutionPolicy</span> <span class="n">Bypass</span> <span class="n">-Scope</span> <span class="k">Process</span> <span class="n">-Force</span>
<span class="no">[System.Net.ServicePointManager]</span><span class="p">::</span><span class="n">SecurityProtocol</span> <span class="p">=</span> <span class="p">`</span>
    <span class="no">[System.Net.ServicePointManager]</span><span class="p">::</span><span class="n">SecurityProtocol</span> <span class="o">-bor</span> <span class="n">3072</span>
<span class="nb">iex </span><span class="p">((</span><span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">WebClient</span><span class="p">).</span><span class="n">DownloadString</span><span class="p">(</span>
    <span class="s1">&#39;https://community.chocolatey.org/install.ps1&#39;</span><span class="p">))</span>
</code></pre></div>

<p>Then install packages:</p>
<div class="codehilite"><pre><span></span><code><span class="n">choco</span> <span class="n">install</span> <span class="n">-y</span> <span class="n">powershell-core</span> <span class="n">vscode</span> <span class="n">git</span> <span class="n">azure-cli</span> <span class="n">terraform</span>
</code></pre></div>

<p><strong>It just works.</strong></p>
<hr />
<h2 id="the-automated-setup-script">The Automated Setup Script</h2>
<p>I packaged this into a complete Azure admin workstation setup script.</p>
<p><strong>What it installs:</strong><br />
- PowerShell 7<br />
- VS Code with Azure extensions<br />
- Git, Python, Node.js<br />
- Azure CLI, Azure Storage Explorer<br />
- Terraform, Bicep<br />
- Windows Terminal<br />
- Docker Desktop<br />
- Postman, 7-Zip, Notepad++</p>
<p><strong>One command:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Download the script</span>
<span class="nb">Invoke-WebRequest</span> <span class="n">-Uri</span> <span class="s2">&quot;https://raw.githubusercontent.com/dswann101164/azure-admin-workstation-setup/main/Setup-AzureAdminWorkstation-Chocolatey.ps1&quot;</span> <span class="n">-OutFile</span> <span class="s2">&quot;Setup-AzureAdminWorkstation-Chocolatey.ps1&quot;</span>

<span class="c"># Run it</span>
<span class="p">.\</span><span class="n">Setup-AzureAdminWorkstation-Chocolatey</span><span class="p">.</span><span class="n">ps1</span> <span class="n">-NoPrompts</span>
</code></pre></div>

<p><strong>Time to complete:</strong> 15-20 minutes (downloads + installs)</p>
<p><strong>Manual steps required:</strong> Zero</p>
<hr />
<h2 id="complete-script-with-powershell-7-first">Complete Script (with PowerShell 7 First)</h2>
<div class="codehilite"><pre><span></span><code><span class="cm">&lt;#</span>
<span class="sd">.SYNOPSIS</span>
<span class="cm">    Automated Azure admin workstation setup using Chocolatey</span>
<span class="sd">.DESCRIPTION</span>
<span class="cm">    Installs PowerShell 7 FIRST, then all other Azure admin tools.</span>
<span class="cm">    Works on fresh Azure Marketplace Windows VMs. Bypasses winget dependency issues.</span>
<span class="sd">.PARAMETER</span><span class="cm"> NoPrompts</span>
<span class="cm">    Skip all confirmation prompts (for automation)</span>
<span class="sd">.EXAMPLE</span>
<span class="cm">    .\Setup-AzureAdminWorkstation-Chocolatey.ps1 -NoPrompts</span>
<span class="cm">#&gt;</span>

<span class="p">[</span><span class="k">CmdletBinding</span><span class="p">()]</span>
<span class="k">param</span><span class="p">(</span>
    <span class="no">[switch]</span><span class="nv">$NoPrompts</span>
<span class="p">)</span>

<span class="c"># Require admin</span>
<span class="k">if</span> <span class="p">(</span><span class="o">-NOT</span> <span class="p">(</span><span class="no">[Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]</span><span class="p">::</span><span class="n">GetCurrent</span><span class="p">()).</span><span class="n">IsInRole</span><span class="p">(</span><span class="no">[Security.Principal.WindowsBuiltInRole]</span> <span class="s2">&quot;Administrator&quot;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nb">Write-Error</span> <span class="s2">&quot;This script requires administrative privileges. Run PowerShell as Administrator.&quot;</span>
    <span class="n">exit</span> <span class="n">1</span>
<span class="p">}</span>

<span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">=== Azure Admin Workstation Setup (Chocolatey) ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;Installing PowerShell 7 and modern Azure admin tools.</span><span class="se">`n</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>

<span class="c"># Show current PowerShell version</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;Current PowerShell version: </span><span class="p">$(</span><span class="nv">$PSVersionTable</span><span class="p">.</span><span class="n">PSVersion</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$PSVersionTable</span><span class="p">.</span><span class="n">PSVersion</span><span class="p">.</span><span class="n">Major</span> <span class="o">-lt</span> <span class="n">7</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Write-Host</span> <span class="s2">&quot;PowerShell 7 will be installed (required for modern Azure automation)</span><span class="se">`n</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="o">-not</span> <span class="nv">$NoPrompts</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$confirm</span> <span class="p">=</span> <span class="nb">Read-Host</span> <span class="s2">&quot;Continue? (Y/N)&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$confirm</span> <span class="o">-ne</span> <span class="s1">&#39;Y&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">Write-Host</span> <span class="s2">&quot;Installation cancelled.&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
        <span class="n">exit</span> <span class="n">0</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c"># Install Chocolatey</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">[1/4] Installing Chocolatey package manager...&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
<span class="k">if</span> <span class="p">(</span><span class="o">-not</span> <span class="p">(</span><span class="nb">Get-Command</span> <span class="n">choco</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span><span class="p">))</span> <span class="p">{</span>
    <span class="nb">Set-ExecutionPolicy</span> <span class="n">Bypass</span> <span class="n">-Scope</span> <span class="k">Process</span> <span class="n">-Force</span>
    <span class="no">[System.Net.ServicePointManager]</span><span class="p">::</span><span class="n">SecurityProtocol</span> <span class="p">=</span> <span class="no">[System.Net.ServicePointManager]</span><span class="p">::</span><span class="n">SecurityProtocol</span> <span class="o">-bor</span> <span class="n">3072</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nb">Invoke-Expression</span> <span class="p">((</span><span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">WebClient</span><span class="p">).</span><span class="n">DownloadString</span><span class="p">(</span><span class="s1">&#39;https://community.chocolatey.org/install.ps1&#39;</span><span class="p">))</span>
        <span class="nb">Write-Host</span> <span class="s2">&quot;‚úì Chocolatey installed successfully&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">{</span>
        <span class="nb">Write-Error</span> <span class="s2">&quot;Failed to install Chocolatey: $_&quot;</span>
        <span class="n">exit</span> <span class="n">1</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">Write-Host</span> <span class="s2">&quot;‚úì Chocolatey already installed&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
<span class="p">}</span>

<span class="c"># Refresh environment variables</span>
<span class="nv">$env:Path</span> <span class="p">=</span> <span class="no">[System.Environment]</span><span class="p">::</span><span class="n">GetEnvironmentVariable</span><span class="p">(</span><span class="s2">&quot;Path&quot;</span><span class="p">,</span><span class="s2">&quot;Machine&quot;</span><span class="p">)</span> <span class="p">+</span> <span class="s2">&quot;;&quot;</span> <span class="p">+</span> <span class="no">[System.Environment]</span><span class="p">::</span><span class="n">GetEnvironmentVariable</span><span class="p">(</span><span class="s2">&quot;Path&quot;</span><span class="p">,</span><span class="s2">&quot;User&quot;</span><span class="p">)</span>

<span class="c"># Install PowerShell 7 FIRST (most important)</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">[2/4] Installing PowerShell 7...&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;  PowerShell 7 is required for modern Azure automation&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
<span class="n">choco</span> <span class="n">install</span> <span class="n">powershell-core</span> <span class="n">-y</span> <span class="p">-</span><span class="n">-no-progress</span> <span class="n">2</span><span class="p">&gt;&amp;</span><span class="n">1</span> <span class="p">|</span> <span class="nb">Out-Null</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$LASTEXITCODE</span> <span class="o">-eq</span> <span class="n">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Write-Host</span> <span class="s2">&quot;  ‚úì PowerShell 7 installed&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
    <span class="nb">Write-Host</span> <span class="s2">&quot;  After script completes, run: pwsh&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">Write-Host</span> <span class="s2">&quot;  ‚úó PowerShell 7 installation failed&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
<span class="p">}</span>

<span class="c"># Core development tools</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">[3/4] Installing core development tools...&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
<span class="nv">$corePackages</span> <span class="p">=</span> <span class="p">@(</span>
    <span class="s1">&#39;vscode&#39;</span><span class="p">,</span>
    <span class="s1">&#39;git&#39;</span><span class="p">,</span>
    <span class="s1">&#39;python&#39;</span><span class="p">,</span>
    <span class="s1">&#39;nodejs&#39;</span>
<span class="p">)</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$package</span> <span class="k">in</span> <span class="nv">$corePackages</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Write-Host</span> <span class="s2">&quot;  Installing $package...&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
    <span class="n">choco</span> <span class="n">install</span> <span class="nv">$package</span> <span class="n">-y</span> <span class="p">-</span><span class="n">-no-progress</span> <span class="n">2</span><span class="p">&gt;&amp;</span><span class="n">1</span> <span class="p">|</span> <span class="nb">Out-Null</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$LASTEXITCODE</span> <span class="o">-eq</span> <span class="n">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">Write-Host</span> <span class="s2">&quot;  ‚úì $package&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">Write-Host</span> <span class="s2">&quot;  ‚úó $package (failed)&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c"># Azure tools</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">[4/4] Installing Azure tools...&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
<span class="nv">$azurePackages</span> <span class="p">=</span> <span class="p">@(</span>
    <span class="s1">&#39;azure-cli&#39;</span><span class="p">,</span>
    <span class="s1">&#39;microsoft-windows-terminal&#39;</span><span class="p">,</span>
    <span class="s1">&#39;azure-data-studio&#39;</span><span class="p">,</span>
    <span class="s1">&#39;microsoftazurestorageexplorer&#39;</span><span class="p">,</span>
    <span class="s1">&#39;terraform&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bicep&#39;</span>
<span class="p">)</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$package</span> <span class="k">in</span> <span class="nv">$azurePackages</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Write-Host</span> <span class="s2">&quot;  Installing $package...&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
    <span class="n">choco</span> <span class="n">install</span> <span class="nv">$package</span> <span class="n">-y</span> <span class="p">-</span><span class="n">-no-progress</span> <span class="n">2</span><span class="p">&gt;&amp;</span><span class="n">1</span> <span class="p">|</span> <span class="nb">Out-Null</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$LASTEXITCODE</span> <span class="o">-eq</span> <span class="n">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">Write-Host</span> <span class="s2">&quot;  ‚úì $package&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">Write-Host</span> <span class="s2">&quot;  ‚úó $package (failed)&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c"># Optional tools</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">Installing optional tools...&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
<span class="nv">$optionalPackages</span> <span class="p">=</span> <span class="p">@(</span>
    <span class="s1">&#39;docker-desktop&#39;</span><span class="p">,</span>
    <span class="s1">&#39;postman&#39;</span><span class="p">,</span>
    <span class="s1">&#39;7zip&#39;</span><span class="p">,</span>
    <span class="s1">&#39;notepadplusplus&#39;</span>
<span class="p">)</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$package</span> <span class="k">in</span> <span class="nv">$optionalPackages</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Write-Host</span> <span class="s2">&quot;  Installing $package...&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
    <span class="n">choco</span> <span class="n">install</span> <span class="nv">$package</span> <span class="n">-y</span> <span class="p">-</span><span class="n">-no-progress</span> <span class="n">2</span><span class="p">&gt;&amp;</span><span class="n">1</span> <span class="p">|</span> <span class="nb">Out-Null</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$LASTEXITCODE</span> <span class="o">-eq</span> <span class="n">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">Write-Host</span> <span class="s2">&quot;  ‚úì $package&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">Write-Host</span> <span class="s2">&quot;  ‚úó $package (skipped)&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">=== Setup Complete ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;IMPORTANT: Launch PowerShell 7 by running: pwsh</span><span class="se">`n</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>

<span class="c"># Show PowerShell 7 verification</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;Verifying PowerShell 7 installation:&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
<span class="k">try</span> <span class="p">{</span>
    <span class="nv">$ps7Path</span> <span class="p">=</span> <span class="nb">Get-Command</span> <span class="n">pwsh</span> <span class="n">-ErrorAction</span> <span class="n">Stop</span>
    <span class="nb">Write-Host</span> <span class="s2">&quot;  ‚úì PowerShell 7 installed at: </span><span class="p">$(</span><span class="nv">$ps7Path</span><span class="p">.</span><span class="n">Source</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
    <span class="nv">$ps7Version</span> <span class="p">=</span> <span class="p">&amp;</span> <span class="n">pwsh</span> <span class="n">-NoProfile</span> <span class="n">-Command</span> <span class="s1">&#39;$PSVersionTable.PSVersion.ToString()&#39;</span>
    <span class="nb">Write-Host</span> <span class="s2">&quot;  ‚úì Version: $ps7Version&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
    <span class="nb">Write-Host</span> <span class="s2">&quot;  ‚úó PowerShell 7 not found (may require restart)&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
<span class="p">}</span>

<span class="c"># Show other installed versions</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">Verifying other installations:&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
<span class="nv">$checks</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="s1">&#39;Git&#39;</span> <span class="p">=</span> <span class="p">{</span> <span class="n">git</span> <span class="p">-</span><span class="n">-version</span> <span class="p">}</span>
    <span class="s1">&#39;Azure CLI&#39;</span> <span class="p">=</span> <span class="p">{</span> <span class="n">az</span> <span class="p">-</span><span class="n">-version</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">-First</span> <span class="n">1</span> <span class="p">}</span>
    <span class="s1">&#39;Terraform&#39;</span> <span class="p">=</span> <span class="p">{</span> <span class="n">terraform</span> <span class="p">-</span><span class="n">-version</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">-First</span> <span class="n">1</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$tool</span> <span class="k">in</span> <span class="nv">$checks</span><span class="p">.</span><span class="n">Keys</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nv">$version</span> <span class="p">=</span> <span class="p">&amp;</span> <span class="nv">$checks</span><span class="p">[</span><span class="nv">$tool</span><span class="p">]</span>
        <span class="nb">Write-Host</span> <span class="s2">&quot;  ‚úì $tool`: $version&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">{</span>
        <span class="nb">Write-Host</span> <span class="s2">&quot;  ‚úó $tool`: Not found (may require restart)&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">=== Next Steps ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;1. Close this PowerShell 5.1 window&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;2. Open PowerShell 7 by running: pwsh&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;3. Verify with: </span><span class="se">`$</span><span class="s2">PSVersionTable.PSVersion&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;4. Install Azure PowerShell modules: Install-Module -Name Az -Repository PSGallery -Force</span><span class="se">`n</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</code></pre></div>

<p><strong>Download from GitHub:</strong> <a href="https://github.com/dswann101164/azure-admin-workstation-setup/blob/main/Setup-AzureAdminWorkstation-Chocolatey.ps1">Setup-AzureAdminWorkstation-Chocolatey.ps1</a></p>
<hr />
<h2 id="why-chocolatey-works-and-winget-doesn-t">Why Chocolatey Works (and winget Doesn't)</h2>
<p><strong>Chocolatey:</strong><br />
- Uses direct HTTPS downloads<br />
- No dependency on Microsoft's App Installer infrastructure<br />
- Simple executable wrappers<br />
- Proven stable since 2011</p>
<p><strong>winget:</strong><br />
- Depends on App Installer (UWP app)<br />
- Requires specific VCLibs versions<br />
- Certificate validation tied to Windows Update<br />
- Breaks on isolated/offline systems</p>
<p>For enterprise Azure VMs where you control the provisioning pipeline, Chocolatey is more reliable.</p>
<hr />
<h2 id="the-powershell-7-migration-path">The PowerShell 7 Migration Path</h2>
<p>Once you have PowerShell 7 installed via Chocolatey, here's what changes:</p>
<h3 id="stop-using-powershell-ise">Stop Using PowerShell ISE</h3>
<p>PowerShell ISE (Integrated Scripting Environment) only works with PowerShell 5.1. It's deprecated. Microsoft stopped development in 2016.</p>
<p><strong>Old workflow (PowerShell 5.1 + ISE):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Open PowerShell ISE</span>
<span class="n">ise</span><span class="p">.</span><span class="n">exe</span>

<span class="c"># Your scripts use old syntax</span>
<span class="nv">$vm</span> <span class="p">=</span> <span class="nb">Get-AzVM</span> <span class="n">-Name</span> <span class="s2">&quot;myvm&quot;</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$vm</span> <span class="o">-ne</span> <span class="nv">$null</span><span class="p">)</span> <span class="p">{</span>
    <span class="c"># Do something</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>New workflow (PowerShell 7 + VS Code):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Open VS Code with PowerShell extension</span>
<span class="n">code</span> <span class="p">.</span>

<span class="c"># Your scripts use modern syntax</span>
<span class="nv">$vm</span> <span class="p">=</span> <span class="nb">Get-AzVM</span> <span class="n">-Name</span> <span class="s2">&quot;myvm&quot;</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$vm</span><span class="p">)</span> <span class="p">{</span>  <span class="c"># Simplified null check</span>
    <span class="c"># Do something</span>
<span class="p">}</span>

<span class="c"># Ternary operator (PowerShell 7+)</span>
<span class="nv">$status</span> <span class="p">=</span> <span class="nv">$vm</span> <span class="p">?</span> <span class="s2">&quot;Running&quot;</span> <span class="p">:</span> <span class="s2">&quot;Stopped&quot;</span>

<span class="c"># Pipeline chain operators (PowerShell 7+)</span>
<span class="nb">Get-AzVM</span> <span class="n">-Name</span> <span class="s2">&quot;myvm&quot;</span> <span class="p">&amp;&amp;</span> <span class="nb">Start-AzVM</span> <span class="n">-Name</span> <span class="s2">&quot;myvm&quot;</span> <span class="p">||</span> <span class="nb">Write-Error</span> <span class="s2">&quot;VM not found&quot;</span>
</code></pre></div>

<h3 id="modern-azure-modules-require-powershell-7">Modern Azure Modules Require PowerShell 7</h3>
<p>Many new Azure PowerShell modules target PowerShell 7:</p>
<div class="codehilite"><pre><span></span><code><span class="c"># PowerShell 7 required</span>
<span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">Az</span><span class="p">.</span><span class="n">App</span> <span class="n">-Force</span>  <span class="c"># Azure Container Apps</span>
<span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">Az</span><span class="p">.</span><span class="n">DevCenter</span> <span class="n">-Force</span>  <span class="c"># Azure Dev Center</span>
<span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">Az</span><span class="p">.</span><span class="n">ContainerInstance</span> <span class="n">-Force</span>  <span class="c"># Updated modules</span>
</code></pre></div>

<p><strong>If you're on PowerShell 5.1, you're missing entire Azure service modules.</strong></p>
<h3 id="script-compatibility">Script Compatibility</h3>
<p>Your existing PowerShell 5.1 scripts will run in PowerShell 7 (99% compatibility).</p>
<p><strong>But:</strong> Some deprecated cmdlets don't work. Test your scripts after migration.</p>
<p><strong>Common issues:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># PowerShell 5.1 - works</span>
<span class="nb">Invoke-WebRequest</span> <span class="n">-UseBasicParsing</span>

<span class="c"># PowerShell 7 - -UseBasicParsing is default, parameter deprecated</span>
<span class="nb">Invoke-WebRequest</span>  <span class="c"># Just works</span>

<span class="c"># PowerShell 5.1 - works</span>
<span class="nv">$PSVersionTable</span><span class="p">.</span><span class="n">CLRVersion</span>

<span class="c"># PowerShell 7 - .NET Core doesn&#39;t expose CLRVersion</span>
<span class="nv">$PSVersionTable</span><span class="p">.</span><span class="n">PSVersion</span>  <span class="c"># Use this instead</span>
</code></pre></div>

<h3 id="running-both-side-by-side">Running Both Side-by-Side</h3>
<p>PowerShell 7 installs alongside PowerShell 5.1. Both remain available:</p>
<div class="codehilite"><pre><span></span><code><span class="c"># Launch PowerShell 5.1 (Windows PowerShell)</span>
<span class="n">powershell</span><span class="p">.</span><span class="n">exe</span>

<span class="c"># Launch PowerShell 7</span>
<span class="n">pwsh</span><span class="p">.</span><span class="n">exe</span>
</code></pre></div>

<p><strong>Your Azure admin workflow:</strong><br />
1. Use PowerShell 7 for all new scripts<br />
2. Keep PowerShell 5.1 for legacy scripts that can't migrate<br />
3. Gradually migrate old scripts to PowerShell 7</p>
<hr />
<h2 id="when-you-actually-need-winget">When You Actually Need winget</h2>
<p>If you're managing end-user workstations with:<br />
- Windows Update enabled<br />
- Regular feature updates<br />
- Public internet access<br />
- Non-isolated environments</p>
<p>Then winget works fine and integrates better with Windows 11's package management.</p>
<p><strong>For Azure infrastructure VMs, use Chocolatey.</strong></p>
<hr />
<h2 id="automating-this-in-your-deployment-pipeline">Automating This in Your Deployment Pipeline</h2>
<p><strong>Terraform:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;azurerm_virtual_machine_extension&quot;</span><span class="w"> </span><span class="nv">&quot;setup&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;setup-workstation&quot;</span>
<span class="w">  </span><span class="na">virtual_machine_id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_windows_virtual_machine.admin.id</span>
<span class="w">  </span><span class="na">publisher</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Microsoft.Compute&quot;</span>
<span class="w">  </span><span class="na">type</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;CustomScriptExtension&quot;</span>
<span class="w">  </span><span class="na">type_handler_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1.10&quot;</span>

<span class="w">  </span><span class="na">settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
<span class="w">    </span><span class="na">commandToExecute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;powershell -ExecutionPolicy Bypass -File Setup-AzureAdminWorkstation-Chocolatey.ps1 -NoPrompts&quot;</span>
<span class="w">  </span><span class="p">})</span>

<span class="w">  </span><span class="na">protected_settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
<span class="w">    </span><span class="na">fileUris</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;https://raw.githubusercontent.com/dswann101164/azure-admin-workstation-setup/main/Setup-AzureAdminWorkstation-Chocolatey.ps1&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>ARM Template:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Microsoft.Compute/virtualMachines/extensions&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;[concat(variables(&#39;vmName&#39;), &#39;/setup&#39;)]&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;publisher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Microsoft.Compute&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CustomScriptExtension&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;typeHandlerVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.10&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;fileUris&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;https://raw.githubusercontent.com/dswann101164/azure-admin-workstation-setup/main/Setup-AzureAdminWorkstation-Chocolatey.ps1&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;commandToExecute&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;powershell -ExecutionPolicy Bypass -File Setup-AzureAdminWorkstation-Chocolatey.ps1 -NoPrompts&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Bicep:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">resource</span><span class="w"> </span><span class="n">setupExtension</span><span class="w"> </span><span class="err">&#39;</span><span class="n">Microsoft</span><span class="p">.</span><span class="n">Compute</span><span class="o">/</span><span class="n">virtualMachines</span><span class="o">/</span><span class="n">extensions</span><span class="mi">@2023</span><span class="mo">-03-01</span><span class="err">&#39;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nl">parent</span><span class="p">:</span><span class="w"> </span><span class="n">adminVM</span>
<span class="w">  </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="n">setup</span><span class="o">-</span><span class="n">workstation</span><span class="err">&#39;</span>
<span class="w">  </span><span class="nl">properties</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">publisher</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="n">Microsoft</span><span class="p">.</span><span class="n">Compute</span><span class="err">&#39;</span>
<span class="w">    </span><span class="nl">type</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="n">CustomScriptExtension</span><span class="err">&#39;</span>
<span class="w">    </span><span class="nl">typeHandlerVersion</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="mf">1.10</span><span class="err">&#39;</span>
<span class="w">    </span><span class="nl">settings</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nl">fileUris</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="err">&#39;</span><span class="n">https</span><span class="o">:</span><span class="c1">//raw.githubusercontent.com/dswann101164/azure-admin-workstation-setup/main/Setup-AzureAdminWorkstation-Chocolatey.ps1&#39;</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">      </span><span class="nl">commandToExecute</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="n">powershell</span><span class="w"> </span><span class="o">-</span><span class="n">ExecutionPolicy</span><span class="w"> </span><span class="n">Bypass</span><span class="w"> </span><span class="o">-</span><span class="n">File</span><span class="w"> </span><span class="n">Setup</span><span class="o">-</span><span class="n">AzureAdminWorkstation</span><span class="o">-</span><span class="n">Chocolatey</span><span class="p">.</span><span class="n">ps1</span><span class="w"> </span><span class="o">-</span><span class="n">NoPrompts</span><span class="err">&#39;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="what-gets-installed-powershell-7-first">What Gets Installed (PowerShell 7 First)</h2>
<p><strong>PowerShell 7 (installed first):</strong><br />
- PowerShell 7.4+ (replaces need for Windows PowerShell 5.1)<br />
- Parallel installation (5.1 remains available)<br />
- Launch with: <code>pwsh</code></p>
<p><strong>Development tools:</strong><br />
- Visual Studio Code with PowerShell extension<br />
- Git 2.43+<br />
- Python 3.12+<br />
- Node.js 20 LTS</p>
<p><strong>Azure tools:</strong><br />
- Azure CLI 2.57+<br />
- Azure Storage Explorer<br />
- Azure Data Studio<br />
- Windows Terminal (better than old console)</p>
<p><strong>Infrastructure tools:</strong><br />
- Terraform latest<br />
- Bicep latest</p>
<p><strong>Utilities:</strong><br />
- Docker Desktop<br />
- Postman<br />
- 7-Zip<br />
- Notepad++</p>
<p><strong>After installation:</strong><br />
1. Close PowerShell 5.1<br />
2. Open PowerShell 7: <code>pwsh</code><br />
3. Install Azure modules: <code>Install-Module -Name Az -Force</code></p>
<p><strong>Total install time:</strong> 15-20 minutes</p>
<hr />
<h2 id="troubleshooting">Troubleshooting</h2>
<p><strong>Problem:</strong> Script fails with execution policy error</p>
<p><strong>Solution:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nb">Set-ExecutionPolicy</span> <span class="n">-ExecutionPolicy</span> <span class="n">RemoteSigned</span> <span class="n">-Scope</span> <span class="n">CurrentUser</span>
</code></pre></div>

<p><strong>Problem:</strong> Chocolatey install hangs</p>
<p><strong>Solution:</strong> Check if antivirus is blocking the download. Temporarily disable or add exception for <code>chocolatey.org</code>.</p>
<p><strong>Problem:</strong> Individual package fails</p>
<p><strong>Solution:</strong> Run manually:</p>
<div class="codehilite"><pre><span></span><code><span class="n">choco</span> <span class="n">install</span> <span class="n">package-name</span> <span class="n">-y</span> <span class="p">-</span><span class="n">-force</span>
</code></pre></div>

<p><strong>Problem:</strong> Tools not found after install</p>
<p><strong>Solution:</strong> Restart your terminal or refresh environment:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">$env:Path</span> <span class="p">=</span> <span class="no">[System.Environment]</span><span class="p">::</span><span class="n">GetEnvironmentVariable</span><span class="p">(</span><span class="s2">&quot;Path&quot;</span><span class="p">,</span><span class="s2">&quot;Machine&quot;</span><span class="p">)</span> <span class="p">+</span> <span class="s2">&quot;;&quot;</span> <span class="p">+</span> <span class="no">[System.Environment]</span><span class="p">::</span><span class="n">GetEnvironmentVariable</span><span class="p">(</span><span class="s2">&quot;Path&quot;</span><span class="p">,</span><span class="s2">&quot;User&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="alternative-the-winget-version-if-you-must">Alternative: The winget Version (If You Must)</h2>
<p>If you've already updated your marketplace image or have a functioning winget, there's a winget-based version in the repo:</p>
<div class="codehilite"><pre><span></span><code><span class="p">.\</span><span class="n">Setup-AzureAdminWorkstation</span><span class="p">.</span><span class="n">ps1</span> <span class="n">-NoPrompts</span>
</code></pre></div>

<p><strong>But:</strong> This will fail on fresh marketplace VMs. Use the Chocolatey version.</p>
<hr />
<h2 id="get-the-complete-scripts">Get the Complete Scripts</h2>
<p><strong>‚≠ê GitHub Repository:</strong> <a href="https://github.com/dswann101164/azure-admin-workstation-setup">azure-admin-workstation-setup</a></p>
<p><strong>What's included:</strong><br />
- Chocolatey version (recommended)<br />
- winget version (for updated systems)<br />
- Fresh VM updater script<br />
- Full documentation<br />
- Terraform/ARM/Bicep examples</p>
<p>Star the repo if this saves you time.</p>
<hr />
<h2 id="related-guides">Related Guides</h2>
<p><strong>Automation:</strong><br />
- <a href="/hub/automation/">Azure Automation Hub</a> - PowerShell automation patterns<br />
- <a href="/blog/azure-scripts-break-server-2025/">PowerShell Scripts Break on Server 2025</a> - ISE vs PowerShell 7 migration</p>
<p><strong>Infrastructure:</strong><br />
- <a href="/hub/terraform/">Terraform Hub</a> - Infrastructure as Code examples<br />
- <a href="/hub/arc/">Azure Arc Hub</a> - Hybrid workstation management</p>
<hr />
<p><strong>Production-tested on Azure Marketplace Windows 11 Enterprise N VMs. MIT licensed. Contributions welcome.</strong></p>
  </div>

  
  <section class="starter-kit-callout" style="
    max-width: 800px;
    margin: 3rem auto 2rem;
    padding: 2rem;
    border-radius: 12px;
    background: var(--bg-light);
    border: 1px solid var(--border);
    text-align: left;
  ">
    <h3 style="margin-top: 0;">Azure Admin Starter Kit (Free Download)</h3>
    <p style="margin-bottom: 1rem;">
      Get my KQL cheat sheet, 50 Windows + 50 Linux commands, and an Azure RACI template in one free bundle.
    </p>
    <a href="/blog/starter-kit/" class="btn">Get the Starter Kit ‚Üí</a>
  </section>



  
  
  <aside class="related-posts" style="max-width: 800px; margin: 3rem auto; padding: 2rem; background: var(--bg-light); border-radius: 12px;">
    <h3 style="margin-top: 0;">Related Posts</h3>
    <ul style="list-style: none; padding: 0;">
      
      <li style="margin: 1rem 0;">
        <a href="/blog/azure-vm-automation-dependency-hell/" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">Why Your Automation Fails on Fresh Azure VMs (And How I Fixed It)</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-09-29</span>
        </a>
      </li>
      
      <li style="margin: 1rem 0;">
        <a href="/blog/powershell-7-enterprise-migration/" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">PowerShell 7 Migration Guide (Complete Checklist + Time Savings Calculator)</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-11-03</span>
        </a>
      </li>
      
      <li style="margin: 1rem 0;">
        <a href="/blog/azure-periodic-table-service-dictionary/" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">I Scraped the Azure Periodic Table to Build a Service Dictionary (And You Can Use It)</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-10-29</span>
        </a>
      </li>
      
    </ul>
  </aside>
  

  
  
  
    <!-- CTA: Azure Admin Starter Kit (Free Download) -->
<div class="cta-block" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: 2rem; border-radius: 8px; margin: 3rem 0; text-align: center; color: white;">
  <h3 style="margin: 0 0 1rem; font-size: 1.75rem; color: white;">üöÄ Azure Admin Starter Kit</h3>
  <p style="margin: 0 0 1.5rem; font-size: 1.1rem; line-height: 1.6;">
    Get the <strong>KQL cheat sheet, 50 Windows + 50 Linux commands, and Azure RACI template</strong> in one free bundle.
    Built from managing 44 subscriptions and 31,000+ resources.
  </p>
  <a href="/blog/starter-kit/" 
     style="display: inline-block; padding: 0.75rem 2rem; background: white; color: #4facfe; text-decoration: none; border-radius: 6px; font-weight: 700; font-size: 1.1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transition: all 0.3s ease;"
     onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,0,0,0.2)'"
     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'">
    Get the Starter Kit ‚Üí
  </a>
  <p style="margin: 1rem 0 0; font-size: 0.9rem; opacity: 0.9;">
    Free download ‚Ä¢ No email required ‚Ä¢ Instant access
  </p>
</div>
  

  
  <nav class="post-nav">
    
      <a href="/blog/azure-finops-complete-guide/">
        <span style="opacity: 0.7; font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">‚Üê Previous</span>
        <strong>Azure FinOps Complete Guide 2026: Tag Governance, Cost Allocation &amp; Chargeback Models</strong>
      </a>
    
    
  </nav>

</article>

    </div>
  </main>

  <footer class="site-footer">
    <div class="wrap">
      <p>&copy; 2026 Azure Noob ‚Äî Don&#39;t be a Noob</p>
      <p style="margin-top: 0.5rem; font-size: 0.9rem;">
        <a href="/feed.xml" title="Subscribe via RSS">RSS Feed</a> ¬∑ 
        <a href="https://github.com/dswann101164" target="_blank" rel="noopener">GitHub</a>
      </p>
      <p style="margin-top: 1.5rem; font-size: 0.85rem; opacity: 0.7; font-style: italic;">
        "Trust in the Lord with all your heart, and lean not on your own understanding;<br>
        in all your ways acknowledge Him, and He will make your paths straight" ‚Äî Proverbs 3:5-6
      </p>
    </div>
  </footer>

  <!-- Copy code functionality -->
  <script src="/static/copy-code.js"></script>


</body>
</html>