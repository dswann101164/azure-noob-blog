<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  
  

  <!-- Primary SEO -->
  <title>The Azure Arc Multi-vCenter Implementation Guide That Actually Works ¬∑ Azure Noob</title>
  <meta name="description" content="End-to-end implementation guide for connecting VMware vCenter to Azure Arc with governance in mind: tags, policy, RBAC, and reporting from day one.">
  
  <link rel="canonical" href="https://azure-noob.com/blog/azure-arc-vcenter-implementation-guide/" />

  <!-- Favicons -->
  <link rel="icon" href="/static/images/logo.png">

  <!-- Open Graph -->
  <meta property="og:title" content="The Azure Arc Multi-vCenter Implementation Guide That Actually Works">
  <meta property="og:description" content="End-to-end implementation guide for connecting VMware vCenter to Azure Arc with governance in mind: tags, policy, RBAC, and reporting from day one.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://azure-noob.com/blog/azure-arc-vcenter-implementation-guide/">
  <meta property="og:image" content="https://azure-noob.com/static/images/hero/azure-arc-vcenter-guide.png">

  
    <meta property="article:published_time" content="2025-11-24T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-11-24T00:00:00+00:00">
    <meta property="article:author" content="David Swann">
    
      
        <meta property="article:tag" content="Azure">
      
        <meta property="article:tag" content="Azure Arc">
      
        <meta property="article:tag" content="Enterprise">
      
        <meta property="article:tag" content="Governance">
      
        <meta property="article:tag" content="Hybrid">
      
        <meta property="article:tag" content="Migration">
      
        <meta property="article:tag" content="VMware">
      
        <meta property="article:tag" content="vCenter">
      
    
  

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="The Azure Arc Multi-vCenter Implementation Guide That Actually Works">
  <meta name="twitter:description" content="End-to-end implementation guide for connecting VMware vCenter to Azure Arc with governance in mind: tags, policy, RBAC, and reporting from day one.">
  <meta name="twitter:image" content="https://azure-noob.com/static/images/hero/azure-arc-vcenter-guide.png">

  <!-- Styles -->
  <link rel="stylesheet" href="/static/styles.css">

  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="Azure Noob RSS Feed" href="https://azure-noob.com/rss.xml">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZNHGEB0BNZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-ZNHGEB0BNZ');
  </script>
</head>
<body>
  <header class="site-header">
    <div class="wrap nav-wrap">
      <div class="brand-block">
        <a href="/" class="brand-link">
          <img src="/static/images/logo.png" alt="Azure Noob logo" class="logo">
        </a>
        <span class="brand-text">
          <small>Official Website of</small>
          <strong>Azure Noob</strong>
        </span>
      </div>
      <nav class="nav">
        <a href="/">Home</a>
        <a href="/blog/">Blog</a>
        <a href="/hubs/" style="font-weight: 700;">Content Hubs</a>
        <a href="/products/" style="font-weight: 700; color: #ff6b6b;">Products</a>
        <a href="/start-here/">Start Here</a>
        <a href="/blog/starter-kit/">Starter Kit</a>
        <a href="/about/">About</a>
        <a href="/tags/">Tags</a>
        <a href="https://github.com/dswann101164" target="_blank" rel="noopener">GitHub</a>
        <a href="/search/">Search</a>
      </nav>
    </div>
  </header>

  <main class="site-content">
    <div class="wrap">
      


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "The Azure Arc Multi-vCenter Implementation Guide That Actually Works",
  "description": "End-to-end implementation guide for connecting VMware vCenter to Azure Arc with governance in mind: tags, policy, RBAC, and reporting from day one.",
  "image": {
    "@type": "ImageObject",
    "url": "https://azure-noob.com/static/images/hero/azure-arc-vcenter-guide.png",
    "width": 1200,
    "height": 630
  },
  "author": {
    "@type": "Person",
    "name": "David Swann",
    "url": "https://azure-noob.com/about/",
    "description": "Azure Architect specializing in enterprise cloud infrastructure",
    "jobTitle": "Azure Architect",
    "worksFor": {
      "@type": "Organization",
      "name": "Synovus"
    }
  },
  "publisher": {
    "@type": "Organization",
    "name": "Azure Noob",
    "url": "https://azure-noob.com",
    "logo": {
      "@type": "ImageObject",
      "url": "https://azure-noob.com/static/images/logo.png"
    }
  },
  "datePublished": "2025-11-24T00:00:00+00:00",
  "dateModified": "2025-11-24T00:00:00+00:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://azure-noob.com/blog/azure-arc-vcenter-implementation-guide/"
  },
  "keywords": "Azure, Azure Arc, Enterprise, Governance, Hybrid, Migration, VMware, vCenter",
  "articleSection": "Azure",
  "wordCount": "10163",
  "timeRequired": "PT51M",
  "inLanguage": "en-US",
  "isAccessibleForFree": "True",
  "about": {
    "@type": "Thing",
    "name": "Azure"
  }
}
</script>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://azure-noob.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": "https://azure-noob.com/blog/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "The Azure Arc Multi-vCenter Implementation Guide That Actually Works",
      "item": "https://azure-noob.com/blog/azure-arc-vcenter-implementation-guide/"
    }
  ]
}
</script>







<article class="post">

  
  
    
    <div class="hero">
      <img src="/static/images/hero/azure-arc-vcenter-guide.png" alt="The Azure Arc Multi-vCenter Implementation Guide That Actually Works" loading="eager">
    </div>
  

  <header class="post-header">
    <h1>The Azure Arc Multi-vCenter Implementation Guide That Actually Works</h1>
    <p class="muted">
      2025-11-24 ¬∑ ~51 min read
      
    </p>
    
    
    <ul class="tags-list">
      
      <li><a href="/tags/azure/" class="tag-badge">Azure</a></li>
      
      <li><a href="/tags/azure-arc/" class="tag-badge">Azure Arc</a></li>
      
      <li><a href="/tags/enterprise/" class="tag-badge">Enterprise</a></li>
      
      <li><a href="/tags/governance/" class="tag-badge">Governance</a></li>
      
      <li><a href="/tags/hybrid/" class="tag-badge">Hybrid</a></li>
      
      <li><a href="/tags/migration/" class="tag-badge">Migration</a></li>
      
      <li><a href="/tags/vmware/" class="tag-badge">VMware</a></li>
      
      <li><a href="/tags/vcenter/" class="tag-badge">vCenter</a></li>
      
    </ul>
    
    
    
      <p class="summary">End-to-end implementation guide for connecting VMware vCenter to Azure Arc with governance in mind: tags, policy, RBAC, and reporting from day one.</p>
    
  </header>

  
  <p class="post-actions" style="margin:.5rem 0 0; text-align: center;">
    <button class="btn"
            onclick="window.print(); return false;"
            title="Print this page"
            aria-label="Print this page"
            style="cursor: pointer; background: none; border: 2px solid var(--azure-blue);">
      üñ®Ô∏è Print this page
    </button>
  </p>

  
  <div class="post-body">
    <p>This guide is part of our <a href="/hub/migration/">Azure Migration hub</a> covering assessment, planning, execution, and post-migration optimization.<br />
My boss asked me and my colleague to train the team on Azure Arc this morning. We're the only two people in the organization who understand Azure at scale. We just connected 1,200+ servers to Arc under pressure from Microsoft with no governance strategy.</p>
<p>Now we're supposed to teach others how to use it.</p>
<p>We're still laughing about it.</p>
<p>Here's why this is every enterprise Azure Arc deployment, and more importantly, here's the complete implementation guide that doesn't exist anywhere else.</p>
<h2>The Reality Check: How Arc Deployments Actually Happen</h2>
<p><strong>What Should Happen:</strong><br />
1. Plan subscription and resource group strategy<br />
2. Define tagging taxonomy with stakeholder input<br />
3. Map cost centers and application owners<br />
4. Design migration wave structure<br />
5. Deploy Arc with governance from day one</p>
<p><strong>What Actually Happens:</strong><br />
1. Microsoft sales calls every week about ESU deadlines<br />
2. Leadership says "just get the servers connected, we'll figure out governance later"<br />
3. You deploy everything to one subscription, one resource group, zero tags<br />
4. Three months later: "Which department pays for these Arc licenses?"<br />
5. You have no answer because there's no metadata<br />
6. Now you're supposed to train people on a system you haven't properly architected</p>
<p><img alt="Don't be this guy" src="/static/images/hero/do-not-be-this-guy.png" /><br />
<em>Figure 1: The "rushed Arc deployment" disaster - Everything crammed into one resource group with zero organization or tags</em></p>
<p>This pattern repeats across every enterprise I've talked to. Tactical pressure destroys strategic planning every single time.</p>
<p>The problem isn't the technology. Azure Arc works. The problem is nobody documents <strong>how to actually implement Arc at enterprise scale</strong> with proper governance.</p>
<p>This guide fixes that.</p>
<h2>What is Azure Arc for VMware vCenter?</h2>
<p><strong>Quick Answer:</strong> Azure Arc for VMware vCenter connects your on-premises VMware infrastructure to Azure, enabling cloud-based management, security, and governance for VMs that stay in your datacenter.</p>
<h3>How Azure Arc Works</h3>
<p>Azure Arc uses a <strong>two-phase deployment model</strong> that most documentation glosses over:</p>
<p><strong>Phase 1: Deploy Arc Resource Bridge</strong><br />
- A Kubernetes-based appliance VM deployed INTO your vCenter environment<br />
- Connects your vCenter infrastructure to Azure cloud<br />
- Makes VM inventory visible in Azure Portal<br />
- <strong>Requirements:</strong> vCenter 7 or 8, 3 static IP addresses, 8GB RAM minimum</p>
<p><strong>Phase 2: Install Arc Connected Machine Agents</strong><br />
- Individual agents installed on each VM you want to manage<br />
- Enables guest OS management, ESU licensing, and Azure services<br />
- Must be deployed WITH tags for proper cost allocation</p>
<h3>What You Can Do With Arc</h3>
<p>‚úÖ <strong>ESU Licensing:</strong> Extend support for Windows Server 2012/R2 without migrating to Azure<br />
‚úÖ <strong>Unified Inventory:</strong> See all VMs from multiple vCenters in one Azure Portal view<br />
‚úÖ <strong>Azure Monitor:</strong> Collect logs and metrics from on-premises VMs<br />
‚úÖ <strong>Azure Policy:</strong> Apply governance and compliance policies to hybrid infrastructure<br />
‚úÖ <strong>Migration Planning:</strong> Use Azure Migrate to assess workloads before moving to cloud<br />
‚úÖ <strong>Cost Allocation:</strong> Tag VMs by department, application, or cost center for chargeback</p>
<h3>Common Use Cases</h3>
<p><strong>Enterprise Scenarios:</strong><br />
- Managing 3+ vCenter instances (Production, Dev/Test, DR)<br />
- Merger situations with acquired company vCenters<br />
- Extended Security Updates for legacy Windows servers<br />
- Multi-cloud inventory (Azure + VMware + AWS + GCP)</p>
<p><strong>Deployment Timeline:</strong><br />
- POC (single vCenter, &lt;50 VMs): 2-3 hours<br />
- Enterprise (3 vCenters, 1,200+ VMs): 8-10 weeks including governance planning</p>
<p><strong>Critical Success Factor:</strong> Tag your VMs DURING deployment, not after. Retroactive tagging requires metadata you don't have (cost centers, application owners, migration priorities).</p>
<hr />
<p>Now let's talk about why most Arc deployments fail...</p>
<h2>The Multi-vCenter Arc Architecture (The Goal)</h2>
<p>Before we talk about what goes wrong, here's what proper multi-vCenter Arc architecture looks like:</p>
<p><img alt="Multi-vCenter Arc Architecture" src="/static/images/hero/arc-multi-vcenter-goal.png" /><br />
<em>The Goal: Each vCenter gets its own Arc Resource Bridge connecting to Azure Arc for unified management</em></p>
<p><strong>This is the target architecture:</strong><br />
- Three vCenter environments (Production, Dev/Test, DR)<br />
- Each vCenter has a dedicated Arc Resource Bridge (Kubernetes appliance VM)<br />
- All bridges connect to Azure Arc cloud for unified management<br />
- Clean separation allows independent lifecycle management<br />
- Proper organization in Azure with resource groups and tags</p>
<p>Now let's look at what actually happens in most enterprises...</p>
<h2>How Azure Arc Actually Connects to vCenter</h2>
<p>Before we dive into implementation, here's what the architecture actually looks like:</p>
<p><img alt="Azure Arc vCenter Architecture" src="/static/images/hero/azure-arc-vcenter-guide.png" /></p>
<p><strong>What this diagram shows:</strong><br />
1. <strong>Left side (On-Premises):</strong> Your vCenter environment with VMs and the vCenter Server<br />
2. <strong>Middle (The Bridge):</strong> Arc Resource Bridge appliance deployed FROM a jump box<br />
3. <strong>Right side (Azure Cloud):</strong> Azure Arc services that manage your on-prem VMs</p>
<p><strong>The critical flow:</strong><br />
- Jump box (admin workstation) runs deployment scripts<br />
- Scripts create the Arc Resource Bridge as a Kubernetes appliance VM in vCenter<br />
- Resource Bridge connects to Azure and registers your vCenter<br />
- Azure Portal now shows vCenter inventory<br />
- You then Arc-enable individual VMs for management</p>
<p>Keep this diagram in mind - it's the foundation for everything that follows.</p>
<h2>Quick Start: Single vCenter POC (Skip the Enterprise Complexity)</h2>
<p>If you're testing Arc with a single vCenter and &lt;50 VMs, here's the fast path:</p>
<p><strong>30-Minute POC Setup:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># 1. Deploy jump box (or use your admin workstation)</span>
<span class="c"># Install prerequisites:</span>
<span class="n">winget</span> <span class="n">install</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">Azure</span><span class="p">.</span><span class="nb">CLI</span>
<span class="n">winget</span> <span class="n">install</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">PowerShell</span>
<span class="nb">Install-Module</span> <span class="n">VMware</span><span class="p">.</span><span class="n">PowerCLI</span> <span class="n">-Force</span>
<span class="n">az</span> <span class="n">extension</span> <span class="n">add</span> <span class="p">-</span><span class="n">-name</span> <span class="n">arcappliance</span>
<span class="n">az</span> <span class="n">extension</span> <span class="n">add</span> <span class="p">-</span><span class="n">-name</span> <span class="n">connectedvmware</span>

<span class="c"># 2. Create resource group</span>
<span class="n">az</span> <span class="nb">group </span><span class="n">create</span> <span class="p">-</span><span class="n">-name</span> <span class="n">arc-poc-rg</span> <span class="p">-</span><span class="n">-location</span> <span class="n">eastus</span>

<span class="c"># 3. Create Arc config (interactive prompts will guide you)</span>
<span class="n">az</span> <span class="n">arcappliance</span> <span class="n">createconfig</span> <span class="n">vmware</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-resource-group</span> <span class="n">arc-poc-rg</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-name</span> <span class="n">arc-poc</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-location</span> <span class="n">eastus</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-out-dir</span> <span class="p">./</span><span class="n">arc-poc-config</span>

<span class="c"># Edit arc-poc-config/config.yaml with your vCenter details</span>
<span class="c"># (IP, credentials, network - takes 5 minutes)</span>

<span class="c"># 4. Deploy Resource Bridge (30-45 minutes)</span>
<span class="n">az</span> <span class="n">arcappliance</span> <span class="n">deploy</span> <span class="n">vmware</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-config</span><span class="o">-file</span> <span class="p">./</span><span class="n">arc-poc-config</span><span class="p">/</span><span class="n">config</span><span class="p">.</span><span class="n">yaml</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-outfile</span> <span class="p">./</span><span class="n">arc-poc-config</span><span class="p">/</span><span class="n">kubeconfig</span>

<span class="n">az</span> <span class="n">arcappliance</span> <span class="n">create</span> <span class="n">vmware</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-config</span><span class="o">-file</span> <span class="p">./</span><span class="n">arc-poc-config</span><span class="p">/</span><span class="n">config</span><span class="p">.</span><span class="n">yaml</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-kubeconfig</span> <span class="p">./</span><span class="n">arc-poc-config</span><span class="p">/</span><span class="n">kubeconfig</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-resource-group</span> <span class="n">arc-poc-rg</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-name</span> <span class="n">arc-poc</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-location</span> <span class="n">eastus</span>

<span class="c"># 5. Connect vCenter</span>
<span class="n">az</span> <span class="n">connectedvmware</span> <span class="n">vcenter</span> <span class="n">connect</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-resource-group</span> <span class="n">arc-poc-rg</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-name</span> <span class="n">vcenter-poc</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-custom-location</span> <span class="n">arc-poc-cl</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-location</span> <span class="n">eastus</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-fqdn</span> <span class="n">vcenter</span><span class="p">.</span><span class="n">company</span><span class="p">.</span><span class="n">local</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-username</span> <span class="n">administrator</span><span class="nv">@vsphere</span><span class="p">.</span><span class="n">local</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-password</span> <span class="s2">&quot;YourPassword&quot;</span>

<span class="c"># 6. Enable guest management on 5 test VMs from Azure Portal</span>
<span class="c"># (Click VM -&gt; Enable guest management -&gt; Apply)</span>

<span class="c"># Done. You now have Arc visibility into vCenter.</span>
</code></pre></div>

<p><strong>POC Success Criteria:</strong><br />
- VMs visible in Azure Portal<br />
- Can query VM inventory with Resource Graph<br />
- Guest management enabled on test VMs<br />
- Total setup time: 2-3 hours</p>
<p><strong>When to graduate to enterprise deployment:</strong><br />
- You've proven Arc works in your environment<br />
- Leadership approved budget<br />
- You've collected tagging metadata (or accepted you'll fix it later)<br />
- You're ready to deploy to 100+ VMs</p>
<p>For POCs, skip the tagging complexity. Get it working first, add governance when you scale.</p>
<hr />
<h2>Understanding Multi-vCenter Environments</h2>
<p>Most enterprises don't have one vCenter. You have:<br />
- Production vCenter<br />
- Non-production vCenter (dev/test)<br />
- DR/failover vCenter<br />
- Potentially acquired company vCenters (merger scenarios)</p>
<p><strong>Example architecture:</strong><br />
- <code>vcenter-01</code> = Production workloads<br />
- <code>vcenter-02</code> = Development and test environments<br />
- <code>vcenter-03</code> = Disaster recovery site</p>
<p>Each vCenter manages hundreds to thousands of VMs. You need Azure Arc to:<br />
- Get unified inventory across all vCenters<br />
- Enable cloud management capabilities (monitoring, security, patching)<br />
- Plan migration to Azure with proper visibility<br />
- Allocate costs during hybrid state (on-prem + Azure)</p>
<p><img alt="Proper Arc organization" src="/static/images/hero/what-i-wish-i-knew.png" /><br />
<em>Figure 2: What proper Arc organization looks like - Multiple resource groups, clear structure, organized by purpose</em></p>
<p>But here's what Microsoft doesn't explain clearly: <strong>connecting vCenter to Azure is a two-phase process.</strong></p>
<h2>The Two-Phase Deployment Nobody Explains</h2>
<p>This is where everyone gets confused. Azure Arc for VMware has two distinct deployment phases.</p>
<p>But before you can even start Phase 1, you need a <strong>jump box</strong>.</p>
<h3>Phase 0: Deploy the Jump Box (The Prerequisite Nobody Mentions)</h3>
<p>Before you can deploy the Arc Resource Bridge, you need a Windows VM in your vCenter environment to run the deployment scripts from.</p>
<p><strong>What the jump box is:</strong><br />
- A Windows Server 2019/2022 or Windows 10/11 VM<br />
- Deployed IN your vCenter environment (not in Azure, not on your laptop)<br />
- Has network access to vCenter (port 443)<br />
- Has outbound internet access to Azure and GitHub<br />
- Serves as the deployment tool for Arc Resource Bridge</p>
<p><strong>Why you need it:</strong><br />
- The Arc deployment scripts must run from a system WITH network access to vCenter<br />
- You can't deploy from Azure Cloud Shell (no vCenter access)<br />
- You can't deploy from your laptop over VPN (too slow, will timeout)<br />
- The scripts download a large OVA file and deploy it into vCenter</p>
<p><strong>Jump box specifications:</strong><br />
- 2-4 vCPU<br />
- 8GB RAM<br />
- 50GB disk (minimum 20GB free for OVA download)<br />
- Windows Server 2019+ or Windows 10/11<br />
- Network connectivity to vCenter management network<br />
- Outbound HTTPS to internet</p>
<p><strong>Software to install on jump box:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Install Azure CLI</span>
<span class="nb">Invoke-WebRequest</span> <span class="n">-Uri</span> <span class="n">https</span><span class="p">://</span><span class="n">aka</span><span class="p">.</span><span class="n">ms</span><span class="p">/</span><span class="n">installazurecliwindows</span> <span class="n">-OutFile</span> <span class="p">.\</span><span class="n">AzureCLI</span><span class="p">.</span><span class="n">msi</span>
<span class="nb">Start-Process</span> <span class="n">msiexec</span><span class="p">.</span><span class="n">exe</span> <span class="n">-Wait</span> <span class="n">-ArgumentList</span> <span class="s1">&#39;/I AzureCLI.msi /quiet&#39;</span>

<span class="c"># Install PowerShell 7</span>
<span class="n">winget</span> <span class="n">install</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">PowerShell</span>

<span class="c"># Install VMware PowerCLI</span>
<span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">VMware</span><span class="p">.</span><span class="n">PowerCLI</span> <span class="n">-Force</span> <span class="n">-AllowClobber</span>

<span class="c"># Install Arc appliance extensions</span>
<span class="n">az</span> <span class="n">extension</span> <span class="n">add</span> <span class="p">-</span><span class="n">-name</span> <span class="n">arcappliance</span>
<span class="n">az</span> <span class="n">extension</span> <span class="n">add</span> <span class="p">-</span><span class="n">-name</span> <span class="n">connectedvmware</span>

<span class="c"># Login to Azure</span>
<span class="n">az</span> <span class="n">login</span>
</code></pre></div>

<p><strong>One jump box can deploy multiple Resource Bridges:</strong><br />
You can use the same jump box to deploy Arc Resource Bridges for vcenter-01, vcenter-02, and vcenter-03. You don't need a separate jump box per vCenter.</p>
<h3>Phase 1: Deploy the Arc Resource Bridge (FROM the Jump Box)</h3>
<p>The Arc Resource Bridge connects your vCenter infrastructure to Azure. Think of it as the "connector" layer.</p>
<p><strong>What the Resource Bridge actually is:</strong><br />
- A Kubernetes-based appliance VM deployed INTO your vCenter environment<br />
- Runs as a VM in vCenter (minimum 4 vCPU, 8GB RAM - Microsoft recommends 16GB for production)<br />
- Requires 3 static IP addresses (2 for appliance VMs, 1 for control plane endpoint)<br />
- Provides the connection between vCenter and Azure<br />
- Deployed from a Windows jump box that has network access to vCenter</p>
<p><strong>What the Resource Bridge does:</strong><br />
- Authenticates to your vCenter instance<br />
- Discovers VMs in vCenter inventory<br />
- Makes VMs visible in Azure Portal<br />
- Enables self-service VM operations from Azure</p>
<p><strong>What the Resource Bridge does NOT do:</strong><br />
- Install agents on VMs<br />
- Enable guest management<br />
- Enable ESU licensing<br />
- Enable Azure Monitor or security features</p>
<p><strong>The Deployment Reality:</strong></p>
<p>You run the deployment script FROM a jump box (Windows VM) IN the vCenter environment. The script:<br />
1. Downloads the Arc Resource Bridge appliance OVA<br />
2. Deploys it as a VM into vCenter<br />
3. Configures the Kubernetes cluster inside the appliance<br />
4. Connects the appliance to Azure<br />
5. Registers your vCenter with Azure Arc</p>
<p><strong>Prerequisites for the jump box:</strong><br />
- Windows Server 2019/2022 or Windows 10/11<br />
- Network access to vCenter (port 443)<br />
- Network access to Azure (outbound HTTPS)<br />
- Azure CLI installed<br />
- PowerShell 7+<br />
- 20GB free disk space (for OVA download)</p>
<p><strong>How to deploy from the jump box:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Run this FROM your vCenter jump box</span>

<span class="c"># Install prerequisites</span>
<span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">VMware</span><span class="p">.</span><span class="n">PowerCLI</span> <span class="n">-Force</span>
<span class="n">az</span> <span class="n">extension</span> <span class="n">add</span> <span class="p">-</span><span class="n">-name</span> <span class="n">arcappliance</span>
<span class="n">az</span> <span class="n">extension</span> <span class="n">add</span> <span class="p">-</span><span class="n">-name</span> <span class="n">connectedvmware</span>

<span class="c"># Create config file for vcenter-01</span>
<span class="n">az</span> <span class="n">arcappliance</span> <span class="n">createconfig</span> <span class="n">vmware</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-resource-group</span> <span class="n">arc-infrastructure-rg</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-name</span> <span class="n">arc-bridge-vcenter</span><span class="p">-</span><span class="n">01</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-location</span> <span class="n">eastus</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-out-dir</span> <span class="p">./</span><span class="n">vcenter</span><span class="p">-</span><span class="n">01-config</span>

<span class="c"># Edit the generated config.yaml with your vCenter details:</span>
<span class="c"># - vCenter IP/hostname</span>
<span class="c"># - vCenter credentials (service account)</span>
<span class="c"># - Network configuration for the appliance VM</span>
<span class="c"># - Datastore for appliance deployment</span>

<span class="c"># Deploy the Resource Bridge (this takes 30-45 minutes)</span>
<span class="n">az</span> <span class="n">arcappliance</span> <span class="n">deploy</span> <span class="n">vmware</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-config</span><span class="o">-file</span> <span class="p">./</span><span class="n">vcenter</span><span class="p">-</span><span class="n">01-config</span><span class="p">/</span><span class="n">config</span><span class="p">.</span><span class="n">yaml</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-outfile</span> <span class="p">./</span><span class="n">vcenter</span><span class="p">-</span><span class="n">01-config</span><span class="p">/</span><span class="n">kubeconfig</span>

<span class="c"># Create the Azure Arc connection</span>
<span class="n">az</span> <span class="n">arcappliance</span> <span class="n">create</span> <span class="n">vmware</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-config</span><span class="o">-file</span> <span class="p">./</span><span class="n">vcenter</span><span class="p">-</span><span class="n">01-config</span><span class="p">/</span><span class="n">config</span><span class="p">.</span><span class="n">yaml</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-kubeconfig</span> <span class="p">./</span><span class="n">vcenter</span><span class="p">-</span><span class="n">01-config</span><span class="p">/</span><span class="n">kubeconfig</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-resource-group</span> <span class="n">arc-infrastructure-rg</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-name</span> <span class="n">arc-bridge-vcenter</span><span class="p">-</span><span class="n">01</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-location</span> <span class="n">eastus</span>

<span class="c"># Connect your vCenter to Azure</span>
<span class="n">az</span> <span class="n">connectedvmware</span> <span class="n">vcenter</span> <span class="n">connect</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-resource-group</span> <span class="n">arc-infrastructure-rg</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-name</span> <span class="n">vcenter</span><span class="p">-</span><span class="n">01</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-custom-location</span> <span class="n">arc-bridge-vcenter</span><span class="p">-</span><span class="n">01-cl</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-location</span> <span class="n">eastus</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-fqdn</span> <span class="n">vcenter</span><span class="p">-</span><span class="n">01</span><span class="p">.</span><span class="n">company</span><span class="p">.</span><span class="n">local</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-username</span> <span class="n">svc-arc</span><span class="nv">@company</span><span class="p">.</span><span class="n">local</span> <span class="p">`</span>
  <span class="p">-</span><span class="n">-password</span> <span class="nv">$vCenterPassword</span>

<span class="c"># Repeat entire process for vcenter-02 and vcenter-03</span>
</code></pre></div>

<p><strong>What you'll see in vCenter:</strong><br />
After deployment, you'll have a new VM in vCenter named something like <code>arc-bridge-vcenter-01-appliance</code>. This is the Resource Bridge running Kubernetes. Don't delete it or power it off.</p>
<p><strong>What you'll see in Azure Portal:</strong><br />
Your vCenter appears as a resource in Azure. All VMs from that vCenter are now visible in Azure Portal under "Azure Arc &gt; VMware vCenters".</p>
<p><strong>Common mistakes:</strong></p>
<ol>
<li>
<p><strong>Wrong network configuration:</strong> The appliance VM needs an IP address in your vCenter network. If you configure the wrong subnet, deployment fails 30 minutes in.</p>
</li>
<li>
<p><strong>Insufficient vCenter permissions:</strong> The service account needs these permissions:</p>
</li>
<li>Read-only on VMs</li>
<li>Deploy OVF template</li>
<li>
<p>Create/delete VMs (for the appliance)</p>
</li>
<li>
<p><strong>Firewall blocking deployment:</strong> The jump box needs outbound HTTPS to:</p>
</li>
<li>vCenter (port 443)</li>
<li>Azure (management.azure.com, login.microsoftonline.com)</li>
<li>
<p>GitHub (to download OVA)</p>
</li>
<li>
<p><strong>Running from Azure instead of on-premises:</strong> The deployment script must run from a jump box WITH network access to vCenter. You can't deploy from Azure Cloud Shell or your laptop over VPN (too slow, will timeout).</p>
</li>
<li>
<p><strong>Thinking you're done:</strong> People deploy the Resource Bridge, see VMs in Azure Portal, and think Arc is working. <strong>Wrong.</strong> The VMs are visible but not Arc-enabled. You're looking at VMware inventory reflected in Azure, not Arc-managed resources.</p>
</li>
</ol>
<h3>Phase 2: Deploy Arc Agents to Individual VMs</h3>
<p>After the Resource Bridge is deployed, you need to Arc-enable each VM by installing the Connected Machine agent.</p>
<p><strong>What the Arc agent does:</strong><br />
- Enables guest OS management from Azure<br />
- Enables ESU licensing (for Windows Server 2012/R2)<br />
- Enables Azure Monitor integration<br />
- Enables Azure Policy guest configuration<br />
- Enables extension management (security, backup, etc.)</p>
<p><strong>Critical insight:</strong> The Resource Bridge makes VMs discoverable. The Arc agent makes them manageable.</p>
<p><strong>How to deploy at scale:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Script to deploy Arc agents to VMs from vcenter-01</span>
<span class="nv">$ServicePrincipalId</span> <span class="p">=</span> <span class="s2">&quot;YOUR-SP-ID&quot;</span>
<span class="nv">$ServicePrincipalSecret</span> <span class="p">=</span> <span class="s2">&quot;YOUR-SP-SECRET&quot;</span> <span class="p">|</span> <span class="nb">ConvertTo-SecureString</span> <span class="n">-AsPlainText</span> <span class="n">-Force</span>
<span class="nv">$TenantId</span> <span class="p">=</span> <span class="s2">&quot;YOUR-TENANT-ID&quot;</span>
<span class="nv">$SubscriptionId</span> <span class="p">=</span> <span class="s2">&quot;YOUR-SUBSCRIPTION-ID&quot;</span>
<span class="nv">$ResourceGroup</span> <span class="p">=</span> <span class="s2">&quot;arc-vcenter-01-rg&quot;</span>
<span class="nv">$Location</span> <span class="p">=</span> <span class="s2">&quot;eastus&quot;</span>

<span class="c"># Tags to apply during onboarding - THIS IS CRITICAL</span>
<span class="nv">$Tags</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="s2">&quot;vcenter-source&quot;</span> <span class="p">=</span> <span class="s2">&quot;vcenter-01&quot;</span>
    <span class="s2">&quot;environment&quot;</span> <span class="p">=</span> <span class="s2">&quot;production&quot;</span>
    <span class="s2">&quot;migration-wave&quot;</span> <span class="p">=</span> <span class="s2">&quot;wave-2&quot;</span>
    <span class="s2">&quot;cost-center&quot;</span> <span class="p">=</span> <span class="s2">&quot;IT-INFRASTRUCTURE&quot;</span>
<span class="p">}</span>

<span class="c"># Deploy to target VMs</span>
<span class="nv">$VMs</span> <span class="p">=</span> <span class="nb">Get-VM</span> <span class="n">-Location</span> <span class="n">vcenter</span><span class="p">-</span><span class="n">01</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">PowerState</span> <span class="o">-eq</span> <span class="s2">&quot;PoweredOn&quot;</span><span class="p">}</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$VM</span> <span class="k">in</span> <span class="nv">$VMs</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Invoke-VMScript</span> <span class="n">-VM</span> <span class="nv">$VM</span> <span class="n">-ScriptText</span> <span class="sh">@&quot;</span>
<span class="sh">        # Download Arc agent</span>
<span class="sh">        Invoke-WebRequest -Uri &#39;https://aka.ms/AzureConnectedMachineAgent&#39; -OutFile AzureConnectedMachineAgent.msi</span>

<span class="sh">        # Install agent</span>
<span class="sh">        msiexec /i AzureConnectedMachineAgent.msi /quiet /norestart</span>

<span class="sh">        # Connect to Azure with tags</span>
<span class="sh">        &amp; &quot;$env:ProgramFiles\AzureConnectedMachineAgent\azcmagent.exe&quot; connect `</span>
<span class="sh">          --service-principal-id $ServicePrincipalId `</span>
<span class="sh">          --service-principal-secret $ServicePrincipalSecret `</span>
<span class="sh">          --tenant-id $TenantId `</span>
<span class="sh">          --subscription-id $SubscriptionId `</span>
<span class="sh">          --resource-group $ResourceGroup `</span>
<span class="sh">          --location $Location `</span>
<span class="sh">          --tags &quot;vcenter-source=vcenter-01,environment=production,migration-wave=wave-2,cost-center=IT-INFRASTRUCTURE&quot;</span>
<span class="sh">&quot;@</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Why this matters:</strong> If you deploy the Resource Bridge but don't install agents, you get Azure Portal visibility but zero management capability. People will ask "why aren't my VMs getting ESU patches?" and the answer is "because you only completed phase 1."</p>
<h2>The Tagging Strategy That Prevents Disasters</h2>
<p>Tags are not optional. Tags are the <strong>only way</strong> to organize multi-vCenter environments in Azure.</p>
<p>Without tags, you have 1,200 VMs in Azure Portal with names like:<br />
- <code>SQLPROD03</code><br />
- <code>WEBSERVER17</code><br />
- <code>APPVM-2024-NEW</code></p>
<p>Good luck figuring out:<br />
- Which vCenter is this VM from?<br />
- Is this production or dev?<br />
- Which business unit pays for this?<br />
- What application does it run?<br />
- What's the migration priority?</p>
<h3>Required Tag Schema</h3>
<p>Apply these tags <strong>during Arc agent deployment</strong>, not after:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">vcenter-source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;vcenter-01&quot;</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="err"> &quot;vcenter-02&quot; | &quot;vcenter-03&quot;</span>
<span class="w">  </span><span class="no"># Which vCenter instance is this VM from?</span>
<span class="w">  </span><span class="no"># Critical for migration wave planning</span>

<span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;production&quot;</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="err"> &quot;development&quot; | &quot;test&quot; | &quot;dr-failover&quot;</span>
<span class="w">  </span><span class="no"># Determines migration priority and support criticality</span>

<span class="nt">cost-center</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;FINANCE-001&quot;</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="err"> &quot;IT-INFRASTRUCTURE&quot; | &quot;SALES-EAST&quot;</span>
<span class="w">  </span><span class="no"># Required for chargeback and budget allocation</span>

<span class="nt">app-owner</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;john.smith@company.com&quot;</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="err"> &quot;finance-team@company.com&quot;</span>
<span class="w">  </span><span class="no"># Who to contact about this workload</span>

<span class="nt">application</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;erp-system&quot;</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="err"> &quot;crm-prod&quot; | &quot;internal-portal&quot;</span>
<span class="w">  </span><span class="no"># What business function does this support</span>

<span class="nt">migration-wave</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wave-1&quot;</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="err"> &quot;wave-2&quot; | &quot;wave-3&quot; | &quot;not-planned&quot;</span>
<span class="w">  </span><span class="no"># Deployment sequence for Azure migration</span>

<span class="nt">azure-ready</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="err"> &quot;no&quot; | &quot;needs-assessment&quot;</span>
<span class="w">  </span><span class="no"># Can this VM migrate to Azure as-is?</span>

<span class="nt">compliance-scope</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sox&quot;</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="err"> &quot;pci&quot; | &quot;hipaa&quot; | &quot;none&quot;</span>
<span class="w">  </span><span class="no"># Regulatory requirements affecting architecture</span>
</code></pre></div>

<h3>Why Tag During Deployment, Not After</h3>
<p><strong>Wrong approach:</strong><br />
1. Deploy Arc agents to all VMs (no tags)<br />
2. "We'll add tags later when we have time"<br />
3. Three months pass<br />
4. Finance asks for cost breakdown by department<br />
5. You have 1,200 untagged VMs and no way to retroactively determine ownership</p>
<p><strong>Right approach:</strong><br />
1. Collect tag data BEFORE deploying Arc (see next section)<br />
2. Deploy Arc agents WITH tags in the deployment script<br />
3. Tags appear in Azure Portal immediately<br />
4. Resource Graph queries work from day one</p>
<p><strong>The reality:</strong> Retroactive tagging is brutally hard. You'll need to:<br />
- Match VM names to application databases (often incomplete)<br />
- Email application owners (who don't respond)<br />
- Cross-reference cost center codes (which changed last year)<br />
- Make educated guesses (which finance will reject)</p>
<p>Tag during deployment or accept that you'll never have complete metadata.</p>
<h2>The Real Bottleneck: Data Collection</h2>
<p>Here's what nobody tells you about Azure Arc implementation: <strong>the technology is the easy part.</strong></p>
<p>Installing the Arc Resource Bridge takes 30 minutes. Installing agents on 1,200 VMs takes a weekend with scripting.</p>
<p><strong>Getting the data to tag those VMs properly takes three months.</strong></p>
<h3>What You Need to Collect</h3>
<p>Before you can deploy Arc with proper governance, you need:</p>
<p><strong>From Finance:</strong><br />
- Valid cost center codes for each department<br />
- Budget allocation model (centralized vs. chargeback)<br />
- Approval for new Azure spending categories<br />
- Expected monthly costs for Arc management</p>
<p><strong>From Application Teams:</strong><br />
- Application inventory (what runs on each VM?)<br />
- Business owner contacts<br />
- Criticality ratings (tier 1/2/3)<br />
- Support expectations</p>
<p><strong>From Infrastructure Teams:</strong><br />
- vCenter inventory exports<br />
- Network dependencies between VMs<br />
- Backup and DR requirements<br />
- Patching schedules and maintenance windows</p>
<p><strong>From Security/Compliance:</strong><br />
- Regulatory scope for each application (SOX, PCI, HIPAA)<br />
- Approval for Arc agent installation (new software on servers)<br />
- Required security configurations<br />
- Audit requirements</p>
<p><strong>From Business Leadership:</strong><br />
- Cloud migration strategy<br />
- Timeline and priorities<br />
- Budget constraints<br />
- Success criteria</p>
<h3>Why This Takes Forever</h3>
<p><strong>The email approach doesn't work:</strong><br />
- Finance doesn't respond (they're busy with quarter close)<br />
- Application teams don't track ownership (knowledge left with Bob who retired)<br />
- Security wants committee approval (meeting scheduled for next month)</p>
<p><strong>The meeting approach is slow:</strong><br />
- Scheduling 8 stakeholder calendars takes two weeks<br />
- Half the attendees don't show up<br />
- Decisions require "further discussion"<br />
- Action items get lost in email threads</p>
<p><strong>The phone call approach works but is exhausting:</strong><br />
- Call Finance: "I need cost center codes for 1,200 VMs"<br />
- They ask: "Can you send a spreadsheet?"<br />
- You send spreadsheet with VM names<br />
- They respond: "We don't recognize these VM names, can you map to applications?"<br />
- You don't have application mapping<br />
- Call application teams...<br />
- (Repeat for three months)</p>
<p><strong>Budget 2-3 weeks minimum for data collection.</strong> For complex environments with poor documentation, budget 2-3 months.</p>
<p>The Arc agent installs in 5 minutes. Getting the metadata to tag it properly is the actual project.</p>
<h2>The Complete Implementation Checklist</h2>
<p>Here's the step-by-step process that actually works.</p>
<h3>Phase 0: Pre-Deployment Planning (Week 1-4)</h3>
<div class="codehilite"><pre><span></span><code>‚òê<span class="w"> </span><span class="nv">Document</span><span class="w"> </span><span class="nv">Current</span><span class="w"> </span><span class="nv">State</span>
<span class="w">  </span>‚òê<span class="w"> </span><span class="nv">List</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">vCenter</span><span class="w"> </span><span class="nv">instances</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">versions</span>
<span class="w">  </span>‚òê<span class="w"> </span><span class="nv">Export</span><span class="w"> </span><span class="nv">VM</span><span class="w"> </span><span class="nv">inventory</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">each</span><span class="w"> </span><span class="nv">vCenter</span>
<span class="w">  </span>‚òê<span class="w"> </span><span class="nv">Document</span><span class="w"> </span><span class="nv">VM</span><span class="w"> </span><span class="nv">counts</span>:<span class="w"> </span><span class="nv">production</span>,<span class="w"> </span><span class="nv">dev</span><span class="o">/</span><span class="nv">test</span>,<span class="w"> </span><span class="nv">DR</span>
<span class="w">  </span>‚òê<span class="w"> </span><span class="nv">Identify</span><span class="w"> </span><span class="nv">applications</span><span class="w"> </span><span class="nv">running</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">VMs</span><span class="w"> </span><span class="ss">(</span><span class="nv">as</span><span class="w"> </span><span class="nv">best</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">can</span><span class="ss">)</span>
<span class="w">  </span>‚òê<span class="w"> </span><span class="nv">Note</span><span class="w"> </span><span class="nv">VMs</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">special</span><span class="w"> </span><span class="nv">requirements</span><span class="w"> </span><span class="ss">(</span><span class="nv">GPU</span>,<span class="w"> </span><span class="nv">high</span><span class="w"> </span><span class="nv">memory</span>,<span class="w"> </span><span class="nv">etc</span>.<span class="ss">)</span>

‚òê<span class="w"> </span><span class="nv">Define</span><span class="w"> </span><span class="nv">Azure</span><span class="w"> </span><span class="nv">Organization</span><span class="w"> </span><span class="nv">Strategy</span>
<span class="w">  </span>‚òê<span class="w"> </span><span class="nv">Subscription</span><span class="w"> </span><span class="nv">model</span>:<span class="w"> </span><span class="nv">one</span><span class="w"> </span><span class="nv">sub</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">Arc</span>?<span class="w"> </span><span class="nv">One</span><span class="w"> </span><span class="nv">per</span><span class="w"> </span><span class="nv">vCenter</span>?<span class="w"> </span><span class="nv">One</span><span class="w"> </span><span class="nv">per</span><span class="w"> </span><span class="nv">business</span><span class="w"> </span><span class="nv">unit</span>?
<span class="w">  </span>‚òê<span class="w"> </span><span class="nv">Resource</span><span class="w"> </span><span class="nv">group</span><span class="w"> </span><span class="nv">model</span>:<span class="w"> </span><span class="nv">by</span><span class="w"> </span><span class="nv">vCenter</span>?<span class="w"> </span><span class="nv">By</span><span class="w"> </span><span class="nv">application</span>?<span class="w"> </span><span class="nv">By</span><span class="w"> </span><span class="nv">environment</span>?
<span class="w">  </span>‚òê<span class="w"> </span><span class="nv">Naming</span><span class="w"> </span><span class="nv">convention</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">Arc</span><span class="w"> </span><span class="nv">resources</span>
<span class="w">  </span>‚òê<span class="w"> </span><span class="nv">RBAC</span><span class="w"> </span><span class="nv">model</span>:<span class="w"> </span><span class="nv">who</span><span class="w"> </span><span class="nv">can</span><span class="w"> </span><span class="nv">deploy</span>?<span class="w"> </span><span class="nv">Who</span><span class="w"> </span><span class="nv">can</span><span class="w"> </span><span class="nv">manage</span>?<span class="w"> </span><span class="nv">Who</span><span class="w"> </span><span class="nv">can</span><span class="w"> </span><span class="nv">view</span>?

‚òê<span class="w"> </span><span class="nv">Build</span><span class="w"> </span><span class="nv">Tagging</span><span class="w"> </span><span class="nv">Taxonomy</span>
<span class="w">  </span>‚òê<span class="w"> </span><span class="nv">Define</span><span class="w"> </span><span class="nv">required</span><span class="w"> </span><span class="nv">tags</span><span class="w"> </span><span class="ss">(</span><span class="nv">see</span><span class="w"> </span><span class="nv">schema</span><span class="w"> </span><span class="nv">above</span><span class="ss">)</span>
<span class="w">  </span>‚òê<span class="w"> </span><span class="nv">Get</span><span class="w"> </span><span class="nv">Finance</span><span class="w"> </span><span class="nv">approval</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">cost</span><span class="o">-</span><span class="nv">center</span><span class="w"> </span><span class="nv">codes</span>
<span class="w">  </span>‚òê<span class="w"> </span><span class="nv">Get</span><span class="w"> </span><span class="nv">Security</span><span class="w"> </span><span class="nv">approval</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">compliance</span><span class="o">-</span><span class="nv">scope</span><span class="w"> </span><span class="nv">values</span>
<span class="w">  </span>‚òê<span class="w"> </span><span class="nv">Document</span><span class="w"> </span><span class="nv">tag</span><span class="w"> </span><span class="nv">enforcement</span><span class="w"> </span><span class="nv">policy</span>

‚òê<span class="w"> </span><span class="nv">Collect</span><span class="w"> </span><span class="nv">Metadata</span><span class="w"> </span><span class="ss">(</span><span class="nv">THE</span><span class="w"> </span><span class="nv">HARD</span><span class="w"> </span><span class="nv">PART</span><span class="ss">)</span>
<span class="w">  </span>‚òê<span class="w"> </span><span class="k">Call</span><span class="w"> </span><span class="nl">Finance</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">cost</span><span class="w"> </span><span class="nv">center</span><span class="w"> </span><span class="nv">mapping</span>
<span class="w">  </span>‚òê<span class="w"> </span><span class="k">Call</span><span class="w"> </span><span class="nl">application</span><span class="w"> </span><span class="nv">teams</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">ownership</span><span class="w"> </span><span class="nv">data</span>
<span class="w">  </span>‚òê<span class="w"> </span><span class="k">Call</span><span class="w"> </span><span class="nl">business</span><span class="w"> </span><span class="nv">units</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">migration</span><span class="w"> </span><span class="nv">priorities</span>
<span class="w">  </span>‚òê<span class="w"> </span><span class="nv">Map</span><span class="w"> </span><span class="nv">VMs</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">applications</span><span class="w"> </span><span class="ss">(</span><span class="nv">manually</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">needed</span><span class="ss">)</span>
<span class="w">  </span>‚òê<span class="w"> </span><span class="nv">Build</span><span class="w"> </span><span class="nv">master</span><span class="w"> </span><span class="nv">spreadsheet</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">tag</span><span class="w"> </span><span class="nv">values</span>

‚òê<span class="w"> </span><span class="nv">Get</span><span class="w"> </span><span class="nv">Approvals</span>
<span class="w">  </span>‚òê<span class="w"> </span><span class="nv">Budget</span><span class="w"> </span><span class="nv">approval</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">Arc</span><span class="w"> </span><span class="nv">licensing</span><span class="w"> </span><span class="nv">costs</span>
<span class="w">  </span>‚òê<span class="w"> </span><span class="nv">Security</span><span class="w"> </span><span class="nv">approval</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">agent</span><span class="w"> </span><span class="nv">installation</span>
<span class="w">  </span>‚òê<span class="w"> </span><span class="nv">Change</span><span class="w"> </span><span class="nv">control</span><span class="w"> </span><span class="nv">approval</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">production</span><span class="w"> </span><span class="nv">VMs</span>
<span class="w">  </span>‚òê<span class="w"> </span><span class="nv">Business</span><span class="w"> </span><span class="nv">unit</span><span class="w"> </span><span class="nv">sign</span><span class="o">-</span><span class="nv">off</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">migration</span><span class="w"> </span><span class="nv">plan</span>
</code></pre></div>

<p><strong>Reality check:</strong> This phase takes longer than the actual deployment. Don't skip it. Deploying Arc without this planning creates an unfixable mess.</p>
<h3>Phase 0: Jump Box Deployment (Week 4)</h3>
<div class="codehilite"><pre><span></span><code><span class="err">‚òê</span><span class="w"> </span><span class="n">Deploy</span><span class="w"> </span><span class="n">Jump</span><span class="w"> </span><span class="n">Box</span><span class="w"> </span><span class="n">VM</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">vCenter</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Windows</span><span class="w"> </span><span class="n">Server</span><span class="w"> </span><span class="mi">2019</span><span class="o">/</span><span class="mi">2022</span><span class="w"> </span><span class="n">VM</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">vCenter</span><span class="w"> </span><span class="p">(</span><span class="ow">or</span><span class="w"> </span><span class="n">identify</span><span class="w"> </span><span class="n">existing</span><span class="p">)</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Allocate</span><span class="w"> </span><span class="mi">2</span><span class="o">-</span><span class="mi">4</span><span class="w"> </span><span class="n">vCPU</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="n">GB</span><span class="w"> </span><span class="n">RAM</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="n">GB</span><span class="w"> </span><span class="n">disk</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Place</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">vCenter</span><span class="w"> </span><span class="n">management</span><span class="w"> </span><span class="n">interface</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Configure</span><span class="w"> </span><span class="n">outbound</span><span class="w"> </span><span class="n">internet</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="p">(</span><span class="n">direct</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">proxy</span><span class="p">)</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Install</span><span class="w"> </span><span class="n">Windows</span><span class="w"> </span><span class="n">updates</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Join</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">domain</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">environment</span><span class="p">)</span>

<span class="err">‚òê</span><span class="w"> </span><span class="n">Install</span><span class="w"> </span><span class="n">Required</span><span class="w"> </span><span class="n">Software</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">Jump</span><span class="w"> </span><span class="n">Box</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Install</span><span class="w"> </span><span class="n">Azure</span><span class="w"> </span><span class="n">CLI</span><span class="w"> </span><span class="p">(</span><span class="n">az</span><span class="p">)</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Install</span><span class="w"> </span><span class="n">PowerShell</span><span class="w"> </span><span class="mi">7</span><span class="o">+</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Install</span><span class="w"> </span><span class="n">VMware</span><span class="w"> </span><span class="n">PowerCLI</span><span class="w"> </span><span class="n">module</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Install</span><span class="w"> </span><span class="n">Azure</span><span class="w"> </span><span class="n">Arc</span><span class="w"> </span><span class="n">appliance</span><span class="w"> </span><span class="n">extensions</span><span class="w"> </span><span class="p">(</span><span class="n">arcappliance</span><span class="p">,</span><span class="w"> </span><span class="n">connectedvmware</span><span class="p">)</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">Azure</span><span class="w"> </span><span class="n">connectivity</span><span class="w"> </span><span class="p">(</span><span class="n">az</span><span class="w"> </span><span class="n">login</span><span class="p">)</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">vCenter</span><span class="w"> </span><span class="n">connectivity</span><span class="w"> </span><span class="p">(</span><span class="n">Connect</span><span class="o">-</span><span class="n">VIServer</span><span class="p">)</span>

<span class="err">‚òê</span><span class="w"> </span><span class="n">Validate</span><span class="w"> </span><span class="n">Jump</span><span class="w"> </span><span class="n">Box</span><span class="w"> </span><span class="n">Prerequisites</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="mi">20</span><span class="n">GB</span><span class="o">+</span><span class="w"> </span><span class="n">free</span><span class="w"> </span><span class="n">disk</span><span class="w"> </span><span class="n">space</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">OVA</span><span class="w"> </span><span class="n">downloads</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">vCenter</span><span class="w"> </span><span class="p">(</span><span class="n">port</span><span class="w"> </span><span class="mi">443</span><span class="p">)</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="n">outbound</span><span class="w"> </span><span class="n">HTTPS</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">Azure</span><span class="w"> </span><span class="p">(</span><span class="n">management</span><span class="o">.</span><span class="n">azure</span><span class="o">.</span><span class="n">com</span><span class="p">,</span><span class="w"> </span><span class="n">login</span><span class="o">.</span><span class="n">microsoftonline</span><span class="o">.</span><span class="n">com</span><span class="p">)</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="n">outbound</span><span class="w"> </span><span class="n">HTTPS</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">GitHub</span><span class="w"> </span><span class="p">(</span><span class="n">to</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="n">OVA</span><span class="w"> </span><span class="n">files</span><span class="p">)</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">RDP</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">jump</span><span class="w"> </span><span class="n">box</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">deployment</span><span class="w"> </span><span class="n">sessions</span>

<span class="c1">### Phase 1: Arc Resource Bridge Deployment (Week 5)</span>
</code></pre></div>

<p>‚òê Azure Infrastructure Setup<br />
  ‚òê Create subscriptions (if using multiple)<br />
  ‚òê Create resource groups for Arc infrastructure<br />
  ‚òê Create service principals for Arc authentication<br />
  ‚òê Assign RBAC permissions (custom roles may be required)<br />
  ‚òê Configure Azure Policy for Arc governance</p>
<p>‚òê Prepare vCenter for Arc<br />
  ‚òê Create service account with required permissions:<br />
    ‚òê Read-only on VMs<br />
    ‚òê Deploy OVF template<br />
    ‚òê Create/delete VMs<br />
  ‚òê Identify datastore for appliance VM deployment<br />
  ‚òê Identify network/VLAN for appliance VM (needs IP address)<br />
  ‚òê Reserve static IP or configure DHCP reservation for appliance</p>
<p>‚òê Deploy Arc Resource Bridge - vcenter-01 (Production)<br />
  ‚òê RDP to jump box in vCenter environment<br />
  ‚òê Run az arcappliance createconfig to generate config files<br />
  ‚òê Edit config.yaml with vCenter details (IP, credentials, network, datastore)<br />
  ‚òê Run az arcappliance deploy (takes 30-45 minutes)<br />
  ‚òê Run az arcappliance create to connect to Azure<br />
  ‚òê Run az connectedvmware vcenter connect to register vCenter<br />
  ‚òê Validate appliance VM appears in vCenter<br />
  ‚òê Validate vCenter resource appears in Azure Portal<br />
  ‚òê Verify VM inventory appears in Azure Portal</p>
<p>‚òê Deploy Arc Resource Bridge - vcenter-02 (Non-Production)<br />
  ‚òê Repeat deployment process<br />
  ‚òê Use separate resource group or naming convention<br />
  ‚òê Validate connection and inventory</p>
<p>‚òê Deploy Arc Resource Bridge - vcenter-03 (DR Site)<br />
  ‚òê Repeat deployment process<br />
  ‚òê Tag infrastructure with dr-site designation<br />
  ‚òê Validate connection and inventory</p>
<p>‚òê Validate Resource Bridge Deployment<br />
  ‚òê All VMs from all vCenters visible in Azure Portal<br />
  ‚òê VM metadata (CPU, memory, OS) populated correctly<br />
  ‚òê Resource Bridge health status: healthy<br />
  ‚òê No authentication or connectivity errors</p>
<div class="codehilite"><pre><span></span><code>### Phase 2: Arc Agent Deployment with Tags (Week 6-8)
</code></pre></div>

<p>‚òê Prepare Agent Deployment<br />
  ‚òê Load metadata spreadsheet with tag values<br />
  ‚òê Create deployment scripts with tag application<br />
  ‚òê Test agent deployment on 5 VMs from each vCenter<br />
  ‚òê Validate tags appear correctly in Azure Portal<br />
  ‚òê Test Resource Graph queries for filtering by tags</p>
<p>‚òê Deploy Arc Agents - Wave 1 (vcenter-02 Non-Production)<br />
  ‚òê Deploy agents to development VMs first<br />
  ‚òê Apply all required tags during deployment<br />
  ‚òê Monitor for deployment failures (network, permissions, TLS issues)<br />
  ‚òê Validate agent connectivity and health<br />
  ‚òê Verify tags in Azure Portal and Resource Graph<br />
  ‚òê Wait 48 hours to observe for issues</p>
<p>‚òê Deploy Arc Agents - Wave 2 (vcenter-03 DR Site)<br />
  ‚òê Deploy to DR VMs<br />
  ‚òê Monitor for performance impact (DR sites often have lower specs)<br />
  ‚òê Validate agent health<br />
  ‚òê Verify no impact to DR replication or failover capability</p>
<p>‚òê Deploy Arc Agents - Wave 3 (vcenter-01 Production)<br />
  ‚òê Schedule during maintenance window<br />
  ‚òê Deploy in batches (200 VMs at a time)<br />
  ‚òê Monitor application health after each batch<br />
  ‚òê Have rollback plan ready (uninstall script)<br />
  ‚òê Complete deployment over 2-3 weeks to minimize risk</p>
<div class="codehilite"><pre><span></span><code>**Common deployment failures:**

**TLS 1.2 not enabled (Windows Server 2012):**
```powershell
<span class="gh">#</span> Enable TLS 1.2 before Arc agent installation
Set-ItemProperty -Path &#39;HKLM:\SOFTWARE\Microsoft\.NETFramework\v4.0.30319&#39; -Name &#39;SchemeUseStrongCrypto&#39; -Value 1 -Type DWord
Set-ItemProperty -Path &#39;HKLM:\SOFTWARE\Wow6432Node\Microsoft\.NETFramework\v4.0.30319&#39; -Name &#39;SchemeUseStrongCrypto&#39; -Value 1 -Type DWord
Restart-Computer -Force
</code></pre></div>

<p><strong>Firewall blocking Arc endpoints:</strong></p>
<div class="codehilite"><pre><span></span><code>Required outbound HTTPS (443) to:
<span class="k">-</span> management.azure.com
<span class="k">-</span> login.microsoftonline.com
<span class="k">-</span> *.guestconfiguration.azure.com
<span class="k">-</span> *.his.arc.azure.com
<span class="k">-</span> *.servicebus.windows.net
</code></pre></div>

<p><strong>Permission errors:</strong><br />
Verify service principal has these permissions:<br />
- <code>Microsoft.HybridCompute/machines/read</code><br />
- <code>Microsoft.HybridCompute/machines/write</code><br />
- <code>Microsoft.HybridCompute/machines/extensions/write</code></p>
<h3>Phase 3: Validation and Governance (Week 9-10)</h3>
<div class="codehilite"><pre><span></span><code><span class="err">‚òê</span><span class="w"> </span><span class="n">Validate</span><span class="w"> </span><span class="n">Complete</span><span class="w"> </span><span class="n">Deployment</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">All</span><span class="w"> </span><span class="n">VMs</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">Arc</span><span class="w"> </span><span class="n">agents</span><span class="w"> </span><span class="n">installed</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">All</span><span class="w"> </span><span class="n">VMs</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="n">tags</span><span class="w"> </span><span class="n">applied</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Agent</span><span class="w"> </span><span class="n">health</span><span class="w"> </span><span class="nl">status:</span><span class="w"> </span><span class="n">connected</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">states</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">Azure</span><span class="w"> </span><span class="n">Portal</span>

<span class="err">‚òê</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">Resource</span><span class="w"> </span><span class="n">Graph</span><span class="w"> </span><span class="n">Queries</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Query</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">vcenter</span><span class="o">-</span><span class="n">source</span><span class="w"> </span><span class="p">(</span><span class="n">can</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">vCenter</span><span class="o">?</span><span class="p">)</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Query</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">cost</span><span class="o">-</span><span class="n">center</span><span class="w"> </span><span class="p">(</span><span class="n">can</span><span class="w"> </span><span class="n">Finance</span><span class="w"> </span><span class="k">generate</span><span class="w"> </span><span class="n">reports</span><span class="o">?</span><span class="p">)</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Query</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">migration</span><span class="o">-</span><span class="n">wave</span><span class="w"> </span><span class="p">(</span><span class="n">can</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">plan</span><span class="w"> </span><span class="n">deployment</span><span class="w"> </span><span class="n">sequences</span><span class="o">?</span><span class="p">)</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Query</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">compliance</span><span class="o">-</span><span class="n">scope</span><span class="w"> </span><span class="p">(</span><span class="n">can</span><span class="w"> </span><span class="n">Security</span><span class="w"> </span><span class="n">audit</span><span class="w"> </span><span class="n">regulatory</span><span class="w"> </span><span class="n">scope</span><span class="o">?</span><span class="p">)</span>

<span class="err">‚òê</span><span class="w"> </span><span class="n">Enable</span><span class="w"> </span><span class="n">Arc</span><span class="w"> </span><span class="n">Features</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Azure</span><span class="w"> </span><span class="n">Monitor</span><span class="w"> </span><span class="n">integration</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="n">required</span><span class="p">)</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Azure</span><span class="w"> </span><span class="n">Policy</span><span class="w"> </span><span class="n">guest</span><span class="w"> </span><span class="n">configuration</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Azure</span><span class="w"> </span><span class="n">Update</span><span class="w"> </span><span class="n">Manager</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">patching</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">ESU</span><span class="w"> </span><span class="n">licensing</span><span class="w"> </span><span class="p">(</span><span class="k">for</span><span class="w"> </span><span class="n">Windows</span><span class="w"> </span><span class="n">Server</span><span class="w"> </span><span class="mh">2012</span><span class="o">/</span><span class="n">R2</span><span class="p">)</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Microsoft</span><span class="w"> </span><span class="n">Defender</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Cloud</span><span class="w"> </span><span class="n">integration</span>

<span class="err">‚òê</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">Up</span><span class="w"> </span><span class="n">Monitoring</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">Alerting</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Alert</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">Arc</span><span class="w"> </span><span class="n">agent</span><span class="w"> </span><span class="n">disconnections</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Alert</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">agent</span><span class="w"> </span><span class="n">health</span><span class="w"> </span><span class="n">failures</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Monitor</span><span class="w"> </span><span class="n">Arc</span><span class="w"> </span><span class="n">infrastructure</span><span class="w"> </span><span class="n">costs</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Track</span><span class="w"> </span><span class="n">agent</span><span class="w"> </span><span class="n">deployment</span><span class="w"> </span><span class="n">coverage</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">VMs</span><span class="w"> </span><span class="n">Arc</span><span class="o">-</span><span class="n">enabled</span><span class="p">)</span>

<span class="err">‚òê</span><span class="w"> </span><span class="n">Configure</span><span class="w"> </span><span class="n">Cost</span><span class="w"> </span><span class="n">Management</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="n">allocation</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">vcenter</span><span class="o">-</span><span class="n">source</span><span class="w"> </span><span class="n">tag</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="n">allocation</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">cost</span><span class="o">-</span><span class="n">center</span><span class="w"> </span><span class="n">tag</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Generate</span><span class="w"> </span><span class="n">monthly</span><span class="w"> </span><span class="n">reports</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Finance</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Track</span><span class="w"> </span><span class="n">Arc</span><span class="w"> </span><span class="n">licensing</span><span class="w"> </span><span class="n">costs</span><span class="w"> </span><span class="n">separately</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">Azure</span><span class="w"> </span><span class="n">consumption</span>

<span class="err">‚òê</span><span class="w"> </span><span class="n">Documentation</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">Runbooks</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Document</span><span class="w"> </span><span class="n">Arc</span><span class="w"> </span><span class="n">architecture</span><span class="w"> </span><span class="n">decisions</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">runbook</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">adding</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">VMs</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">Arc</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">runbook</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">troubleshooting</span><span class="w"> </span><span class="n">agent</span><span class="w"> </span><span class="n">failures</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">runbook</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">management</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">updates</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Document</span><span class="w"> </span><span class="n">escalation</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Arc</span><span class="w"> </span><span class="n">issues</span>
</code></pre></div>

<h3>Phase 4: Migration Planning (Week 11+)</h3>
<div class="codehilite"><pre><span></span><code><span class="err">‚òê</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">Arc</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Migration</span><span class="w"> </span><span class="n">Planning</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Query</span><span class="w"> </span><span class="n">VMs</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">migration</span><span class="o">-</span><span class="n">wave</span><span class="w"> </span><span class="n">tag</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Identify</span><span class="w"> </span><span class="n">dependencies</span><span class="w"> </span><span class="n">between</span><span class="w"> </span><span class="n">VMs</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="n">data</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Assess</span><span class="w"> </span><span class="n">azure</span><span class="o">-</span><span class="n">ready</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">VM</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Calculate</span><span class="w"> </span><span class="n">migration</span><span class="w"> </span><span class="n">costs</span><span class="w"> </span><span class="p">(</span><span class="n">Azure</span><span class="w"> </span><span class="n">consumption</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Arc</span><span class="w"> </span><span class="n">management</span><span class="p">)</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Build</span><span class="w"> </span><span class="n">migration</span><span class="w"> </span><span class="n">timeline</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">wave</span>

<span class="err">‚òê</span><span class="w"> </span><span class="n">Pilot</span><span class="w"> </span><span class="n">Migration</span><span class="w"> </span><span class="p">(</span><span class="n">vcenter</span><span class="o">-</span><span class="mi">02</span><span class="w"> </span><span class="n">VMs</span><span class="w"> </span><span class="n">first</span><span class="p">)</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="mi">10</span><span class="o">-</span><span class="mi">20</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="n">critical</span><span class="w"> </span><span class="n">dev</span><span class="o">/</span><span class="n">test</span><span class="w"> </span><span class="n">VMs</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Migrate</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">Azure</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">Azure</span><span class="w"> </span><span class="n">Migrate</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Validate</span><span class="w"> </span><span class="n">application</span><span class="w"> </span><span class="n">functionality</span><span class="w"> </span><span class="n">post</span><span class="o">-</span><span class="n">migration</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Measure</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="n">differences</span><span class="w"> </span><span class="p">(</span><span class="n">vCenter</span><span class="w"> </span><span class="n">vs</span><span class="w"> </span><span class="n">Azure</span><span class="p">)</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Document</span><span class="w"> </span><span class="n">lessons</span><span class="w"> </span><span class="n">learned</span>

<span class="err">‚òê</span><span class="w"> </span><span class="n">Production</span><span class="w"> </span><span class="n">Migration</span><span class="w"> </span><span class="n">Planning</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">vcenter</span><span class="o">-</span><span class="mi">01</span><span class="w"> </span><span class="n">tags</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">prioritize</span><span class="w"> </span><span class="n">applications</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Start</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="n">critical</span><span class="w"> </span><span class="n">production</span><span class="w"> </span><span class="n">workloads</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Keep</span><span class="w"> </span><span class="n">vcenter</span><span class="o">-</span><span class="mi">03</span><span class="w"> </span><span class="n">DR</span><span class="w"> </span><span class="n">site</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">fallback</span><span class="w"> </span><span class="n">during</span><span class="w"> </span><span class="n">migration</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Monitor</span><span class="w"> </span><span class="n">Arc</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">baselines</span>
<span class="w">  </span><span class="err">‚òê</span><span class="w"> </span><span class="n">Plan</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">hybrid</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="p">(</span><span class="n">some</span><span class="w"> </span><span class="n">VMs</span><span class="w"> </span><span class="n">on</span><span class="o">-</span><span class="n">prem</span><span class="p">,</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">Azure</span><span class="p">)</span>
</code></pre></div>

<h2>The KQL Queries That Make This Work</h2>
<p>Once you have Arc deployed with proper tags, these Resource Graph queries give you the visibility you need.</p>
<h3>Query 1: VM Count by vCenter Source</h3>
<div class="codehilite"><pre><span></span><code><span class="n">resources</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;microsoft.hybridcompute/machines&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">vcenterSource</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tags</span><span class="err">.</span><span class="n">vcenter_source</span>
<span class="p">|</span><span class="w"> </span><span class="k">summarize</span><span class="w"> </span><span class="n">VMCount</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">count</span><span class="p">()</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">vcenterSource</span>
<span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">VMCount</span><span class="w"> </span><span class="n">desc</span>
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>vcenter_source    VMCount
vcenter-01        450
vcenter-02        280
vcenter-03        150
</code></pre></div>

<p>Now you know exactly how many VMs you have in each vCenter, visible in Azure.</p>
<h3>Query 2: Migration Wave Planning</h3>
<div class="codehilite"><pre><span></span><code><span class="n">resources</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;microsoft.hybridcompute/machines&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">vcenterSource</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tags</span><span class="err">.</span><span class="n">vcenter_source</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">migrationWave</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tags</span><span class="p">[</span><span class="s">&quot;migration-wave&quot;</span><span class="p">]</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">azureReady</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tags</span><span class="p">[</span><span class="s">&quot;azure-ready&quot;</span><span class="p">]</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">migrationWave</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">migrationWave</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="s">&quot;not-planned&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">summarize</span><span class="w"> </span><span class="n">VMCount</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">count</span><span class="p">()</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">migrationWave</span><span class="p">,</span><span class="w"> </span><span class="n">azureReady</span>
<span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">migrationWave</span>
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>migration_wave    azure_ready    VMCount
wave-1           yes             45
wave-1           needs-assessment 12
wave-2           yes             120
wave-2           no              35
wave-3           yes             200
</code></pre></div>

<p>Now you can plan migration sprints. Wave 1 has 45 VMs ready to migrate immediately, but 12 need assessment first.</p>
<h3>Query 3: Cost Allocation by Department</h3>
<div class="codehilite"><pre><span></span><code><span class="n">resources</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;microsoft.hybridcompute/machines&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">costCenter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tags</span><span class="p">[</span><span class="s">&quot;cost-center&quot;</span><span class="p">]</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">vcenterSource</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tags</span><span class="err">.</span><span class="n">vcenter_source</span>
<span class="p">|</span><span class="w"> </span><span class="k">summarize</span><span class="w"> </span><span class="n">VMCount</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">count</span><span class="p">()</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">costCenter</span><span class="p">,</span><span class="w"> </span><span class="n">vcenterSource</span>
<span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">costCenter</span>
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>cost_center         vcenter_source    VMCount
FINANCE-001        vcenter-01         80
FINANCE-001        vcenter-02         25
IT-INFRASTRUCTURE  vcenter-01         120
IT-INFRASTRUCTURE  vcenter-03         150
SALES-EAST         vcenter-01         45
</code></pre></div>

<p>Now Finance can allocate Arc management costs back to departments. Finance runs 105 VMs (80 prod + 25 dev), IT Infrastructure runs 270 VMs.</p>
<h3>Query 4: Find Untagged VMs (Data Quality Check)</h3>
<div class="codehilite"><pre><span></span><code><span class="n">resources</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;microsoft.hybridcompute/machines&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">vcenterSource</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tags</span><span class="err">.</span><span class="n">vcenter_source</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">costCenter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tags</span><span class="p">[</span><span class="s">&quot;cost-center&quot;</span><span class="p">]</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">appOwner</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tags</span><span class="p">[</span><span class="s">&quot;app-owner&quot;</span><span class="p">]</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">isnull</span><span class="p">(</span><span class="n">vcenterSource</span><span class="p">)</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">isnull</span><span class="p">(</span><span class="n">costCenter</span><span class="p">)</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">isnull</span><span class="p">(</span><span class="n">appOwner</span><span class="p">)</span>
<span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">vcenterSource</span><span class="p">,</span><span class="w"> </span><span class="n">costCenter</span><span class="p">,</span><span class="w"> </span><span class="n">appOwner</span><span class="p">,</span><span class="w"> </span><span class="n">resourceGroup</span>
<span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">name</span>
</code></pre></div>

<p>This finds VMs missing required tags. Run this weekly and fix tag gaps before Finance asks for reports.</p>
<h3>Query 5: Production VMs by Compliance Scope</h3>
<div class="codehilite"><pre><span></span><code><span class="n">resources</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;microsoft.hybridcompute/machines&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tags</span><span class="err">.</span><span class="n">environment</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">complianceScope</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tags</span><span class="p">[</span><span class="s">&quot;compliance-scope&quot;</span><span class="p">]</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;production&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">summarize</span><span class="w"> </span><span class="n">VMCount</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">count</span><span class="p">()</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">complianceScope</span>
<span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">VMCount</span><span class="w"> </span><span class="n">desc</span>
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>compliance_scope    VMCount
sox                 180
pci                 45
hipaa               30
none                195
</code></pre></div>

<p>Security can now audit regulatory scope. 180 VMs are SOX-regulated and require specific Azure Policy configurations.</p>
<h3>Query 6: Arc Agent Health Status</h3>
<div class="codehilite"><pre><span></span><code><span class="n">resources</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;microsoft.hybridcompute/machines&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">vcenterSource</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tags</span><span class="err">.</span><span class="n">vcenter_source</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">agentStatus</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">properties</span><span class="err">.</span><span class="n">status</span>
<span class="p">|</span><span class="w"> </span><span class="k">summarize</span><span class="w"> </span><span class="n">VMCount</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">count</span><span class="p">()</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">vcenterSource</span><span class="p">,</span><span class="w"> </span><span class="n">agentStatus</span>
<span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">vcenterSource</span><span class="p">,</span><span class="w"> </span><span class="n">agentStatus</span>
</code></pre></div>

<p><strong>Output:</strong></p>
<div class="codehilite"><pre><span></span><code>vcenter_source    agent_status    VMCount
vcenter-01        Connected       445
vcenter-01        Disconnected    5
vcenter-02        Connected       278
vcenter-02        Disconnected    2
</code></pre></div>

<p>Monitor agent health by vCenter. If 5 VMs from vcenter-01 are disconnected, investigate network or authentication issues.</p>
<h2>What To Do If You Already Deployed Without Planning</h2>
<p>Maybe you're reading this after you already deployed Arc to 1,200 VMs with no tags. Everything in one subscription, one resource group, zero governance.</p>
<p>I've been there. Here's how to fix it.</p>
<h3>Step 1: Accept Reality</h3>
<p>You cannot retroactively apply tags at scale without significant manual effort. There is no "magic script" that automatically discovers application owners and cost centers.</p>
<p>Budget 4-8 weeks to fix this mess.</p>
<h3>Step 2: Export Current Inventory</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Export all Arc machines to CSV</span>
<span class="n">az</span> <span class="n">graph</span> <span class="n">query</span> <span class="n">-q</span> <span class="s2">&quot;resources | where type == &#39;microsoft.hybridcompute/machines&#39; | project name, resourceGroup, location, properties.osName&quot;</span> <span class="p">-</span><span class="n">-output</span> <span class="n">table</span> <span class="p">&gt;</span> <span class="n">arc-inventory</span><span class="p">.</span><span class="n">csv</span>
</code></pre></div>

<p>Now you have a spreadsheet with all Arc-enabled VMs.</p>
<h3>Step 3: Map VMs to Metadata (The Hard Part)</h3>
<p>Send this spreadsheet to:<br />
- Finance: "Please fill in cost-center column"<br />
- Application teams: "Please fill in app-owner and application columns"<br />
- Infrastructure: "Please fill in vcenter-source column"</p>
<p><strong>They will not fill it out completely.</strong> You'll get 60% coverage if you're lucky.</p>
<p>For the remaining 40%, you need to:<br />
- Cross-reference VM names against CMDBs (if you have one)<br />
- Match VM names to vCenter inventory exports (to determine vcenter-source)<br />
- Make educated guesses based on naming conventions<br />
- Accept that some VMs will remain "unknown" until someone complains</p>
<h3>Step 4: Apply Tags Programmatically</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Read CSV with tag data</span>
<span class="nv">$VMTagData</span> <span class="p">=</span> <span class="nb">Import-Csv</span> <span class="n">-Path</span> <span class="s2">&quot;arc-inventory-with-tags.csv&quot;</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$VM</span> <span class="k">in</span> <span class="nv">$VMTagData</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$ResourceId</span> <span class="p">=</span> <span class="s2">&quot;/subscriptions/$SubscriptionId/resourceGroups/</span><span class="p">$(</span><span class="nv">$VM</span><span class="p">.</span><span class="n">resourceGroup</span><span class="p">)</span><span class="s2">/providers/Microsoft.HybridCompute/machines/</span><span class="p">$(</span><span class="nv">$VM</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="s2">&quot;</span>

    <span class="nv">$Tags</span> <span class="p">=</span> <span class="p">@{</span>
        <span class="s2">&quot;vcenter-source&quot;</span> <span class="p">=</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">vcenter_source</span>
        <span class="s2">&quot;cost-center&quot;</span> <span class="p">=</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">cost_center</span>
        <span class="s2">&quot;app-owner&quot;</span> <span class="p">=</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">app_owner</span>
        <span class="s2">&quot;environment&quot;</span> <span class="p">=</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">environment</span>
        <span class="s2">&quot;migration-wave&quot;</span> <span class="p">=</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">migration_wave</span>
    <span class="p">}</span>

    <span class="c"># Apply tags</span>
    <span class="n">az</span> <span class="n">tag</span> <span class="n">create</span> <span class="p">-</span><span class="n">-resource-id</span> <span class="nv">$ResourceId</span> <span class="p">-</span><span class="n">-tags</span> <span class="nv">$Tags</span>
<span class="p">}</span>
</code></pre></div>

<h3>Step 5: Reorganize Resource Groups (Optional)</h3>
<p>If everything is in one resource group and you want to split by vCenter:</p>
<div class="codehilite"><pre><span></span><code><span class="c"># Move vcenter-01 VMs to dedicated resource group</span>
<span class="nv">$Vcenter01VMs</span> <span class="p">=</span> <span class="n">az</span> <span class="n">graph</span> <span class="n">query</span> <span class="n">-q</span> <span class="s2">&quot;resources | where type == &#39;microsoft.hybridcompute/machines&#39; and tags.vcenter_source == &#39;vcenter-01&#39;&quot;</span> <span class="p">-</span><span class="n">-output</span> <span class="n">json</span> <span class="p">|</span> <span class="nb">ConvertFrom-Json</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$VM</span> <span class="k">in</span> <span class="nv">$Vcenter01VMs</span><span class="p">.</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">az</span> <span class="n">resource</span> <span class="nb">move </span><span class="p">-</span><span class="n">-ids</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">id</span> <span class="p">-</span><span class="n">-destination-group</span> <span class="s2">&quot;arc-vcenter-01-rg&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Warning:</strong> Moving resources can break dependencies like Azure Monitor dashboards and Policy assignments. Test on 5 VMs first.</p>
<h3>Step 6: Prevent Future Tag Drift</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Azure Policy to require tags on new Arc machines</span>
<span class="p">{</span>
  <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;Indexed&quot;</span><span class="p">,</span>
  <span class="s2">&quot;policyRule&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;if&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;allOf&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span>
          <span class="s2">&quot;equals&quot;</span><span class="p">:</span> <span class="s2">&quot;Microsoft.HybridCompute/machines&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;tags[&#39;vcenter-source&#39;]&quot;</span><span class="p">,</span>
          <span class="s2">&quot;exists&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;then&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;effect&quot;</span><span class="p">:</span> <span class="s2">&quot;deny&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>This prevents future Arc deployments without required tags.</p>
<h2>Common Arc Implementation Mistakes</h2>
<p>After helping multiple organizations deploy Arc, here are the patterns I see repeatedly:</p>
<h3>Mistake 1: "We'll Tag Later"</h3>
<p><strong>The trap:</strong> Deploy Arc agents fast, plan to add tags afterward.</p>
<p><strong>Why it fails:</strong> Retroactive tagging requires data you don't have. VM names don't map to applications. Application owners don't respond to surveys. Cost centers changed last year.</p>
<p><strong>The fix:</strong> Collect tag data BEFORE deployment. Delay deployment by 4 weeks if needed. Proper tags are worth it.</p>
<h3>Mistake 2: Ignoring the Two-Phase Deployment</h3>
<p><strong>The trap:</strong> Deploy Arc Resource Bridge, assume VMs are now Arc-enabled.</p>
<p><strong>Why it fails:</strong> The Resource Bridge makes VMs visible but doesn't install agents. No agents = no management capability.</p>
<p><strong>The fix:</strong> Understand that Resource Bridge ‚â† Arc agents. Budget time for both phases.</p>
<h3>Mistake 3: Using Only OOTB RBAC Roles</h3>
<p><strong>The trap:</strong> Assign "Contributor" role and start deploying.</p>
<p><strong>Why it fails:</strong> Arc requires specific permissions that don't exist in standard roles. Deployments fail with cryptic "access denied" errors.</p>
<p><strong>The fix:</strong> Create custom RBAC roles with Arc-specific permissions:<br />
- <code>Microsoft.HybridCompute/machines/read</code><br />
- <code>Microsoft.HybridCompute/machines/write</code><br />
- <code>Microsoft.HybridCompute/machines/extensions/write</code><br />
- <code>Microsoft.HybridCompute/machines/licenseProfiles/write</code> (for ESU)</p>
<h3>Mistake 4: One Subscription for Everything</h3>
<p><strong>The trap:</strong> Put all Arc resources in one subscription to "keep it simple."</p>
<p><strong>Why it fails:</strong> You can't separate costs by business unit. Finance can't charge back departments. Migration planning is harder (can't separate prod from dev subscriptions).</p>
<p><strong>The fix:</strong> Use subscription strategy aligned with your organization:<br />
- Option A: One subscription per vCenter<br />
- Option B: One subscription per environment (prod/dev/dr)<br />
- Option C: One subscription per business unit</p>
<h3>Mistake 5: Assuming WSUS Integration Works</h3>
<p><strong>The trap:</strong> Enable Arc ESU and expect patches to flow through existing WSUS infrastructure.</p>
<p><strong>Why it fails:</strong> WSUS doesn't validate ESU licenses. Patches approve for VMs that can't install them. Compliance reports become garbage.</p>
<p><strong>The fix:</strong> Use Azure Update Manager instead of WSUS for Arc-enabled VMs. Query Resource Graph for patch compliance, not WSUS.</p>
<h3>Mistake 6: No Monitoring for Agent Health</h3>
<p><strong>The trap:</strong> Deploy agents and assume they'll stay connected forever.</p>
<p><strong>Why it fails:</strong> Agents disconnect due to network issues, certificate expiration, Azure API throttling, TLS configuration changes. Silent failures = VMs stop getting patches.</p>
<p><strong>The fix:</strong> Set up Azure Monitor alerts for disconnected agents:</p>
<div class="codehilite"><pre><span></span><code><span class="n">resources</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;microsoft.hybridcompute/machines&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">agentStatus</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">properties</span><span class="err">.</span><span class="n">status</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">agentStatus</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="s">&quot;Connected&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">agentStatus</span><span class="p">,</span><span class="w"> </span><span class="n">resourceGroup</span><span class="p">,</span><span class="w"> </span><span class="n">tags</span>
</code></pre></div>

<p>Alert when count &gt; 0.</p>
<h2>The Questions to Ask Your Boss Before Deploying Anything</h2>
<p>Before you install a single Arc agent, sit down with leadership and get answers to these questions. Email doesn't work. Schedule a meeting. Get decisions.</p>
<h3>Question 1: Subscription Strategy</h3>
<p>"Do we want one Azure subscription for all Arc resources, or separate subscriptions by vCenter/environment/business unit?"</p>
<p><strong>Why this matters:</strong> You can't easily move resources between subscriptions later. This decision is permanent.</p>
<p><strong>Get specific:</strong> <br />
- Who pays for Arc costs? (centralized IT budget vs. departmental chargeback)<br />
- How do we separate prod from non-prod spending?<br />
- What happens when we acquire another company? (merger scenario)</p>
<h3>Question 2: Tagging Taxonomy</h3>
<p>"What metadata do we need to track for every VM? Who will provide this data?"</p>
<p><strong>Why this matters:</strong> Without tags, you can't allocate costs, plan migrations, or organize resources.</p>
<p><strong>Get specific:</strong><br />
- "Finance, what cost center codes should we use?" (Get the actual codes, not "we'll figure it out")<br />
- "Application teams, who should we list as app-owner?" (Get email addresses, not "the team")<br />
- "Security, what compliance scopes do we need to track?" (SOX, PCI, HIPAA, etc.)</p>
<h3>Question 3: Migration Timeline</h3>
<p>"When are we planning to migrate these VMs to Azure? What's the priority?"</p>
<p><strong>Why this matters:</strong> If migration is 5+ years away, Arc might not be worth the cost. If migration is 6 months away, Arc helps with planning.</p>
<p><strong>Get specific:</strong><br />
- "Which vCenter do we migrate first?" (Dev/test before production)<br />
- "Which applications are migration priorities?" (Business-critical vs. nice-to-have)<br />
- "What's blocking migration today?" (Technical debt, vendor support, budget)</p>
<h3>Question 4: Cost Allocation Model</h3>
<p>"How do we charge back Arc management costs to business units?"</p>
<p><strong>Why this matters:</strong> Arc costs $5-15 per VM per month. For 1,200 VMs, that's $72K-180K annually. Someone has to pay.</p>
<p><strong>Get specific:</strong><br />
- "Does IT absorb all Arc costs?" (centralized model)<br />
- "Do we charge departments based on VM count?" (chargeback model)<br />
- "Do we allocate based on cost-center tags?" (tag-based allocation)</p>
<h3>Question 5: Governance and RBAC</h3>
<p>"Who can deploy Arc agents? Who can manage Arc resources? Who can view data?"</p>
<p><strong>Why this matters:</strong> Without RBAC planning, everyone becomes an Arc administrator or nobody can do their job.</p>
<p><strong>Get specific:</strong><br />
- "Can application teams deploy their own Arc agents?" (self-service vs. centralized)<br />
- "Can Finance view cost data without full Azure access?" (read-only roles)<br />
- "Who handles Arc support escalations?" (operations model)</p>
<p><strong>If your boss says "yeah yeah, we'll figure that out later" to any of these questions, do not proceed with deployment.</strong> You're setting up an unfixable mess.</p>
<p>Push back. Say: "I need these decisions before deployment. Retrofitting governance is 10x harder than planning upfront."</p>
<p>If they still push for fast deployment despite no strategy, document that you raised these concerns. When the mess happens (and it will), you'll need that paper trail.</p>
<h2>Resources and Tools</h2>
<p>Here are the PowerShell scripts, KQL queries, and templates I use for Arc implementations.</p>
<h3>GitHub Repository</h3>
<p>I've published a complete Arc implementation toolkit at:<br />
<strong>github.com/azure-noob/arc-vcenter-toolkit</strong></p>
<p>Includes:<br />
- PowerShell script for Arc agent deployment with tags<br />
- KQL query library for Resource Graph<br />
- Tagging taxonomy template (Excel)<br />
- Pre-deployment questionnaire for stakeholders<br />
- Cost allocation calculator<br />
- RBAC custom role definitions</p>
<h3>Essential PowerShell Functions</h3>
<p><strong>Check Arc Agent Status Across All VMs:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">function</span> <span class="nb">Get-ArcAgentHealth</span> <span class="p">{</span>
    <span class="n">az</span> <span class="n">graph</span> <span class="n">query</span> <span class="n">-q</span> <span class="sh">@&quot;</span>
<span class="sh">        resources</span>
<span class="sh">        | where type == &#39;microsoft.hybridcompute/machines&#39;</span>
<span class="sh">        | extend agentStatus = properties.status</span>
<span class="sh">        | extend lastHeartbeat = properties.lastStatusChange</span>
<span class="sh">        | extend vcenterSource = tags.vcenter_source</span>
<span class="sh">        | project name, agentStatus, lastHeartbeat, vcenterSource, resourceGroup</span>
<span class="sh">        | order by agentStatus desc, name asc</span>
<span class="sh">&quot;@</span> <span class="p">-</span><span class="n">-output</span> <span class="n">table</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Bulk Tag Application:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">function</span> <span class="nb">Set-ArcVMTags</span> <span class="p">{</span>
    <span class="k">param</span><span class="p">(</span>
        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$true</span><span class="p">)]</span>
        <span class="no">[string]</span><span class="nv">$CsvPath</span><span class="p">,</span>

        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$true</span><span class="p">)]</span>
        <span class="no">[string]</span><span class="nv">$SubscriptionId</span>
    <span class="p">)</span>

    <span class="nv">$VMData</span> <span class="p">=</span> <span class="nb">Import-Csv</span> <span class="n">-Path</span> <span class="nv">$CsvPath</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$VM</span> <span class="k">in</span> <span class="nv">$VMData</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$ResourceId</span> <span class="p">=</span> <span class="s2">&quot;/subscriptions/$SubscriptionId/resourceGroups/</span><span class="p">$(</span><span class="nv">$VM</span><span class="p">.</span><span class="n">resourceGroup</span><span class="p">)</span><span class="s2">/providers/Microsoft.HybridCompute/machines/</span><span class="p">$(</span><span class="nv">$VM</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="s2">&quot;</span>

        <span class="nv">$Tags</span> <span class="p">=</span> <span class="p">@{}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$VM</span><span class="p">.</span><span class="n">vcenter_source</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$Tags</span><span class="p">[</span><span class="s2">&quot;vcenter-source&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">vcenter_source</span> <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$VM</span><span class="p">.</span><span class="n">cost_center</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$Tags</span><span class="p">[</span><span class="s2">&quot;cost-center&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">cost_center</span> <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$VM</span><span class="p">.</span><span class="n">app_owner</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$Tags</span><span class="p">[</span><span class="s2">&quot;app-owner&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">app_owner</span> <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$VM</span><span class="p">.</span><span class="n">environment</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$Tags</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">environment</span> <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$VM</span><span class="p">.</span><span class="n">migration_wave</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$Tags</span><span class="p">[</span><span class="s2">&quot;migration-wave&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">migration_wave</span> <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$Tags</span><span class="p">.</span><span class="n">Count</span> <span class="o">-gt</span> <span class="n">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">Write-Host</span> <span class="s2">&quot;Tagging </span><span class="p">$(</span><span class="nv">$VM</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="s2">...&quot;</span>
            <span class="n">az</span> <span class="n">tag</span> <span class="n">create</span> <span class="p">-</span><span class="n">-resource-id</span> <span class="nv">$ResourceId</span> <span class="p">-</span><span class="n">-tags</span> <span class="nv">$Tags</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Find VMs Missing Required Tags:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">function</span> <span class="nb">Get-UntaggedArcVMs</span> <span class="p">{</span>
    <span class="n">az</span> <span class="n">graph</span> <span class="n">query</span> <span class="n">-q</span> <span class="sh">@&quot;</span>
<span class="sh">        resources</span>
<span class="sh">        | where type == &#39;microsoft.hybridcompute/machines&#39;</span>
<span class="sh">        | extend vcenterSource = tags.vcenter_source</span>
<span class="sh">        | extend costCenter = tags[&#39;cost-center&#39;]</span>
<span class="sh">        | extend appOwner = tags[&#39;app-owner&#39;]</span>
<span class="sh">        | where isnull(vcenterSource) or isnull(costCenter) or isnull(appOwner)</span>
<span class="sh">        | project name, vcenterSource, costCenter, appOwner, resourceGroup</span>
<span class="sh">        | order by name asc</span>
<span class="sh">&quot;@</span> <span class="p">-</span><span class="n">-output</span> <span class="n">table</span>
<span class="p">}</span>
</code></pre></div>

<h3>Cost Allocation Queries</h3>
<p><strong>Monthly Arc Costs by vCenter:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c">// Run in Azure Cost Management</span>
<span class="n">AzureConsumption</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">ResourceType</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;microsoft.hybridcompute/machines&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">vcenterSource</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tags</span><span class="p">[</span><span class="s">&quot;vcenter-source&quot;</span><span class="p">]</span>
<span class="p">|</span><span class="w"> </span><span class="k">summarize</span><span class="w"> </span><span class="n">MonthlyCost</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">Cost</span><span class="p">)</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">vcenterSource</span><span class="p">,</span><span class="w"> </span><span class="n">format_datetime</span><span class="p">(</span><span class="n">Date</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;yyyy-MM&#39;</span><span class="p">)</span>
<span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="n">desc</span><span class="p">,</span><span class="w"> </span><span class="n">MonthlyCost</span><span class="w"> </span><span class="n">desc</span>
</code></pre></div>

<p><strong>Arc Licensing Costs by Department:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">AzureConsumption</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">ResourceType</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;microsoft.hybridcompute/machines&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">costCenter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tags</span><span class="p">[</span><span class="s">&quot;cost-center&quot;</span><span class="p">]</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">isnotempty</span><span class="p">(</span><span class="n">costCenter</span><span class="p">)</span>
<span class="p">|</span><span class="w"> </span><span class="k">summarize</span><span class="w"> </span><span class="n">TotalCost</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">Cost</span><span class="p">)</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">costCenter</span>
<span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">TotalCost</span><span class="w"> </span><span class="n">desc</span>
</code></pre></div>

<h2>The Bottom Line</h2>
<p>Azure Arc for multi-vCenter environments is powerful. When implemented correctly, it gives you:<br />
- Unified inventory across all vCenters<br />
- Cloud management for on-premises VMs<br />
- Migration planning visibility<br />
- Cost allocation by department<br />
- Compliance tracking across hybrid infrastructure</p>
<p>But "implemented correctly" requires:<br />
- Strategic planning before deployment (not after)<br />
- Understanding the two-phase deployment model<br />
- Comprehensive tagging from day one<br />
- Weeks of data collection from stakeholders<br />
- Clear governance and RBAC design</p>
<p>The technology is not the challenge. The organizational coordination is the challenge.</p>
<p>If Microsoft is pressuring you to "just deploy Arc fast," push back. Ask for 4 weeks to plan properly. Collect tag data before installing agents. Get leadership decisions on subscription strategy and cost allocation.</p>
<p>If your boss says "yeah yeah, we'll figure out governance later," recognize that you're being set up for failure. Document your concerns. Deploy with proper tags anyway (even if it delays the timeline). Your future self will thank you.</p>
<p>And if you're already in the mess‚Äîeverything in one subscription, no tags, Finance asking questions you can't answer‚Äîknow that you're not alone. Every enterprise I've worked with has made some version of these mistakes.</p>
<p>The path forward is clear: export inventory, collect metadata manually, apply tags retroactively, and prevent future tag drift with Azure Policy.</p>
<p>It's painful, but it's fixable.</p>
<p>Just don't make the same mistake twice.</p>
<hr />
<h2>üìã Related: Azure Arc Enterprise Readiness Checklist</h2>
<p>Deploying Arc at enterprise scale? Download the complete pre-deployment validation checklist covering governance, networking, cost planning, and vCenter integration.</p>
<p><strong><a href="/static/downloads/Azure-Arc-Enterprise-Readiness-Checklist.pdf">Download Free Checklist (PDF)</a></strong> | <strong><a href="/static/downloads/Azure-Arc-Enterprise-Readiness-Checklist.xlsx">Excel Version</a></strong></p>
<hr />
<p><strong>Have questions about Arc implementation?</strong> I've probably seen your problem. Drop a comment or check out the <a href="https://github.com/azure-noob/arc-vcenter-toolkit">Arc vCenter toolkit repository</a> for scripts and templates.</p>
<p><strong>Dealing with a rushed Arc deployment?</strong> You're not alone. The pattern repeats across every enterprise. Share your story in the comments‚Äîother admins need to know they're not the only ones navigating this mess.</p>
  </div>

  
  <section class="starter-kit-callout" style="
    max-width: 800px;
    margin: 3rem auto 2rem;
    padding: 2rem;
    border-radius: 12px;
    background: var(--bg-light);
    border: 1px solid var(--border);
    text-align: left;
  ">
    <h3 style="margin-top: 0;">Azure Admin Starter Kit (Free Download)</h3>
    <p style="margin-bottom: 1rem;">
      Get my KQL cheat sheet, 50 Windows + 50 Linux commands, and an Azure RACI template in one free bundle.
    </p>
    <a href="/blog/starter-kit/" class="btn">Get the Starter Kit ‚Üí</a>
  </section>

  
  <aside class="email-capture" style="max-width: 800px; margin: 4rem auto; padding: 3rem; background: linear-gradient(135deg, #0078d4 0%, #005a9e 100%); border-radius: 12px; text-align: center; color: white;">
    <h3 style="margin-top: 0; color: white; font-size: 1.75rem;">Get Azure operational guides in your inbox</h3>
    <p style="margin: 1rem 0 2rem; font-size: 1.1rem; color: white;">Weekly tips from managing 44 Azure subscriptions. No marketing BS.</p>
    
    <form action="https://app.kit.com/forms/8896829/subscriptions" method="post" style="max-width: 500px; margin: 0 auto; display: flex; gap: 0.75rem; flex-wrap: wrap; justify-content: center;">
      <input type="email" 
             name="email_address" 
             placeholder="your@email.com" 
             required 
             style="flex: 1; min-width: 250px; padding: 0.875rem 1rem; border: none; border-radius: 8px; font-size: 1rem; color: #333;">
      <button type="submit" 
              style="padding: 0.875rem 2rem; background: white; color: #0078d4; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; white-space: nowrap; font-size: 1rem; transition: all 0.2s;">
        Subscribe
      </button>
    </form>
    
    <p style="margin: 1.5rem 0 0; font-size: 0.9rem; opacity: 0.9; color: white;">
      Join 500+ Azure admins. Unsubscribe anytime.
    </p>
  </aside>

  
  
  <aside class="related-posts" style="max-width: 800px; margin: 3rem auto; padding: 2rem; background: var(--bg-light); border-radius: 12px;">
    <h3 style="margin-top: 0;">Related Posts</h3>
    <ul style="list-style: none; padding: 0;">
      
      <li style="margin: 1rem 0;">
        <a href="/blog/azure-arc-enterprise-scale-problems/" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">Azure Arc at Enterprise Scale: The Problems Microsoft Doesn&#39;t Document</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-12-19</span>
        </a>
      </li>
      
      <li style="margin: 1rem 0;">
        <a href="/blog/azure-arc-ghost-registrations/" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">Azure Arc Ghost Registrations: Why 64% of My Arc Inventory Doesn&#39;t Exist</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-12-06</span>
        </a>
      </li>
      
      <li style="margin: 1rem 0;">
        <a href="/blog/azure-arc-private-lab/" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">Building an Azure Arc Lab with Private Link (No Public IPs)</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-11-26</span>
        </a>
      </li>
      
    </ul>
  </aside>
  

  
  
  
    <!-- CTA: Azure Migration Assessment Framework -->
<div class="cta-block" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); padding: 2rem; border-radius: 8px; margin: 3rem 0; text-align: center; color: white;">
  <h3 style="margin: 0 0 1rem; font-size: 1.75rem; color: white;">‚úã Stop. Don't Migrate Yet.</h3>
  <p style="margin: 0 0 1.5rem; font-size: 1.1rem; line-height: 1.6;">
    Answer <strong>55 questions about each application</strong> before touching Azure Migrate.
    This framework prevents the $2M mistakes that kill enterprise migrations.
  </p>
  <a href="/static/downloads/Azure-Integration-Assessment-Framework.xlsx" 
     download
     style="display: inline-block; padding: 0.75rem 2rem; background: white; color: #330867; text-decoration: none; border-radius: 6px; font-weight: 700; font-size: 1.1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transition: all 0.3s ease;"
     onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,0,0,0.2)'"
     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'">
    Get the Migration Assessment Framework
  </a>
  <p style="margin: 1rem 0 0; font-size: 0.9rem; opacity: 0.9;">
    Excel template ‚Ä¢ Complete instructions included ‚Ä¢ No email required
  </p>
</div>
  

  
  <nav class="post-nav">
    
      <a href="/blog/resource-tags-100k-problem/">
        <span style="opacity: 0.7; font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">‚Üê Previous</span>
        <strong>The $100k Tag Problem: Calculating Hidden Azure Costs (2025)</strong>
      </a>
    
    
      <a href="/blog/azure-ai-foundry-terraform/" style="text-align: right;">
        <span style="opacity: 0.7; font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">Next ‚Üí</span>
        <strong>Azure AI Foundry + Terraform: Production RAG Infrastructure as Code (Not Portal Clickops)</strong>
      </a>
    
  </nav>

</article>

    </div>
  </main>

  <footer class="site-footer">
    <div class="wrap">
      
      <!-- Featured Bundle Promotion - TEMPORARILY DISABLED
      <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 2rem; border-radius: 8px; margin-bottom: 2rem; text-align: center; color: white;">
        <h3 style="color: white; margin: 0 0 0.75rem 0; font-size: 1.5rem;">üì¶ Enterprise Azure Operations Bundle</h3>
        <p style="font-size: 1.05rem; margin: 0 0 1rem 0; opacity: 0.95;">
          Get all 4 digital products for <strong style="font-size: 1.25rem;">$97</strong> <span style="text-decoration: line-through; opacity: 0.7;">($86 separately)</span>
        </p>
        <ul style="list-style: none; padding: 0; margin: 1rem 0 1.5rem; text-align: left; max-width: 500px; margin-left: auto; margin-right: auto; font-size: 0.95rem;">
          <li style="padding: 0.35rem 0;">‚úîÔ∏è Azure AI FinOps Query Pack (12 production KQL queries)</li>
          <li style="padding: 0.35rem 0;">‚úîÔ∏è Azure Migration Assessment Pro (55-question framework)</li>
          <li style="padding: 0.35rem 0;">‚úîÔ∏è Azure CAF Operations RACI Pro (Governance matrix)</li>
          <li style="padding: 0.35rem 0;">‚úîÔ∏è Enterprise Azure Inventory KQL Pack (Tested on 30K+ resources)</li>
        </ul>
        <a href="https://davidnoob.gumroad.com/l/azure-ops-bundle" 
           style="display: inline-block; padding: 0.875rem 2rem; background: white; color: #667eea; text-decoration: none; border-radius: 6px; font-weight: 700; font-size: 1.05rem; box-shadow: 0 4px 12px rgba(0,0,0,0.2);" 
           target="_blank" rel="noopener">
          Get the Bundle ‚Üí
        </a>
        <p style="margin: 1rem 0 0; font-size: 0.85rem; opacity: 0.9;">
          Instant digital delivery ‚Ä¢ Lifetime updates ‚Ä¢ Money-back guarantee
        </p>
      </div>
      -->
      
      <p>&copy; 2026 Azure Noob ‚Äî Don&#39;t be a Noob</p>
      <p style="margin-top: 0.5rem; font-size: 0.9rem;">
        <a href="/rss.xml" title="Subscribe via RSS">RSS Feed</a> ¬∑ 
        <a href="https://github.com/dswann101164" target="_blank" rel="noopener">GitHub</a>
      </p>
      <p style="margin-top: 1.5rem; font-size: 0.85rem; opacity: 0.7; font-style: italic;">
        "Trust in the Lord with all your heart, and lean not on your own understanding;<br>
        in all your ways acknowledge Him, and He will make your paths straight" ‚Äî Proverbs 3:5-6
      </p>
    </div>
  </footer>

  <!-- Copy code functionality -->
  <script src="/static/copy-code.js"></script>

  <!-- Exit-Intent Popup -->
  <div id="exit-popup" class="exit-popup" style="display: none;">
    <div class="exit-popup-content">
      <button class="exit-popup-close" onclick="closeExitPopup()">&times;</button>
      <h2>Wait! Before You Go...</h2>
      <p class="exit-popup-subtitle">Get the <strong>FREE Azure Admin Starter Kit</strong></p>
      <ul class="exit-popup-benefits">
        <li>‚úì 15 Essential KQL Queries</li>
        <li>‚úì 50 Windows Commands</li>
        <li>‚úì 50 Linux Commands</li>
      </ul>
      <form id="exit-popup-form" class="exit-popup-form">
        <input type="email" id="popup-email" placeholder="Enter your email" required>
        <button type="submit" class="exit-popup-submit">Send Me The Free Kit</button>
      </form>
      <p class="exit-popup-privacy">We'll also notify you about new tools & guides. Unsubscribe anytime.</p>
    </div>
  </div>

  <style>
  .exit-popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .exit-popup-content {
    background: white;
    padding: 2.5rem;
    border-radius: 12px;
    max-width: 500px;
    width: 90%;
    position: relative;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: slideUp 0.3s ease;
  }

  @keyframes slideUp {
    from { transform: translateY(50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .exit-popup-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    font-size: 2rem;
    cursor: pointer;
    color: #999;
    line-height: 1;
  }

  .exit-popup-close:hover {
    color: #333;
  }

  .exit-popup h2 {
    margin: 0 0 0.5rem 0;
    color: #0078d4;
    font-size: 2rem;
  }

  .exit-popup-subtitle {
    font-size: 1.2rem;
    margin: 0 0 1.5rem 0;
  }

  .exit-popup-benefits {
    list-style: none;
    padding: 0;
    margin: 1.5rem 0;
  }

  .exit-popup-benefits li {
    padding: 0.5rem 0;
    font-size: 1.1rem;
  }

  .exit-popup-form {
    margin: 1.5rem 0;
  }

  .exit-popup-form input[type="email"] {
    width: 100%;
    padding: 1rem;
    border: 2px solid #ddd;
    border-radius: 6px;
    font-size: 1rem;
    margin-bottom: 1rem;
  }

  .exit-popup-form input[type="email"]:focus {
    outline: none;
    border-color: #0078d4;
  }

  .exit-popup-submit {
    width: 100%;
    padding: 1rem 2rem;
    background: #0078d4;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 1.1rem;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s;
  }

  .exit-popup-submit:hover {
    background: #005a9e;
  }

  .exit-popup-privacy {
    font-size: 0.85rem;
    color: #666;
    margin-top: 1rem;
    text-align: center;
  }
  </style>

  <script>
  // Exit-intent detection
  let exitPopupShown = false;
  let mouseY = 0;

  document.addEventListener('mousemove', (e) => {
    mouseY = e.clientY;
  });

  document.addEventListener('mouseout', (e) => {
    // If mouse leaves through top of viewport and popup hasn't been shown
    if (!exitPopupShown && e.clientY <= 0 && mouseY <= 100) {
      // Check if user has seen it before (session storage)
      if (!sessionStorage.getItem('exitPopupSeen')) {
        showExitPopup();
      }
    }
  });

  function showExitPopup() {
    exitPopupShown = true;
    document.getElementById('exit-popup').style.display = 'flex';
    sessionStorage.setItem('exitPopupSeen', 'true');
  }

  function closeExitPopup() {
    document.getElementById('exit-popup').style.display = 'none';
  }

  // Handle form submission
  document.getElementById('exit-popup-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('popup-email').value;
    
    // Send to Kit (ConvertKit)
    try {
      const FORM_ID = '8896829'; // Your Kit Form ID
      
      const response = await fetch(`https://api.convertkit.com/v3/forms/${FORM_ID}/subscribe`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          email: email
        })
      });
      
      if (response.ok) {
        console.log('‚úÖ Email captured to Kit:', email);
      }
      
      closeExitPopup();
      
      // Track in Google Analytics
      if (typeof gtag !== 'undefined') {
        gtag('event', 'signup', {
          'event_category': 'email',
          'event_label': 'exit_popup',
          'value': email
        });
      }
      
      // Redirect to starter kit page
      window.location.href = '/blog/starter-kit/';
      
    } catch (error) {
      console.error('Error:', error);
      // Still redirect even if tracking fails
      window.location.href = '/blog/starter-kit/';
    }
  });

  // Close on background click
  document.getElementById('exit-popup').addEventListener('click', (e) => {
    if (e.target.id === 'exit-popup') {
      closeExitPopup();
    }
  });
  </script>
</body>
</html>