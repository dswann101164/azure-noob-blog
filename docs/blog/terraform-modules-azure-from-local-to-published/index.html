<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  
  

  <!-- Primary SEO -->
  <title>Terraform Modules for Azure: From Local to Published (4 Steps That Actually Work) ¬∑ Azure Noob</title>
  <meta name="description" content="Stop copy-pasting Terraform code across repos. Build reusable modules, version them properly, and publish to Azure DevOps Artifacts or Terraform Registry.">
  
  <link rel="canonical" href="https://azure-noob.com/blog/terraform-modules-azure-from-local-to-published/" />

  <!-- Favicons -->
  <link rel="icon" href="/static/images/logo.png">

  <!-- Open Graph -->
  <meta property="og:title" content="Terraform Modules for Azure: From Local to Published (4 Steps That Actually Work)">
  <meta property="og:description" content="Stop copy-pasting Terraform code across repos. Build reusable modules, version them properly, and publish to Azure DevOps Artifacts or Terraform Registry.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://azure-noob.com/blog/terraform-modules-azure-from-local-to-published/">
  <meta property="og:image" content="https://azure-noob.com/static/images/hero/terraform-modules-azure.png">

  
    <meta property="article:published_time" content="2025-12-21T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-12-21T00:00:00+00:00">
    <meta property="article:author" content="David Swann">
    
      
        <meta property="article:tag" content="terraform">
      
        <meta property="article:tag" content="iac">
      
        <meta property="article:tag" content="azure-devops">
      
        <meta property="article:tag" content="modules">
      
        <meta property="article:tag" content="best-practices">
      
    
  

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Terraform Modules for Azure: From Local to Published (4 Steps That Actually Work)">
  <meta name="twitter:description" content="Stop copy-pasting Terraform code across repos. Build reusable modules, version them properly, and publish to Azure DevOps Artifacts or Terraform Registry.">
  <meta name="twitter:image" content="https://azure-noob.com/static/images/hero/terraform-modules-azure.png">

  <!-- Organization Schema for GEO/AEO entity recognition -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Azure Noob",
    "url": "https://azure-noob.com",
    "logo": "https://azure-noob.com/static/images/logo.png",
    "description": "Practical Azure cloud tutorials and guides from managing 31,000+ resources across 44 subscriptions in regulated enterprise environments.",
    "founder": {
      "@type": "Person",
      "name": "David Swann",
      "jobTitle": "Azure Architect",
      "sameAs": [
        "https://github.com/dswann101164",
        "https://www.linkedin.com/in/intikiswann/"
      ]
    },
    "sameAs": [
      "https://github.com/dswann101164"
    ]
  }
  </script>

  <!-- Styles -->
  <link rel="stylesheet" href="/static/styles.css">

  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="Azure Noob RSS Feed" href="https://azure-noob.com/rss.xml">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZNHGEB0BNZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-ZNHGEB0BNZ');
  </script>
</head>
<body>
  <header class="site-header">
    <div class="wrap nav-wrap">
      <div class="brand-block">
        <a href="/" class="brand-link">
          <img src="/static/images/logo.png" alt="Azure Noob logo" class="logo">
        </a>
        <span class="brand-text">
          <small>Official Website of</small>
          <strong>Azure Noob</strong>
        </span>
      </div>
      <nav class="nav">
        <a href="/">Home</a>
        <a href="/blog/">Blog</a>
        <a href="/hubs/">Content Hubs</a>
        <a href="/start-here/">Start Here</a>
        <a href="/about/">About</a>
        <a href="/tags/">Tags</a>
        <a href="https://github.com/dswann101164" target="_blank" rel="noopener">GitHub</a>
        <a href="/search/">Search</a>
      </nav>
    </div>
  </header>

  <main class="site-content">
    <div class="wrap">
      


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "headline": "Terraform Modules for Azure: From Local to Published (4 Steps That Actually Work)",
  "description": "Stop copy-pasting Terraform code across repos. Build reusable modules, version them properly, and publish to Azure DevOps Artifacts or Terraform Registry.",
  "image": {
    "@type": "ImageObject",
    "url": "https://azure-noob.com/static/images/hero/terraform-modules-azure.png",
    "width": 1200,
    "height": 630
  },
  "author": {
    "@type": "Person",
    "name": "David Swann",
    "url": "https://azure-noob.com/about/",
    "description": "Azure Architect specializing in enterprise cloud infrastructure",
    "jobTitle": "Azure Architect",
    "sameAs": [
      "https://github.com/dswann101164",
      "https://www.linkedin.com/in/intikiswann/"
    ],
    "worksFor": {
      "@type": "Organization",
      "name": "Synovus"
    }
  },
  "publisher": {
    "@type": "Organization",
    "name": "Azure Noob",
    "url": "https://azure-noob.com",
    "logo": {
      "@type": "ImageObject",
      "url": "https://azure-noob.com/static/images/logo.png"
    }
  },
  "datePublished": "2025-12-21T00:00:00+00:00",
  "dateModified": "2025-12-21T00:00:00+00:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://azure-noob.com/blog/terraform-modules-azure-from-local-to-published/"
  },
  "keywords": "terraform, iac, azure-devops, modules, best-practices",
  "articleSection": "terraform",
  "wordCount": "3815",
  "timeRequired": "PT19M",
  "inLanguage": "en-US",
  "isAccessibleForFree": "True",
  "proficiencyLevel": "Intermediate",
  
  "about": {
    "@type": "Thing",
    "name": "terraform"
  }
}
</script>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://azure-noob.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": "https://azure-noob.com/blog/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Terraform Modules for Azure: From Local to Published (4 Steps That Actually Work)",
      "item": "https://azure-noob.com/blog/terraform-modules-azure-from-local-to-published/"
    }
  ]
}
</script>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "speakable": {
    "@type": "SpeakableSpecification",
    "cssSelector": [".summary", ".post-header h1", ".post-body h2", ".post-body p:first-of-type"]
  },
  "url": "https://azure-noob.com/blog/terraform-modules-azure-from-local-to-published/"
}
</script>










<article class="post">

  
  
    
    <div class="hero">
      <img src="/static/images/hero/terraform-modules-azure.png" alt="Terraform Modules for Azure: From Local to Published (4 Steps That Actually Work)" loading="eager">
    </div>
  

  <header class="post-header">
    <h1>Terraform Modules for Azure: From Local to Published (4 Steps That Actually Work)</h1>
    <p class="muted">
      2025-12-21 ¬∑ ~19 min read
      
    </p>
    
    
    <ul class="tags-list">
      
      <li><a href="/tags/terraform/" class="tag-badge">terraform</a></li>
      
      <li><a href="/tags/iac/" class="tag-badge">iac</a></li>
      
      <li><a href="/tags/azure-devops/" class="tag-badge">azure-devops</a></li>
      
      <li><a href="/tags/modules/" class="tag-badge">modules</a></li>
      
      <li><a href="/tags/best-practices/" class="tag-badge">best-practices</a></li>
      
    </ul>
    
    
    
      <p class="summary">Stop copy-pasting Terraform code across repos. Build reusable modules, version them properly, and publish to Azure DevOps Artifacts or Terraform Registry.</p>
    
  </header>

  
  <p class="post-actions" style="margin:.5rem 0 0; text-align: center;">
    <button class="btn"
            onclick="window.print(); return false;"
            title="Print this page"
            aria-label="Print this page"
            style="cursor: pointer; background: none; border: 2px solid var(--azure-blue);">
      üñ®Ô∏è Print this page
    </button>
  </p>

  
  <div class="post-body">
    <p><strong>Short Answer:</strong> Terraform modules let you package reusable infrastructure as code that multiple teams can consume without copy-pasting. Build a local module first, test it in isolation, version it with semantic versioning, then publish to Azure DevOps Artifacts or Terraform Registry. Most teams skip versioning and testing, creating unmaintainable module sprawl across 47 repos.</p>
<p>This guide is part of our <a href="/hub/terraform/">Terraform for Azure hub</a> covering enterprise CI/CD, remote state management, and production IaC patterns.</p>
<p>I've watched teams copy-paste the same Azure resource definitions into 23 different Terraform repos. Then one person discovers a security issue with how they configured NSG rules. Now you need to fix it in 23 places.</p>
<p>Or you build a Terraform module. Fix it once. Everyone gets the update.</p>
<p>Here's how to build modules that teams actually use instead of routing around.</p>
<hr />
<h2 id="why-use-terraform-modules">Why Use Terraform Modules?</h2>
<p><strong>Modules solve three problems:</strong></p>
<ol>
<li><strong>Reduce repetition</strong> ‚Äî Write resource configuration once, use it everywhere</li>
<li><strong>Enforce standards</strong> ‚Äî Team can't deploy non-compliant resources if the module won't allow it</li>
<li><strong>Enable self-service</strong> ‚Äî Developers provision infrastructure without knowing Terraform internals</li>
</ol>
<p><strong>When NOT to use modules:</strong></p>
<ul>
<li><strong>Unique, one-off resources</strong> ‚Äî If you're only deploying it once, just write the Terraform directly</li>
<li><strong>Rapidly changing requirements</strong> ‚Äî Modules add abstraction. During prototyping, abstraction slows you down</li>
<li><strong>Learning Terraform</strong> ‚Äî Learn the resources first, then abstract into modules</li>
</ul>
<p><strong>Real example:</strong> We built a module for Azure Storage Accounts with encryption, private endpoints, and compliance settings. 14 teams use it. When NIST 800-53 requirements changed, we updated the module once. All 14 teams got compliance by running <code>terraform init -upgrade</code>.</p>
<hr />
<h2 id="step-1-use-existing-modules-first-don-t-build-yet">Step 1: Use Existing Modules First (Don't Build Yet)</h2>
<p><strong>Before you write any code, check if someone already built it:</strong></p>
<h3 id="community-modules">Community Modules</h3>
<p><strong>HashiCorp Verified Modules:</strong><br />
- Browse: https://registry.terraform.io/browse/modules?provider=azurerm<br />
- Quality guarantee: HashiCorp reviews these<br />
- Example: <code>Azure/compute/azurerm</code> for Virtual Machines</p>
<p><strong>Azure Verified Modules (AVM):</strong><br />
- Microsoft's official module collection<br />
- GitHub: https://github.com/Azure/terraform-azurerm-avm<br />
- Follows Azure naming conventions<br />
- Updated when Azure resources change</p>
<p><strong>How to evaluate a module:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check module metadata</span>
terraform<span class="w"> </span>init
terraform<span class="w"> </span>providers

<span class="c1"># Review source on GitHub</span>
<span class="c1"># Look for:</span>
<span class="c1"># - Last updated date (&lt; 6 months = maintained)</span>
<span class="c1"># - Issue count vs. closed issues</span>
<span class="c1"># - Number of contributors (&gt; 1 = not abandoned)</span>
</code></pre></div>

<p><strong>Example: Using a verified module</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;storage_account&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">source</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Azure/storage/azurerm&quot;</span>
<span class="w">  </span><span class="na">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;~&gt; 4.0&quot;</span>

<span class="w">  </span><span class="na">resource_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_resource_group.example.name</span>
<span class="w">  </span><span class="na">location</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_resource_group.example.location</span>
<span class="w">  </span><span class="na">storage_account_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mystorageaccount&quot;</span>

<span class="c1">  # Module handles encryption, networking, compliance</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>When to build your own:</strong></p>
<ul>
<li>Existing modules don't match your compliance requirements</li>
<li>You need custom resource combinations (Storage + Key Vault + Private Endpoint as one unit)</li>
<li>Enterprise standards differ from community patterns (naming, tagging, RBAC)</li>
</ul>
<hr />
<h2 id="step-2-build-a-local-module-test-before-publishing">Step 2: Build a Local Module (Test Before Publishing)</h2>
<p><strong>Modules are just Terraform code in a subdirectory.</strong></p>
<h3 id="module-structure">Module Structure</h3>
<div class="codehilite"><pre><span></span><code><span class="n">terraform</span><span class="o">-</span><span class="n">modules</span><span class="o">/</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">modules</span><span class="o">/</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="n">azure</span><span class="o">-</span><span class="n">storage</span><span class="o">-</span><span class="n">private</span><span class="o">/</span>
<span class="err">‚îÇ</span><span class="w">       </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">main</span><span class="o">.</span><span class="n">tf</span><span class="w">          </span><span class="c1"># Resource definitions</span>
<span class="err">‚îÇ</span><span class="w">       </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">variables</span><span class="o">.</span><span class="n">tf</span><span class="w">     </span><span class="c1"># Input variables</span>
<span class="err">‚îÇ</span><span class="w">       </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">outputs</span><span class="o">.</span><span class="n">tf</span><span class="w">       </span><span class="c1"># Return values</span>
<span class="err">‚îÇ</span><span class="w">       </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">versions</span><span class="o">.</span><span class="n">tf</span><span class="w">      </span><span class="c1"># Provider requirements</span>
<span class="err">‚îÇ</span><span class="w">       </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="n">README</span><span class="o">.</span><span class="n">md</span><span class="w">        </span><span class="c1"># Usage documentation</span>
<span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="n">examples</span><span class="o">/</span>
<span class="w">    </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="n">complete</span><span class="o">/</span>
<span class="w">        </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">main</span><span class="o">.</span><span class="n">tf</span><span class="w">          </span><span class="c1"># Example usage</span>
<span class="w">        </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="n">terraform</span><span class="o">.</span><span class="n">tfvars</span><span class="w"> </span><span class="c1"># Example values</span>
</code></pre></div>

<h3 id="example-azure-storage-account-module">Example: Azure Storage Account Module</h3>
<p><strong>modules/azure-storage-private/variables.tf</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;resource_group_name&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Resource group for storage account&quot;</span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;location&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Azure region&quot;</span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;storage_account_name&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Storage account name (3-24 chars, lowercase, numbers)&quot;</span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>

<span class="w">  </span><span class="nb">validation</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">condition</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nf">can</span><span class="p">(</span><span class="nf">regex</span><span class="p">(</span><span class="s2">&quot;^[a-z0-9]{3,24}$&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">var.storage_account_name</span><span class="p">))</span>
<span class="w">    </span><span class="na">error_message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Storage account name must be 3-24 lowercase letters/numbers&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;private_endpoint_subnet_id&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Subnet ID for private endpoint&quot;</span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;tags&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Resource tags&quot;</span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span>
<span class="w">  </span><span class="nb">default</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>modules/azure-storage-private/main.tf</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nb">terraform</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nb">required_providers</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">azurerm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">source</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;hashicorp/azurerm&quot;</span>
<span class="w">      </span><span class="na">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;~&gt; 3.0&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;azurerm_storage_account&quot;</span><span class="w"> </span><span class="nv">&quot;this&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="nv">var.storage_account_name</span>
<span class="w">  </span><span class="na">resource_group_name</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">var.resource_group_name</span>
<span class="w">  </span><span class="na">location</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="nv">var.location</span>
<span class="w">  </span><span class="na">account_tier</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Standard&quot;</span>
<span class="w">  </span><span class="na">account_replication_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;GRS&quot;</span>

<span class="c1">  # Security defaults</span>
<span class="w">  </span><span class="na">min_tls_version</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;TLS1_2&quot;</span>
<span class="w">  </span><span class="na">allow_nested_items_to_be_public</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
<span class="w">  </span><span class="na">enable_https_traffic_only</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>

<span class="c1">  # Encryption</span>
<span class="w">  </span><span class="na">infrastructure_encryption_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>

<span class="c1">  # Network rules - deny public access</span>
<span class="w">  </span><span class="nb">network_rules</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">default_action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Deny&quot;</span>
<span class="w">    </span><span class="na">bypass</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;AzureServices&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.tags</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;azurerm_private_endpoint&quot;</span><span class="w"> </span><span class="nv">&quot;blob&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.storage_account_name}-blob-pe&quot;</span>
<span class="w">  </span><span class="na">location</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nv">var.location</span>
<span class="w">  </span><span class="na">resource_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.resource_group_name</span>
<span class="w">  </span><span class="na">subnet_id</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="nv">var.private_endpoint_subnet_id</span>

<span class="w">  </span><span class="nb">private_service_connection</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">name</span><span class="w">                           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.storage_account_name}-blob-psc&quot;</span>
<span class="w">    </span><span class="na">private_connection_resource_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_storage_account.this.id</span>
<span class="w">    </span><span class="na">subresource_names</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;blob&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="na">is_manual_connection</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.tags</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>modules/azure-storage-private/outputs.tf</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;storage_account_id&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Storage account resource ID&quot;</span>
<span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_storage_account.this.id</span>
<span class="p">}</span>

<span class="kr">output</span><span class="w"> </span><span class="nv">&quot;storage_account_name&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Storage account name&quot;</span>
<span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_storage_account.this.name</span>
<span class="p">}</span>

<span class="kr">output</span><span class="w"> </span><span class="nv">&quot;primary_blob_endpoint&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Primary blob endpoint&quot;</span>
<span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_storage_account.this.primary_blob_endpoint</span>
<span class="p">}</span>

<span class="kr">output</span><span class="w"> </span><span class="nv">&quot;private_endpoint_ip&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Private endpoint IP address&quot;</span>
<span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_private_endpoint.blob.private_service_connection[0].private_ip_address</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="using-the-local-module">Using the Local Module</h3>
<p><strong>examples/complete/main.tf</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nb">terraform</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nb">required_providers</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">azurerm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">source</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;hashicorp/azurerm&quot;</span>
<span class="w">      </span><span class="na">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;~&gt; 3.0&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kr">provider</span><span class="w"> </span><span class="nv">&quot;azurerm&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nb">features</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;azurerm_resource_group&quot;</span><span class="w"> </span><span class="nv">&quot;example&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;rg-storage-example&quot;</span>
<span class="w">  </span><span class="na">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;East US&quot;</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;azurerm_virtual_network&quot;</span><span class="w"> </span><span class="nv">&quot;example&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;vnet-example&quot;</span>
<span class="w">  </span><span class="na">address_space</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;10.0.0.0/16&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="na">location</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_resource_group.example.location</span>
<span class="w">  </span><span class="na">resource_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_resource_group.example.name</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;azurerm_subnet&quot;</span><span class="w"> </span><span class="nv">&quot;private_endpoints&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;snet-private-endpoints&quot;</span>
<span class="w">  </span><span class="na">resource_group_name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_resource_group.example.name</span>
<span class="w">  </span><span class="na">virtual_network_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_virtual_network.example.name</span>
<span class="w">  </span><span class="na">address_prefixes</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;10.0.1.0/24&quot;</span><span class="p">]</span>
<span class="p">}</span>

<span class="kr">module</span><span class="w"> </span><span class="nv">&quot;storage_private&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;../../modules/azure-storage-private&quot;</span>

<span class="w">  </span><span class="na">storage_account_name</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;stprivateexample001&quot;</span>
<span class="w">  </span><span class="na">resource_group_name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_resource_group.example.name</span>
<span class="w">  </span><span class="na">location</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_resource_group.example.location</span>
<span class="w">  </span><span class="na">private_endpoint_subnet_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_subnet.private_endpoints.id</span>

<span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Production&quot;</span>
<span class="w">    </span><span class="na">ManagedBy</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Terraform&quot;</span>
<span class="w">    </span><span class="na">CostCenter</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Infrastructure&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kr">output</span><span class="w"> </span><span class="nv">&quot;storage_id&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.storage_private.storage_account_id</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Test it:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>examples/complete
terraform<span class="w"> </span>init
terraform<span class="w"> </span>plan
terraform<span class="w"> </span>apply

<span class="c1"># Verify private endpoint works</span>
<span class="c1"># Verify public access is blocked</span>
<span class="c1"># Test from VM in same VNet</span>

terraform<span class="w"> </span>destroy
</code></pre></div>

<hr />
<h2 id="step-3-version-your-module-semantic-versioning">Step 3: Version Your Module (Semantic Versioning)</h2>
<p><strong>Modules without versions create deployment chaos.</strong></p>
<h3 id="why-versioning-matters">Why Versioning Matters</h3>
<p><strong>Without versions:</strong><br />
- Team A: "The storage module broke our deployment"<br />
- Team B: "We updated it last week to fix security issues"<br />
- Team A: "We didn't know. Our production is down."</p>
<p><strong>With versions:</strong><br />
- Team A: Uses <code>version = "1.2.3"</code> (stable)<br />
- Team B: Tests <code>version = "1.3.0"</code> (latest)<br />
- Team A: Upgrades when ready, not when broken</p>
<h3 id="semantic-versioning-rules">Semantic Versioning Rules</h3>
<p><strong>Format: <code>MAJOR.MINOR.PATCH</code> (e.g., <code>2.1.4</code>)</strong></p>
<ul>
<li><strong>MAJOR</strong> (2.0.0) ‚Äî Breaking changes (rename variables, remove outputs, change defaults)</li>
<li><strong>MINOR</strong> (1.1.0) ‚Äî New features, backward compatible (add optional variables)</li>
<li><strong>PATCH</strong> (1.0.1) ‚Äî Bug fixes, no API changes</li>
</ul>
<p><strong>Examples:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Breaking change: renamed variable</span>
<span class="c1"># OLD: private_endpoint_enabled = true</span>
<span class="c1"># NEW: enable_private_endpoint = true</span>
<span class="c1"># Version: 1.x.x ‚Üí 2.0.0</span>

<span class="c1"># New feature: add optional lifecycle rules</span>
<span class="c1"># Version: 1.2.x ‚Üí 1.3.0</span>

<span class="c1"># Bug fix: fixed private endpoint DNS</span>
<span class="c1"># Version: 1.2.3 ‚Üí 1.2.4</span>
</code></pre></div>

<h3 id="tagging-releases-in-git">Tagging Releases in Git</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># After testing module changes</span>
git<span class="w"> </span>add<span class="w"> </span>modules/azure-storage-private/
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;feat: add lifecycle management support&quot;</span>

<span class="c1"># Create version tag</span>
git<span class="w"> </span>tag<span class="w"> </span>-a<span class="w"> </span>v1.3.0<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Add lifecycle management support&quot;</span>
git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>v1.3.0

<span class="c1"># View tags</span>
git<span class="w"> </span>tag<span class="w"> </span>-l
</code></pre></div>

<p><strong>CHANGELOG.md (track changes):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="gh"># Changelog</span>

<span class="gu">## [1.3.0] - 2025-12-21</span>
<span class="gu">### Added</span>
<span class="k">-</span><span class="w"> </span>Lifecycle management rules for blob retention
<span class="k">-</span><span class="w"> </span>Optional variable <span class="sb">`lifecycle_rules`</span> (default: null)

<span class="gu">### Changed</span>
<span class="k">-</span><span class="w"> </span>Updated azurerm provider requirement to ~&gt; 3.85

<span class="gu">## [1.2.4] - 2025-12-15</span>
<span class="gu">### Fixed</span>
<span class="k">-</span><span class="w"> </span>Private endpoint DNS registration now works correctly

<span class="gu">## [1.2.3] - 2025-12-10</span>
<span class="gu">### Security</span>
<span class="k">-</span><span class="w"> </span>Enforce TLS 1.2 minimum (was allowing TLS 1.0)
</code></pre></div>

<hr />
<h2 id="step-4-publish-to-azure-devops-artifacts-or-terraform-registry">Step 4: Publish to Azure DevOps Artifacts or Terraform Registry</h2>
<p><strong>Local modules work for single teams. Published modules work for enterprises.</strong></p>
<h3 id="option-a-azure-devops-artifacts-private-modules">Option A: Azure DevOps Artifacts (Private Modules)</h3>
<p><strong>Best for:</strong><br />
- Enterprise internal modules<br />
- Compliance-restricted code<br />
- Modules with proprietary logic</p>
<p><strong>Setup:</strong></p>
<ol>
<li><strong>Create Azure DevOps Artifacts feed:</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="c1"># In your Azure DevOps project</span>
Artifacts<span class="w"> </span>‚Üí<span class="w"> </span>Create<span class="w"> </span>Feed<span class="w"> </span>‚Üí<span class="w"> </span><span class="s2">&quot;terraform-modules&quot;</span>
<span class="c1"># Permissions: Project Contributors (read), Module Publishers (write)</span>
</code></pre></div>

<ol>
<li><strong>Configure Terraform to use feed:</strong></li>
</ol>
<p><strong>terraform.tfrc (in user home directory):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="err">credentials</span><span class="w"> </span><span class="s2">&quot;pkgs.dev.azure.com&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;YOUR_PAT_TOKEN&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Generate PAT token:</strong><br />
- Azure DevOps ‚Üí User Settings ‚Üí Personal Access Tokens<br />
- Scopes: Packaging (Read &amp; Write)</p>
<ol>
<li><strong>Publish module to feed:</strong></li>
</ol>
<p><strong>Package as .tar.gz:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>modules/azure-storage-private
tar<span class="w"> </span>-czf<span class="w"> </span>azure-storage-private-1.3.0.tar.gz<span class="w"> </span>.
</code></pre></div>

<p><strong>Upload to Artifacts:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Using Azure CLI</span>
az<span class="w"> </span>artifacts<span class="w"> </span>universal<span class="w"> </span>publish<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--organization<span class="w"> </span>https://dev.azure.com/YOUR_ORG<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--project<span class="w"> </span>YOUR_PROJECT<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--feed<span class="w"> </span>terraform-modules<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span>azure-storage-private<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--version<span class="w"> </span><span class="m">1</span>.3.0<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--path<span class="w"> </span>azure-storage-private-1.3.0.tar.gz
</code></pre></div>

<ol>
<li><strong>Consume from Artifacts:</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;storage&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">source</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;pkgs.dev.azure.com/YOUR_ORG/YOUR_PROJECT/_packaging/terraform-modules/generic/azure-storage-private/1.3.0&quot;</span>

<span class="c1">  # ... variables</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="option-b-terraform-registry-public-modules">Option B: Terraform Registry (Public Modules)</h3>
<p><strong>Best for:</strong><br />
- Open source modules<br />
- Community contributions<br />
- Building reputation</p>
<p><strong>Requirements:</strong><br />
- Public GitHub repository<br />
- Named: <code>terraform-azurerm-MODULENAME</code><br />
- Git tags for versions</p>
<p><strong>Setup:</strong></p>
<ol>
<li><strong>Create GitHub repo:</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="c1"># Repo name: terraform-azurerm-storage-private</span>
<span class="c1"># Description: &quot;Azure Storage Account with Private Endpoint&quot;</span>
<span class="c1"># License: Apache 2.0 or MIT</span>
</code></pre></div>

<ol>
<li><strong>Structure for Terraform Registry:</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="n">terraform</span><span class="o">-</span><span class="n">azurerm</span><span class="o">-</span><span class="n">storage</span><span class="o">-</span><span class="n">private</span><span class="o">/</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">main</span><span class="o">.</span><span class="n">tf</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">variables</span><span class="o">.</span><span class="n">tf</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">outputs</span><span class="o">.</span><span class="n">tf</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">versions</span><span class="o">.</span><span class="n">tf</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">README</span><span class="o">.</span><span class="n">md</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">CHANGELOG</span><span class="o">.</span><span class="n">md</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">LICENSE</span>
<span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="n">examples</span><span class="o">/</span>
<span class="w">    </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="n">complete</span><span class="o">/</span>
<span class="w">        </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">main</span><span class="o">.</span><span class="n">tf</span>
<span class="w">        </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="n">README</span><span class="o">.</span><span class="n">md</span>
</code></pre></div>

<ol>
<li>
<p><strong>Publish to Registry:</strong></p>
</li>
<li>
<p>Go to: https://registry.terraform.io/github/create</p>
</li>
<li>Sign in with GitHub</li>
<li>Select your repository</li>
<li>
<p>Registry auto-detects Git tags as versions</p>
</li>
<li>
<p><strong>Consume from Registry:</strong></p>
</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;storage&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">source</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;YOUR_GITHUB_USERNAME/storage-private/azurerm&quot;</span>
<span class="w">  </span><span class="na">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;~&gt; 1.3&quot;</span>

<span class="c1">  # ... variables</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Registry publishing checklist:</strong></p>
<ul>
<li>‚úÖ README with usage examples</li>
<li>‚úÖ Input variables documented</li>
<li>‚úÖ Outputs documented</li>
<li>‚úÖ Git tag with version (v1.0.0)</li>
<li>‚úÖ LICENSE file</li>
<li>‚úÖ Working examples/ directory</li>
</ul>
<hr />
<h2 id="what-breaks-at-enterprise-scale">What Breaks at Enterprise Scale</h2>
<h3 id="problem-1-module-sprawl">Problem 1: Module Sprawl</h3>
<p><strong>Symptom:</strong> 47 different storage account modules across repos.</p>
<p><strong>Cause:</strong> Each team builds their own because discovery is hard.</p>
<p><strong>Fix:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="gh"># Create central module catalog</span>
<span class="gh"># Confluence page or internal docs site</span>

<span class="gu">## Available Terraform Modules</span>

<span class="gu">### azure-storage-private</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Source:**</span> pkgs.dev.azure.com/.../azure-storage-private
<span class="k">-</span><span class="w"> </span><span class="gs">**Latest:**</span> 1.3.0
<span class="k">-</span><span class="w"> </span><span class="gs">**Owner:**</span> Infrastructure Team
<span class="k">-</span><span class="w"> </span><span class="gs">**Docs:**</span> [Link to README]

<span class="gu">### azure-vm-windows</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Source:**</span> pkgs.dev.azure.com/.../azure-vm-windows  
<span class="k">-</span><span class="w"> </span><span class="gs">**Latest:**</span> 2.1.0
<span class="k">-</span><span class="w"> </span><span class="gs">**Owner:**</span> Platform Team
</code></pre></div>

<h3 id="problem-2-breaking-changes-without-warning">Problem 2: Breaking Changes Without Warning</h3>
<p><strong>Symptom:</strong> <code>terraform apply</code> fails in production after module update.</p>
<p><strong>Cause:</strong> Didn't use version constraints.</p>
<p><strong>Fix:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># BAD: No version constraint (always gets latest)</span>
<span class="kr">module</span><span class="w"> </span><span class="nv">&quot;storage&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;pkgs.dev.azure.com/.../azure-storage-private&quot;</span>
<span class="p">}</span>

<span class="c1"># GOOD: Pessimistic constraint (allows patches, not breaking changes)</span>
<span class="kr">module</span><span class="w"> </span><span class="nv">&quot;storage&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">source</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;pkgs.dev.azure.com/.../azure-storage-private&quot;</span>
<span class="w">  </span><span class="na">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;~&gt; 1.3.0&quot;</span><span class="c1">  # Allows 1.3.x, blocks 1.4.0 and 2.0.0</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="problem-3-modules-don-t-get-updated">Problem 3: Modules Don't Get Updated</h3>
<p><strong>Symptom:</strong> Module has security patch, but teams still use v1.0.0.</p>
<p><strong>Cause:</strong> No automated dependency scanning.</p>
<p><strong>Fix:</strong></p>
<p><strong>Add Dependabot (GitHub):</strong></p>
<p><strong>.github/dependabot.yml</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="nt">updates</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">package-ecosystem</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;terraform&quot;</span>
<span class="w">    </span><span class="nt">directory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/&quot;</span>
<span class="w">    </span><span class="nt">schedule</span><span class="p">:</span>
<span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;weekly&quot;</span>
<span class="w">    </span><span class="nt">commit-message</span><span class="p">:</span>
<span class="w">      </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;terraform&quot;</span>
</code></pre></div>

<p><strong>Or manual audit:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Find all module versions in use</span>
grep<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;source.*azure-storage-private&quot;</span><span class="w"> </span>.<span class="w"> </span>--include<span class="o">=</span><span class="s2">&quot;*.tf&quot;</span><span class="w"> </span>-A<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>version

<span class="c1"># Output:</span>
<span class="c1"># version = &quot;1.2.3&quot;  # Team A</span>
<span class="c1"># version = &quot;1.3.0&quot;  # Team B</span>
<span class="c1"># (no version)       # Team C ‚Üê Problem!</span>
</code></pre></div>

<h3 id="problem-4-module-testing-doesn-t-exist">Problem 4: Module Testing Doesn't Exist</h3>
<p><strong>Symptom:</strong> Module works in dev, fails in prod.</p>
<p><strong>Cause:</strong> Never tested with production-like config (multiple subnets, existing resources, etc.)</p>
<p><strong>Fix:</strong></p>
<p><strong>Add Terratest (Go-based testing):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// test/storage_test.go</span>
<span class="kn">package</span><span class="w"> </span><span class="nx">test</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;testing&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/gruntwork-io/terratest/modules/terraform&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">TestStorageModule</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">terraformOptions</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">terraform</span><span class="p">.</span><span class="nx">Options</span><span class="p">{</span>
<span class="w">        </span><span class="nx">TerraformDir</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;../examples/complete&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">Destroy</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">terraformOptions</span><span class="p">)</span>
<span class="w">    </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">InitAndApply</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">terraformOptions</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Assertions</span>
<span class="w">    </span><span class="nx">storageID</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">Output</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">terraformOptions</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;storage_id&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">assert</span><span class="p">.</span><span class="nx">NotEmpty</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">storageID</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Or use Azure Policy validation:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># After apply, validate compliance</span>
az<span class="w"> </span>policy<span class="w"> </span>state<span class="w"> </span>list<span class="w"> </span>--resource-group<span class="w"> </span>rg-storage-example<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--query<span class="w"> </span><span class="s2">&quot;[?complianceState==&#39;NonCompliant&#39;]&quot;</span>

<span class="c1"># Should return empty if module enforces compliance correctly</span>
</code></pre></div>

<hr />
<h2 id="production-checklist">Production Checklist</h2>
<p>Before publishing a module to your team:</p>
<ul>
<li>‚úÖ <strong>Tested in isolation</strong> (examples/complete works)</li>
<li>‚úÖ <strong>Versioned</strong> (Git tag, CHANGELOG.md updated)</li>
<li>‚úÖ <strong>Documented</strong> (README with inputs, outputs, examples)</li>
<li>‚úÖ <strong>Validated</strong> (runs <code>terraform validate</code>, <code>terraform fmt -check</code>)</li>
<li>‚úÖ <strong>Security reviewed</strong> (no hardcoded secrets, follows least privilege)</li>
<li>‚úÖ <strong>Published</strong> (Azure DevOps Artifacts or Terraform Registry)</li>
<li>‚úÖ <strong>Cataloged</strong> (team knows it exists and how to use it)</li>
</ul>
<hr />
<h2 id="what-to-do-next">What to Do Next</h2>
<p><strong>If you're new to modules:</strong></p>
<ol>
<li>Pick one resource type you deploy repeatedly (Storage, VMs, App Services)</li>
<li>Build a local module following Step 2</li>
<li>Test with <code>examples/complete</code></li>
<li>Use it in one project for 2 weeks</li>
<li>If it works, version and publish</li>
</ol>
<p><strong>If you already have modules:</strong></p>
<ol>
<li>Audit: <code>find . -name "*.tf" -exec grep -l "module \"" {} \;</code></li>
<li>Identify unversioned modules (grep for source without version)</li>
<li>Add versions: <code>version = "~&gt; 1.0"</code></li>
<li>Create central module catalog (Confluence, internal docs)</li>
</ol>
<p><strong>If you have 10+ modules:</strong></p>
<ol>
<li>Consolidate: Merge duplicate modules</li>
<li>Deprecate: Mark old modules as deprecated, provide migration path</li>
<li>Automate: Add Dependabot or similar for version tracking</li>
<li>Test: Add Terratest or Azure Policy validation</li>
</ol>
<hr />
<h2 id="common-questions">Common Questions</h2>
<p><strong>Q: Should every Terraform resource be in a module?</strong></p>
<p>No. Modules add abstraction. Use them when:<br />
- You deploy the same pattern 3+ times<br />
- Compliance requires specific configuration<br />
- Teams need self-service without Terraform expertise</p>
<p><strong>Q: How do I handle breaking changes?</strong></p>
<p>Increment major version (1.x ‚Üí 2.0). Provide migration guide in CHANGELOG.md. Keep old version available for 6-12 months.</p>
<p><strong>Q: Azure DevOps Artifacts vs. Terraform Registry?</strong></p>
<ul>
<li><strong>Artifacts:</strong> Private modules, enterprise compliance, works behind firewall</li>
<li><strong>Registry:</strong> Public modules, community contributions, free hosting</li>
</ul>
<p>Use both: Private modules in Artifacts, public examples in Registry.</p>
<p><strong>Q: How do I test modules locally without publishing?</strong></p>
<p>Use relative paths:</p>
<div class="codehilite"><pre><span></span><code><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;storage&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;../../modules/azure-storage-private&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p>Once tested, switch to versioned source.</p>
<p><strong>Q: What if the module doesn't support our use case?</strong></p>
<p>Add optional variable with default behavior:</p>
<div class="codehilite"><pre><span></span><code><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;enable_lifecycle_rules&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Enable lifecycle management&quot;</span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">bool</span>
<span class="w">  </span><span class="na">default</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="c1">  # Doesn&#39;t break existing usage</span>
<span class="p">}</span>
</code></pre></div>

<p>Increment minor version (1.2.x ‚Üí 1.3.0).</p>
<hr />
<h2 id="tools-that-help">Tools That Help</h2>
<p><strong>Module Development:</strong><br />
- <strong>Terraform Docs:</strong> Auto-generate README from variables/outputs<br />
- <strong>TFLint:</strong> Catch errors before running apply<br />
- <strong>Checkov:</strong> Security scanning for IaC</p>
<p><strong>Module Testing:</strong><br />
- <strong>Terratest:</strong> Go-based testing framework<br />
- <strong>Kitchen-Terraform:</strong> Test Kitchen for Terraform<br />
- <strong>Azure Policy:</strong> Validate deployed resources meet compliance</p>
<p><strong>Module Publishing:</strong><br />
- <strong>Azure DevOps Artifacts:</strong> Private module registry<br />
- <strong>Terraform Registry:</strong> Public module hosting<br />
- <strong>GitHub Actions:</strong> Automate testing and publishing</p>
<hr />
<h2 id="the-bottom-line">The Bottom Line</h2>
<p><strong>Terraform modules are force multipliers.</strong></p>
<p>Build one storage account module. 20 teams use it. Fix one security issue. All 20 teams get the fix.</p>
<p>Don't build modules too early (wait until you have repetition).</p>
<p>Don't publish modules without testing (examples/complete must work).</p>
<p>Don't skip versioning (version = "~&gt; 1.0" saves you from breaking changes).</p>
<p>Version your modules. Test your modules. Publish your modules. Then teams stop copy-pasting your Terraform code into 47 repos.</p>
<hr />
<p><strong>Related Terraform Content:</strong></p>
<ul>
<li><a href="/hub/terraform/">Terraform CI/CD Complete Series</a> ‚Äî Build Azure DevOps pipelines for Terraform deployments</li>
<li><a href="/blog/terraform-remote-state-azure/">Terraform Remote State with Azure</a> ‚Äî Configure backend storage for state files</li>
<li><a href="/blog/azure-ai-foundry-terraform/">Azure AI Foundry with Terraform</a> ‚Äî Advanced module example for AI infrastructure</li>
</ul>
  </div>

  
  <section class="starter-kit-callout" style="
    max-width: 800px;
    margin: 3rem auto 2rem;
    padding: 2rem;
    border-radius: 12px;
    background: var(--bg-light);
    border: 1px solid var(--border);
    text-align: left;
  ">
    <h3 style="margin-top: 0;">Azure Admin Starter Kit (Free Download)</h3>
    <p style="margin-bottom: 1rem;">
      Get my KQL cheat sheet, 50 Windows + 50 Linux commands, and an Azure RACI template in one free bundle.
    </p>
    <a href="/blog/starter-kit/" class="btn">Get the Starter Kit ‚Üí</a>
  </section>



  
  
  <aside class="related-posts" style="max-width: 800px; margin: 3rem auto; padding: 2rem; background: var(--bg-light); border-radius: 12px;">
    <h3 style="margin-top: 0;">Related Posts</h3>
    <ul style="list-style: none; padding: 0;">
      
      <li style="margin: 1rem 0;">
        <a href="/blog/terraform-azure-devops-cicd-part5-production-best-practices/" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">Terraform + Azure DevOps CI/CD: Part 5 - Production Best Practices &amp; Multi-Environment Setup</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-11-07</span>
        </a>
      </li>
      
      <li style="margin: 1rem 0;">
        <a href="/blog/terraform-azure-devops-cicd-part4-branch-policies/" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">Terraform + Azure DevOps CI/CD: Part 4 - Branch Policies &amp; Pull Request Automation</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-11-06</span>
        </a>
      </li>
      
      <li style="margin: 1rem 0;">
        <a href="/blog/terraform-azure-devops-cicd-part3-release-pipeline/" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">Terraform + Azure DevOps CI/CD: Part 3 - Release Pipeline &amp; Approval Gates</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-11-05</span>
        </a>
      </li>
      
    </ul>
  </aside>
  

  
  
  
    <!-- CTA: Azure Admin Starter Kit (Free Download) -->
<div class="cta-block" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: 2rem; border-radius: 8px; margin: 3rem 0; text-align: center; color: white;">
  <h3 style="margin: 0 0 1rem; font-size: 1.75rem; color: white;">üöÄ Azure Admin Starter Kit</h3>
  <p style="margin: 0 0 1.5rem; font-size: 1.1rem; line-height: 1.6;">
    Get the <strong>KQL cheat sheet, 50 Windows + 50 Linux commands, and Azure RACI template</strong> in one free bundle.
    Built from managing 44 subscriptions and 31,000+ resources.
  </p>
  <a href="/blog/starter-kit/" 
     style="display: inline-block; padding: 0.75rem 2rem; background: white; color: #4facfe; text-decoration: none; border-radius: 6px; font-weight: 700; font-size: 1.1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transition: all 0.3s ease;"
     onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,0,0,0.2)'"
     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'">
    Get the Starter Kit ‚Üí
  </a>
  <p style="margin: 1rem 0 0; font-size: 0.9rem; opacity: 0.9;">
    Free download ‚Ä¢ No email required ‚Ä¢ Instant access
  </p>
</div>
  

  
  <nav class="post-nav">
    
      <a href="/blog/what-caf-wont-tell-you-azure-subscriptions-arc/">
        <span style="opacity: 0.7; font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">‚Üê Previous</span>
        <strong>What the CAF Won&#39;t Tell You About Azure Subscriptions (And Why Azure Arc Makes It Worse)</strong>
      </a>
    
    
      <a href="/blog/azure-chargeback-architecture-reality/" style="text-align: right;">
        <span style="opacity: 0.7; font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">Next ‚Üí</span>
        <strong>Azure Chargeback Architecture: The Two Models That Actually Work</strong>
      </a>
    
  </nav>

</article>

    </div>
  </main>

  <footer class="site-footer">
    <div class="wrap">
      <p>&copy; 2026 Azure Noob ‚Äî Don&#39;t be a Noob</p>
      <p style="margin-top: 0.5rem; font-size: 0.9rem;">
        <a href="/rss.xml" title="Subscribe via RSS">RSS Feed</a> ¬∑ 
        <a href="https://github.com/dswann101164" target="_blank" rel="noopener">GitHub</a>
      </p>
      <p style="margin-top: 1.5rem; font-size: 0.85rem; opacity: 0.7; font-style: italic;">
        "Trust in the Lord with all your heart, and lean not on your own understanding;<br>
        in all your ways acknowledge Him, and He will make your paths straight" ‚Äî Proverbs 3:5-6
      </p>
    </div>
  </footer>

  <!-- Copy code functionality -->
  <script src="/static/copy-code.js"></script>


</body>
</html>