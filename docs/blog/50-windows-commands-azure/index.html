<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  
  

  <!-- Primary SEO -->
  <title>50 Windows Commands for Azure VMs (PowerShell + Active Directory) ¬∑ Azure Noob</title>
  <meta name="description" content="The essential Windows commands every Azure administrator needs‚Äîfrom PowerShell basics to Active Directory domain join and Group Policy troubleshooting in...">
  
  <link rel="canonical" href="https://azure-noob.com/blog/50-windows-commands-azure/" />

  <!-- Favicons -->
  <link rel="icon" href="/static/images/logo.png">

  <!-- Open Graph -->
  <meta property="og:title" content="50 Windows Commands for Azure VMs (PowerShell + Active Directory)">
  <meta property="og:description" content="The essential Windows commands every Azure administrator needs‚Äîfrom PowerShell basics to Active Directory domain join and Group Policy troubleshooting in...">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://azure-noob.com/blog/50-windows-commands-azure/">
  <meta property="og:image" content="https://azure-noob.com/static/images/hero/windows-commands-azure.png">

  
    <meta property="article:published_time" content="2025-12-08T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-12-08T00:00:00+00:00">
    <meta property="article:author" content="David Swann">
    
      
        <meta property="article:tag" content="azure">
      
        <meta property="article:tag" content="windows">
      
        <meta property="article:tag" content="powershell">
      
        <meta property="article:tag" content="active-directory">
      
        <meta property="article:tag" content="group-policy">
      
        <meta property="article:tag" content="troubleshooting">
      
    
  

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="50 Windows Commands for Azure VMs (PowerShell + Active Directory)">
  <meta name="twitter:description" content="The essential Windows commands every Azure administrator needs‚Äîfrom PowerShell basics to Active Directory domain join and Group Policy troubleshooting in...">
  <meta name="twitter:image" content="https://azure-noob.com/static/images/hero/windows-commands-azure.png">

  <!-- Organization Schema for GEO/AEO entity recognition -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Azure Noob",
    "url": "https://azure-noob.com",
    "logo": "https://azure-noob.com/static/images/logo.png",
    "description": "Practical Azure cloud tutorials and guides from managing 31,000+ resources across 44 subscriptions in regulated enterprise environments.",
    "founder": {
      "@type": "Person",
      "name": "David Swann",
      "jobTitle": "Azure Architect",
      "sameAs": [
        "https://github.com/dswann101164",
        "https://www.linkedin.com/in/intikiswann/"
      ]
    },
    "sameAs": [
      "https://github.com/dswann101164"
    ]
  }
  </script>

  <!-- Styles -->
  <link rel="stylesheet" href="/static/styles.css">

  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="Azure Noob RSS Feed" href="https://azure-noob.com/rss.xml">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZNHGEB0BNZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-ZNHGEB0BNZ');
  </script>
</head>
<body>
  <header class="site-header">
    <div class="wrap nav-wrap">
      <div class="brand-block">
        <a href="/" class="brand-link">
          <img src="/static/images/logo.png" alt="Azure Noob logo" class="logo">
        </a>
        <span class="brand-text">
          <small>Official Website of</small>
          <strong>Azure Noob</strong>
        </span>
      </div>
      <nav class="nav">
        <a href="/">Home</a>
        <a href="/blog/">Blog</a>
        <a href="/hubs/" style="font-weight: 700;">Content Hubs</a>
        <a href="/products/" style="font-weight: 700; color: #ff6b6b;">Products</a>
        <a href="/start-here/">Start Here</a>
        <a href="/blog/starter-kit/">Starter Kit</a>
        <a href="/about/">About</a>
        <a href="/tags/">Tags</a>
        <a href="https://github.com/dswann101164" target="_blank" rel="noopener">GitHub</a>
        <a href="/search/">Search</a>
      </nav>
    </div>
  </header>

  <main class="site-content">
    <div class="wrap">
      


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "headline": "50 Windows Commands for Azure VMs (PowerShell + Active Directory)",
  "description": "The essential Windows commands every Azure administrator needs‚Äîfrom PowerShell basics to Active Directory domain join and Group Policy troubleshooting in...",
  "image": {
    "@type": "ImageObject",
    "url": "https://azure-noob.com/static/images/hero/windows-commands-azure.png",
    "width": 1200,
    "height": 630
  },
  "author": {
    "@type": "Person",
    "name": "David Swann",
    "url": "https://azure-noob.com/about/",
    "description": "Azure Architect specializing in enterprise cloud infrastructure",
    "jobTitle": "Azure Architect",
    "sameAs": [
      "https://github.com/dswann101164",
      "https://www.linkedin.com/in/intikiswann/"
    ],
    "worksFor": {
      "@type": "Organization",
      "name": "Synovus"
    }
  },
  "publisher": {
    "@type": "Organization",
    "name": "Azure Noob",
    "url": "https://azure-noob.com",
    "logo": {
      "@type": "ImageObject",
      "url": "https://azure-noob.com/static/images/logo.png"
    }
  },
  "datePublished": "2025-12-08T00:00:00+00:00",
  "dateModified": "2025-12-08T00:00:00+00:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://azure-noob.com/blog/50-windows-commands-azure/"
  },
  "keywords": "azure, windows, powershell, active-directory, group-policy, troubleshooting",
  "articleSection": "azure",
  "wordCount": "6623",
  "timeRequired": "PT33M",
  "inLanguage": "en-US",
  "isAccessibleForFree": "True",
  "proficiencyLevel": "Intermediate",
  
  "about": {
    "@type": "Thing",
    "name": "azure"
  }
}
</script>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://azure-noob.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": "https://azure-noob.com/blog/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "50 Windows Commands for Azure VMs (PowerShell + Active Directory)",
      "item": "https://azure-noob.com/blog/50-windows-commands-azure/"
    }
  ]
}
</script>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "speakable": {
    "@type": "SpeakableSpecification",
    "cssSelector": [".summary", ".post-header h1", ".post-body h2", ".post-body p:first-of-type"]
  },
  "url": "https://azure-noob.com/blog/50-windows-commands-azure/"
}
</script>










<article class="post">

  
  
    
    <div class="hero">
      <img src="/static/images/hero/windows-commands-azure.png" alt="50 Windows Commands for Azure VMs (PowerShell + Active Directory)" loading="eager">
    </div>
  

  <header class="post-header">
    <h1>50 Windows Commands for Azure VMs (PowerShell + Active Directory)</h1>
    <p class="muted">
      2025-12-08 ¬∑ ~33 min read
      
    </p>
    
    
    <ul class="tags-list">
      
      <li><a href="/tags/azure/" class="tag-badge">azure</a></li>
      
      <li><a href="/tags/windows/" class="tag-badge">windows</a></li>
      
      <li><a href="/tags/powershell/" class="tag-badge">powershell</a></li>
      
      <li><a href="/tags/active-directory/" class="tag-badge">active-directory</a></li>
      
      <li><a href="/tags/group-policy/" class="tag-badge">group-policy</a></li>
      
      <li><a href="/tags/troubleshooting/" class="tag-badge">troubleshooting</a></li>
      
    </ul>
    
    
    
      <p class="summary">The essential Windows commands every Azure administrator needs‚Äîfrom PowerShell basics to Active Directory domain join and Group Policy troubleshooting in enterprise environments.</p>
    
  </header>

  
  <p class="post-actions" style="margin:.5rem 0 0; text-align: center;">
    <button class="btn"
            onclick="window.print(); return false;"
            title="Print this page"
            aria-label="Print this page"
            style="cursor: pointer; background: none; border: 2px solid var(--azure-blue);">
      üñ®Ô∏è Print this page
    </button>
  </p>

  
  <div class="post-body">
    <p>Whether you deploy Azure Windows VMs through the Portal, PowerShell, ARM templates, or Terraform‚Äîeventually you'll RDP in to troubleshoot something. The deployment succeeded, the Portal shows healthy, but users can't authenticate with domain credentials, Group Policy won't apply, or the domain trust is broken.</p>
<p>This guide is part of our <a href="/hub/ai/">AI-Assisted Azure Operations hub</a> exploring how AI tools transform cloud administration and productivity workflows.</p>
<p>This is when you need actual Windows commands.</p>
<p>This guide covers the 50 PowerShell and CMD commands that bridge the gap between successful deployment and operational readiness. These are the commands I use daily managing Windows Server infrastructure in a regulated banking environment.</p>
<h2 id="who-this-is-for">Who This is For</h2>
<ul>
<li>Azure administrators managing Windows Server VMs</li>
<li>Enterprise environments with Active Directory requirements</li>
<li>Anyone troubleshooting Group Policy, domain trust, or authentication issues</li>
<li>Operations teams bridging traditional infrastructure and Azure</li>
</ul>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#azure-basics">Azure-Specific Basics</a></li>
<li><a href="#system-admin">System Administration</a></li>
<li><a href="#active-directory">Active Directory &amp; Domain Join</a></li>
<li><a href="#group-policy">Group Policy Troubleshooting</a></li>
<li><a href="#networking">Networking</a></li>
<li><a href="#disk-operations">Disk Operations</a></li>
<li><a href="#security-logs">Security &amp; Event Logs</a></li>
<li><a href="#azure-powershell">Azure PowerShell</a></li>
<li><a href="#serial-console">Serial Console (SAC)</a></li>
<li><a href="#quick-reference">Quick Reference</a></li>
</ol>
<hr />
<h2 id="part-1-azure-specific-basics"><a name="azure-basics"></a>Part 1: Azure-Specific Basics</h2>
<h3 id="azure-vm-agent-windows">Azure VM Agent (Windows)</h3>
<p>The Azure VM Agent enables extensions, monitoring, and automation. When Custom Script Extensions fail or Azure Automation won't work, start here:</p>
<div class="codehilite"><pre><span></span><code><span class="c"># Check VM Agent service status</span>
<span class="nb">Get-Service</span> <span class="n">WindowsAzureGuestAgent</span>

<span class="c"># View VM Agent logs</span>
<span class="nb">Get-Content</span> <span class="s2">&quot;C:\WindowsAzure\Logs\WaAppAgent.log&quot;</span> <span class="n">-Tail</span> <span class="n">50</span>

<span class="c"># Check which extensions are installed</span>
<span class="nb">Get-ChildItem</span> <span class="s2">&quot;C:\Packages\Plugins&quot;</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">Name</span><span class="p">,</span> <span class="n">LastWriteTime</span>

<span class="c"># View specific extension status</span>
<span class="nb">Get-ChildItem</span> <span class="s2">&quot;C:\Packages\Plugins\Microsoft.Compute.CustomScriptExtension&quot;</span>

<span class="c"># Check extension logs</span>
<span class="nb">Get-Content</span> <span class="s2">&quot;C:\WindowsAzure\Logs\Plugins\Microsoft.Compute.CustomScriptExtension\*\CommandExecution.log&quot;</span>
</code></pre></div>

<p><strong>Common issue:</strong> "Custom Script Extension shows succeeded in Portal but script didn't actually run."</p>
<p>Check the actual execution logs:</p>
<div class="codehilite"><pre><span></span><code><span class="c"># View extension execution output</span>
<span class="nb">Get-Content</span> <span class="s2">&quot;C:\Packages\Plugins\Microsoft.Compute.CustomScriptExtension\*\Status\*.status&quot;</span> <span class="p">|</span> <span class="nb">ConvertFrom-Json</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">-ExpandProperty</span> <span class="n">status</span>

<span class="c"># Check for errors</span>
<span class="nb">Get-Content</span> <span class="s2">&quot;C:\Packages\Plugins\Microsoft.Compute.CustomScriptExtension\*\RuntimeSettings\*.settings&quot;</span> <span class="p">|</span> <span class="nb">ConvertFrom-Json</span>
</code></pre></div>

<h3 id="azure-instance-metadata-service-imds">Azure Instance Metadata Service (IMDS)</h3>
<p>Query VM metadata and managed identity tokens:</p>
<div class="codehilite"><pre><span></span><code><span class="c"># Get VM metadata</span>
<span class="nv">$metadata</span> <span class="p">=</span> <span class="nb">Invoke-RestMethod</span> <span class="n">-Headers</span> <span class="p">@{</span><span class="s2">&quot;Metadata&quot;</span><span class="p">=</span><span class="s2">&quot;true&quot;</span><span class="p">}</span> <span class="n">-Uri</span> <span class="s2">&quot;http://169.254.169.254/metadata/instance?api-version=2021-02-01&quot;</span>
<span class="nv">$metadata</span> <span class="p">|</span> <span class="nb">ConvertTo-Json</span> <span class="n">-Depth</span> <span class="n">10</span>

<span class="c"># Get specific values</span>
<span class="nv">$metadata</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">vmId</span>
<span class="nv">$metadata</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">location</span>
<span class="nv">$metadata</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">resourceGroupName</span>

<span class="c"># Get managed identity token</span>
<span class="nv">$token</span> <span class="p">=</span> <span class="nb">Invoke-RestMethod</span> <span class="n">-Headers</span> <span class="p">@{</span><span class="s2">&quot;Metadata&quot;</span><span class="p">=</span><span class="s2">&quot;true&quot;</span><span class="p">}</span> <span class="n">-Uri</span> <span class="s2">&quot;http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01&amp;resource=https://management.azure.com/&quot;</span>
<span class="nv">$token</span><span class="p">.</span><span class="n">access_token</span>

<span class="c"># Check if VM has managed identity</span>
<span class="nv">$metadata</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">identity</span>
</code></pre></div>

<h3 id="run-command-execution-status">Run Command Execution Status</h3>
<p>When you deploy scripts via Azure Run Command:</p>
<div class="codehilite"><pre><span></span><code><span class="c"># List all Run Commands on this VM (requires Az PowerShell module)</span>
<span class="nb">Get-AzVMRunCommand</span> <span class="n">-ResourceGroupName</span> <span class="s2">&quot;myRG&quot;</span> <span class="n">-VMName</span> <span class="s2">&quot;myVM&quot;</span>

<span class="c"># View Run Command output</span>
<span class="nb">Get-AzVMRunCommand</span> <span class="n">-ResourceGroupName</span> <span class="s2">&quot;myRG&quot;</span> <span class="n">-VMName</span> <span class="s2">&quot;myVM&quot;</span> <span class="n">-RunCommandName</span> <span class="s2">&quot;myCommand&quot;</span> <span class="n">-Expand</span> <span class="n">instanceView</span>

<span class="c"># Check Run Command logs locally</span>
<span class="nb">Get-ChildItem</span> <span class="s2">&quot;C:\Packages\Plugins\Microsoft.CPlat.Core.RunCommandWindows&quot;</span> <span class="n">-Recurse</span>
</code></pre></div>

<blockquote>
<p><strong>üíº Enterprise Callout: Active Directory Domain Join</strong></p>
<p>If you need to join Azure VMs to Active Directory for centralized authentication:<br />
```powershell</p>
<h1 id="quick-test-if-domain-join-succeeded">Quick test if domain join succeeded</h1>
<p>Test-ComputerSecureChannel<br />
Get-ADComputer $env:COMPUTERNAME<br />
```</p>
<p><a href="#active-directory">Jump to full Active Directory guide ‚Üí</a></p>
</blockquote>
<hr />
<h2 id="part-2-system-administration"><a name="system-admin"></a>Part 2: System Administration</h2>
<h3 id="process-performance-monitoring">Process &amp; Performance Monitoring</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># List running processes sorted by CPU</span>
<span class="nb">Get-Process</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">CPU</span> <span class="n">-Descending</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">-First</span> <span class="n">10</span>

<span class="c"># List processes by memory usage</span>
<span class="nb">Get-Process</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">WS</span> <span class="n">-Descending</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">-First</span> <span class="n">10</span> <span class="n">Name</span><span class="p">,</span> <span class="p">@{</span><span class="n">N</span><span class="p">=</span><span class="s1">&#39;Memory(MB)&#39;</span><span class="p">;</span><span class="n">E</span><span class="p">={</span><span class="no">[math]</span><span class="p">::</span><span class="n">Round</span><span class="p">(</span><span class="nv">$_</span><span class="p">.</span><span class="n">WS</span><span class="p">/</span><span class="n">1MB</span><span class="p">,</span><span class="n">2</span><span class="p">)}}</span>

<span class="c"># Monitor CPU usage</span>
<span class="nb">Get-Counter</span> <span class="s1">&#39;\Processor(_Total)\% Processor Time&#39;</span> <span class="n">-SampleInterval</span> <span class="n">2</span> <span class="n">-MaxSamples</span> <span class="n">5</span>

<span class="c"># Check memory usage</span>
<span class="nb">Get-CimInstance</span> <span class="n">Win32_OperatingSystem</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="p">@{</span><span class="n">N</span><span class="p">=</span><span class="s1">&#39;TotalMemory(GB)&#39;</span><span class="p">;</span><span class="n">E</span><span class="p">={</span><span class="no">[math]</span><span class="p">::</span><span class="n">Round</span><span class="p">(</span><span class="nv">$_</span><span class="p">.</span><span class="n">TotalVisibleMemorySize</span><span class="p">/</span><span class="n">1MB</span><span class="p">,</span><span class="n">2</span><span class="p">)}},</span> <span class="p">@{</span><span class="n">N</span><span class="p">=</span><span class="s1">&#39;FreeMemory(GB)&#39;</span><span class="p">;</span><span class="n">E</span><span class="p">={</span><span class="no">[math]</span><span class="p">::</span><span class="n">Round</span><span class="p">(</span><span class="nv">$_</span><span class="p">.</span><span class="n">FreePhysicalMemory</span><span class="p">/</span><span class="n">1MB</span><span class="p">,</span><span class="n">2</span><span class="p">)}}</span>

<span class="c"># System uptime</span>
<span class="p">(</span><span class="nb">Get-Date</span><span class="p">)</span> <span class="p">-</span> <span class="p">(</span><span class="nb">Get-CimInstance</span> <span class="n">Win32_OperatingSystem</span><span class="p">).</span><span class="n">LastBootUpTime</span>
</code></pre></div>

<h3 id="service-management">Service Management</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Check service status</span>
<span class="nb">Get-Service</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">Status</span> <span class="o">-eq</span> <span class="s2">&quot;Running&quot;</span><span class="p">}</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">Name</span><span class="p">,</span> <span class="n">DisplayName</span><span class="p">,</span> <span class="n">StartType</span>

<span class="c"># Check specific services</span>
<span class="nb">Get-Service</span> <span class="n">-Name</span> <span class="s2">&quot;NTDS&quot;</span><span class="p">,</span> <span class="s2">&quot;DNS&quot;</span><span class="p">,</span> <span class="s2">&quot;W32Time&quot;</span><span class="p">,</span> <span class="s2">&quot;Netlogon&quot;</span>

<span class="c"># Start/stop/restart service</span>
<span class="nb">Start-Service</span> <span class="n">-Name</span> <span class="s2">&quot;Spooler&quot;</span>
<span class="nb">Stop-Service</span> <span class="n">-Name</span> <span class="s2">&quot;Spooler&quot;</span>
<span class="nb">Restart-Service</span> <span class="n">-Name</span> <span class="s2">&quot;Spooler&quot;</span>

<span class="c"># Set service startup type</span>
<span class="nb">Set-Service</span> <span class="n">-Name</span> <span class="s2">&quot;Spooler&quot;</span> <span class="n">-StartupType</span> <span class="n">Automatic</span>

<span class="c"># Check service dependencies</span>
<span class="nb">Get-Service</span> <span class="n">-Name</span> <span class="s2">&quot;NTDS&quot;</span> <span class="n">-DependentServices</span>
<span class="nb">Get-Service</span> <span class="n">-Name</span> <span class="s2">&quot;NTDS&quot;</span> <span class="n">-RequiredServices</span>
</code></pre></div>

<h3 id="event-log-monitoring">Event Log Monitoring</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># View recent system errors</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">System</span> <span class="n">-EntryType</span> <span class="n">Error</span> <span class="n">-Newest</span> <span class="n">20</span>

<span class="c"># View application errors</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">Application</span> <span class="n">-EntryType</span> <span class="n">Error</span> <span class="n">-Newest</span> <span class="n">20</span>

<span class="c"># Security log - failed logon attempts</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">Security</span> <span class="n">-InstanceId</span> <span class="n">4625</span> <span class="n">-Newest</span> <span class="n">50</span>

<span class="c"># Security log - successful logons</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">Security</span> <span class="n">-InstanceId</span> <span class="n">4624</span> <span class="n">-Newest</span> <span class="n">50</span>

<span class="c"># Filter by time</span>
<span class="nv">$startTime</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Get-Date</span><span class="p">).</span><span class="n">AddHours</span><span class="p">(-</span><span class="n">1</span><span class="p">)</span>
<span class="nb">Get-WinEvent</span> <span class="n">-FilterHashtable</span> <span class="p">@{</span><span class="n">LogName</span><span class="p">=</span><span class="s1">&#39;System&#39;</span><span class="p">;</span> <span class="n">Level</span><span class="p">=</span><span class="n">2</span><span class="p">;</span> <span class="n">StartTime</span><span class="p">=</span><span class="nv">$startTime</span><span class="p">}</span>

<span class="c"># Search for specific text in event logs</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">System</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">Message</span> <span class="o">-like</span> <span class="s2">&quot;*failed*&quot;</span><span class="p">}</span>

<span class="c"># Export events to CSV</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">System</span> <span class="n">-EntryType</span> <span class="n">Error</span> <span class="n">-Newest</span> <span class="n">100</span> <span class="p">|</span> <span class="nb">Export-Csv</span> <span class="n">C</span><span class="p">:\</span><span class="n">Temp</span><span class="p">\</span><span class="n">SystemErrors</span><span class="p">.</span><span class="n">csv</span> <span class="n">-NoTypeInformation</span>
</code></pre></div>

<h3 id="user-permission-management">User &amp; Permission Management</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># List local users</span>
<span class="nb">Get-LocalUser</span>

<span class="c"># Create local user</span>
<span class="nb">New-LocalUser</span> <span class="n">-Name</span> <span class="s2">&quot;serviceaccount&quot;</span> <span class="n">-Password</span> <span class="p">(</span><span class="nb">ConvertTo-SecureString</span> <span class="s2">&quot;P@ssw0rd&quot;</span> <span class="n">-AsPlainText</span> <span class="n">-Force</span><span class="p">)</span> <span class="n">-FullName</span> <span class="s2">&quot;Service Account&quot;</span>

<span class="c"># Add user to local administrators</span>
<span class="nb">Add-LocalGroupMember</span> <span class="n">-Group</span> <span class="s2">&quot;Administrators&quot;</span> <span class="n">-Member</span> <span class="s2">&quot;DOMAIN\AdminUser&quot;</span>

<span class="c"># List members of local group</span>
<span class="nb">Get-LocalGroupMember</span> <span class="n">-Group</span> <span class="s2">&quot;Administrators&quot;</span>

<span class="c"># Check current user</span>
<span class="n">whoami</span>
<span class="n">whoami</span> <span class="p">/</span><span class="n">groups</span>

<span class="c"># Check user&#39;s group memberships</span>
<span class="n">net</span> <span class="n">user</span> <span class="n">username</span> <span class="p">/</span><span class="n">domain</span>
</code></pre></div>

<hr />
<h2 id="part-3-active-directory-domain-join"><a name="active-directory"></a>Part 3: Active Directory &amp; Domain Join</h2>
<blockquote>
<p><strong>Note:</strong> This section covers traditional Active Directory Domain Controllers, not Azure AD Domain Services. Most enterprises run traditional AD in Azure for hybrid scenarios.</p>
</blockquote>
<h3 id="prerequisites-for-domain-join">Prerequisites for Domain Join</h3>
<p>Before joining a Windows VM to Active Directory:</p>
<ol>
<li><strong>DNS must point to domain controller</strong> (not Azure DNS or 8.8.8.8)</li>
<li><strong>Network connectivity to DC</strong> (ports 53, 88, 135, 389, 445, 636)</li>
<li><strong>Time sync within 5 minutes</strong> (Kerberos requirement)</li>
<li><strong>Account with domain join privileges</strong></li>
</ol>
<h3 id="required-ports">Required Ports</h3>
<table>
<thead>
<tr>
<th>Port</th>
<th>Protocol</th>
<th>Service</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr>
<td>53</td>
<td>TCP/UDP</td>
<td>DNS</td>
<td>Yes</td>
</tr>
<tr>
<td>88</td>
<td>TCP/UDP</td>
<td>Kerberos</td>
<td>Yes</td>
</tr>
<tr>
<td>135</td>
<td>TCP</td>
<td>RPC Endpoint Mapper</td>
<td>Yes</td>
</tr>
<tr>
<td>389</td>
<td>TCP/UDP</td>
<td>LDAP</td>
<td>Yes</td>
</tr>
<tr>
<td>445</td>
<td>TCP</td>
<td>SMB/CIFS</td>
<td>Yes</td>
</tr>
<tr>
<td>464</td>
<td>TCP/UDP</td>
<td>Kerberos Password Change</td>
<td>Yes</td>
</tr>
<tr>
<td>636</td>
<td>TCP</td>
<td>LDAPS</td>
<td>Recommended</td>
</tr>
<tr>
<td>3268</td>
<td>TCP</td>
<td>Global Catalog</td>
<td>Recommended</td>
</tr>
<tr>
<td>3269</td>
<td>TCP</td>
<td>Global Catalog SSL</td>
<td>Recommended</td>
</tr>
</tbody>
</table>
<h3 id="domain-join-process">Domain Join Process</h3>
<h4 id="step-1-configure-dns">Step 1: Configure DNS</h4>
<p><strong>Critical:</strong> VM must use domain controller as DNS server.</p>
<div class="codehilite"><pre><span></span><code><span class="c"># Check current DNS configuration</span>
<span class="nb">Get-DnsClientServerAddress</span>

<span class="c"># Set DNS to domain controller (temporary - testing only)</span>
<span class="nb">Set-DnsClientServerAddress</span> <span class="n">-InterfaceIndex</span> <span class="p">(</span><span class="nb">Get-NetAdapter</span><span class="p">).</span><span class="n">ifIndex</span> <span class="n">-ServerAddresses</span> <span class="s2">&quot;10.0.0.4&quot;</span><span class="p">,</span><span class="s2">&quot;10.0.0.5&quot;</span>

<span class="c"># Verify DNS resolution</span>
<span class="nb">Resolve-DnsName</span> <span class="n">DC01</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span>
<span class="nb">Resolve-DnsName</span> <span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span>
<span class="n">nslookup</span> <span class="n">_ldap</span><span class="p">.</span><span class="n">_tcp</span><span class="p">.</span><span class="n">dc</span><span class="p">.</span><span class="n">_msdcs</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span>

<span class="c"># Test DNS connectivity</span>
<span class="nb">Test-NetConnection</span> <span class="n">DC01</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span> <span class="n">-Port</span> <span class="n">53</span>
</code></pre></div>

<p><strong>Note:</strong> For permanent DNS changes in Azure, configure at the VNet level in Azure Portal, not on the VM itself.</p>
<h4 id="step-2-configure-time-sync">Step 2: Configure Time Sync</h4>
<p><strong>This is critical.</strong> Kerberos authentication fails if time difference exceeds 5 minutes.</p>
<div class="codehilite"><pre><span></span><code><span class="c"># Check time sync status</span>
<span class="n">w32tm</span> <span class="p">/</span><span class="n">query</span> <span class="p">/</span><span class="n">status</span>
<span class="n">w32tm</span> <span class="p">/</span><span class="n">query</span> <span class="p">/</span><span class="n">source</span>

<span class="c"># Configure time sync to domain controller</span>
<span class="n">w32tm</span> <span class="p">/</span><span class="n">config</span> <span class="p">/</span><span class="n">manualpeerlist</span><span class="p">:</span><span class="s2">&quot;DC01.CONTOSO.COM&quot;</span> <span class="p">/</span><span class="n">syncfromflags</span><span class="p">:</span><span class="n">manual</span> <span class="p">/</span><span class="n">reliable</span><span class="p">:</span><span class="n">yes</span> <span class="p">/</span><span class="n">update</span>

<span class="c"># Force time sync</span>
<span class="n">w32tm</span> <span class="p">/</span><span class="n">resync</span> <span class="p">/</span><span class="n">force</span>

<span class="c"># Verify time difference</span>
<span class="n">w32tm</span> <span class="p">/</span><span class="n">stripchart</span> <span class="p">/</span><span class="n">computer</span><span class="p">:</span><span class="n">DC01</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span> <span class="p">/</span><span class="n">samples</span><span class="p">:</span><span class="n">5</span> <span class="p">/</span><span class="n">dataonly</span>
</code></pre></div>

<h4 id="step-3-test-connectivity-to-domain-controller">Step 3: Test Connectivity to Domain Controller</h4>
<div class="codehilite"><pre><span></span><code><span class="c"># Ping domain controller</span>
<span class="nb">Test-NetConnection</span> <span class="n">DC01</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span>

<span class="c"># Test required ports</span>
<span class="nb">Test-NetConnection</span> <span class="n">DC01</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span> <span class="n">-Port</span> <span class="n">53</span>   <span class="c"># DNS</span>
<span class="nb">Test-NetConnection</span> <span class="n">DC01</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span> <span class="n">-Port</span> <span class="n">88</span>   <span class="c"># Kerberos</span>
<span class="nb">Test-NetConnection</span> <span class="n">DC01</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span> <span class="n">-Port</span> <span class="n">389</span>  <span class="c"># LDAP</span>
<span class="nb">Test-NetConnection</span> <span class="n">DC01</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span> <span class="n">-Port</span> <span class="n">445</span>  <span class="c"># SMB</span>
<span class="nb">Test-NetConnection</span> <span class="n">DC01</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span> <span class="n">-Port</span> <span class="n">636</span>  <span class="c"># LDAPS</span>

<span class="c"># Test LDAP connectivity</span>
<span class="n">nltest</span> <span class="p">/</span><span class="n">dsgetdc</span><span class="p">:</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span>

<span class="c"># Check domain controller availability</span>
<span class="n">nltest</span> <span class="p">/</span><span class="n">dclist</span><span class="p">:</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span>
</code></pre></div>

<h4 id="step-4-join-domain">Step 4: Join Domain</h4>
<div class="codehilite"><pre><span></span><code><span class="c"># Join domain (interactive - prompts for credentials)</span>
<span class="nb">Add-Computer</span> <span class="n">-DomainName</span> <span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span> <span class="n">-Restart</span>

<span class="c"># Join domain with specific credentials</span>
<span class="nv">$credential</span> <span class="p">=</span> <span class="nb">Get-Credential</span>
<span class="nb">Add-Computer</span> <span class="n">-DomainName</span> <span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span> <span class="n">-Credential</span> <span class="nv">$credential</span> <span class="n">-Restart</span>

<span class="c"># Join domain with specific OU</span>
<span class="nb">Add-Computer</span> <span class="n">-DomainName</span> <span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span> <span class="n">-OUPath</span> <span class="s2">&quot;OU=Servers,OU=Azure,DC=CONTOSO,DC=COM&quot;</span> <span class="n">-Credential</span> <span class="nv">$credential</span> <span class="n">-Restart</span>

<span class="c"># Join domain without restart</span>
<span class="nb">Add-Computer</span> <span class="n">-DomainName</span> <span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span> <span class="n">-Credential</span> <span class="nv">$credential</span>
</code></pre></div>

<h4 id="step-5-verify-domain-join">Step 5: Verify Domain Join</h4>
<div class="codehilite"><pre><span></span><code><span class="c"># Check computer&#39;s domain</span>
<span class="p">(</span><span class="nb">Get-WmiObject</span> <span class="n">Win32_ComputerSystem</span><span class="p">).</span><span class="n">Domain</span>

<span class="c"># Test secure channel to domain</span>
<span class="nb">Test-ComputerSecureChannel</span>

<span class="c"># Verify computer account in AD</span>
<span class="nb">Get-ADComputer</span> <span class="nv">$env:COMPUTERNAME</span>

<span class="c"># Check domain controller connection</span>
<span class="n">nltest</span> <span class="p">/</span><span class="n">sc_query</span><span class="p">:</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span>

<span class="c"># List domain controllers</span>
<span class="n">nltest</span> <span class="p">/</span><span class="n">dclist</span><span class="p">:</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span>
</code></pre></div>

<h3 id="troubleshooting-domain-join">Troubleshooting Domain Join</h3>
<h4 id="test-secure-channel">Test Secure Channel</h4>
<div class="codehilite"><pre><span></span><code><span class="c"># Test domain trust</span>
<span class="nb">Test-ComputerSecureChannel</span>

<span class="c"># Repair broken trust</span>
<span class="nb">Test-ComputerSecureChannel</span> <span class="n">-Repair</span> <span class="n">-Credential</span> <span class="p">(</span><span class="nb">Get-Credential</span><span class="p">)</span>

<span class="c"># Force password reset for computer account</span>
<span class="nb">Reset-ComputerMachinePassword</span> <span class="n">-Credential</span> <span class="p">(</span><span class="nb">Get-Credential</span><span class="p">)</span>
</code></pre></div>

<h4 id="domain-join-errors">Domain Join Errors</h4>
<p><strong>Error: "The specified domain either does not exist or could not be contacted"</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Check DNS configuration</span>
<span class="nb">Get-DnsClientServerAddress</span>
<span class="nb">Resolve-DnsName</span> <span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span>
<span class="n">nslookup</span> <span class="n">_ldap</span><span class="p">.</span><span class="n">_tcp</span><span class="p">.</span><span class="n">dc</span><span class="p">.</span><span class="n">_msdcs</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span>

<span class="c"># Test DC connectivity</span>
<span class="nb">Test-NetConnection</span> <span class="n">DC01</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span> <span class="n">-Port</span> <span class="n">389</span>
<span class="n">nltest</span> <span class="p">/</span><span class="n">dsgetdc</span><span class="p">:</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span>
</code></pre></div>

<p><strong>Error: "The trust relationship between this workstation and the primary domain failed"</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Check secure channel</span>
<span class="nb">Test-ComputerSecureChannel</span>

<span class="c"># Repair trust</span>
<span class="nb">Test-ComputerSecureChannel</span> <span class="n">-Repair</span> <span class="n">-Credential</span> <span class="p">(</span><span class="nb">Get-Credential</span><span class="p">)</span>

<span class="c"># If repair fails, rejoin domain</span>
<span class="nb">Remove-Computer</span> <span class="n">-UnjoinDomainCredential</span> <span class="p">(</span><span class="nb">Get-Credential</span><span class="p">)</span> <span class="n">-WorkgroupName</span> <span class="n">WORKGROUP</span> <span class="n">-Restart</span>
<span class="c"># After restart:</span>
<span class="nb">Add-Computer</span> <span class="n">-DomainName</span> <span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span> <span class="n">-Credential</span> <span class="p">(</span><span class="nb">Get-Credential</span><span class="p">)</span> <span class="n">-Restart</span>
</code></pre></div>

<p><strong>Error: "The clock skew is too great"</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Check time on local machine</span>
<span class="nb">Get-Date</span>

<span class="c"># Check time on DC (run on DC or use WMI)</span>
<span class="n">w32tm</span> <span class="p">/</span><span class="n">stripchart</span> <span class="p">/</span><span class="n">computer</span><span class="p">:</span><span class="n">DC01</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span> <span class="p">/</span><span class="n">samples</span><span class="p">:</span><span class="n">1</span> <span class="p">/</span><span class="n">dataonly</span>

<span class="c"># Sync time immediately</span>
<span class="n">w32tm</span> <span class="p">/</span><span class="n">resync</span> <span class="p">/</span><span class="n">force</span>

<span class="c"># Configure continuous sync</span>
<span class="n">w32tm</span> <span class="p">/</span><span class="n">config</span> <span class="p">/</span><span class="n">manualpeerlist</span><span class="p">:</span><span class="s2">&quot;DC01.CONTOSO.COM&quot;</span> <span class="p">/</span><span class="n">syncfromflags</span><span class="p">:</span><span class="n">manual</span> <span class="p">/</span><span class="n">reliable</span><span class="p">:</span><span class="n">yes</span> <span class="p">/</span><span class="n">update</span>
</code></pre></div>

<h3 id="active-directory-queries">Active Directory Queries</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Import AD module (if not already loaded)</span>
<span class="nb">Import-Module</span> <span class="n">ActiveDirectory</span>

<span class="c"># Find computer in AD</span>
<span class="nb">Get-ADComputer</span> <span class="nv">$env:COMPUTERNAME</span> <span class="n">-Properties</span> <span class="p">*</span>

<span class="c"># Find user account</span>
<span class="nb">Get-ADUser</span> <span class="n">-Filter</span> <span class="p">{</span><span class="n">SamAccountName</span> <span class="o">-eq</span> <span class="s2">&quot;john.doe&quot;</span><span class="p">}</span> <span class="n">-Properties</span> <span class="p">*</span>

<span class="c"># List all computers in specific OU</span>
<span class="nb">Get-ADComputer</span> <span class="n">-Filter</span> <span class="p">*</span> <span class="n">-SearchBase</span> <span class="s2">&quot;OU=Servers,OU=Azure,DC=CONTOSO,DC=COM&quot;</span>

<span class="c"># List all domain controllers</span>
<span class="nb">Get-ADDomainController</span> <span class="n">-Filter</span> <span class="p">*</span>

<span class="c"># Check AD replication status</span>
<span class="nb">Get-ADReplicationFailure</span> <span class="n">-Scope</span> <span class="n">Domain</span>

<span class="c"># Find all domain admins</span>
<span class="nb">Get-ADGroupMember</span> <span class="s2">&quot;Domain Admins&quot;</span>
</code></pre></div>

<hr />
<h2 id="part-4-group-policy-troubleshooting"><a name="group-policy"></a>Part 4: Group Policy Troubleshooting</h2>
<p>Group Policy is critical in regulated environments. When GP won't apply to Azure VMs, use these commands:</p>
<h3 id="force-group-policy-update">Force Group Policy Update</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Force GP update</span>
<span class="n">gpupdate</span> <span class="p">/</span><span class="n">force</span>

<span class="c"># Force GP update with logging</span>
<span class="n">gpupdate</span> <span class="p">/</span><span class="n">force</span> <span class="p">/</span><span class="n">wait</span><span class="p">:</span><span class="n">0</span>

<span class="c"># Update computer policy only</span>
<span class="n">gpupdate</span> <span class="p">/</span><span class="n">target</span><span class="p">:</span><span class="n">computer</span> <span class="p">/</span><span class="n">force</span>

<span class="c"># Update user policy only</span>
<span class="n">gpupdate</span> <span class="p">/</span><span class="n">target</span><span class="p">:</span><span class="n">user</span> <span class="p">/</span><span class="n">force</span>
</code></pre></div>

<h3 id="check-group-policy-results">Check Group Policy Results</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Show currently applied policies (summary)</span>
<span class="n">gpresult</span> <span class="p">/</span><span class="nb">r</span>

<span class="c"># Show detailed results</span>
<span class="n">gpresult</span> <span class="p">/</span><span class="n">v</span>

<span class="c"># Generate HTML report</span>
<span class="n">gpresult</span> <span class="p">/</span><span class="nb">h </span><span class="n">C</span><span class="p">:\</span><span class="n">Temp</span><span class="p">\</span><span class="n">GPReport</span><span class="p">.</span><span class="n">html</span>

<span class="c"># Show only computer policies</span>
<span class="n">gpresult</span> <span class="p">/</span><span class="nb">r </span><span class="p">/</span><span class="n">scope</span><span class="p">:</span><span class="n">computer</span>

<span class="c"># Show only user policies</span>
<span class="n">gpresult</span> <span class="p">/</span><span class="nb">r </span><span class="p">/</span><span class="n">scope</span><span class="p">:</span><span class="n">user</span>
</code></pre></div>

<h3 id="powershell-group-policy-commands">PowerShell Group Policy Commands</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Get Resultant Set of Policy</span>
<span class="nb">Get-GPResultantSetOfPolicy</span> <span class="n">-ReportType</span> <span class="n">Html</span> <span class="n">-Path</span> <span class="n">C</span><span class="p">:\</span><span class="n">Temp</span><span class="p">\</span><span class="n">RSoP</span><span class="p">.</span><span class="n">html</span>

<span class="c"># List all GPOs in domain</span>
<span class="nb">Get-GPO</span> <span class="n">-All</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">DisplayName</span><span class="p">,</span> <span class="n">GpoStatus</span><span class="p">,</span> <span class="n">ModificationTime</span>

<span class="c"># Check specific GPO</span>
<span class="nb">Get-GPO</span> <span class="n">-Name</span> <span class="s2">&quot;Azure VM Security Policy&quot;</span>

<span class="c"># Find GPOs linked to specific OU</span>
<span class="nb">Get-GPInheritance</span> <span class="n">-Target</span> <span class="s2">&quot;OU=Servers,OU=Azure,DC=CONTOSO,DC=COM&quot;</span>

<span class="c"># Test if GPO applies to computer</span>
<span class="nb">Get-GPOReport</span> <span class="n">-Name</span> <span class="s2">&quot;Azure VM Security Policy&quot;</span> <span class="n">-ReportType</span> <span class="n">Html</span> <span class="n">-Path</span> <span class="n">C</span><span class="p">:\</span><span class="n">Temp</span><span class="p">\</span><span class="n">GPO</span><span class="p">.</span><span class="n">html</span>
</code></pre></div>

<h3 id="group-policy-event-logs">Group Policy Event Logs</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Check GP application events</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">System</span> <span class="n">-Source</span> <span class="s2">&quot;Microsoft-Windows-GroupPolicy&quot;</span> <span class="n">-Newest</span> <span class="n">50</span>

<span class="c"># Filter for errors only</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">System</span> <span class="n">-Source</span> <span class="s2">&quot;Microsoft-Windows-GroupPolicy&quot;</span> <span class="n">-EntryType</span> <span class="n">Error</span> <span class="n">-Newest</span> <span class="n">20</span>

<span class="c"># Check GP processing time</span>
<span class="nb">Get-WinEvent</span> <span class="n">-FilterHashtable</span> <span class="p">@{</span><span class="n">LogName</span><span class="p">=</span><span class="s1">&#39;System&#39;</span><span class="p">;</span> <span class="n">ProviderName</span><span class="p">=</span><span class="s1">&#39;Microsoft-Windows-GroupPolicy&#39;</span><span class="p">}</span> <span class="n">-MaxEvents</span> <span class="n">10</span>

<span class="c"># Search for specific GP issues</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">System</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">Message</span> <span class="o">-like</span> <span class="s2">&quot;*Group Policy*&quot;</span> <span class="o">-and</span> <span class="nv">$_</span><span class="p">.</span><span class="n">EntryType</span> <span class="o">-eq</span> <span class="s2">&quot;Error&quot;</span><span class="p">}</span>
</code></pre></div>

<h3 id="common-group-policy-issues">Common Group Policy Issues</h3>
<p><strong>Issue: "Group Policy not applying to Azure VM"</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Check domain membership</span>
<span class="p">(</span><span class="nb">Get-WmiObject</span> <span class="n">Win32_ComputerSystem</span><span class="p">).</span><span class="n">Domain</span>

<span class="c"># Test secure channel</span>
<span class="nb">Test-ComputerSecureChannel</span>

<span class="c"># Check DNS (must point to DC)</span>
<span class="nb">Get-DnsClientServerAddress</span>

<span class="c"># Test DC connectivity</span>
<span class="nb">Test-NetConnection</span> <span class="n">DC01</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span> <span class="n">-Port</span> <span class="n">389</span>

<span class="c"># Force GP refresh</span>
<span class="n">gpupdate</span> <span class="p">/</span><span class="n">force</span>

<span class="c"># Check if computer is in correct OU</span>
<span class="nb">Get-ADComputer</span> <span class="nv">$env:COMPUTERNAME</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">DistinguishedName</span>
</code></pre></div>

<p><strong>Issue: "GP applies on-premises but not in Azure"</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Check site assignment (Azure VMs often in &quot;Default-First-Site-Name&quot;)</span>
<span class="n">nltest</span> <span class="p">/</span><span class="n">dsgetsite</span>

<span class="c"># Verify network connectivity to DC</span>
<span class="n">nltest</span> <span class="p">/</span><span class="n">sc_query</span><span class="p">:</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span>

<span class="c"># Check if WMI filters blocking GPO</span>
<span class="nb">Get-GPOReport</span> <span class="n">-Name</span> <span class="s2">&quot;PolicyName&quot;</span> <span class="n">-ReportType</span> <span class="n">Xml</span> <span class="p">|</span> <span class="nb">Select-String</span> <span class="s2">&quot;WmiFilter&quot;</span>

<span class="c"># Check GP event logs for details</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">System</span> <span class="n">-Source</span> <span class="s2">&quot;Microsoft-Windows-GroupPolicy&quot;</span> <span class="n">-Newest</span> <span class="n">20</span>
</code></pre></div>

<hr />
<h2 id="part-5-networking"><a name="networking"></a>Part 5: Networking</h2>
<h3 id="connectivity-testing">Connectivity Testing</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Test basic connectivity</span>
<span class="nb">Test-NetConnection</span> <span class="n">8</span><span class="p">.</span><span class="n">8</span><span class="p">.</span><span class="n">8</span><span class="p">.</span><span class="n">8</span>
<span class="nb">Test-Connection</span> <span class="n">8</span><span class="p">.</span><span class="n">8</span><span class="p">.</span><span class="n">8</span><span class="p">.</span><span class="n">8</span> <span class="n">-Count</span> <span class="n">4</span>

<span class="c"># Test specific port</span>
<span class="nb">Test-NetConnection</span> <span class="n">DC01</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span> <span class="n">-Port</span> <span class="n">389</span>
<span class="nb">Test-NetConnection</span> <span class="n">azure</span><span class="p">.</span><span class="n">microsoft</span><span class="p">.</span><span class="n">com</span> <span class="n">-Port</span> <span class="n">443</span>

<span class="c"># Trace route</span>
<span class="nb">Test-NetConnection</span> <span class="n">DC01</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span> <span class="n">-TraceRoute</span>

<span class="c"># DNS resolution</span>
<span class="nb">Resolve-DnsName</span> <span class="n">DC01</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span>
<span class="nb">Resolve-DnsName</span> <span class="n">azure</span><span class="p">.</span><span class="n">microsoft</span><span class="p">.</span><span class="n">com</span>

<span class="c"># Check DNS configuration</span>
<span class="nb">Get-DnsClientServerAddress</span>

<span class="c"># Test DNS server response</span>
<span class="n">nslookup</span> <span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span>
<span class="n">nslookup</span> <span class="n">-type</span><span class="p">=</span><span class="n">SRV</span> <span class="n">_ldap</span><span class="p">.</span><span class="n">_tcp</span><span class="p">.</span><span class="n">dc</span><span class="p">.</span><span class="n">_msdcs</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span>
</code></pre></div>

<h3 id="network-configuration">Network Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Show network adapters</span>
<span class="nb">Get-NetAdapter</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">Name</span><span class="p">,</span> <span class="n">Status</span><span class="p">,</span> <span class="n">LinkSpeed</span><span class="p">,</span> <span class="n">MacAddress</span>

<span class="c"># Show IP configuration</span>
<span class="nb">Get-NetIPAddress</span>

<span class="c"># Show routing table</span>
<span class="nb">Get-NetRoute</span>

<span class="c"># Show active connections</span>
<span class="nb">Get-NetTCPConnection</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">State</span> <span class="o">-eq</span> <span class="s2">&quot;Established&quot;</span><span class="p">}</span>

<span class="c"># Show listening ports</span>
<span class="nb">Get-NetTCPConnection</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">State</span> <span class="o">-eq</span> <span class="s2">&quot;Listen&quot;</span><span class="p">}</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">LocalPort</span><span class="p">,</span> <span class="n">LocalAddress</span>

<span class="c"># Legacy ipconfig</span>
<span class="n">ipconfig</span> <span class="p">/</span><span class="n">all</span>
<span class="n">ipconfig</span> <span class="p">/</span><span class="n">displaydns</span>
<span class="n">ipconfig</span> <span class="p">/</span><span class="n">flushdns</span>
</code></pre></div>

<h3 id="firewall-management">Firewall Management</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Check firewall status</span>
<span class="nb">Get-NetFirewallProfile</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">Name</span><span class="p">,</span> <span class="n">Enabled</span>

<span class="c"># List all firewall rules</span>
<span class="nb">Get-NetFirewallRule</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">Enabled</span> <span class="o">-eq</span> <span class="nv">$true</span><span class="p">}</span>

<span class="c"># Check specific rule</span>
<span class="nb">Get-NetFirewallRule</span> <span class="n">-DisplayName</span> <span class="s2">&quot;Remote Desktop*&quot;</span>

<span class="c"># Create new firewall rule</span>
<span class="nb">New-NetFirewallRule</span> <span class="n">-DisplayName</span> <span class="s2">&quot;Allow RDP&quot;</span> <span class="n">-Direction</span> <span class="n">Inbound</span> <span class="n">-Protocol</span> <span class="n">TCP</span> <span class="n">-LocalPort</span> <span class="n">3389</span> <span class="n">-Action</span> <span class="n">Allow</span>

<span class="c"># Enable/disable firewall</span>
<span class="nb">Set-NetFirewallProfile</span> <span class="n">-Profile</span> <span class="n">Domain</span><span class="p">,</span><span class="n">Public</span><span class="p">,</span><span class="n">Private</span> <span class="n">-Enabled</span> <span class="n">True</span>

<span class="c"># Disable firewall temporarily (testing only!)</span>
<span class="nb">Set-NetFirewallProfile</span> <span class="n">-Profile</span> <span class="n">Domain</span><span class="p">,</span><span class="n">Public</span><span class="p">,</span><span class="n">Private</span> <span class="n">-Enabled</span> <span class="n">False</span>
</code></pre></div>

<h3 id="network-troubleshooting">Network Troubleshooting</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Test port connectivity (legacy)</span>
<span class="n">telnet</span> <span class="n">DC01</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span> <span class="n">389</span>

<span class="c"># Modern port test</span>
<span class="nb">Test-NetConnection</span> <span class="n">DC01</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span> <span class="n">-Port</span> <span class="n">389</span> <span class="n">-InformationLevel</span> <span class="n">Detailed</span>

<span class="c"># Check ARP table</span>
<span class="nb">Get-NetNeighbor</span>

<span class="c"># Check DNS cache</span>
<span class="nb">Get-DnsClientCache</span>

<span class="c"># Check hosts file</span>
<span class="nb">Get-Content</span> <span class="n">C</span><span class="p">:\</span><span class="n">Windows</span><span class="p">\</span><span class="n">System32</span><span class="p">\</span><span class="n">drivers</span><span class="p">\</span><span class="n">etc</span><span class="p">\</span><span class="n">hosts</span>

<span class="c"># Network statistics</span>
<span class="n">netstat</span> <span class="n">-ano</span>
<span class="n">netstat</span> <span class="n">-s</span>
</code></pre></div>

<hr />
<h2 id="part-6-disk-operations"><a name="disk-operations"></a>Part 6: Disk Operations</h2>
<p>When you attach a managed disk via Portal or PowerShell, it shows as "attached" but isn't initialized or formatted.</p>
<h3 id="check-available-disks">Check Available Disks</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># List all disks</span>
<span class="nb">Get-Disk</span>

<span class="c"># Show disk details</span>
<span class="nb">Get-Disk</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">Number</span><span class="p">,</span> <span class="n">FriendlyName</span><span class="p">,</span> <span class="n">Size</span><span class="p">,</span> <span class="n">PartitionStyle</span><span class="p">,</span> <span class="n">OperationalStatus</span>

<span class="c"># Check for offline disks</span>
<span class="nb">Get-Disk</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">OperationalStatus</span> <span class="o">-eq</span> <span class="s2">&quot;Offline&quot;</span><span class="p">}</span>

<span class="c"># Show volumes</span>
<span class="nb">Get-Volume</span>

<span class="c"># Show partition information</span>
<span class="nb">Get-Partition</span>
</code></pre></div>

<h3 id="initialize-and-format-disk">Initialize and Format Disk</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Initialize disk (replace 2 with your disk number)</span>
<span class="nb">Initialize-Disk</span> <span class="n">-Number</span> <span class="n">2</span> <span class="n">-PartitionStyle</span> <span class="n">GPT</span>

<span class="c"># Create partition using maximum size</span>
<span class="nb">New-Partition</span> <span class="n">-DiskNumber</span> <span class="n">2</span> <span class="n">-UseMaximumSize</span> <span class="n">-AssignDriveLetter</span>

<span class="c"># Format volume</span>
<span class="nb">Format-Volume</span> <span class="n">-DriveLetter</span> <span class="n">F</span> <span class="n">-FileSystem</span> <span class="n">NTFS</span> <span class="n">-NewFileSystemLabel</span> <span class="s2">&quot;Data&quot;</span> <span class="n">-Confirm</span><span class="p">:</span><span class="nv">$false</span>

<span class="c"># Complete process in one script</span>
<span class="nv">$diskNumber</span> <span class="p">=</span> <span class="n">2</span>
<span class="nb">Initialize-Disk</span> <span class="n">-Number</span> <span class="nv">$diskNumber</span> <span class="n">-PartitionStyle</span> <span class="n">GPT</span>
<span class="nv">$partition</span> <span class="p">=</span> <span class="nb">New-Partition</span> <span class="n">-DiskNumber</span> <span class="nv">$diskNumber</span> <span class="n">-UseMaximumSize</span> <span class="n">-AssignDriveLetter</span>
<span class="nb">Format-Volume</span> <span class="n">-Partition</span> <span class="nv">$partition</span> <span class="n">-FileSystem</span> <span class="n">NTFS</span> <span class="n">-NewFileSystemLabel</span> <span class="s2">&quot;Data&quot;</span> <span class="n">-Confirm</span><span class="p">:</span><span class="nv">$false</span>
</code></pre></div>

<h3 id="disk-management">Disk Management</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Bring disk online</span>
<span class="nb">Set-Disk</span> <span class="n">-Number</span> <span class="n">2</span> <span class="n">-IsOffline</span> <span class="nv">$false</span>

<span class="c"># Set disk to read-write</span>
<span class="nb">Set-Disk</span> <span class="n">-Number</span> <span class="n">2</span> <span class="n">-IsReadOnly</span> <span class="nv">$false</span>

<span class="c"># Extend volume (if space available)</span>
<span class="nv">$partition</span> <span class="p">=</span> <span class="nb">Get-Partition</span> <span class="n">-DriveLetter</span> <span class="n">F</span>
<span class="nv">$maxSize</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Get-PartitionSupportedSize</span> <span class="n">-DriveLetter</span> <span class="n">F</span><span class="p">).</span><span class="n">SizeMax</span>
<span class="nb">Resize-Partition</span> <span class="n">-DriveLetter</span> <span class="n">F</span> <span class="n">-Size</span> <span class="nv">$maxSize</span>

<span class="c"># Check disk health</span>
<span class="nb">Get-PhysicalDisk</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">FriendlyName</span><span class="p">,</span> <span class="n">HealthStatus</span><span class="p">,</span> <span class="n">OperationalStatus</span>

<span class="c"># Check for disk errors (Windows built-in)</span>
<span class="n">chkdsk</span> <span class="n">C</span><span class="p">:</span> <span class="p">/</span><span class="n">scan</span>
</code></pre></div>

<hr />
<h2 id="part-7-security-event-logs"><a name="security-logs"></a>Part 7: Security &amp; Event Logs</h2>
<h3 id="security-event-log">Security Event Log</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Failed logon attempts (Event ID 4625)</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">Security</span> <span class="n">-InstanceId</span> <span class="n">4625</span> <span class="n">-Newest</span> <span class="n">50</span> <span class="p">|</span> <span class="nb">Format-Table</span> <span class="n">TimeGenerated</span><span class="p">,</span> <span class="n">Message</span> <span class="n">-AutoSize</span>

<span class="c"># Successful logons (Event ID 4624)</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">Security</span> <span class="n">-InstanceId</span> <span class="n">4624</span> <span class="n">-Newest</span> <span class="n">50</span>

<span class="c"># Account lockouts (Event ID 4740)</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">Security</span> <span class="n">-InstanceId</span> <span class="n">4740</span>

<span class="c"># Special privilege logons (Event ID 4672)</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">Security</span> <span class="n">-InstanceId</span> <span class="n">4672</span> <span class="n">-Newest</span> <span class="n">20</span>

<span class="c"># Audit policy changes (Event ID 4719)</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">Security</span> <span class="n">-InstanceId</span> <span class="n">4719</span>

<span class="c"># User account created (Event ID 4720)</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">Security</span> <span class="n">-InstanceId</span> <span class="n">4720</span>
</code></pre></div>

<h3 id="system-event-log">System Event Log</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># System errors</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">System</span> <span class="n">-EntryType</span> <span class="n">Error</span> <span class="n">-Newest</span> <span class="n">50</span>

<span class="c"># System warnings</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">System</span> <span class="n">-EntryType</span> <span class="n">Warning</span> <span class="n">-Newest</span> <span class="n">50</span>

<span class="c"># Service start/stop events</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">System</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">Message</span> <span class="o">-like</span> <span class="s2">&quot;*service*&quot;</span><span class="p">}</span>

<span class="c"># Recent reboots</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">System</span> <span class="n">-Source</span> <span class="s2">&quot;User32&quot;</span> <span class="n">-Newest</span> <span class="n">10</span>

<span class="c"># Filter by time</span>
<span class="nv">$startTime</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Get-Date</span><span class="p">).</span><span class="n">AddHours</span><span class="p">(-</span><span class="n">24</span><span class="p">)</span>
<span class="nb">Get-WinEvent</span> <span class="n">-FilterHashtable</span> <span class="p">@{</span><span class="n">LogName</span><span class="p">=</span><span class="s1">&#39;System&#39;</span><span class="p">;</span> <span class="n">Level</span><span class="p">=</span><span class="n">2</span><span class="p">;</span> <span class="n">StartTime</span><span class="p">=</span><span class="nv">$startTime</span><span class="p">}</span>
</code></pre></div>

<h3 id="application-event-log">Application Event Log</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Application errors</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">Application</span> <span class="n">-EntryType</span> <span class="n">Error</span> <span class="n">-Newest</span> <span class="n">50</span>

<span class="c"># Application crashes</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">Application</span> <span class="n">-Source</span> <span class="s2">&quot;Application Error&quot;</span> <span class="n">-Newest</span> <span class="n">20</span>

<span class="c"># Application hangs</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">Application</span> <span class="n">-Source</span> <span class="s2">&quot;Application Hang&quot;</span> <span class="n">-Newest</span> <span class="n">20</span>
</code></pre></div>

<h3 id="azure-specific-logs">Azure-Specific Logs</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Windows Azure Guest Agent logs</span>
<span class="nb">Get-Content</span> <span class="s2">&quot;C:\WindowsAzure\Logs\WaAppAgent.log&quot;</span> <span class="n">-Tail</span> <span class="n">50</span>

<span class="c"># Extension logs</span>
<span class="nb">Get-ChildItem</span> <span class="s2">&quot;C:\WindowsAzure\Logs\Plugins\&quot;</span> <span class="n">-Recurse</span> <span class="n">-Filter</span> <span class="s2">&quot;*.log&quot;</span>

<span class="c"># Custom Script Extension logs</span>
<span class="nb">Get-Content</span> <span class="s2">&quot;C:\Packages\Plugins\Microsoft.Compute.CustomScriptExtension\*\Status\*.status&quot;</span>
</code></pre></div>

<h3 id="audit-current-security-settings">Audit Current Security Settings</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Check local security policy</span>
<span class="n">secedit</span> <span class="p">/</span><span class="n">export</span> <span class="p">/</span><span class="n">cfg</span> <span class="n">C</span><span class="p">:\</span><span class="n">Temp</span><span class="p">\</span><span class="n">secpol</span><span class="p">.</span><span class="n">cfg</span>

<span class="c"># Check audit policy</span>
<span class="n">auditpol</span> <span class="p">/</span><span class="n">get</span> <span class="p">/</span><span class="n">category</span><span class="p">:*</span>

<span class="c"># Check user rights assignment</span>
<span class="n">whoami</span> <span class="p">/</span><span class="n">priv</span>

<span class="c"># Check if BitLocker is enabled</span>
<span class="nb">Get-BitLockerVolume</span>

<span class="c"># Check Windows Defender status</span>
<span class="nb">Get-MpComputerStatus</span>
</code></pre></div>

<hr />
<h2 id="part-8-azure-powershell-commands"><a name="azure-powershell"></a>Part 8: Azure PowerShell Commands</h2>
<h3 id="installation-authentication">Installation &amp; Authentication</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Install Azure PowerShell module</span>
<span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">Az</span> <span class="n">-Repository</span> <span class="n">PSGallery</span> <span class="n">-Force</span>

<span class="c"># Import module</span>
<span class="nb">Import-Module</span> <span class="n">Az</span>

<span class="c"># Login to Azure</span>
<span class="nb">Connect-AzAccount</span>

<span class="c"># Login with managed identity (from Azure VM)</span>
<span class="nb">Connect-AzAccount</span> <span class="n">-Identity</span>

<span class="c"># Check current context</span>
<span class="nb">Get-AzContext</span>

<span class="c"># List all subscriptions</span>
<span class="nb">Get-AzSubscription</span>

<span class="c"># Switch subscription</span>
<span class="nb">Set-AzContext</span> <span class="n">-SubscriptionId</span> <span class="s2">&quot;subscription-id&quot;</span>
</code></pre></div>

<h3 id="vm-management">VM Management</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># List all VMs in subscription</span>
<span class="nb">Get-AzVM</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">Name</span><span class="p">,</span> <span class="n">ResourceGroupName</span><span class="p">,</span> <span class="n">Location</span>

<span class="c"># List VMs in specific resource group</span>
<span class="nb">Get-AzVM</span> <span class="n">-ResourceGroupName</span> <span class="s2">&quot;myRG&quot;</span>

<span class="c"># Get VM details</span>
<span class="nb">Get-AzVM</span> <span class="n">-ResourceGroupName</span> <span class="s2">&quot;myRG&quot;</span> <span class="n">-Name</span> <span class="s2">&quot;myVM&quot;</span>

<span class="c"># Get VM status</span>
<span class="nb">Get-AzVM</span> <span class="n">-ResourceGroupName</span> <span class="s2">&quot;myRG&quot;</span> <span class="n">-Name</span> <span class="s2">&quot;myVM&quot;</span> <span class="n">-Status</span>

<span class="c"># Start VM</span>
<span class="nb">Start-AzVM</span> <span class="n">-ResourceGroupName</span> <span class="s2">&quot;myRG&quot;</span> <span class="n">-Name</span> <span class="s2">&quot;myVM&quot;</span>

<span class="c"># Stop VM (deallocate)</span>
<span class="nb">Stop-AzVM</span> <span class="n">-ResourceGroupName</span> <span class="s2">&quot;myRG&quot;</span> <span class="n">-Name</span> <span class="s2">&quot;myVM&quot;</span> <span class="n">-Force</span>

<span class="c"># Restart VM</span>
<span class="nb">Restart-AzVM</span> <span class="n">-ResourceGroupName</span> <span class="s2">&quot;myRG&quot;</span> <span class="n">-Name</span> <span class="s2">&quot;myVM&quot;</span>
</code></pre></div>

<h3 id="network-disk-operations">Network &amp; Disk Operations</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># List NSG rules</span>
<span class="nb">Get-AzNetworkSecurityGroup</span> <span class="n">-ResourceGroupName</span> <span class="s2">&quot;myRG&quot;</span> <span class="p">|</span> <span class="nb">Get-AzNetworkSecurityRuleConfig</span>

<span class="c"># List virtual networks</span>
<span class="nb">Get-AzVirtualNetwork</span>

<span class="c"># List public IP addresses</span>
<span class="nb">Get-AzPublicIpAddress</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">Name</span><span class="p">,</span> <span class="n">ResourceGroupName</span><span class="p">,</span> <span class="n">IpAddress</span>

<span class="c"># List network interfaces</span>
<span class="nb">Get-AzNetworkInterface</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">Name</span><span class="p">,</span> <span class="n">ResourceGroupName</span><span class="p">,</span> <span class="n">IpConfigurations</span>

<span class="c"># List managed disks</span>
<span class="nb">Get-AzDisk</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">Name</span><span class="p">,</span> <span class="n">ResourceGroupName</span><span class="p">,</span> <span class="n">DiskSizeGB</span><span class="p">,</span> <span class="n">DiskState</span>

<span class="c"># Get disk details</span>
<span class="nb">Get-AzDisk</span> <span class="n">-ResourceGroupName</span> <span class="s2">&quot;myRG&quot;</span> <span class="n">-Name</span> <span class="s2">&quot;myDisk&quot;</span>
</code></pre></div>

<hr />
<h2 id="part-9-serial-console-special-admin-console"><a name="serial-console"></a>Part 9: Serial Console (Special Admin Console)</h2>
<p>When RDP fails, use Azure Serial Console. It's a text-based console that gives you CMD access even when networking is broken.</p>
<h3 id="accessing-serial-console">Accessing Serial Console</h3>
<ol>
<li>Azure Portal ‚Üí VM ‚Üí Help ‚Üí Serial Console</li>
<li>Press Enter to get CMD prompt</li>
<li>You're now in a CMD window with SYSTEM privileges</li>
</ol>
<h3 id="essential-serial-console-commands">Essential Serial Console Commands</h3>
<p><strong>Note:</strong> Serial Console uses CMD, not PowerShell. Screen is limited to 80x24 characters.</p>
<div class="codehilite"><pre><span></span><code><span class="n">REM</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="n">configuration</span>
<span class="n">ipconfig</span><span class="w"> </span><span class="o">/</span><span class="n">all</span>

<span class="n">REM</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">connectivity</span>
<span class="n">ping</span><span class="w"> </span><span class="mf">8.8.8.8</span>
<span class="n">ping</span><span class="w"> </span><span class="n">DC01</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span>

<span class="n">REM</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">firewall</span><span class="w"> </span><span class="n">status</span>
<span class="n">netsh</span><span class="w"> </span><span class="n">advfirewall</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">allprofiles</span>

<span class="n">REM</span><span class="w"> </span><span class="n">Temporarily</span><span class="w"> </span><span class="k">disable</span><span class="w"> </span><span class="n">firewall</span><span class="w"> </span><span class="p">(</span><span class="n">testing</span><span class="w"> </span><span class="n">only</span><span class="o">!</span><span class="p">)</span>
<span class="n">netsh</span><span class="w"> </span><span class="n">advfirewall</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">allprofiles</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="n">off</span>

<span class="n">REM</span><span class="w"> </span><span class="n">Re</span><span class="o">-</span><span class="n">enable</span><span class="w"> </span><span class="n">firewall</span>
<span class="n">netsh</span><span class="w"> </span><span class="n">advfirewall</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">allprofiles</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="n">on</span>

<span class="n">REM</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">RDP</span><span class="w"> </span><span class="n">service</span>
<span class="n">sc</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">TermService</span>
<span class="n">sc</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">TermService</span>

<span class="n">REM</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">RDP</span><span class="w"> </span><span class="n">port</span>
<span class="n">netstat</span><span class="w"> </span><span class="o">-</span><span class="n">ano</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">findstr</span><span class="w"> </span><span class="o">:</span><span class="mh">3389</span>

<span class="n">REM</span><span class="w"> </span><span class="n">Enable</span><span class="w"> </span><span class="n">RDP</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">registry</span>
<span class="kt">reg</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="s">&quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server&quot;</span><span class="w"> </span><span class="o">/</span><span class="n">v</span><span class="w"> </span><span class="n">fDenyTSConnections</span><span class="w"> </span><span class="o">/</span><span class="n">t</span><span class="w"> </span><span class="n">REG_DWORD</span><span class="w"> </span><span class="o">/</span><span class="n">d</span><span class="w"> </span><span class="mh">0</span><span class="w"> </span><span class="o">/</span><span class="n">f</span>

<span class="n">REM</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">DNS</span><span class="w"> </span><span class="n">settings</span>
<span class="n">ipconfig</span><span class="w"> </span><span class="o">/</span><span class="n">displaydns</span>
<span class="n">ipconfig</span><span class="w"> </span><span class="o">/</span><span class="n">flushdns</span>

<span class="n">REM</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">routes</span>
<span class="n">route</span><span class="w"> </span><span class="n">print</span>

<span class="n">REM</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">services</span>
<span class="n">sc</span><span class="w"> </span><span class="n">query</span>
<span class="n">sc</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">NTDS</span>
<span class="n">sc</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">DNS</span>

<span class="n">REM</span><span class="w"> </span><span class="n">View</span><span class="w"> </span><span class="k">event</span><span class="w"> </span><span class="n">logs</span><span class="w"> </span><span class="p">(</span><span class="n">limited</span><span class="p">)</span>
<span class="n">wevtutil</span><span class="w"> </span><span class="n">qe</span><span class="w"> </span><span class="n">System</span><span class="w"> </span><span class="o">/</span><span class="nl">c:</span><span class="mh">20</span><span class="w"> </span><span class="o">/</span><span class="nl">rd:</span><span class="n">true</span><span class="w"> </span><span class="o">/</span><span class="nl">f:</span><span class="n">text</span>

<span class="n">REM</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">disk</span><span class="w"> </span><span class="n">status</span>
<span class="n">wmic</span><span class="w"> </span><span class="n">diskdrive</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">brief</span>
<span class="n">wmic</span><span class="w"> </span><span class="n">logicaldisk</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="n">freespace</span><span class="p">,</span><span class="n">size</span>
</code></pre></div>

<h3 id="powershell-from-serial-console">PowerShell from Serial Console</h3>
<p>You can launch PowerShell from SAC:</p>
<div class="codehilite"><pre><span></span><code>REM Start PowerShell
powershell

REM Now you&#39;re in PowerShell with all commands available
Get-Service
Get-EventLog -LogName System -Newest 10
Test-ComputerSecureChannel
</code></pre></div>

<h3 id="common-serial-console-scenarios">Common Serial Console Scenarios</h3>
<p><strong>Scenario 1: RDP Not Working After Update</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">REM</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">RDP</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="n">status</span>
<span class="n">sc</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">TermService</span>

<span class="n">REM</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">stopped</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">it</span>
<span class="n">sc</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">TermService</span>

<span class="n">REM</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">RDP</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span>
<span class="kt">reg</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="s">&quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server&quot;</span><span class="w"> </span><span class="o">/</span><span class="n">v</span><span class="w"> </span><span class="n">fDenyTSConnections</span>

<span class="n">REM</span><span class="w"> </span><span class="n">Enable</span><span class="w"> </span><span class="n">RDP</span>
<span class="kt">reg</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="s">&quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server&quot;</span><span class="w"> </span><span class="o">/</span><span class="n">v</span><span class="w"> </span><span class="n">fDenyTSConnections</span><span class="w"> </span><span class="o">/</span><span class="n">t</span><span class="w"> </span><span class="n">REG_DWORD</span><span class="w"> </span><span class="o">/</span><span class="n">d</span><span class="w"> </span><span class="mh">0</span><span class="w"> </span><span class="o">/</span><span class="n">f</span>

<span class="n">REM</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">firewall</span>
<span class="n">netsh</span><span class="w"> </span><span class="n">advfirewall</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">allprofiles</span>

<span class="n">REM</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">what</span><span class="p">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">listening</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="mh">3389</span>
<span class="n">netstat</span><span class="w"> </span><span class="o">-</span><span class="n">ano</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">findstr</span><span class="w"> </span><span class="o">:</span><span class="mh">3389</span>
</code></pre></div>

<p><strong>Scenario 2: VM Not Joining Domain</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nv">REM</span><span class="w"> </span><span class="nv">Check</span><span class="w"> </span><span class="nv">DNS</span><span class="w"> </span><span class="nv">configuration</span>
<span class="nv">ipconfig</span><span class="w"> </span><span class="o">/</span><span class="nv">all</span>

<span class="nv">REM</span><span class="w"> </span><span class="nv">Test</span><span class="w"> </span><span class="nv">DC</span><span class="w"> </span><span class="nv">connectivity</span>
<span class="nv">ping</span><span class="w"> </span><span class="nv">DC01</span>.<span class="nv">CONTOSO</span>.<span class="nv">COM</span>
<span class="nv">telnet</span><span class="w"> </span><span class="nv">DC01</span>.<span class="nv">CONTOSO</span>.<span class="nv">COM</span><span class="w"> </span><span class="mi">389</span>

<span class="nv">REM</span><span class="w"> </span><span class="nv">Check</span><span class="w"> </span><span class="nv">domain</span><span class="w"> </span><span class="nv">membership</span>
<span class="nv">wmic</span><span class="w"> </span><span class="nv">computersystem</span><span class="w"> </span><span class="nv">get</span><span class="w"> </span><span class="nv">domain</span>

<span class="nv">REM</span><span class="w"> </span><span class="nv">Try</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">join</span><span class="w"> </span><span class="nv">domain</span><span class="w"> </span><span class="ss">(</span><span class="k">if</span><span class="w"> </span><span class="nv">networked</span><span class="ss">)</span>
<span class="nv">powershell</span>
<span class="nv">Add</span><span class="o">-</span><span class="nv">Computer</span><span class="w"> </span><span class="o">-</span><span class="nv">DomainName</span><span class="w"> </span><span class="nv">CONTOSO</span>.<span class="nv">COM</span><span class="w"> </span><span class="o">-</span><span class="nv">Credential</span><span class="w"> </span><span class="ss">(</span><span class="nv">Get</span><span class="o">-</span><span class="nv">Credential</span><span class="ss">)</span><span class="w"> </span><span class="o">-</span><span class="nv">Restart</span>
</code></pre></div>

<hr />
<h2 id="quick-reference-table"><a name="quick-reference"></a>Quick Reference Table</h2>
<table>
<thead>
<tr>
<th>Category</th>
<th>Command</th>
<th>What It Does</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>VM Agent</strong></td>
<td><code>Get-Service WindowsAzureGuestAgent</code></td>
<td>Check Azure agent</td>
</tr>
<tr>
<td></td>
<td><code>Get-Content C:\WindowsAzure\Logs\WaAppAgent.log</code></td>
<td>View agent logs</td>
</tr>
<tr>
<td><strong>Extensions</strong></td>
<td><code>Get-ChildItem C:\Packages\Plugins</code></td>
<td>List extensions</td>
</tr>
<tr>
<td></td>
<td><code>Get-Content C:\WindowsAzure\Logs\Plugins\...\CommandExecution.log</code></td>
<td>View execution logs</td>
</tr>
<tr>
<td><strong>IMDS</strong></td>
<td><code>Invoke-RestMethod -Headers @{"Metadata"="true"} -Uri http://169.254...</code></td>
<td>Get metadata</td>
</tr>
<tr>
<td><strong>Domain Join</strong></td>
<td><code>Add-Computer -DomainName CONTOSO.COM</code></td>
<td>Join AD domain</td>
</tr>
<tr>
<td></td>
<td><code>Test-ComputerSecureChannel</code></td>
<td>Test domain trust</td>
</tr>
<tr>
<td></td>
<td><code>Test-ComputerSecureChannel -Repair</code></td>
<td>Repair trust</td>
</tr>
<tr>
<td><strong>Group Policy</strong></td>
<td><code>gpupdate /force</code></td>
<td>Force GP refresh</td>
</tr>
<tr>
<td></td>
<td><code>gpresult /r</code></td>
<td>Show applied policies</td>
</tr>
<tr>
<td></td>
<td><code>gpresult /h report.html</code></td>
<td>Generate GP report</td>
</tr>
<tr>
<td><strong>AD Queries</strong></td>
<td><code>Get-ADComputer $env:COMPUTERNAME</code></td>
<td>Get computer object</td>
</tr>
<tr>
<td></td>
<td><code>Get-ADUser username</code></td>
<td>Get user details</td>
</tr>
<tr>
<td></td>
<td><code>nltest /sc_query:CONTOSO.COM</code></td>
<td>Check DC connection</td>
</tr>
<tr>
<td><strong>Network</strong></td>
<td><code>Test-NetConnection -Port 389</code></td>
<td>Test port connectivity</td>
</tr>
<tr>
<td></td>
<td><code>Resolve-DnsName DC01.CONTOSO.COM</code></td>
<td>DNS lookup</td>
</tr>
<tr>
<td></td>
<td><code>Get-NetFirewallRule</code></td>
<td>List firewall rules</td>
</tr>
<tr>
<td><strong>Disk</strong></td>
<td><code>Get-Disk</code></td>
<td>List disks</td>
</tr>
<tr>
<td></td>
<td><code>Initialize-Disk -Number 2</code></td>
<td>Initialize disk</td>
</tr>
<tr>
<td></td>
<td><code>Format-Volume -DriveLetter F</code></td>
<td>Format volume</td>
</tr>
<tr>
<td><strong>Event Logs</strong></td>
<td><code>Get-EventLog -LogName Security -InstanceId 4625</code></td>
<td>Failed logons</td>
</tr>
<tr>
<td></td>
<td><code>Get-EventLog -LogName System -EntryType Error</code></td>
<td>System errors</td>
</tr>
<tr>
<td><strong>Azure PowerShell</strong></td>
<td><code>Get-AzVM</code></td>
<td>List VMs</td>
</tr>
<tr>
<td></td>
<td><code>Start-AzVM</code> / <code>Stop-AzVM</code></td>
<td>Control VMs</td>
</tr>
<tr>
<td><strong>Serial Console</strong></td>
<td><code>sc query TermService</code></td>
<td>Check RDP service</td>
</tr>
<tr>
<td></td>
<td><code>ipconfig /all</code></td>
<td>Network config</td>
</tr>
<tr>
<td></td>
<td><code>netsh advfirewall show allprofiles</code></td>
<td>Firewall status</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="domain-controller-management-bonus">Domain Controller Management (Bonus)</h2>
<p>If you're running Domain Controllers in Azure (many enterprises do):</p>
<h3 id="dc-health-checks">DC Health Checks</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Check AD services</span>
<span class="nb">Get-Service</span> <span class="n">NTDS</span><span class="p">,</span> <span class="n">DNS</span><span class="p">,</span> <span class="n">Kerberos</span><span class="p">,</span> <span class="n">Netlogon</span><span class="p">,</span> <span class="n">W32Time</span>

<span class="c"># Check AD replication</span>
<span class="n">repadmin</span> <span class="p">/</span><span class="n">replsummary</span>
<span class="n">repadmin</span> <span class="p">/</span><span class="n">showrepl</span>

<span class="c"># Check replication failures</span>
<span class="nb">Get-ADReplicationFailure</span> <span class="n">-Scope</span> <span class="n">Domain</span>

<span class="c"># Force replication</span>
<span class="n">repadmin</span> <span class="p">/</span><span class="n">syncall</span> <span class="p">/</span><span class="n">AdeP</span>

<span class="c"># Check FSMO roles</span>
<span class="n">netdom</span> <span class="n">query</span> <span class="n">fsmo</span>

<span class="c"># Move FSMO role (if needed)</span>
<span class="nb">Move-ADDirectoryServerOperationMasterRole</span> <span class="n">-Identity</span> <span class="s2">&quot;DC02&quot;</span> <span class="n">-OperationMasterRole</span> <span class="n">SchemaMaster</span>
</code></pre></div>

<h3 id="dns-diagnostics">DNS Diagnostics</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Run dcdiag DNS tests</span>
<span class="n">dcdiag</span> <span class="p">/</span><span class="n">test</span><span class="p">:</span><span class="n">dns</span>

<span class="c"># Full DC diagnostic</span>
<span class="n">dcdiag</span> <span class="p">/</span><span class="n">v</span>

<span class="c"># Check DNS zones</span>
<span class="nb">Get-DnsServerZone</span>

<span class="c"># Check DNS server settings</span>
<span class="nb">Get-DnsServer</span>

<span class="c"># Test DNS recursion</span>
<span class="nb">Resolve-DnsName</span> <span class="n">www</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span> <span class="n">-Server</span> <span class="n">localhost</span>
</code></pre></div>

<h3 id="time-sync-for-dcs">Time Sync for DCs</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Check time source (PDC Emulator should sync with external source)</span>
<span class="n">w32tm</span> <span class="p">/</span><span class="n">query</span> <span class="p">/</span><span class="n">source</span>
<span class="n">w32tm</span> <span class="p">/</span><span class="n">query</span> <span class="p">/</span><span class="n">status</span>

<span class="c"># Configure PDC to sync with external time source</span>
<span class="n">w32tm</span> <span class="p">/</span><span class="n">config</span> <span class="p">/</span><span class="n">manualpeerlist</span><span class="p">:</span><span class="s2">&quot;time.windows.com&quot;</span> <span class="p">/</span><span class="n">syncfromflags</span><span class="p">:</span><span class="n">manual</span> <span class="p">/</span><span class="n">reliable</span><span class="p">:</span><span class="n">yes</span> <span class="p">/</span><span class="n">update</span>

<span class="c"># Restart time service</span>
<span class="nb">Restart-Service</span> <span class="n">W32Time</span>

<span class="c"># Force sync</span>
<span class="n">w32tm</span> <span class="p">/</span><span class="n">resync</span> <span class="p">/</span><span class="n">force</span>

<span class="c"># Check sync with other DCs</span>
<span class="n">w32tm</span> <span class="p">/</span><span class="n">monitor</span>
</code></pre></div>

<hr />
<h2 id="what-microsoft-doesn-t-document-well">What Microsoft Doesn't Document Well</h2>
<p>Microsoft's Azure Windows documentation assumes:</p>
<ol>
<li><strong>Domain join always works</strong> - It doesn't. DNS misconfiguration, time sync, and network issues are common.</li>
<li><strong>Group Policy "just applies"</strong> - In hybrid scenarios with Azure VMs, GP often fails without clear errors.</li>
<li><strong>Serial Console is obvious</strong> - It's not. Most admins don't know it exists or how to use it effectively.</li>
<li><strong>Traditional AD needs are met</strong> - Azure AD Domain Services docs dominate, but enterprises run traditional AD.</li>
<li><strong>Extension troubleshooting is straightforward</strong> - Exit codes and logs are poorly documented.</li>
</ol>
<p>This guide fills those gaps with commands you'll actually use in production.</p>
<hr />
<h2 id="common-production-scenarios">Common Production Scenarios</h2>
<h3 id="scenario-1-domain-trust-failed-after-vm-restart">Scenario 1: "Domain trust failed after VM restart"</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Check secure channel</span>
<span class="nb">Test-ComputerSecureChannel</span>
<span class="c"># If returns False:</span>

<span class="c"># Repair trust</span>
<span class="nb">Test-ComputerSecureChannel</span> <span class="n">-Repair</span> <span class="n">-Credential</span> <span class="p">(</span><span class="nb">Get-Credential</span> <span class="n">CONTOSO</span><span class="p">\</span><span class="n">admin</span><span class="p">)</span>

<span class="c"># If repair fails, check DNS and DC connectivity</span>
<span class="nb">Get-DnsClientServerAddress</span>
<span class="nb">Test-NetConnection</span> <span class="n">DC01</span><span class="p">.</span><span class="n">CONTOSO</span><span class="p">.</span><span class="n">COM</span> <span class="n">-Port</span> <span class="n">389</span>

<span class="c"># Check event logs</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">System</span> <span class="n">-Source</span> <span class="s2">&quot;Microsoft-Windows-GroupPolicy&quot;</span> <span class="n">-Newest</span> <span class="n">10</span>
</code></pre></div>

<h3 id="scenario-2-group-policy-not-applying-to-azure-vms">Scenario 2: "Group Policy not applying to Azure VMs"</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Force GP update</span>
<span class="n">gpupdate</span> <span class="p">/</span><span class="n">force</span>

<span class="c"># Generate detailed report</span>
<span class="n">gpresult</span> <span class="p">/</span><span class="nb">h </span><span class="n">C</span><span class="p">:\</span><span class="n">Temp</span><span class="p">\</span><span class="n">GPReport</span><span class="p">.</span><span class="n">html</span>

<span class="c"># Check GP event logs</span>
<span class="nb">Get-EventLog</span> <span class="n">-LogName</span> <span class="n">System</span> <span class="n">-Source</span> <span class="s2">&quot;Microsoft-Windows-GroupPolicy&quot;</span> <span class="n">-EntryType</span> <span class="n">Error</span>

<span class="c"># Verify domain membership</span>
<span class="p">(</span><span class="nb">Get-WmiObject</span> <span class="n">Win32_ComputerSystem</span><span class="p">).</span><span class="n">Domain</span>

<span class="c"># Check OU placement</span>
<span class="nb">Get-ADComputer</span> <span class="nv">$env:COMPUTERNAME</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">DistinguishedName</span>

<span class="c"># Test secure channel</span>
<span class="nb">Test-ComputerSecureChannel</span>

<span class="c"># Check site assignment</span>
<span class="n">nltest</span> <span class="p">/</span><span class="n">dsgetsite</span>
</code></pre></div>

<h3 id="scenario-3-can-t-rdp-after-windows-update">Scenario 3: "Can't RDP after Windows Update"</h3>
<p>Use Serial Console:</p>
<div class="codehilite"><pre><span></span><code><span class="n">REM</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">RDP</span><span class="w"> </span><span class="n">service</span>
<span class="n">sc</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">TermService</span>
<span class="n">sc</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">TermService</span>

<span class="n">REM</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">firewall</span>
<span class="n">netsh</span><span class="w"> </span><span class="n">advfirewall</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">allprofiles</span>
<span class="n">netsh</span><span class="w"> </span><span class="n">advfirewall</span><span class="w"> </span><span class="n">firewall</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">rule</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Remote Desktop&quot;</span>

<span class="n">REM</span><span class="w"> </span><span class="n">Enable</span><span class="w"> </span><span class="n">RDP</span>
<span class="kt">reg</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="s">&quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server&quot;</span><span class="w"> </span><span class="o">/</span><span class="n">v</span><span class="w"> </span><span class="n">fDenyTSConnections</span><span class="w"> </span><span class="o">/</span><span class="n">t</span><span class="w"> </span><span class="n">REG_DWORD</span><span class="w"> </span><span class="o">/</span><span class="n">d</span><span class="w"> </span><span class="mh">0</span><span class="w"> </span><span class="o">/</span><span class="n">f</span>

<span class="n">REM</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">what</span><span class="p">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">listening</span>
<span class="n">netstat</span><span class="w"> </span><span class="o">-</span><span class="n">ano</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">findstr</span><span class="w"> </span><span class="o">:</span><span class="mh">3389</span>

<span class="n">REM</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">recent</span><span class="w"> </span><span class="n">errors</span>
<span class="n">powershell</span><span class="w"> </span><span class="n">Get</span><span class="o">-</span><span class="n">EventLog</span><span class="w"> </span><span class="o">-</span><span class="n">LogName</span><span class="w"> </span><span class="n">System</span><span class="w"> </span><span class="o">-</span><span class="n">EntryType</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="o">-</span><span class="n">Newest</span><span class="w"> </span><span class="mh">20</span>
</code></pre></div>

<h3 id="scenario-4-new-disk-attached-but-not-showing-in-explorer">Scenario 4: "New disk attached but not showing in Explorer"</h3>
<div class="codehilite"><pre><span></span><code><span class="c"># Check if disk is visible</span>
<span class="nb">Get-Disk</span>

<span class="c"># If disk shows as Offline or Raw:</span>
<span class="nb">Initialize-Disk</span> <span class="n">-Number</span> <span class="n">2</span> <span class="n">-PartitionStyle</span> <span class="n">GPT</span>
<span class="nb">New-Partition</span> <span class="n">-DiskNumber</span> <span class="n">2</span> <span class="n">-UseMaximumSize</span> <span class="n">-AssignDriveLetter</span>
<span class="nb">Format-Volume</span> <span class="n">-DriveLetter</span> <span class="n">F</span> <span class="n">-FileSystem</span> <span class="n">NTFS</span> <span class="n">-NewFileSystemLabel</span> <span class="s2">&quot;Data&quot;</span>

<span class="c"># Verify</span>
<span class="nb">Get-Volume</span>
</code></pre></div>

<hr />
<h2 id="conclusion">Conclusion</h2>
<p>These 50 commands cover 90% of Windows Server Azure administration tasks. Whether you manage 5 VMs or 5,000, these commands bridge the gap between successful deployment and operational reality.</p>
<p><strong>For most administrators:</strong> Focus on Parts 1-6 for daily operations</p>
<p><strong>For enterprise environments:</strong> Add Parts 3-4 (Active Directory + Group Policy) for domain-joined infrastructure</p>
<p><strong>For troubleshooting:</strong> Part 9 (Serial Console) is critical when RDP fails</p>
<p>The key insight: Infrastructure-as-code deploys the VMs. These Windows commands fix the 20% that breaks after deployment.</p>
<hr />
<h2 id="download-complete-command-reference">Download: Complete Command Reference</h2>
<p>Want this as a searchable PDF cheat sheet?</p>
<p><strong><a href="#">Download: Azure Windows Command Reference (PDF)</a></strong></p>
<p>Includes:<br />
- All 50 commands with examples and Azure context<br />
- Active Directory domain join checklist<br />
- Group Policy troubleshooting flowchart<br />
- Port reference table (AD, Azure services, RDP)<br />
- Event log ID reference (4624, 4625, 4740, etc.)<br />
- Serial Console quick reference card</p>
<p>Enter your email below and I'll send you the complete guide:</p>
<p>[Beehiiv email capture form]</p>
<hr />
<h2 id="what-s-next">What's Next?</h2>
<p><strong>Related posts:</strong><br />
- <a href="/blog/50-linux-commands-azure/">50 Linux Commands for Azure</a><br />
- <a href="/blog/azure-vm-inventory-kql/">Azure VM Inventory with KQL</a><br />
- <a href="/blog/why-most-azure-migrations-fail/">Why Most Azure Migrations Fail</a></p>
<p><strong>Managing both Windows and Linux?</strong> Check out our <a href="/blog/50-linux-commands-azure/">Linux Commands for Azure guide</a> covering Ubuntu, RHEL, and Active Directory domain join from the Linux side.</p>
<p><strong>Questions?</strong> Domain join issues, Group Policy problems, and trust relationship failures are some of the most frustrating Azure problems. If you hit an issue not covered here, reach out‚ÄîI've probably seen it in a production banking environment.</p>
<hr />
<p><em>Updated December 2025 - Tested on Windows Server 2019, 2022, and Windows 10/11 in Azure production environments.</em></p>
<hr />
<h2 id="ready-for-production-ready-queries">üéØ Ready for Production-Ready Queries?</h2>
<p>This guide covers the basics, but <strong>scaling to 30,000+ resources requires battle-tested patterns.</strong></p>
<p><strong>The Complete KQL Query Library includes:</strong><br />
- ‚úÖ 48 copy-paste ready queries (VMs, networking, security, cost)<br />
- ‚úÖ Advanced joins (VMs ‚Üí NICs ‚Üí Disks ‚Üí Subnets ‚Üí Subscriptions)<br />
- ‚úÖ Enterprise-scale tested on 31,000+ resources<br />
- ‚úÖ Performance optimization for massive environments<br />
- ‚úÖ SQL to KQL translation guide<br />
- ‚úÖ Lifetime updates</p>
<p><strong>Launch price: $19</strong> (regular $29)</p>
<p><a href="https://davidnoob.gumroad.com/l/hooih">Get the Complete KQL Library ‚Üí</a></p>
<hr />
  </div>

  
  <section class="starter-kit-callout" style="
    max-width: 800px;
    margin: 3rem auto 2rem;
    padding: 2rem;
    border-radius: 12px;
    background: var(--bg-light);
    border: 1px solid var(--border);
    text-align: left;
  ">
    <h3 style="margin-top: 0;">Azure Admin Starter Kit (Free Download)</h3>
    <p style="margin-bottom: 1rem;">
      Get my KQL cheat sheet, 50 Windows + 50 Linux commands, and an Azure RACI template in one free bundle.
    </p>
    <a href="/blog/starter-kit/" class="btn">Get the Starter Kit ‚Üí</a>
  </section>

  
  <aside class="email-capture" style="max-width: 800px; margin: 4rem auto; padding: 3rem; background: linear-gradient(135deg, #0078d4 0%, #005a9e 100%); border-radius: 12px; text-align: center; color: white;">
    <h3 style="margin-top: 0; color: white; font-size: 1.75rem;">Get Azure operational guides in your inbox</h3>
    <p style="margin: 1rem 0 2rem; font-size: 1.1rem; color: white;">Weekly tips from managing 44 Azure subscriptions. No marketing BS.</p>
    
    <form action="https://app.kit.com/forms/8896829/subscriptions" method="post" style="max-width: 500px; margin: 0 auto; display: flex; gap: 0.75rem; flex-wrap: wrap; justify-content: center;">
      <input type="email" 
             name="email_address" 
             placeholder="your@email.com" 
             required 
             style="flex: 1; min-width: 250px; padding: 0.875rem 1rem; border: none; border-radius: 8px; font-size: 1rem; color: #333;">
      <button type="submit" 
              style="padding: 0.875rem 2rem; background: white; color: #0078d4; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; white-space: nowrap; font-size: 1rem; transition: all 0.2s;">
        Subscribe
      </button>
    </form>
    
    <p style="margin: 1.5rem 0 0; font-size: 0.9rem; opacity: 0.9; color: white;">
      Join 500+ Azure admins. Unsubscribe anytime.
    </p>
  </aside>

  
  
  <aside class="related-posts" style="max-width: 800px; margin: 3rem auto; padding: 2rem; background: var(--bg-light); border-radius: 12px;">
    <h3 style="margin-top: 0;">Related Posts</h3>
    <ul style="list-style: none; padding: 0;">
      
      <li style="margin: 1rem 0;">
        <a href="/blog/azure-command-finder/" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">Azure Command Finder - Interactive Troubleshooting Tool</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-12-09</span>
        </a>
      </li>
      
      <li style="margin: 1rem 0;">
        <a href="/blog/50-linux-commands-azure/" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">50 Essential Linux Commands for Azure Admins (Complete 2025 Guide)</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-12-08</span>
        </a>
      </li>
      
      <li style="margin: 1rem 0;">
        <a href="/blog/azure-vm-automation-dependency-hell/" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">Why Your Automation Fails on Fresh Azure VMs (And How I Fixed It)</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-09-29</span>
        </a>
      </li>
      
    </ul>
  </aside>
  

  
  
  
    <!-- CTA: General Email Capture (KIT INLINE FORM) -->
<div class="cta-block" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: 2rem; border-radius: 12px; margin: 3rem 0; text-align: center; color: white;">
  <h3 style="margin: 0 0 0.5rem; font-size: 1.5rem; color: white;">Get Azure operational guides in your inbox</h3>
  <p style="margin: 0 0 1.5rem; font-size: 1rem; line-height: 1.5; color: white;">
    Weekly tips from managing 44 Azure subscriptions. No marketing BS.
  </p>
  
  <!-- Kit inline form - no JavaScript conflicts -->
  <form action="https://app.kit.com/forms/7867186/subscriptions" method="post" style="max-width: 500px; margin: 0 auto; display: flex; gap: 0.5rem; flex-wrap: wrap; justify-content: center;">
    <input type="email" 
           name="email_address" 
           placeholder="your@email.com" 
           required 
           style="flex: 1; min-width: 250px; padding: 0.75rem 1rem; border: none; border-radius: 6px; font-size: 1rem; color: #333;">
    <button type="submit" 
            style="padding: 0.75rem 1.5rem; background: white; color: #4facfe; border: none; border-radius: 6px; font-weight: 700; cursor: pointer; white-space: nowrap; font-size: 1rem;">
      Subscribe
    </button>
  </form>
  
  <p style="margin: 1rem 0 0; font-size: 0.85rem; opacity: 0.9; color: white;">
    Join 500+ Azure admins. Unsubscribe anytime.
  </p>
</div>
  

  
  <nav class="post-nav">
    
      <a href="/blog/azure-cost-optimization-what-actually-works/">
        <span style="opacity: 0.7; font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">‚Üê Previous</span>
        <strong>Azure Cost Optimization 2025: Hidden Costs &amp; What Actually Works</strong>
      </a>
    
    
      <a href="/blog/50-linux-commands-azure/" style="text-align: right;">
        <span style="opacity: 0.7; font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">Next ‚Üí</span>
        <strong>50 Essential Linux Commands for Azure Admins (Complete 2025 Guide)</strong>
      </a>
    
  </nav>

</article>

    </div>
  </main>

  <footer class="site-footer">
    <div class="wrap">
      
      <!-- Featured Bundle Promotion - TEMPORARILY DISABLED
      <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 2rem; border-radius: 8px; margin-bottom: 2rem; text-align: center; color: white;">
        <h3 style="color: white; margin: 0 0 0.75rem 0; font-size: 1.5rem;">üì¶ Enterprise Azure Operations Bundle</h3>
        <p style="font-size: 1.05rem; margin: 0 0 1rem 0; opacity: 0.95;">
          Get all 4 digital products for <strong style="font-size: 1.25rem;">$97</strong> <span style="text-decoration: line-through; opacity: 0.7;">($86 separately)</span>
        </p>
        <ul style="list-style: none; padding: 0; margin: 1rem 0 1.5rem; text-align: left; max-width: 500px; margin-left: auto; margin-right: auto; font-size: 0.95rem;">
          <li style="padding: 0.35rem 0;">‚úîÔ∏è Azure AI FinOps Query Pack (12 production KQL queries)</li>
          <li style="padding: 0.35rem 0;">‚úîÔ∏è Azure Migration Assessment Pro (55-question framework)</li>
          <li style="padding: 0.35rem 0;">‚úîÔ∏è Azure CAF Operations RACI Pro (Governance matrix)</li>
          <li style="padding: 0.35rem 0;">‚úîÔ∏è Enterprise Azure Inventory KQL Pack (Tested on 30K+ resources)</li>
        </ul>
        <a href="https://davidnoob.gumroad.com/l/azure-ops-bundle" 
           style="display: inline-block; padding: 0.875rem 2rem; background: white; color: #667eea; text-decoration: none; border-radius: 6px; font-weight: 700; font-size: 1.05rem; box-shadow: 0 4px 12px rgba(0,0,0,0.2);" 
           target="_blank" rel="noopener">
          Get the Bundle ‚Üí
        </a>
        <p style="margin: 1rem 0 0; font-size: 0.85rem; opacity: 0.9;">
          Instant digital delivery ‚Ä¢ Lifetime updates ‚Ä¢ Money-back guarantee
        </p>
      </div>
      -->
      
      <p>&copy; 2026 Azure Noob ‚Äî Don&#39;t be a Noob</p>
      <p style="margin-top: 0.5rem; font-size: 0.9rem;">
        <a href="/rss.xml" title="Subscribe via RSS">RSS Feed</a> ¬∑ 
        <a href="https://github.com/dswann101164" target="_blank" rel="noopener">GitHub</a>
      </p>
      <p style="margin-top: 1.5rem; font-size: 0.85rem; opacity: 0.7; font-style: italic;">
        "Trust in the Lord with all your heart, and lean not on your own understanding;<br>
        in all your ways acknowledge Him, and He will make your paths straight" ‚Äî Proverbs 3:5-6
      </p>
    </div>
  </footer>

  <!-- Copy code functionality -->
  <script src="/static/copy-code.js"></script>

  <!-- Exit-Intent Popup -->
  <div id="exit-popup" class="exit-popup" style="display: none;">
    <div class="exit-popup-content">
      <button class="exit-popup-close" onclick="closeExitPopup()">&times;</button>
      <h2>Wait! Before You Go...</h2>
      <p class="exit-popup-subtitle">Get the <strong>FREE Azure Admin Starter Kit</strong></p>
      <ul class="exit-popup-benefits">
        <li>‚úì 15 Essential KQL Queries</li>
        <li>‚úì 50 Windows Commands</li>
        <li>‚úì 50 Linux Commands</li>
      </ul>
      <form id="exit-popup-form" class="exit-popup-form">
        <input type="email" id="popup-email" placeholder="Enter your email" required>
        <button type="submit" class="exit-popup-submit">Send Me The Free Kit</button>
      </form>
      <p class="exit-popup-privacy">We'll also notify you about new tools & guides. Unsubscribe anytime.</p>
    </div>
  </div>

  <style>
  .exit-popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .exit-popup-content {
    background: white;
    padding: 2.5rem;
    border-radius: 12px;
    max-width: 500px;
    width: 90%;
    position: relative;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: slideUp 0.3s ease;
  }

  @keyframes slideUp {
    from { transform: translateY(50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .exit-popup-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    font-size: 2rem;
    cursor: pointer;
    color: #999;
    line-height: 1;
  }

  .exit-popup-close:hover {
    color: #333;
  }

  .exit-popup h2 {
    margin: 0 0 0.5rem 0;
    color: #0078d4;
    font-size: 2rem;
  }

  .exit-popup-subtitle {
    font-size: 1.2rem;
    margin: 0 0 1.5rem 0;
  }

  .exit-popup-benefits {
    list-style: none;
    padding: 0;
    margin: 1.5rem 0;
  }

  .exit-popup-benefits li {
    padding: 0.5rem 0;
    font-size: 1.1rem;
  }

  .exit-popup-form {
    margin: 1.5rem 0;
  }

  .exit-popup-form input[type="email"] {
    width: 100%;
    padding: 1rem;
    border: 2px solid #ddd;
    border-radius: 6px;
    font-size: 1rem;
    margin-bottom: 1rem;
  }

  .exit-popup-form input[type="email"]:focus {
    outline: none;
    border-color: #0078d4;
  }

  .exit-popup-submit {
    width: 100%;
    padding: 1rem 2rem;
    background: #0078d4;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 1.1rem;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s;
  }

  .exit-popup-submit:hover {
    background: #005a9e;
  }

  .exit-popup-privacy {
    font-size: 0.85rem;
    color: #666;
    margin-top: 1rem;
    text-align: center;
  }
  </style>

  <script>
  // Exit-intent detection
  let exitPopupShown = false;
  let mouseY = 0;

  document.addEventListener('mousemove', (e) => {
    mouseY = e.clientY;
  });

  document.addEventListener('mouseout', (e) => {
    // If mouse leaves through top of viewport and popup hasn't been shown
    if (!exitPopupShown && e.clientY <= 0 && mouseY <= 100) {
      // Check if user has seen it before (session storage)
      if (!sessionStorage.getItem('exitPopupSeen')) {
        showExitPopup();
      }
    }
  });

  function showExitPopup() {
    exitPopupShown = true;
    document.getElementById('exit-popup').style.display = 'flex';
    sessionStorage.setItem('exitPopupSeen', 'true');
  }

  function closeExitPopup() {
    document.getElementById('exit-popup').style.display = 'none';
  }

  // Handle form submission
  document.getElementById('exit-popup-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('popup-email').value;
    
    // Send to Kit (ConvertKit)
    try {
      const FORM_ID = '8896829'; // Your Kit Form ID
      
      const response = await fetch(`https://api.convertkit.com/v3/forms/${FORM_ID}/subscribe`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          email: email
        })
      });
      
      if (response.ok) {
        console.log('‚úÖ Email captured to Kit:', email);
      }
      
      closeExitPopup();
      
      // Track in Google Analytics
      if (typeof gtag !== 'undefined') {
        gtag('event', 'signup', {
          'event_category': 'email',
          'event_label': 'exit_popup',
          'value': email
        });
      }
      
      // Redirect to starter kit page
      window.location.href = '/blog/starter-kit/';
      
    } catch (error) {
      console.error('Error:', error);
      // Still redirect even if tracking fails
      window.location.href = '/blog/starter-kit/';
    }
  });

  // Close on background click
  document.getElementById('exit-popup').addEventListener('click', (e) => {
    if (e.target.id === 'exit-popup') {
      closeExitPopup();
    }
  });
  </script>
</body>
</html>