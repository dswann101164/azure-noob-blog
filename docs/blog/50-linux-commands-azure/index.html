<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  

  <!-- Primary SEO -->
  <title>50 Linux Commands for Azure (However You Deploy) ¬∑ Azure Noob</title>
  <meta name="description" content="The essential Linux commands every Azure administrator needs‚Äîwhether you use the Portal, PowerShell, or IaC. Includes Active Directory domain join for...">
  <link rel="canonical" href="https://azure-noob.com/blog/50-linux-commands-azure" />

  <!-- Favicons -->
  <link rel="icon" href="/static/images/logo.png">

  <!-- Open Graph -->
  <meta property="og:title" content="50 Linux Commands for Azure (However You Deploy)">
  <meta property="og:description" content="The essential Linux commands every Azure administrator needs‚Äîwhether you use the Portal, PowerShell, or IaC. Includes Active Directory domain join for...">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://azure-noob.com/blog/50-linux-commands-azure">
  <meta property="og:image" content="https://azure-noob.com/static/images/hero/linux-commands-azure.png">

  
    <meta property="article:published_time" content="2025-12-08T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-12-08T00:00:00+00:00">
    <meta property="article:author" content="David Swann">
    
      
        <meta property="article:tag" content="azure">
      
        <meta property="article:tag" content="linux">
      
        <meta property="article:tag" content="operations">
      
        <meta property="article:tag" content="active-directory">
      
        <meta property="article:tag" content="troubleshooting">
      
        <meta property="article:tag" content="commands">
      
    
  

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="50 Linux Commands for Azure (However You Deploy)">
  <meta name="twitter:description" content="The essential Linux commands every Azure administrator needs‚Äîwhether you use the Portal, PowerShell, or IaC. Includes Active Directory domain join for...">
  <meta name="twitter:image" content="https://azure-noob.com/static/images/hero/linux-commands-azure.png">

  <!-- Styles -->
  <link rel="stylesheet" href="/static/styles.css">

  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="Azure Noob RSS Feed" href="https://azure-noob.com/rss.xml">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZNHGEB0BNZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-ZNHGEB0BNZ');
  </script>
</head>
<body>
  <header class="site-header">
    <div class="wrap nav-wrap">
      <div class="brand-block">
        <a href="/" class="brand-link">
          <img src="/static/images/logo.png" alt="Azure Noob logo" class="logo">
        </a>
        <span class="brand-text">
          <small>Official Website of</small>
          <strong>Azure Noob</strong>
        </span>
      </div>
      <nav class="nav">
        <a href="/">Home</a>
        <a href="/blog/">Blog</a>
        <a href="/hubs/" style="font-weight: 700;">Content Hubs</a>
        <a href="/start-here">Start Here</a>
        <a href="/blog/starter-kit/">Starter Kit</a>
        <a href="/about">About</a>
        <a href="/tags/">Tags</a>
        <a href="https://github.com/dswann101164" target="_blank" rel="noopener">GitHub</a>
        <a href="/search">Search</a>
      </nav>
    </div>
  </header>

  <main class="site-content">
    <div class="wrap">
      


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "50 Linux Commands for Azure (However You Deploy)",
  "description": "The essential Linux commands every Azure administrator needs‚Äîwhether you use the Portal, PowerShell, or IaC. Includes Active Directory domain join for...",
  "image": {
    "@type": "ImageObject",
    "url": "https://azure-noob.com/static/images/hero/linux-commands-azure.png",
    "width": 1200,
    "height": 630
  },
  "author": {
    "@type": "Person",
    "name": "David Swann",
    "url": "https://azure-noob.com/about/",
    "description": "Azure Architect specializing in enterprise cloud infrastructure",
    "jobTitle": "Azure Architect",
    "worksFor": {
      "@type": "Organization",
      "name": "Synovus"
    }
  },
  "publisher": {
    "@type": "Organization",
    "name": "Azure Noob",
    "url": "https://azure-noob.com",
    "logo": {
      "@type": "ImageObject",
      "url": "https://azure-noob.com/static/images/logo.png"
    }
  },
  "datePublished": "2025-12-08T00:00:00+00:00",
  "dateModified": "2025-12-08T00:00:00+00:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://azure-noob.com/blog/50-linux-commands-azure"
  },
  "keywords": "azure, linux, operations, active-directory, troubleshooting, commands",
  "articleSection": "azure",
  "wordCount": "5641",
  "timeRequired": "PT28M",
  "inLanguage": "en-US",
  "isAccessibleForFree": "True",
  "about": {
    "@type": "Thing",
    "name": "azure"
  }
}
</script>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://azure-noob.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": "https://azure-noob.com/blog/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "50 Linux Commands for Azure (However You Deploy)",
      "item": "https://azure-noob.com/blog/50-linux-commands-azure"
    }
  ]
}
</script>




<article class="post">

  
  
    
    <div class="hero">
      <img src="/static/images/hero/linux-commands-azure.png" alt="50 Linux Commands for Azure (However You Deploy)" loading="eager">
    </div>
  

  <header class="post-header">
    <h1>50 Linux Commands for Azure (However You Deploy)</h1>
    <p class="muted">
      2025-12-08 ¬∑ ~28 min read
      
    </p>
    
    
    <ul class="tags-list">
      
      <li><a href="/tags/azure" class="tag-badge">azure</a></li>
      
      <li><a href="/tags/linux" class="tag-badge">linux</a></li>
      
      <li><a href="/tags/operations" class="tag-badge">operations</a></li>
      
      <li><a href="/tags/active-directory" class="tag-badge">active-directory</a></li>
      
      <li><a href="/tags/troubleshooting" class="tag-badge">troubleshooting</a></li>
      
      <li><a href="/tags/commands" class="tag-badge">commands</a></li>
      
    </ul>
    
    
    
      <p class="summary">The essential Linux commands every Azure administrator needs‚Äîwhether you use the Portal, PowerShell, or IaC. Includes Active Directory domain join for enterprise environments.</p>
    
  </header>

  
  <p class="post-actions" style="margin:.5rem 0 0; text-align: center;">
    <button class="btn"
            onclick="window.print(); return false;"
            title="Print this page"
            aria-label="Print this page"
            style="cursor: pointer; background: none; border: 2px solid var(--azure-blue);">
      üñ®Ô∏è Print this page
    </button>
  </p>

  
  <div class="post-body">
    <p>Whether you deploy Azure VMs through the Portal, PowerShell, ARM templates, or Terraform‚Äîeventually you'll SSH in to troubleshoot something. The deployment succeeded, the Portal shows green checkmarks, but users can't authenticate, disks aren't mounted, or network connectivity mysteriously stopped working.</p>
<p>This is when you need actual Linux commands.</p>
<p>This guide covers the 50 commands that bridge the gap between successful deployment and operational readiness. These are the commands I use daily managing Azure infrastructure in a regulated banking environment.</p>
<h2>Who This is For</h2>
<ul>
<li>Azure administrators managing Linux VMs</li>
<li>Anyone who's ever seen "Deployment succeeded" but things don't work</li>
<li>Enterprise environments with Active Directory requirements</li>
<li>Operations teams bridging cloud and traditional infrastructure</li>
</ul>
<h2>Table of Contents</h2>
<ol>
<li><a href="#azure-basics">Azure-Specific Basics</a></li>
<li><a href="#system-admin">System Administration</a></li>
<li><a href="#networking">Networking</a></li>
<li><a href="#file-operations">File Operations</a></li>
<li><a href="#disk-operations">Azure Disk Operations</a></li>
<li><a href="#security-logs">Security &amp; Logs</a></li>
<li><a href="#azure-cli">Azure CLI</a></li>
<li><a href="#active-directory">Active Directory Domain Join</a> (Enterprise)</li>
<li><a href="#quick-reference">Quick Reference</a></li>
</ol>
<hr />
<h2><a name="azure-basics"></a>Part 1: Azure-Specific Basics</h2>
<h3>Azure VM Agent &amp; Extensions</h3>
<p>The Azure VM Agent enables extensions, monitoring, and management. When extensions won't install or Azure automation fails, start here:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check agent status</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>walinuxagent

<span class="c1"># View agent logs</span>
sudo<span class="w"> </span>tail<span class="w"> </span>-f<span class="w"> </span>/var/log/waagent.log

<span class="c1"># Restart agent</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>walinuxagent

<span class="c1"># Check which extensions are installed</span>
sudo<span class="w"> </span>ls<span class="w"> </span>-la<span class="w"> </span>/var/lib/waagent/
</code></pre></div>

<p><strong>Common issue:</strong> "Custom Script Extension shows as succeeded but my script didn't run."</p>
<p>Check the actual extension logs:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># View extension handler logs</span>
sudo<span class="w"> </span>cat<span class="w"> </span>/var/log/azure/custom-script/handler.log

<span class="c1"># Check extension status files</span>
sudo<span class="w"> </span>cat<span class="w"> </span>/var/lib/waagent/Microsoft.Azure.Extensions.CustomScript*/status/*.status

<span class="c1"># Look for exit codes</span>
sudo<span class="w"> </span>cat<span class="w"> </span>/var/lib/waagent/Microsoft.Azure.Extensions.CustomScript*/status/*.status<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>exitCode
</code></pre></div>

<h3>Azure Instance Metadata Service (IMDS)</h3>
<p>Query VM metadata and managed identity tokens:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get VM metadata</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Metadata:true&quot;</span><span class="w"> </span><span class="s2">&quot;http://169.254.169.254/metadata/instance?api-version=2021-02-01&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq

<span class="c1"># Get managed identity token</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Metadata:true&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">&quot;http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01&amp;resource=https://management.azure.com/&quot;</span>

<span class="c1"># Check if VM has managed identity</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Metadata:true&quot;</span><span class="w"> </span><span class="s2">&quot;http://169.254.169.254/metadata/instance/compute/identity?api-version=2021-02-01&quot;</span>
</code></pre></div>

<h3>cloud-init Troubleshooting</h3>
<p>If you used custom_data for VM initialization:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check cloud-init logs</span>
sudo<span class="w"> </span>tail<span class="w"> </span>-f<span class="w"> </span>/var/log/cloud-init-output.log
sudo<span class="w"> </span>cat<span class="w"> </span>/var/log/cloud-init.log

<span class="c1"># Check cloud-init status</span>
sudo<span class="w"> </span>cloud-init<span class="w"> </span>status

<span class="c1"># Re-run cloud-init (testing only!)</span>
sudo<span class="w"> </span>cloud-init<span class="w"> </span>clean
sudo<span class="w"> </span>cloud-init<span class="w"> </span>init
</code></pre></div>

<blockquote>
<p><strong>üíº Enterprise Callout: Active Directory Domain Join</strong></p>
<p>If you need to join Azure VMs to Active Directory for centralized authentication:<br />
```bash</p>
<h1>Quick test if domain join succeeded</h1>
<p>sudo realm list<br />
getent passwd username@DOMAIN.COM<br />
```</p>
<p><a href="#active-directory">Jump to full Active Directory guide ‚Üí</a></p>
</blockquote>
<hr />
<h2><a name="system-admin"></a>Part 2: System Administration</h2>
<h3>Process &amp; Performance Monitoring</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Real-time process monitoring</span>
top
htop<span class="w">  </span><span class="c1"># Install with: apt install htop</span>

<span class="c1"># List all processes</span>
ps<span class="w"> </span>aux
ps<span class="w"> </span>-ef

<span class="c1"># Check specific service status</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>sshd
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>azuremonitoragent

<span class="c1"># View service logs</span>
sudo<span class="w"> </span>journalctl<span class="w"> </span>-u<span class="w"> </span>sshd
sudo<span class="w"> </span>journalctl<span class="w"> </span>-u<span class="w"> </span>walinuxagent<span class="w"> </span>--since<span class="w"> </span><span class="s2">&quot;1 hour ago&quot;</span>

<span class="c1"># Follow logs in real-time</span>
sudo<span class="w"> </span>journalctl<span class="w"> </span>-u<span class="w"> </span>sshd<span class="w"> </span>-f
</code></pre></div>

<h3>System Resource Checks</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Disk usage</span>
df<span class="w"> </span>-h
du<span class="w"> </span>-sh<span class="w"> </span>/var/log/*

<span class="c1"># Memory usage</span>
free<span class="w"> </span>-h
vmstat<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">5</span>

<span class="c1"># System uptime and load</span>
uptime

<span class="c1"># CPU information</span>
lscpu
cat<span class="w"> </span>/proc/cpuinfo

<span class="c1"># Check for high CPU processes</span>
top<span class="w"> </span>-b<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-20
</code></pre></div>

<h3>User &amp; Permission Management</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Execute as root</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>sshd

<span class="c1"># Change file permissions</span>
chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span>script.sh
chmod<span class="w"> </span><span class="m">600</span><span class="w"> </span>/etc/sssd/sssd.conf

<span class="c1"># Change file ownership</span>
sudo<span class="w"> </span>chown<span class="w"> </span>azureuser:azureuser<span class="w"> </span>/datadisk
sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>www-data:www-data<span class="w"> </span>/var/www/html

<span class="c1"># Add user</span>
sudo<span class="w"> </span>useradd<span class="w"> </span>-m<span class="w"> </span>-s<span class="w"> </span>/bin/bash<span class="w"> </span>newuser

<span class="c1"># Modify user</span>
sudo<span class="w"> </span>usermod<span class="w"> </span>-aG<span class="w"> </span>sudo<span class="w"> </span>newuser

<span class="c1"># Set/change password</span>
sudo<span class="w"> </span>passwd<span class="w"> </span>newuser

<span class="c1"># Check user info</span>
id<span class="w"> </span>username
groups<span class="w"> </span>username
</code></pre></div>

<hr />
<h2><a name="networking"></a>Part 3: Networking</h2>
<h3>Connectivity Testing</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Test basic connectivity</span>
ping<span class="w"> </span><span class="m">8</span>.8.8.8
ping<span class="w"> </span>DC01.CONTOSO.COM

<span class="c1"># HTTP requests</span>
curl<span class="w"> </span>https://azure.microsoft.com
wget<span class="w"> </span>https://example.com/file.tar.gz

<span class="c1"># Test specific port</span>
nc<span class="w"> </span>-zv<span class="w"> </span><span class="m">10</span>.0.0.4<span class="w"> </span><span class="m">22</span>
telnet<span class="w"> </span><span class="m">10</span>.0.0.4<span class="w"> </span><span class="m">389</span>

<span class="c1"># Trace network route</span>
traceroute<span class="w"> </span>azure.microsoft.com

<span class="c1"># DNS lookup</span>
nslookup<span class="w"> </span>DC01.CONTOSO.COM
dig<span class="w"> </span>DC01.CONTOSO.COM

<span class="c1"># Check DNS configuration</span>
cat<span class="w"> </span>/etc/resolv.conf
</code></pre></div>

<h3>Network Status &amp; Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Show network interfaces (modern)</span>
ip<span class="w"> </span>addr<span class="w"> </span>show
ip<span class="w"> </span>link<span class="w"> </span>show

<span class="c1"># Show routing table</span>
ip<span class="w"> </span>route<span class="w"> </span>show

<span class="c1"># Show listening ports and connections</span>
ss<span class="w"> </span>-tulpn
ss<span class="w"> </span>-tulpn<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>LISTEN

<span class="c1"># Legacy netstat (if installed)</span>
netstat<span class="w"> </span>-tulpn
netstat<span class="w"> </span>-an<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>ESTABLISHED
</code></pre></div>

<h3>Firewall Management</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Ubuntu/Debian - UFW</span>
sudo<span class="w"> </span>ufw<span class="w"> </span>status
sudo<span class="w"> </span>ufw<span class="w"> </span>allow<span class="w"> </span><span class="m">22</span>/tcp
sudo<span class="w"> </span>ufw<span class="w"> </span><span class="nb">enable</span>

<span class="c1"># RHEL/CentOS - firewalld</span>
sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--list-all
sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--add-port<span class="o">=</span><span class="m">80</span>/tcp<span class="w"> </span>--permanent
sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--reload

<span class="c1"># iptables (legacy but still used)</span>
sudo<span class="w"> </span>iptables<span class="w"> </span>-L<span class="w"> </span>-n<span class="w"> </span>-v
sudo<span class="w"> </span>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">22</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
</code></pre></div>

<p><strong>Important:</strong> Azure NSG rules take precedence over VM-level firewalls. If you can't connect, check both.</p>
<hr />
<h2><a name="file-operations"></a>Part 4: File Operations</h2>
<h3>Navigation &amp; Viewing</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># List files with details</span>
ls<span class="w"> </span>-la
ls<span class="w"> </span>-lh<span class="w">  </span><span class="c1"># Human-readable sizes</span>
ls<span class="w"> </span>-lt<span class="w">  </span><span class="c1"># Sort by time</span>

<span class="c1"># Change directory</span>
<span class="nb">cd</span><span class="w"> </span>/var/log
<span class="nb">cd</span><span class="w"> </span>~<span class="w">  </span><span class="c1"># Home directory</span>
<span class="nb">cd</span><span class="w"> </span>-<span class="w">  </span><span class="c1"># Previous directory</span>

<span class="c1"># Show current directory</span>
<span class="nb">pwd</span>

<span class="c1"># View files</span>
cat<span class="w"> </span>/etc/hosts
less<span class="w"> </span>/var/log/syslog
more<span class="w"> </span>/etc/fstab

<span class="c1"># View file with line numbers</span>
cat<span class="w"> </span>-n<span class="w"> </span>/etc/ssh/sshd_config

<span class="c1"># Follow log file in real-time</span>
tail<span class="w"> </span>-f<span class="w"> </span>/var/log/syslog
tail<span class="w"> </span>-f<span class="w"> </span>/var/log/auth.log

<span class="c1"># View first/last lines</span>
head<span class="w"> </span>-20<span class="w"> </span>/var/log/syslog
tail<span class="w"> </span>-50<span class="w"> </span>/var/log/syslog
</code></pre></div>

<h3>Searching</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Find files</span>
find<span class="w"> </span>/var/log<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.log&quot;</span>
find<span class="w"> </span>/home<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-mtime<span class="w"> </span>-7<span class="w">  </span><span class="c1"># Modified in last 7 days</span>
find<span class="w"> </span>/<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;waagent.log&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null

<span class="c1"># Search text in files</span>
grep<span class="w"> </span><span class="s2">&quot;error&quot;</span><span class="w"> </span>/var/log/syslog
grep<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;Failed&quot;</span><span class="w"> </span>/var/log/
grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;authentication failure&quot;</span><span class="w"> </span>/var/log/auth.log

<span class="c1"># Search with context</span>
grep<span class="w"> </span>-A<span class="w"> </span><span class="m">5</span><span class="w"> </span>-B<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="s2">&quot;error&quot;</span><span class="w"> </span>logfile.txt
</code></pre></div>

<h3>File Management</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Copy files</span>
cp<span class="w"> </span>file1.txt<span class="w"> </span>file2.txt
cp<span class="w"> </span>-r<span class="w"> </span>/source/dir<span class="w"> </span>/destination/dir

<span class="c1"># Move/rename</span>
mv<span class="w"> </span>oldname.txt<span class="w"> </span>newname.txt
mv<span class="w"> </span>/tmp/file.txt<span class="w"> </span>/home/user/

<span class="c1"># Delete files</span>
rm<span class="w"> </span>file.txt
rm<span class="w"> </span>-rf<span class="w"> </span>/tmp/olddata/<span class="w">  </span><span class="c1"># Careful with -rf!</span>

<span class="c1"># Create empty file</span>
touch<span class="w"> </span>newfile.txt

<span class="c1"># Create directory</span>
mkdir<span class="w"> </span>/datadisk/backups
mkdir<span class="w"> </span>-p<span class="w"> </span>/data/app/logs<span class="w">  </span><span class="c1"># Create parent dirs</span>
</code></pre></div>

<h3>Archive Operations</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create tar archive</span>
tar<span class="w"> </span>-czf<span class="w"> </span>backup.tar.gz<span class="w"> </span>/var/www/html/

<span class="c1"># Extract tar archive</span>
tar<span class="w"> </span>-xzf<span class="w"> </span>backup.tar.gz
tar<span class="w"> </span>-xzf<span class="w"> </span>backup.tar.gz<span class="w"> </span>-C<span class="w"> </span>/destination/

<span class="c1"># List tar contents</span>
tar<span class="w"> </span>-tzf<span class="w"> </span>backup.tar.gz

<span class="c1"># Zip/unzip</span>
zip<span class="w"> </span>-r<span class="w"> </span>archive.zip<span class="w"> </span>/path/to/dir
unzip<span class="w"> </span>archive.zip
</code></pre></div>

<hr />
<h2><a name="disk-operations"></a>Part 5: Azure Disk Operations</h2>
<p>When you attach a managed disk via Portal, PowerShell, or IaC, it shows as "attached" but isn't mounted. Here's how to make it usable:</p>
<h3>Check Attached Disks</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># List block devices</span>
lsblk

<span class="c1"># Show all disks and partitions</span>
sudo<span class="w"> </span>fdisk<span class="w"> </span>-l

<span class="c1"># Show disk UUIDs</span>
sudo<span class="w"> </span>blkid
</code></pre></div>

<h3>Partition, Format, and Mount</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Partition the disk (interactive)</span>
sudo<span class="w"> </span>fdisk<span class="w"> </span>/dev/sdc
<span class="c1"># Commands: n (new), p (primary), 1 (partition number), enter, enter, w (write)</span>

<span class="c1"># Format with ext4</span>
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/sdc1

<span class="c1"># Create mount point</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>/datadisk

<span class="c1"># Mount temporarily</span>
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sdc1<span class="w"> </span>/datadisk

<span class="c1"># Verify mount</span>
df<span class="w"> </span>-h
mount<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>sdc
</code></pre></div>

<h3>Make Mount Permanent</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get UUID</span>
sudo<span class="w"> </span>blkid<span class="w"> </span>/dev/sdc1
<span class="c1"># Output: /dev/sdc1: UUID=&quot;abc123...&quot; TYPE=&quot;ext4&quot;</span>

<span class="c1"># Add to fstab</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;UUID=abc123-def456 /datadisk ext4 defaults,nofail 0 0&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/fstab

<span class="c1"># Test fstab (doesn&#39;t actually mount)</span>
sudo<span class="w"> </span>findmnt<span class="w"> </span>--verify

<span class="c1"># Test mount all</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-a

<span class="c1"># Verify</span>
df<span class="w"> </span>-h<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>datadisk
</code></pre></div>

<p><strong>Important:</strong> Always use <code>nofail</code> option in fstab for data disks. Otherwise, if the disk fails to mount, the VM won't boot.</p>
<hr />
<h2><a name="security-logs"></a>Part 6: Security &amp; Logs</h2>
<h3>Log Files</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># System logs</span>
sudo<span class="w"> </span>tail<span class="w"> </span>-f<span class="w"> </span>/var/log/syslog<span class="w">        </span><span class="c1"># Ubuntu/Debian</span>
sudo<span class="w"> </span>tail<span class="w"> </span>-f<span class="w"> </span>/var/log/messages<span class="w">      </span><span class="c1"># RHEL/CentOS</span>

<span class="c1"># Authentication logs</span>
sudo<span class="w"> </span>tail<span class="w"> </span>-f<span class="w"> </span>/var/log/auth.log<span class="w">      </span><span class="c1"># Ubuntu/Debian</span>
sudo<span class="w"> </span>tail<span class="w"> </span>-f<span class="w"> </span>/var/log/secure<span class="w">        </span><span class="c1"># RHEL/CentOS</span>

<span class="c1"># Azure-specific logs</span>
sudo<span class="w"> </span>tail<span class="w"> </span>-f<span class="w"> </span>/var/log/waagent.log
sudo<span class="w"> </span>tail<span class="w"> </span>-f<span class="w"> </span>/var/log/azure/custom-script/handler.log

<span class="c1"># Kernel logs</span>
dmesg
dmesg<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>error

<span class="c1"># Boot logs</span>
sudo<span class="w"> </span>journalctl<span class="w"> </span>-b
</code></pre></div>

<h3>Security Checks</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check login history</span>
last
last<span class="w"> </span>-a<span class="w">  </span><span class="c1"># Show hostname</span>
lastb<span class="w">    </span><span class="c1"># Failed login attempts</span>

<span class="c1"># Currently logged in users</span>
who
w

<span class="c1"># Check sudo permissions</span>
sudo<span class="w"> </span>-l

<span class="c1"># View failed authentication attempts</span>
sudo<span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;Failed password&quot;</span><span class="w"> </span>/var/log/auth.log
sudo<span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;authentication failure&quot;</span><span class="w"> </span>/var/log/auth.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-20

<span class="c1"># Check for suspicious activity</span>
sudo<span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;session opened&quot;</span><span class="w"> </span>/var/log/auth.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;azureuser&quot;</span>
</code></pre></div>

<hr />
<h2><a name="azure-cli"></a>Part 7: Azure CLI Commands</h2>
<p>Install Azure CLI:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Ubuntu/Debian</span>
curl<span class="w"> </span>-sL<span class="w"> </span>https://aka.ms/InstallAzureCLIDeb<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>bash

<span class="c1"># RHEL/CentOS</span>
sudo<span class="w"> </span>rpm<span class="w"> </span>--import<span class="w"> </span>https://packages.microsoft.com/keys/microsoft.asc
sudo<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;echo -e &quot;[azure-cli]\nname=Azure CLI\nbaseurl=https://packages.microsoft.com/yumrepos/azure-cli\nenabled=1\ngpgcheck=1\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc&quot; &gt; /etc/yum.repos.d/azure-cli.repo&#39;</span>
sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>azure-cli
</code></pre></div>

<p>Common operations:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Login</span>
az<span class="w"> </span>login
az<span class="w"> </span>login<span class="w"> </span>--identity<span class="w">  </span><span class="c1"># Using managed identity</span>

<span class="c1"># Show current subscription</span>
az<span class="w"> </span>account<span class="w"> </span>show

<span class="c1"># List subscriptions</span>
az<span class="w"> </span>account<span class="w"> </span>list<span class="w"> </span>--output<span class="w"> </span>table

<span class="c1"># Switch subscription</span>
az<span class="w"> </span>account<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--subscription<span class="w"> </span><span class="s2">&quot;Production&quot;</span>

<span class="c1"># List VMs</span>
az<span class="w"> </span>vm<span class="w"> </span>list<span class="w"> </span>--output<span class="w"> </span>table
az<span class="w"> </span>vm<span class="w"> </span>list<span class="w"> </span>--resource-group<span class="w"> </span>myRG<span class="w"> </span>--output<span class="w"> </span>table

<span class="c1"># VM operations</span>
az<span class="w"> </span>vm<span class="w"> </span>start<span class="w"> </span>--resource-group<span class="w"> </span>myRG<span class="w"> </span>--name<span class="w"> </span>myVM
az<span class="w"> </span>vm<span class="w"> </span>stop<span class="w"> </span>--resource-group<span class="w"> </span>myRG<span class="w"> </span>--name<span class="w"> </span>myVM
az<span class="w"> </span>vm<span class="w"> </span>restart<span class="w"> </span>--resource-group<span class="w"> </span>myRG<span class="w"> </span>--name<span class="w"> </span>myVM
az<span class="w"> </span>vm<span class="w"> </span>deallocate<span class="w"> </span>--resource-group<span class="w"> </span>myRG<span class="w"> </span>--name<span class="w"> </span>myVM

<span class="c1"># Show VM details</span>
az<span class="w"> </span>vm<span class="w"> </span>show<span class="w"> </span>--resource-group<span class="w"> </span>myRG<span class="w"> </span>--name<span class="w"> </span>myVM
az<span class="w"> </span>vm<span class="w"> </span>get-instance-view<span class="w"> </span>--resource-group<span class="w"> </span>myRG<span class="w"> </span>--name<span class="w"> </span>myVM

<span class="c1"># Network operations</span>
az<span class="w"> </span>network<span class="w"> </span>nsg<span class="w"> </span>rule<span class="w"> </span>list<span class="w"> </span>--resource-group<span class="w"> </span>myRG<span class="w"> </span>--nsg-name<span class="w"> </span>myNSG<span class="w"> </span>--output<span class="w"> </span>table
az<span class="w"> </span>network<span class="w"> </span>vnet<span class="w"> </span>list<span class="w"> </span>--output<span class="w"> </span>table
az<span class="w"> </span>network<span class="w"> </span>nic<span class="w"> </span>list<span class="w"> </span>--output<span class="w"> </span>table

<span class="c1"># Disk operations</span>
az<span class="w"> </span>disk<span class="w"> </span>list<span class="w"> </span>--output<span class="w"> </span>table
az<span class="w"> </span>disk<span class="w"> </span>show<span class="w"> </span>--resource-group<span class="w"> </span>myRG<span class="w"> </span>--name<span class="w"> </span>myDisk
</code></pre></div>

<hr />
<h2><a name="active-directory"></a>Part 8: Active Directory Domain Join (Enterprise Deep-Dive)</h2>
<blockquote>
<p><strong>Note:</strong> This section is optional. Skip if you don't need Active Directory integration.</p>
</blockquote>
<h3>When You Need This</h3>
<ul>
<li>Centralized user authentication across hybrid infrastructure</li>
<li>Group Policy management for compliance</li>
<li>Enterprise SSO requirements</li>
<li>Regulated environments (banking, healthcare, government)</li>
</ul>
<p>Most Azure documentation focuses on Azure AD Domain Services (AADDS). This guide covers joining to <strong>traditional Active Directory Domain Controllers</strong>, which is what most enterprises actually run.</p>
<h3>Prerequisites</h3>
<p>Before attempting domain join:</p>
<ol>
<li><strong>Network connectivity</strong> - VM must reach domain controller</li>
<li><strong>DNS</strong> - Must point to DC (not Azure DNS or 8.8.8.8)</li>
<li><strong>Time sync</strong> - Must be within 5 minutes of DC (Kerberos requirement)</li>
<li><strong>Ports open</strong> - 53, 88, 389, 445, 636 (minimum)</li>
<li><strong>Admin credentials</strong> - Account with domain join privileges</li>
</ol>
<h3>Required Ports</h3>
<table>
<thead>
<tr>
<th>Port</th>
<th>Protocol</th>
<th>Service</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr>
<td>53</td>
<td>TCP/UDP</td>
<td>DNS</td>
<td>Yes</td>
</tr>
<tr>
<td>88</td>
<td>TCP/UDP</td>
<td>Kerberos</td>
<td>Yes</td>
</tr>
<tr>
<td>135</td>
<td>TCP</td>
<td>RPC</td>
<td>Yes</td>
</tr>
<tr>
<td>389</td>
<td>TCP/UDP</td>
<td>LDAP</td>
<td>Yes</td>
</tr>
<tr>
<td>445</td>
<td>TCP</td>
<td>SMB</td>
<td>Yes</td>
</tr>
<tr>
<td>464</td>
<td>TCP/UDP</td>
<td>Kerberos Password</td>
<td>Yes</td>
</tr>
<tr>
<td>636</td>
<td>TCP</td>
<td>LDAPS</td>
<td>Recommended</td>
</tr>
<tr>
<td>3268</td>
<td>TCP</td>
<td>Global Catalog</td>
<td>Recommended</td>
</tr>
<tr>
<td>3269</td>
<td>TCP</td>
<td>Global Catalog SSL</td>
<td>Recommended</td>
</tr>
</tbody>
</table>
<h3>Installation (Ubuntu/Debian)</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Update package list</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update

<span class="c1"># Install required packages</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>realmd<span class="w"> </span>sssd<span class="w"> </span>sssd-tools<span class="w"> </span>libnss-sss<span class="w"> </span>libpam-sss<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>adcli<span class="w"> </span>samba-common-bin<span class="w"> </span>packagekit<span class="w"> </span>krb5-user

<span class="c1"># During install, you&#39;ll be prompted for Kerberos realm (DOMAIN.COM in uppercase)</span>
</code></pre></div>

<h3>Installation (RHEL/CentOS)</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Install packages</span>
sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>realmd<span class="w"> </span>sssd<span class="w"> </span>oddjob<span class="w"> </span>oddjob-mkhomedir<span class="w"> </span>adcli<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>samba-common<span class="w"> </span>samba-common-tools<span class="w"> </span>krb5-workstation

<span class="c1"># Enable and start services</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>sssd
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>sssd
</code></pre></div>

<h3>Domain Join Process</h3>
<h4>Step 1: Configure DNS</h4>
<p><strong>Critical:</strong> VM must use domain controller as DNS server, not Azure DNS or public DNS.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check current DNS</span>
cat<span class="w"> </span>/etc/resolv.conf

<span class="c1"># Configure DNS (temporary - for testing)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;nameserver 10.0.0.4&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/resolv.conf
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;search CONTOSO.COM&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/resolv.conf

<span class="c1"># Make permanent (Ubuntu/Debian with netplan)</span>
sudo<span class="w"> </span>nano<span class="w"> </span>/etc/netplan/50-cloud-init.yaml

<span class="c1"># Add under ethernet section:</span>
<span class="c1">#   nameservers:</span>
<span class="c1">#     addresses: [10.0.0.4, 10.0.0.5]</span>
<span class="c1">#     search: [CONTOSO.COM]</span>

sudo<span class="w"> </span>netplan<span class="w"> </span>apply

<span class="c1"># Make permanent (RHEL/CentOS)</span>
sudo<span class="w"> </span>nmcli<span class="w"> </span>con<span class="w"> </span>mod<span class="w"> </span><span class="s2">&quot;System eth0&quot;</span><span class="w"> </span>ipv4.dns<span class="w"> </span><span class="s2">&quot;10.0.0.4 10.0.0.5&quot;</span>
sudo<span class="w"> </span>nmcli<span class="w"> </span>con<span class="w"> </span>mod<span class="w"> </span><span class="s2">&quot;System eth0&quot;</span><span class="w"> </span>ipv4.dns-search<span class="w"> </span><span class="s2">&quot;CONTOSO.COM&quot;</span>
sudo<span class="w"> </span>nmcli<span class="w"> </span>con<span class="w"> </span>up<span class="w"> </span><span class="s2">&quot;System eth0&quot;</span>

<span class="c1"># Verify DNS resolution</span>
nslookup<span class="w"> </span>DC01.CONTOSO.COM
nslookup<span class="w"> </span>CONTOSO.COM
nslookup<span class="w"> </span>_ldap._tcp.dc._msdcs.CONTOSO.COM
</code></pre></div>

<h4>Step 2: Configure Time Sync</h4>
<p><strong>This is critical.</strong> Kerberos authentication fails if time difference exceeds 5 minutes.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check current time and timezone</span>
timedatectl<span class="w"> </span>status

<span class="c1"># Enable NTP</span>
sudo<span class="w"> </span>timedatectl<span class="w"> </span>set-ntp<span class="w"> </span><span class="nb">true</span>

<span class="c1"># Sync immediately with domain controller</span>
sudo<span class="w"> </span>ntpdate<span class="w"> </span>DC01.CONTOSO.COM

<span class="c1"># Or use chrony (RHEL 8+)</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>chronyd
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>chronyd

<span class="c1"># Add DC as time source</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;server DC01.CONTOSO.COM iburst&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/chrony.conf
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>chronyd

<span class="c1"># Verify sync</span>
chronyc<span class="w"> </span>sources
</code></pre></div>

<h4>Step 3: Discover Domain</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Discover domain</span>
sudo<span class="w"> </span>realm<span class="w"> </span>discover<span class="w"> </span>CONTOSO.COM

<span class="c1"># Expected output:</span>
<span class="c1"># contoso.com</span>
<span class="c1">#   type: kerberos</span>
<span class="c1">#   realm-name: CONTOSO.COM</span>
<span class="c1">#   domain-name: contoso.com</span>
<span class="c1">#   configured: no</span>
<span class="c1">#   server-software: active-directory</span>
<span class="c1">#   client-software: sssd</span>
</code></pre></div>

<p>If discovery fails:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check DNS resolution</span>
nslookup<span class="w"> </span>_ldap._tcp.dc._msdcs.CONTOSO.COM

<span class="c1"># Check DC connectivity</span>
ping<span class="w"> </span>DC01.CONTOSO.COM
nc<span class="w"> </span>-zv<span class="w"> </span>DC01.CONTOSO.COM<span class="w"> </span><span class="m">389</span>
</code></pre></div>

<h4>Step 4: Join Domain</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Join domain (interactive - will prompt for password)</span>
sudo<span class="w"> </span>realm<span class="w"> </span>join<span class="w"> </span>--user<span class="o">=</span>administrator<span class="w"> </span>CONTOSO.COM

<span class="c1"># Or specify password on command line (scripting)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;P@ssw0rd&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>realm<span class="w"> </span>join<span class="w"> </span>--user<span class="o">=</span>administrator<span class="w"> </span>CONTOSO.COM<span class="w"> </span>--stdin

<span class="c1"># Join with specific OU (optional)</span>
sudo<span class="w"> </span>realm<span class="w"> </span>join<span class="w"> </span>--user<span class="o">=</span>administrator<span class="w"> </span>--computer-ou<span class="o">=</span><span class="s2">&quot;OU=Servers,OU=Azure,DC=CONTOSO,DC=COM&quot;</span><span class="w"> </span>CONTOSO.COM

<span class="c1"># Verify join</span>
sudo<span class="w"> </span>realm<span class="w"> </span>list
</code></pre></div>

<p>Expected output:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">contoso</span><span class="p">.</span><span class="nx">com</span>
<span class="w">  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span><span class="nx">kerberos</span>
<span class="w">  </span><span class="nx">realm</span><span class="o">-</span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="nx">CONTOSO</span><span class="p">.</span><span class="nx">COM</span>
<span class="w">  </span><span class="nx">domain</span><span class="o">-</span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="nx">contoso</span><span class="p">.</span><span class="nx">com</span>
<span class="w">  </span><span class="nx">configured</span><span class="p">:</span><span class="w"> </span><span class="nx">kerberos</span><span class="o">-</span><span class="nx">member</span>
<span class="w">  </span><span class="nx">server</span><span class="o">-</span><span class="nx">software</span><span class="p">:</span><span class="w"> </span><span class="nx">active</span><span class="o">-</span><span class="nx">directory</span>
<span class="w">  </span><span class="nx">client</span><span class="o">-</span><span class="nx">software</span><span class="p">:</span><span class="w"> </span><span class="nx">sssd</span>
<span class="w">  </span><span class="nx">required</span><span class="o">-</span><span class="kn">package</span><span class="p">:</span><span class="w"> </span><span class="nx">sssd</span><span class="o">-</span><span class="nx">tools</span>
<span class="w">  </span><span class="nx">required</span><span class="o">-</span><span class="kn">package</span><span class="p">:</span><span class="w"> </span><span class="nx">sssd</span>
<span class="w">  </span><span class="nx">required</span><span class="o">-</span><span class="kn">package</span><span class="p">:</span><span class="w"> </span><span class="nx">libnss</span><span class="o">-</span><span class="nx">sss</span>
<span class="w">  </span><span class="nx">required</span><span class="o">-</span><span class="kn">package</span><span class="p">:</span><span class="w"> </span><span class="nx">libpam</span><span class="o">-</span><span class="nx">sss</span>
<span class="w">  </span><span class="nx">required</span><span class="o">-</span><span class="kn">package</span><span class="p">:</span><span class="w"> </span><span class="nx">adcli</span>
<span class="w">  </span><span class="nx">required</span><span class="o">-</span><span class="kn">package</span><span class="p">:</span><span class="w"> </span><span class="nx">samba</span><span class="o">-</span><span class="nx">common</span><span class="o">-</span><span class="nx">bin</span>
<span class="w">  </span><span class="nx">login</span><span class="o">-</span><span class="nx">formats</span><span class="p">:</span><span class="w"> </span><span class="o">%</span><span class="nx">U</span><span class="err">@</span><span class="nx">contoso</span><span class="p">.</span><span class="nx">com</span>
<span class="w">  </span><span class="nx">login</span><span class="o">-</span><span class="nx">policy</span><span class="p">:</span><span class="w"> </span><span class="nx">allow</span><span class="o">-</span><span class="nx">realm</span><span class="o">-</span><span class="nx">logins</span>
</code></pre></div>

<h4>Step 5: Configure SSSD</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Edit SSSD configuration</span>
sudo<span class="w"> </span>nano<span class="w"> </span>/etc/sssd/sssd.conf

<span class="c1"># Recommended settings:</span>
<span class="c1"># [sssd]</span>
<span class="c1"># domains = CONTOSO.COM</span>
<span class="c1"># config_file_version = 2</span>
<span class="c1"># services = nss, pam</span>
<span class="c1"># </span>
<span class="c1"># [domain/CONTOSO.COM]</span>
<span class="c1"># default_shell = /bin/bash</span>
<span class="c1"># krb5_store_password_if_offline = True</span>
<span class="c1"># cache_credentials = True</span>
<span class="c1"># krb5_realm = CONTOSO.COM</span>
<span class="c1"># realmd_tags = manages-system joined-with-adcli</span>
<span class="c1"># id_provider = ad</span>
<span class="c1"># fallback_homedir = /home/%u</span>
<span class="c1"># ad_domain = contoso.com</span>
<span class="c1"># use_fully_qualified_names = False</span>
<span class="c1"># ldap_id_mapping = True</span>
<span class="c1"># access_provider = ad</span>

<span class="c1"># Set correct permissions</span>
sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">600</span><span class="w"> </span>/etc/sssd/sssd.conf
sudo<span class="w"> </span>chown<span class="w"> </span>root:root<span class="w"> </span>/etc/sssd/sssd.conf

<span class="c1"># Restart SSSD</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>sssd
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>sssd
</code></pre></div>

<p>Key settings explained:</p>
<ul>
<li><code>use_fully_qualified_names = False</code> - Allow login as "john" instead of "john@contoso.com"</li>
<li><code>fallback_homedir = /home/%u</code> - Create home directory in /home/username</li>
<li><code>ldap_id_mapping = True</code> - Automatically map AD SIDs to Unix UIDs/GIDs</li>
<li><code>cache_credentials = True</code> - Allow offline authentication</li>
</ul>
<h4>Step 6: Configure Home Directory Creation</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Enable automatic home directory creation</span>
sudo<span class="w"> </span>pam-auth-update<span class="w"> </span>--enable<span class="w"> </span>mkhomedir

<span class="c1"># Or manually add to PAM configuration</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;session required pam_mkhomedir.so skel=/etc/skel/ umask=0077&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/pam.d/common-session

<span class="c1"># For RHEL/CentOS</span>
sudo<span class="w"> </span>authconfig<span class="w"> </span>--enablemkhomedir<span class="w"> </span>--update
</code></pre></div>

<h4>Step 7: Configure Sudo Access</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Add domain admins to sudoers</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;%domain\ admins ALL=(ALL:ALL) ALL&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/sudoers.d/domain_admins

<span class="c1"># Or specific group</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;%azure-admins ALL=(ALL:ALL) ALL&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/sudoers.d/azure_admins

<span class="c1"># Set correct permissions</span>
sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">0440</span><span class="w"> </span>/etc/sudoers.d/domain_admins

<span class="c1"># Test syntax</span>
sudo<span class="w"> </span>visudo<span class="w"> </span>-c
</code></pre></div>

<h4>Step 8: Configure SSH</h4>
<p>Allow password authentication for domain users:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Edit SSH config</span>
sudo<span class="w"> </span>nano<span class="w"> </span>/etc/ssh/sshd_config

<span class="c1"># Ensure these settings:</span>
PasswordAuthentication<span class="w"> </span>yes
ChallengeResponseAuthentication<span class="w"> </span>yes
UsePAM<span class="w"> </span>yes

<span class="c1"># Ubuntu 22.04+ also check:</span>
sudo<span class="w"> </span>nano<span class="w"> </span>/etc/ssh/sshd_config.d/50-cloud-init.conf

<span class="c1"># Restart SSH</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>sshd
</code></pre></div>

<h3>Verification &amp; Testing</h3>
<h4>Test User Lookup</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Test user lookup via SSSD</span>
getent<span class="w"> </span>passwd<span class="w"> </span>john@CONTOSO.COM
getent<span class="w"> </span>passwd<span class="w"> </span>john<span class="w">  </span><span class="c1"># If use_fully_qualified_names = False</span>

<span class="c1"># Expected output:</span>
<span class="c1"># john:*:1450401106:1450400513:John Smith:/home/john:/bin/bash</span>

<span class="c1"># Test group lookup</span>
getent<span class="w"> </span>group<span class="w"> </span><span class="s2">&quot;domain admins&quot;</span>
getent<span class="w"> </span>group<span class="w"> </span><span class="s2">&quot;domain users&quot;</span>

<span class="c1"># Check user details</span>
id<span class="w"> </span>john@CONTOSO.COM
groups<span class="w"> </span>john@CONTOSO.COM
</code></pre></div>

<h4>Test Kerberos Authentication</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Get Kerberos ticket</span>
kinit<span class="w"> </span>john@CONTOSO.COM
<span class="c1"># Enter password when prompted</span>

<span class="c1"># List tickets</span>
klist

<span class="c1"># Expected output:</span>
<span class="c1"># Ticket cache: FILE:/tmp/krb5cc_1000</span>
<span class="c1"># Default principal: john@CONTOSO.COM</span>
<span class="c1"># </span>
<span class="c1"># Valid starting     Expires            Service principal</span>
<span class="c1"># 12/08/25 10:00:00  12/08/25 20:00:00  krbtgt/CONTOSO.COM@CONTOSO.COM</span>

<span class="c1"># Destroy ticket (logout)</span>
kdestroy
</code></pre></div>

<h4>Test SSH Login</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># From another machine, SSH with domain credentials</span>
ssh<span class="w"> </span>john@CONTOSO.COM@vm-hostname.contoso.com

<span class="c1"># Or if use_fully_qualified_names = False</span>
ssh<span class="w"> </span>john@vm-hostname.contoso.com

<span class="c1"># First login will create home directory</span>
</code></pre></div>

<h3>Troubleshooting Commands</h3>
<h4>Check SSSD Status</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Service status</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>sssd
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>sssd-kcm
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>sssd-nss
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>sssd-pam

<span class="c1"># Check domain status</span>
sudo<span class="w"> </span>sssctl<span class="w"> </span>domain-status<span class="w"> </span>CONTOSO.COM

<span class="c1"># Check online/offline status</span>
sudo<span class="w"> </span>sssctl<span class="w"> </span>domain-status<span class="w"> </span>CONTOSO.COM<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;Online status&quot;</span>
</code></pre></div>

<h4>View Logs</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Main SSSD log</span>
sudo<span class="w"> </span>tail<span class="w"> </span>-f<span class="w"> </span>/var/log/sssd/sssd.log

<span class="c1"># Domain-specific log</span>
sudo<span class="w"> </span>tail<span class="w"> </span>-f<span class="w"> </span>/var/log/sssd/sssd_CONTOSO.COM.log

<span class="c1"># Kerberos logs</span>
sudo<span class="w"> </span>tail<span class="w"> </span>-f<span class="w"> </span>/var/log/krb5libs.log

<span class="c1"># PAM authentication log</span>
sudo<span class="w"> </span>tail<span class="w"> </span>-f<span class="w"> </span>/var/log/auth.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>pam
</code></pre></div>

<h4>Clear Cache &amp; Restart</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Clear SSSD cache</span>
sudo<span class="w"> </span>sss_cache<span class="w"> </span>-E

<span class="c1"># Restart SSSD</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>sssd

<span class="c1"># Verify cache cleared</span>
sudo<span class="w"> </span>sssctl<span class="w"> </span>cache-expire<span class="w"> </span>-E
</code></pre></div>

<h4>Test Connectivity to DC</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Ping DC</span>
ping<span class="w"> </span>DC01.CONTOSO.COM

<span class="c1"># Test required ports</span>
nc<span class="w"> </span>-zv<span class="w"> </span>DC01.CONTOSO.COM<span class="w"> </span><span class="m">53</span><span class="w">    </span><span class="c1"># DNS</span>
nc<span class="w"> </span>-zv<span class="w"> </span>DC01.CONTOSO.COM<span class="w"> </span><span class="m">88</span><span class="w">    </span><span class="c1"># Kerberos</span>
nc<span class="w"> </span>-zv<span class="w"> </span>DC01.CONTOSO.COM<span class="w"> </span><span class="m">389</span><span class="w">   </span><span class="c1"># LDAP</span>
nc<span class="w"> </span>-zv<span class="w"> </span>DC01.CONTOSO.COM<span class="w"> </span><span class="m">445</span><span class="w">   </span><span class="c1"># SMB</span>
nc<span class="w"> </span>-zv<span class="w"> </span>DC01.CONTOSO.COM<span class="w"> </span><span class="m">636</span><span class="w">   </span><span class="c1"># LDAPS</span>

<span class="c1"># Test LDAP directly</span>
ldapsearch<span class="w"> </span>-x<span class="w"> </span>-H<span class="w"> </span>ldap://DC01.CONTOSO.COM<span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;DC=CONTOSO,DC=COM&quot;</span>
</code></pre></div>

<h4>Debug Kerberos</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Enable Kerberos tracing</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">KRB5_TRACE</span><span class="o">=</span>/dev/stdout
kinit<span class="w"> </span>john@CONTOSO.COM

<span class="c1"># Check Kerberos config</span>
cat<span class="w"> </span>/etc/krb5.conf

<span class="c1"># Test DNS SRV records</span>
nslookup<span class="w"> </span>-type<span class="o">=</span>SRV<span class="w"> </span>_kerberos._tcp.CONTOSO.COM
nslookup<span class="w"> </span>-type<span class="o">=</span>SRV<span class="w"> </span>_ldap._tcp.CONTOSO.COM
</code></pre></div>

<h4>Check User Authentication Attempts</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># View all authentication attempts</span>
sudo<span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;authentication&quot;</span><span class="w"> </span>/var/log/auth.log

<span class="c1"># View failed attempts</span>
sudo<span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;authentication failure&quot;</span><span class="w"> </span>/var/log/auth.log

<span class="c1"># View successful logins</span>
sudo<span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;session opened&quot;</span><span class="w"> </span>/var/log/auth.log

<span class="c1"># Check SSSD authentication</span>
sudo<span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;pam_sss&quot;</span><span class="w"> </span>/var/log/auth.log
</code></pre></div>

<h3>Common Errors &amp; Solutions</h3>
<h4>Error: "Couldn't join realm: Failed to enroll machine"</h4>
<p><strong>Cause:</strong> DNS not configured correctly</p>
<p><strong>Solution:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Verify DNS points to DC</span>
cat<span class="w"> </span>/etc/resolv.conf

<span class="c1"># Test DNS resolution</span>
nslookup<span class="w"> </span>DC01.CONTOSO.COM
nslookup<span class="w"> </span>_ldap._tcp.dc._msdcs.CONTOSO.COM

<span class="c1"># Fix DNS</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;nameserver 10.0.0.4&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/resolv.conf
</code></pre></div>

<h4>Error: "realm: Couldn't join realm: Insufficient permissions"</h4>
<p><strong>Cause:</strong> User account doesn't have domain join privileges or wrong password</p>
<p><strong>Solution:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Verify account can join domain (run on DC or admin workstation)</span>
Get-ADUser<span class="w"> </span>administrator<span class="w"> </span>-Properties<span class="w"> </span>msDS-AllowedToActOnBehalfOfOtherIdentity

<span class="c1"># Try with domain admin account</span>
sudo<span class="w"> </span>realm<span class="w"> </span>join<span class="w"> </span>--user<span class="o">=</span>domainadmin<span class="w"> </span>CONTOSO.COM
</code></pre></div>

<h4>Error: "No such file or directory" when trying to SSH</h4>
<p><strong>Cause:</strong> Home directory not created automatically</p>
<p><strong>Solution:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Enable home directory creation</span>
sudo<span class="w"> </span>pam-auth-update<span class="w"> </span>--enable<span class="w"> </span>mkhomedir

<span class="c1"># Or manually create</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>/home/john
sudo<span class="w"> </span>chown<span class="w"> </span>john:domain<span class="se">\ </span>users<span class="w"> </span>/home/john
</code></pre></div>

<h4>Error: "Permission denied (publickey,password)"</h4>
<p><strong>Cause:</strong> Password authentication disabled in SSH</p>
<p><strong>Solution:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check SSH config</span>
sudo<span class="w"> </span>grep<span class="w"> </span>PasswordAuthentication<span class="w"> </span>/etc/ssh/sshd_config
sudo<span class="w"> </span>grep<span class="w"> </span>PasswordAuthentication<span class="w"> </span>/etc/ssh/sshd_config.d/*.conf

<span class="c1"># Enable password auth</span>
sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/PasswordAuthentication no/PasswordAuthentication yes/&#39;</span><span class="w"> </span>/etc/ssh/sshd_config
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>sshd
</code></pre></div>

<h4>Error: "Clock skew too great" (Kerberos)</h4>
<p><strong>Cause:</strong> Time difference between VM and DC exceeds 5 minutes</p>
<p><strong>Solution:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check time on both systems</span>
date
timedatectl

<span class="c1"># Sync time immediately</span>
sudo<span class="w"> </span>timedatectl<span class="w"> </span>set-ntp<span class="w"> </span><span class="nb">true</span>
sudo<span class="w"> </span>ntpdate<span class="w"> </span>DC01.CONTOSO.COM

<span class="c1"># Verify sync</span>
timedatectl<span class="w"> </span>status

<span class="c1"># Configure permanent sync</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;server DC01.CONTOSO.COM iburst&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/chrony.conf
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>chronyd
</code></pre></div>

<h4>Error: "getent passwd username" returns nothing</h4>
<p><strong>Cause:</strong> SSSD not properly configured or domain not accessible</p>
<p><strong>Solution:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check SSSD status</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>sssd
sudo<span class="w"> </span>sssctl<span class="w"> </span>domain-status<span class="w"> </span>CONTOSO.COM

<span class="c1"># Check SSSD logs</span>
sudo<span class="w"> </span>tail<span class="w"> </span>-50<span class="w"> </span>/var/log/sssd/sssd_CONTOSO.COM.log

<span class="c1"># Clear cache and restart</span>
sudo<span class="w"> </span>sss_cache<span class="w"> </span>-E
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>sssd

<span class="c1"># Test after restart</span>
sleep<span class="w"> </span><span class="m">5</span>
getent<span class="w"> </span>passwd<span class="w"> </span>username
</code></pre></div>

<h3>Leave Domain</h3>
<p>If you need to unjoin the domain:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Leave domain</span>
sudo<span class="w"> </span>realm<span class="w"> </span>leave<span class="w"> </span>CONTOSO.COM

<span class="c1"># Verify</span>
sudo<span class="w"> </span>realm<span class="w"> </span>list

<span class="c1"># Clean up (optional)</span>
sudo<span class="w"> </span>apt<span class="w"> </span>remove<span class="w"> </span>realmd<span class="w"> </span>sssd<span class="w"> </span>sssd-tools
sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/sss/
sudo<span class="w"> </span>rm<span class="w"> </span>/etc/sssd/sssd.conf
</code></pre></div>

<h3>Automation Script</h3>
<p>Complete domain join script for Ubuntu:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># domain-join.sh - Automated domain join for Azure VMs</span>

<span class="nv">DOMAIN</span><span class="o">=</span><span class="s2">&quot;CONTOSO.COM&quot;</span>
<span class="nv">DC_IP</span><span class="o">=</span><span class="s2">&quot;10.0.0.4&quot;</span>
<span class="nv">ADMIN_USER</span><span class="o">=</span><span class="s2">&quot;administrator&quot;</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Installing packages ===&quot;</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span><span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>realmd<span class="w"> </span>sssd<span class="w"> </span>sssd-tools<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>libnss-sss<span class="w"> </span>libpam-sss<span class="w"> </span>adcli<span class="w"> </span>samba-common-bin<span class="w"> </span>krb5-user

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Configuring DNS ===&quot;</span>
sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s/nameserver .*/nameserver </span><span class="nv">$DC_IP</span><span class="s2">/&quot;</span><span class="w"> </span>/etc/resolv.conf
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;search </span><span class="nv">$DOMAIN</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/resolv.conf

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Syncing time ===&quot;</span>
sudo<span class="w"> </span>timedatectl<span class="w"> </span>set-ntp<span class="w"> </span><span class="nb">true</span>
sleep<span class="w"> </span><span class="m">2</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Discovering domain ===&quot;</span>
sudo<span class="w"> </span>realm<span class="w"> </span>discover<span class="w"> </span><span class="nv">$DOMAIN</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Joining domain ===&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Enter password for </span><span class="nv">$ADMIN_USER</span><span class="s2">@</span><span class="nv">$DOMAIN</span><span class="s2">:&quot;</span>
sudo<span class="w"> </span>realm<span class="w"> </span>join<span class="w"> </span>--user<span class="o">=</span><span class="nv">$ADMIN_USER</span><span class="w"> </span><span class="nv">$DOMAIN</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Configuring SSSD ===&quot;</span>
sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/use_fully_qualified_names = True/use_fully_qualified_names = False/g&#39;</span><span class="w"> </span>/etc/sssd/sssd.conf
sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/\[domain/a fallback_homedir = /home/%u&#39;</span><span class="w"> </span>/etc/sssd/sssd.conf
sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">600</span><span class="w"> </span>/etc/sssd/sssd.conf

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Enabling home directory creation ===&quot;</span>
sudo<span class="w"> </span>pam-auth-update<span class="w"> </span>--enable<span class="w"> </span>mkhomedir

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Configuring sudo ===&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;%domain\ admins ALL=(ALL:ALL) ALL&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/sudoers.d/domain_admins
sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">0440</span><span class="w"> </span>/etc/sudoers.d/domain_admins

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Restarting services ===&quot;</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>sssd

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Verifying join ===&quot;</span>
sudo<span class="w"> </span>realm<span class="w"> </span>list
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test with: getent passwd username@</span><span class="nv">$DOMAIN</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;SSH test: ssh username@</span><span class="nv">$DOMAIN</span><span class="s2">@</span><span class="k">$(</span>hostname<span class="k">)</span><span class="s2">&quot;</span>
</code></pre></div>

<hr />
<h2><a name="quick-reference"></a>Quick Reference Table</h2>
<table>
<thead>
<tr>
<th>Category</th>
<th>Command</th>
<th>What It Does</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Azure VM Agent</strong></td>
<td><code>systemctl status walinuxagent</code></td>
<td>Check Azure agent status</td>
</tr>
<tr>
<td></td>
<td><code>tail -f /var/log/waagent.log</code></td>
<td>View agent logs</td>
</tr>
<tr>
<td><strong>Extensions</strong></td>
<td><code>ls /var/lib/waagent/</code></td>
<td>List installed extensions</td>
</tr>
<tr>
<td></td>
<td><code>cat /var/log/azure/custom-script/handler.log</code></td>
<td>Debug custom scripts</td>
</tr>
<tr>
<td><strong>IMDS</strong></td>
<td><code>curl -H "Metadata:true" http://169.254...</code></td>
<td>Get VM metadata</td>
</tr>
<tr>
<td><strong>cloud-init</strong></td>
<td><code>tail -f /var/log/cloud-init-output.log</code></td>
<td>Check init logs</td>
</tr>
<tr>
<td><strong>Processes</strong></td>
<td><code>top</code> / <code>htop</code></td>
<td>Monitor processes</td>
</tr>
<tr>
<td></td>
<td><code>ps aux</code></td>
<td>List all processes</td>
</tr>
<tr>
<td></td>
<td><code>systemctl status servicename</code></td>
<td>Check service</td>
</tr>
<tr>
<td><strong>Resources</strong></td>
<td><code>df -h</code></td>
<td>Disk usage</td>
</tr>
<tr>
<td></td>
<td><code>free -h</code></td>
<td>Memory usage</td>
</tr>
<tr>
<td></td>
<td><code>uptime</code></td>
<td>System load</td>
</tr>
<tr>
<td><strong>Network</strong></td>
<td><code>ss -tulpn</code></td>
<td>Listening ports</td>
</tr>
<tr>
<td></td>
<td><code>ping</code> / <code>nc -zv</code></td>
<td>Test connectivity</td>
</tr>
<tr>
<td></td>
<td><code>nslookup</code> / <code>dig</code></td>
<td>DNS lookup</td>
</tr>
<tr>
<td><strong>Files</strong></td>
<td><code>ls -la</code></td>
<td>List files</td>
</tr>
<tr>
<td></td>
<td><code>tail -f /var/log/syslog</code></td>
<td>Follow logs</td>
</tr>
<tr>
<td></td>
<td><code>grep "error" logfile</code></td>
<td>Search logs</td>
</tr>
<tr>
<td><strong>Disks</strong></td>
<td><code>lsblk</code></td>
<td>List disks</td>
</tr>
<tr>
<td></td>
<td><code>fdisk -l</code></td>
<td>Partition info</td>
</tr>
<tr>
<td></td>
<td><code>mount</code> / <code>blkid</code></td>
<td>Mount operations</td>
</tr>
<tr>
<td><strong>Security</strong></td>
<td><code>last</code></td>
<td>Login history</td>
</tr>
<tr>
<td></td>
<td><code>who</code> / <code>w</code></td>
<td>Current users</td>
</tr>
<tr>
<td></td>
<td><code>sudo -l</code></td>
<td>Check privileges</td>
</tr>
<tr>
<td><strong>Azure CLI</strong></td>
<td><code>az vm list</code></td>
<td>List VMs</td>
</tr>
<tr>
<td></td>
<td><code>az vm start/stop</code></td>
<td>Control VMs</td>
</tr>
<tr>
<td><strong>AD Join</strong></td>
<td><code>realm join DOMAIN.COM</code></td>
<td>Join AD domain</td>
</tr>
<tr>
<td></td>
<td><code>realm list</code></td>
<td>Check join status</td>
</tr>
<tr>
<td></td>
<td><code>getent passwd user@DOMAIN.COM</code></td>
<td>Test user lookup</td>
</tr>
<tr>
<td></td>
<td><code>kinit user@DOMAIN.COM</code></td>
<td>Get Kerberos ticket</td>
</tr>
<tr>
<td></td>
<td><code>sssctl domain-status DOMAIN.COM</code></td>
<td>Check SSSD status</td>
</tr>
</tbody>
</table>
<hr />
<h2>Pro Tips</h2>
<h3>Serial Console Essentials</h3>
<p>When SSH is broken, use Azure Serial Console with these commands:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check SSH status</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>sshd
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>sshd

<span class="c1"># Check network</span>
ip<span class="w"> </span>addr<span class="w"> </span>show
ip<span class="w"> </span>route<span class="w"> </span>show

<span class="c1"># View recent errors</span>
sudo<span class="w"> </span>journalctl<span class="w"> </span>-xe<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-50
sudo<span class="w"> </span>tail<span class="w"> </span>-50<span class="w"> </span>/var/log/syslog
</code></pre></div>

<h3>Azure Monitor Agent</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check AMA status</span>
systemctl<span class="w"> </span>status<span class="w"> </span>azuremonitoragent

<span class="c1"># View AMA logs</span>
journalctl<span class="w"> </span>-u<span class="w"> </span>azuremonitoragent<span class="w"> </span>-f

<span class="c1"># Restart AMA</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>azuremonitoragent
</code></pre></div>

<h3>Time Sync (Critical for AD)</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check time status</span>
timedatectl<span class="w"> </span>status

<span class="c1"># Enable NTP</span>
sudo<span class="w"> </span>timedatectl<span class="w"> </span>set-ntp<span class="w"> </span><span class="nb">true</span>

<span class="c1"># Sync immediately</span>
sudo<span class="w"> </span>ntpdate<span class="w"> </span>DC01.CONTOSO.COM

<span class="c1"># Check NTP servers (chrony)</span>
chronyc<span class="w"> </span>sources
</code></pre></div>

<h3>Quick Health Check Script</h3>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== System Health Check ===&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Uptime &amp; Load:&quot;</span>
uptime
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Memory:&quot;</span>
free<span class="w"> </span>-h
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Disk:&quot;</span>
df<span class="w"> </span>-h<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span>tmpfs
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Azure Agent:&quot;</span>
systemctl<span class="w"> </span>status<span class="w"> </span>walinuxagent<span class="w"> </span>--no-pager<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-3
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Network:&quot;</span>
ip<span class="w"> </span>addr<span class="w"> </span>show<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;inet |^[0-9]:&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Recent Errors:&quot;</span>
sudo<span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>error<span class="w"> </span>/var/log/syslog<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-5
</code></pre></div>

<hr />
<h2>What's Missing from Microsoft's Docs</h2>
<p>Microsoft's Azure Linux documentation assumes you already know:</p>
<ol>
<li><strong>Linux basics</strong> - They jump straight to Azure-specific tools</li>
<li><strong>Troubleshooting workflow</strong> - Documentation shows happy path only</li>
<li><strong>Active Directory complexity</strong> - AADDS docs don't cover traditional AD</li>
<li><strong>Time sync criticality</strong> - Rarely mentioned but breaks Kerberos auth</li>
<li><strong>Extension debugging</strong> - Exit codes and logs are poorly documented</li>
<li><strong>Network troubleshooting</strong> - NSG vs OS firewall vs app-level blocking</li>
<li><strong>Serial Console workflow</strong> - Only mentioned when SSH fails completely</li>
</ol>
<p>This guide fills those gaps with commands you'll actually use.</p>
<hr />
<h2>Conclusion</h2>
<p>These 50 commands cover 90% of Azure Linux administration tasks. Whether you manage 5 VMs or 5,000, these commands bridge the gap between successful deployment and operational reality.</p>
<p><strong>For most administrators:</strong> Focus on Parts 1-6 for daily operations</p>
<p><strong>For enterprise environments:</strong> Add Part 8 (Active Directory) for centralized authentication</p>
<p><strong>For automation:</strong> Wrap these commands in scripts, Ansible playbooks, or deploy via Custom Script Extensions</p>
<p>The key insight: Infrastructure-as-code gets you 80% there. These Linux commands handle the remaining 20%.</p>
<hr />
<h2>Download: Complete Command Reference</h2>
<p>Want this as a searchable PDF cheat sheet?</p>
<p><strong><a href="#">Download: Azure Linux Command Reference (PDF)</a></strong></p>
<p>Includes:<br />
- All 50 commands with examples and Azure context<br />
- Active Directory domain join checklist and troubleshooting flowchart<br />
- Port reference table (Azure services, AD, common applications)<br />
- Common error messages and solutions<br />
- One-page quick reference card</p>
<p>Enter your email below and I'll send you the complete guide:</p>
<p>[Beehiiv email capture form]</p>
<hr />
<h2>What's Next?</h2>
<p><strong>Related posts:</strong><br />
- <a href="/blog/azure-vm-inventory-kql/">Azure VM Inventory with KQL</a><br />
- <a href="/blog/why-most-azure-migrations-fail/">Why Most Azure Migrations Fail</a><br />
- <a href="/blog/azure-cost-optimization-what-actually-works/">Azure Cost Optimization - What Actually Works</a></p>
<p><strong>Questions?</strong> The hardest part of Azure Linux management is often the stuff Microsoft doesn't document. If you hit an issue not covered here, reach out‚ÄîI've probably seen it before in a production banking environment.</p>
<hr />
<p><em>Updated December 2025 - Tested on Ubuntu 22.04 LTS and RHEL 9.x in Azure production environments.</em></p>
  </div>

  
  <section class="starter-kit-callout" style="
    max-width: 800px;
    margin: 3rem auto 2rem;
    padding: 2rem;
    border-radius: 12px;
    background: var(--bg-light);
    border: 1px solid var(--border);
    text-align: left;
  ">
    <h3 style="margin-top: 0;">Azure Admin Starter Kit (Free Download)</h3>
    <p style="margin-bottom: 1rem;">
      Get my KQL cheat sheet, 50 Windows + 50 Linux commands, and an Azure RACI template in one free bundle.
    </p>
    <a href="/blog/starter-kit/" class="btn">Get the Starter Kit ‚Üí</a>
  </section>

  
  <div class="inline-subscribe" style="
    max-width: 800px;
    margin: 3rem auto;
    padding: 2.5rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 12px;
    text-align: center;
    color: white;
    box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
  ">
    <h3 style="margin: 0 0 1rem; font-size: 1.75rem; color: white;">Get more Azure content like this</h3>
    <p style="margin: 0 0 1.5rem; font-size: 1.1rem; opacity: 0.95%;">
      Join Azure pros getting practical KQL queries, cost optimization tips, and real-world solutions delivered weekly.
    </p>
    <form action="https://magic.beehiiv.com/v1/3827b09b-c887-4929-a724-f6c97cef1c94" method="GET" class="subscribe-form" style="max-width: 500px; margin: 0 auto;">
      <input type="email" name="email" placeholder="your@email.com" required style="
        flex: 1;
        padding: 0.75rem 1rem;
        border: 2px solid rgba(255,255,255,0.3);
        border-radius: 6px;
        font-size: 1rem;
        background: rgba(255,255,255,0.9);
      ">
      <button type="submit" style="
        padding: 0.75rem 1.5rem;
        background: white;
        color: #667eea;
        border: none;
        border-radius: 6px;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s ease;
      ">Subscribe</button>
    </form>
  </div>

  
  
  <aside class="related-posts" style="max-width: 800px; margin: 3rem auto; padding: 2rem; background: var(--bg-light); border-radius: 12px;">
    <h3 style="margin-top: 0;">Related Posts</h3>
    <ul style="list-style: none; padding: 0;">
      
      <li style="margin: 1rem 0;">
        <a href="/blog/starter-kit" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">Azure Admin Starter Kit (Free Download)</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-12-10</span>
        </a>
      </li>
      
      <li style="margin: 1rem 0;">
        <a href="/blog/50-windows-commands-azure" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">50 Windows Commands for Azure VMs (PowerShell + Active Directory)</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-12-08</span>
        </a>
      </li>
      
      <li style="margin: 1rem 0;">
        <a href="/blog/tag-governance-247-variations" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">Azure Tagging Best Practices: The $2.3M Tag Mess (247 Variations of One Tag)</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-11-30</span>
        </a>
      </li>
      
    </ul>
  </aside>
  

  
  <nav class="post-nav">
    
      <a href="/blog/50-windows-commands-azure">
        <span style="opacity: 0.7; font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">‚Üê Previous</span>
        <strong>50 Windows Commands for Azure VMs (PowerShell + Active Directory)</strong>
      </a>
    
    
      <a href="/blog/starter-kit" style="text-align: right;">
        <span style="opacity: 0.7; font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">Next ‚Üí</span>
        <strong>Azure Admin Starter Kit (Free Download)</strong>
      </a>
    
  </nav>

</article>

    </div>
  </main>

  <!-- EMAIL CAPTURE SECTION -->
  <section class="email-signup" id="subscribe">
    <div class="wrap">
      <h3>Get Azure tips in your inbox</h3>
      <p>Join Azure pros getting practical KQL queries, cost optimization tips, and real-world solutions.</p>
      <form action="https://magic.beehiiv.com/v1/3827b09b-c887-4929-a724-f6c97cef1c94" method="GET" class="subscribe-form">
        <input type="email" name="email" placeholder="your@email.com" required>
        <button type="submit">Subscribe</button>
      </form>
    </div>
  </section>

  <footer class="site-footer">
    <div class="wrap">
      <p>&copy; 2025 Azure Noob ‚Äî Don&#39;t be a Noob</p>
      <p style="margin-top: 0.5rem; font-size: 0.9rem;">
        <a href="/rss.xml" title="Subscribe via RSS">RSS Feed</a> ¬∑ 
        <a href="https://github.com/dswann101164" target="_blank" rel="noopener">GitHub</a>
      </p>
      <p style="margin-top: 1.5rem; font-size: 0.85rem; opacity: 0.7; font-style: italic;">
        "Trust in the Lord with all your heart, and lean not on your own understanding;<br>
        in all your ways acknowledge Him, and He will make your paths straight" ‚Äî Proverbs 3:5-6
      </p>
    </div>
  </footer>

  <!-- Copy code functionality -->
  <script src="/static/copy-code.js"></script>
</body>
</html>