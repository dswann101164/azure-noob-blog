<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  
  

  <!-- Primary SEO -->
  <title>Azure Tag Governance 2025: Policies That Actually Enforce ¬∑ Azure Noob</title>
  <meta name="description" content="How to turn Azure tags from &#39;nice to have&#39; into enforceable governance using Azure Policy, deny/modify effects, and remediation so teams can‚Äôt slip around...">
  
  <link rel="canonical" href="https://azure-noob.com/blog/azure-tag-governance-policy/" />

  <!-- Favicons -->
  <link rel="icon" href="/static/images/logo.png">

  <!-- Open Graph -->
  <meta property="og:title" content="Azure Tag Governance 2025: Policies That Actually Enforce">
  <meta property="og:description" content="How to turn Azure tags from &#39;nice to have&#39; into enforceable governance using Azure Policy, deny/modify effects, and remediation so teams can‚Äôt slip around...">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://azure-noob.com/blog/azure-tag-governance-policy/">
  <meta property="og:image" content="https://azure-noob.com/static/images/hero/azure-tag-governance.png">

  
    <meta property="article:published_time" content="2025-10-31T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-10-31T00:00:00+00:00">
    <meta property="article:author" content="David Swann">
    
      
        <meta property="article:tag" content="Azure">
      
        <meta property="article:tag" content="Azure Policy">
      
        <meta property="article:tag" content="Compliance">
      
        <meta property="article:tag" content="FinOps">
      
        <meta property="article:tag" content="Governance">
      
        <meta property="article:tag" content="Tags">
      
    
  

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Azure Tag Governance 2025: Policies That Actually Enforce">
  <meta name="twitter:description" content="How to turn Azure tags from &#39;nice to have&#39; into enforceable governance using Azure Policy, deny/modify effects, and remediation so teams can‚Äôt slip around...">
  <meta name="twitter:image" content="https://azure-noob.com/static/images/hero/azure-tag-governance.png">

  <!-- Organization Schema for GEO/AEO entity recognition -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Azure Noob",
    "url": "https://azure-noob.com",
    "logo": "https://azure-noob.com/static/images/logo.png",
    "description": "Practical Azure cloud tutorials and guides from managing 31,000+ resources across 44 subscriptions in regulated enterprise environments.",
    "founder": {
      "@type": "Person",
      "name": "David Swann",
      "jobTitle": "Azure Architect",
      "sameAs": [
        "https://github.com/dswann101164",
        "https://www.linkedin.com/in/intikiswann/"
      ]
    },
    "sameAs": [
      "https://github.com/dswann101164"
    ]
  }
  </script>

  <!-- Styles -->
  <link rel="stylesheet" href="/static/styles.css">

  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="Azure Noob RSS Feed" href="https://azure-noob.com/rss.xml">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZNHGEB0BNZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-ZNHGEB0BNZ');
  </script>
</head>
<body>
  <header class="site-header">
    <div class="wrap nav-wrap">
      <div class="brand-block">
        <a href="/" class="brand-link">
          <img src="/static/images/logo.png" alt="Azure Noob logo" class="logo">
        </a>
        <span class="brand-text">
          <small>Official Website of</small>
          <strong>Azure Noob</strong>
        </span>
      </div>
      <nav class="nav">
        <a href="/">Home</a>
        <a href="/blog/">Blog</a>
        <a href="/hubs/" style="font-weight: 700;">Content Hubs</a>
        <a href="/products/" style="font-weight: 700; color: #ff6b6b;">Products</a>
        <a href="/start-here/">Start Here</a>
        <a href="/blog/starter-kit/">Starter Kit</a>
        <a href="/about/">About</a>
        <a href="/tags/">Tags</a>
        <a href="https://github.com/dswann101164" target="_blank" rel="noopener">GitHub</a>
        <a href="/search/">Search</a>
      </nav>
    </div>
  </header>

  <main class="site-content">
    <div class="wrap">
      


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "headline": "Azure Tag Governance 2025: Policies That Actually Enforce",
  "description": "How to turn Azure tags from &#39;nice to have&#39; into enforceable governance using Azure Policy, deny/modify effects, and remediation so teams can‚Äôt slip around...",
  "image": {
    "@type": "ImageObject",
    "url": "https://azure-noob.com/static/images/hero/azure-tag-governance.png",
    "width": 1200,
    "height": 630
  },
  "author": {
    "@type": "Person",
    "name": "David Swann",
    "url": "https://azure-noob.com/about/",
    "description": "Azure Architect specializing in enterprise cloud infrastructure",
    "jobTitle": "Azure Architect",
    "sameAs": [
      "https://github.com/dswann101164",
      "https://www.linkedin.com/in/intikiswann/"
    ],
    "worksFor": {
      "@type": "Organization",
      "name": "Synovus"
    }
  },
  "publisher": {
    "@type": "Organization",
    "name": "Azure Noob",
    "url": "https://azure-noob.com",
    "logo": {
      "@type": "ImageObject",
      "url": "https://azure-noob.com/static/images/logo.png"
    }
  },
  "datePublished": "2025-10-31T00:00:00+00:00",
  "dateModified": "2025-10-31T00:00:00+00:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://azure-noob.com/blog/azure-tag-governance-policy/"
  },
  "keywords": "Azure, Azure Policy, Compliance, FinOps, Governance, Tags",
  "articleSection": "Azure",
  "wordCount": "2566",
  "timeRequired": "PT13M",
  "inLanguage": "en-US",
  "isAccessibleForFree": "True",
  "proficiencyLevel": "Intermediate",
  
  "about": {
    "@type": "Thing",
    "name": "Azure"
  }
}
</script>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://azure-noob.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": "https://azure-noob.com/blog/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Azure Tag Governance 2025: Policies That Actually Enforce",
      "item": "https://azure-noob.com/blog/azure-tag-governance-policy/"
    }
  ]
}
</script>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "speakable": {
    "@type": "SpeakableSpecification",
    "cssSelector": [".summary", ".post-header h1", ".post-body h2", ".post-body p:first-of-type"]
  },
  "url": "https://azure-noob.com/blog/azure-tag-governance-policy/"
}
</script>









<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "How do you enforce Azure tags using Azure Policy?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Create a custom Azure Policy that checks for tag name existence (not values) using the exists:false condition, group multiple tag policies into an initiative with two policies per tag (one to apply tags to resource groups, one to inherit tags to child resources), and assign the initiative at management group scope for automatic inheritance to all subscriptions."
      }
    },
    {
      "@type": "Question",
      "name": "How does Azure tag inheritance work from resource groups to resources?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Using the built-in policy Inherit a tag from the resource group if missing, Azure automatically copies tag names and values from resource groups to new child resources created within them. Existing resources need a separate remediation task. The policy will not overwrite existing tag values on resources."
      }
    },
    {
      "@type": "Question",
      "name": "Should I use deny or modify effect for Azure tag policies?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Start with modify effect to automatically apply tags with blank values, reducing friction for users. Switch to deny effect for critical tags that must have specific values like Environment. The modify approach lets users create resources without thinking about tags, while deny forces users to tag correctly during creation."
      }
    },
    {
      "@type": "Question",
      "name": "What are the minimum tags to start with for Azure governance?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Start with three core tags: Application or Workload to identify what the resource is for, Environment to distinguish Production, Development, and Test, and CostCenter or Owner to identify who pays. Add more tags later as governance maturity grows."
      }
    },
    {
      "@type": "Question",
      "name": "How do you remediate existing untagged Azure resources?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Create remediation tasks in Policy > Remediation for each tag policy. Azure Policy scans all resource groups in scope and applies missing tag names with blank values. For large environments with 1000+ resources, remediation can take 10-30 minutes. Break large tasks into smaller chunks by subscription to avoid Resource Graph 10,000 result limits."
      }
    },
    {
      "@type": "Question",
      "name": "What is an Azure Policy initiative for tags?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "An initiative (policy set) groups multiple tag policies into a single assignment. For three tags you need six total policies: two per tag (one custom policy to apply tags to resource groups, one built-in policy to inherit tags to child resources). Initiative parameters let you change tag names at assignment level without modifying the initiative."
      }
    }
  ]
}
</script>


<article class="post">

  
  
    
    <div class="hero">
      <img src="/static/images/hero/azure-tag-governance.png" alt="Azure Tag Governance 2025: Policies That Actually Enforce" loading="eager">
    </div>
  

  <header class="post-header">
    <h1>Azure Tag Governance 2025: Policies That Actually Enforce</h1>
    <p class="muted">
      2025-10-31 ¬∑ ~13 min read
      
    </p>
    
    
    <ul class="tags-list">
      
      <li><a href="/tags/azure/" class="tag-badge">Azure</a></li>
      
      <li><a href="/tags/azure-policy/" class="tag-badge">Azure Policy</a></li>
      
      <li><a href="/tags/compliance/" class="tag-badge">Compliance</a></li>
      
      <li><a href="/tags/finops/" class="tag-badge">FinOps</a></li>
      
      <li><a href="/tags/governance/" class="tag-badge">Governance</a></li>
      
      <li><a href="/tags/tags/" class="tag-badge">Tags</a></li>
      
    </ul>
    
    
    
      <p class="summary">How to turn Azure tags from &#39;nice to have&#39; into enforceable governance using Azure Policy, deny/modify effects, and remediation so teams can‚Äôt slip around your standards.</p>
    
  </header>

  
  <p class="post-actions" style="margin:.5rem 0 0; text-align: center;">
    <button class="btn"
            onclick="window.print(); return false;"
            title="Print this page"
            aria-label="Print this page"
            style="cursor: pointer; background: none; border: 2px solid var(--azure-blue);">
      üñ®Ô∏è Print this page
    </button>
  </p>

  
  <div class="post-body">
    <p>This guide is part of our <a href="/hub/governance/">Azure Governance hub</a> covering policy enforcement, compliance frameworks, and enterprise controls.<br />
If you're managing more than a handful of Azure subscriptions, you've already discovered that tag chaos is real. Finance wants chargeback tags. Security wants owner tags. Compliance wants environment tags. And nobody wants to manually tag 10,000 resources.</p>
<p>Here's how to fix it using Azure Policy to enforce tags at scale and automatically inherit them to child resources.</p>
<p><strong>Updated for 2025:</strong> This guide uses the current Microsoft-recommended approach as of November 2025, including integration with the FinOps Toolkit and FOCUS exports. The core method hasn't changed - it's still Azure Policy with modify effects and tag inheritance - but I've added the latest production recommendations.</p>
<h2 id="the-problem">The Problem</h2>
<p>Manual tagging doesn't scale. You can beg people to tag resources correctly. You can send reminder emails. You can write wiki documentation that nobody reads. Or you can use Azure Policy to make tags mandatory and automatic.</p>
<p>This guide walks through:<br />
- Creating custom tag policies that check for tag names (not values)<br />
- Grouping multiple tag policies into a single initiative<br />
- Assigning policies at management group scope for automatic inheritance<br />
- Remediating existing resources to apply tags retroactively<br />
- Demonstrating automatic tag inheritance from resource groups to resources</p>
<h2 id="step-1-create-a-custom-tag-policy">Step 1: Create a Custom Tag Policy</h2>
<p>Azure has a built-in policy called "Add or replace a tag on resource groups" - but we're going to customize it because the default behavior checks both tag name AND value. We only care if the tag name exists.</p>
<h3 id="why-customize">Why Customize?</h3>
<p>The built-in policy uses <code>notEquals</code> condition, which means it tries to enforce both the tag name AND a specific value. We want flexibility - just ensure the tag exists, let users set their own values.</p>
<h3 id="create-the-custom-policy">Create the Custom Policy</h3>
<ol>
<li>Navigate to <strong>Policy &gt; Definitions</strong></li>
<li>Filter by category: <strong>Tags</strong></li>
<li>Find: <strong>Add or replace a tag on resource groups</strong></li>
<li>Click <strong>Duplicate definition</strong></li>
<li>Save at your <strong>Management Group scope</strong></li>
</ol>
<h3 id="key-changes-to-policy-logic">Key Changes to Policy Logic</h3>
<p><strong>Change 1: Replace the condition</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Old (built-in)</span>
<span class="nt">&quot;condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tags[parameters(&#39;tagName&#39;)]&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;notEquals&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;[parameters(&#39;tagValue&#39;)]&quot;</span>
<span class="p">}</span>

<span class="c1">// New (custom)</span>
<span class="nt">&quot;condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tags[parameters(&#39;tagName&#39;)]&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;exists&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;false&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p>This change ensures the policy only looks for a missing tag name - it doesn't care about the value.</p>
<p><strong>Change 2: Add default empty value</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;tagValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;displayName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Tag Value&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Value of the tag&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;defaultValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w">  </span><span class="c1">// &lt;-- Add this</span>
<span class="p">}</span>
</code></pre></div>

<p>When a missing tag is found, the policy applies the tag with a blank value. Users can then populate the value themselves.</p>
<h2 id="step-2-create-a-tag-initiative">Step 2: Create a Tag Initiative</h2>
<p>Instead of assigning individual tag policies, group them into an <strong>initiative</strong> (policy set). This makes it easier to manage multiple tags.</p>
<h3 id="create-new-initiative">Create New Initiative</h3>
<ol>
<li>Navigate to <strong>Policy &gt; Definitions &gt; + Initiative Definition</strong></li>
<li>Set basic configuration:</li>
<li><strong>Initiative location</strong>: Your management group</li>
<li><strong>Name</strong>: <code>Azure Tag Governance</code></li>
<li><strong>Description</strong>: <code>Enforce required tags on resource groups and inherit to resources</code></li>
<li><strong>Category</strong>: <code>Tags</code></li>
</ol>
<h3 id="add-policy-definitions">Add Policy Definitions</h3>
<p>For each tag you want to govern, add TWO policies:</p>
<ol>
<li><strong>Your custom policy</strong>: Applies tags to resource groups</li>
<li><strong>Microsoft's built-in</strong>: <code>Inherit a tag from the resource group if missing</code></li>
</ol>
<p>Example for three tags (Application, Environment, CostCenter):<br />
- 6 total policies (2 per tag)<br />
- Custom policy #1: Application tag on resource groups<br />
- Built-in policy #1: Inherit Application tag from RG<br />
- Custom policy #2: Environment tag on resource groups<br />
- Built-in policy #2: Inherit Environment tag from RG<br />
- Custom policy #3: CostCenter tag on resource groups<br />
- Built-in policy #3: Inherit CostCenter tag from RG</p>
<h3 id="create-initiative-parameters">Create Initiative Parameters</h3>
<p>Create one parameter for each tag name:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;tagName1&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;displayName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Tag Name 1&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;First required tag name&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;defaultValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Application&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;tagName2&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;defaultValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Environment&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;tagName3&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;defaultValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CostCenter&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="map-policy-parameters-to-initiative-parameters">Map Policy Parameters to Initiative Parameters</h3>
<p>For each policy definition in your initiative, map the policy's <code>tagName</code> parameter to the related initiative parameter:</p>
<ul>
<li>Policy Definition Parameter: <code>tagName</code></li>
<li>Value Type: <strong>Use initiative parameter</strong></li>
<li>Value: Select <code>tagName1</code>, <code>tagName2</code>, or <code>tagName3</code></li>
</ul>
<p>This allows you to change tag names at the assignment level without modifying the initiative.</p>
<h2 id="step-3-assign-the-initiative">Step 3: Assign the Initiative</h2>
<p>Now assign your new initiative to enforce tag governance.</p>
<h3 id="assignment-configuration">Assignment Configuration</h3>
<ol>
<li><strong>Scope</strong>: Your management group (inherits to all subscriptions below)</li>
<li><strong>Enforcement mode</strong>: <strong>Enabled</strong> (automatic remediation for new/changed resources)</li>
<li><strong>Parameters</strong>: Specify your tag names</li>
<li>Tag Name 1: <code>Application</code></li>
<li>Tag Name 2: <code>Environment</code></li>
<li>Tag Name 3: <code>CostCenter</code></li>
<li><strong>Managed Identity</strong>: Required for <code>modify</code> effect policies (auto-created)</li>
</ol>
<h3 id="why-management-group-scope">Why Management Group Scope?</h3>
<p>Assigning at the management group means every subscription underneath automatically inherits the tag policies. Add a new subscription? It's already governed.</p>
<h2 id="step-4-trigger-policy-scan-optional">Step 4: Trigger Policy Scan (Optional)</h2>
<p>Policy compliance stats update automatically in the background, but you can manually trigger a fresh scan:</p>
<p><strong>Using Azure Cloud Shell:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Trigger policy scan for a specific subscription</span>
<span class="nb">Start-AzPolicyComplianceScan</span> <span class="n">-SubscriptionId</span> <span class="s2">&quot;YOUR-SUB-ID&quot;</span>

<span class="c"># Trigger for multiple subscriptions</span>
<span class="nv">$subs</span> <span class="p">=</span> <span class="p">@(</span><span class="s2">&quot;sub-id-1&quot;</span><span class="p">,</span> <span class="s2">&quot;sub-id-2&quot;</span><span class="p">)</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$sub</span> <span class="k">in</span> <span class="nv">$subs</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Start-AzPolicyComplianceScan</span> <span class="n">-SubscriptionId</span> <span class="nv">$sub</span>
<span class="p">}</span>
</code></pre></div>

<p>This updates compliance stats on-demand instead of waiting for the automatic scan.</p>
<h2 id="step-5-remediate-existing-resources">Step 5: Remediate Existing Resources</h2>
<p>Your policy assignment only applies to NEW or CHANGED resources. Existing resource groups need manual remediation.</p>
<h3 id="create-remediation-task">Create Remediation Task</h3>
<ol>
<li>Navigate to <strong>Policy &gt; Remediation</strong></li>
<li>Select your policy assignment: <code>Azure Tag Governance</code></li>
<li>For each tag policy governing resource groups:</li>
<li>Click <strong>Create Remediation Task</strong></li>
<li>Select the policy definition</li>
<li>Leave defaults (or adjust scope as needed)</li>
<li>Click <strong>Remediate</strong></li>
</ol>
<p>Repeat for all three custom policies (Application, Environment, CostCenter on resource groups).</p>
<h3 id="what-happens-during-remediation">What Happens During Remediation?</h3>
<p>Azure Policy scans all resource groups in scope and applies the missing tag names with blank values. You'll see the tags appear in the Azure portal within a few minutes.</p>
<h2 id="step-6-test-tag-inheritance">Step 6: Test Tag Inheritance</h2>
<p>Now for the magic - demonstrating that tags automatically inherit from resource groups to resources.</p>
<h3 id="update-tag-values-on-resource-group">Update Tag Values on Resource Group</h3>
<ol>
<li>Select any resource group</li>
<li>Navigate to <strong>Tags</strong></li>
<li>You'll see three blank tags: <code>Application</code>, <code>Environment</code>, <code>CostCenter</code></li>
<li>Set values:</li>
<li>Application: <code>FinancePortal</code></li>
<li>Environment: <code>Production</code></li>
<li>CostCenter: <code>12345</code></li>
</ol>
<h3 id="create-a-new-resource">Create a New Resource</h3>
<ol>
<li>Create any resource within that resource group (NSG, Storage Account, VM, etc.)</li>
<li><strong>Don't specify any tags during creation</strong></li>
<li>After creation, check the resource's tags</li>
</ol>
<p><strong>Result</strong>: The resource automatically has all three tags with values inherited from the parent resource group.</p>
<h2 id="how-it-actually-works">How It Actually Works</h2>
<p>Here's the policy logic in action:</p>
<h3 id="resource-group-creation">Resource Group Creation</h3>
<ol>
<li>You create a resource group (with or without tags)</li>
<li>Policy detects missing tag names: <code>Application</code>, <code>Environment</code>, <code>CostCenter</code></li>
<li>Policy applies these tags with blank values</li>
<li>You manually set the tag values</li>
</ol>
<h3 id="resource-creation">Resource Creation</h3>
<ol>
<li>You create a resource (VM, Storage, etc.)</li>
<li>Resource doesn't have required tags</li>
<li>Policy checks parent resource group for tag values</li>
<li>Policy copies tag names AND values to the resource</li>
<li>Your resource is now properly tagged</li>
</ol>
<h3 id="resource-group-updates">Resource Group Updates</h3>
<p>If you change a resource group tag value:<br />
- Existing resources keep their current values (policy won't overwrite)<br />
- NEW resources created after the change inherit the updated value</p>
<h2 id="why-this-approach-works">Why This Approach Works</h2>
<p><strong>Flexibility</strong>: Tag names are enforced, but users control the values<br />
<strong>Automation</strong>: No manual tagging required for child resources<br />
<strong>Scale</strong>: Works across thousands of resources automatically<br />
<strong>Compliance</strong>: Policy compliance dashboard shows coverage<br />
<strong>Retroactive</strong>: Remediation applies to existing resources</p>
<h2 id="common-gotchas">Common Gotchas</h2>
<h3 id="policy-won-t-overwrite-existing-tag-values">Policy Won't Overwrite Existing Tag Values</h3>
<p>If a resource already has a tag value, the policy won't change it. This is by design - you don't want policies overwriting intentional tag values.</p>
<p><strong>Solution</strong>: Delete the incorrect tag, let the policy reapply it, then set the correct value.</p>
<h3 id="remediation-isn-t-instant">Remediation Isn't Instant</h3>
<p>Policy remediation tasks run in the background. For large environments (1000+ resources), it can take 10-30 minutes.</p>
<p><strong>Solution</strong>: Check the remediation task status in <strong>Policy &gt; Remediation</strong> to monitor progress.</p>
<h3 id="tags-don-t-inherit-to-existing-resources">Tags Don't Inherit to Existing Resources</h3>
<p>The inheritance policy only applies to NEW resources created after the policy assignment.</p>
<p><strong>Solution</strong>: Run a separate remediation task for the inheritance policies to retroactively apply tags to existing resources.</p>
<h3 id="management-groups-require-planning">Management Groups Require Planning</h3>
<p>If you assign policies at the wrong management group level, you'll govern resources you didn't intend to.</p>
<p><strong>Solution</strong>: Test policy assignments in a non-production management group first. Use exclusions if needed.</p>
<h2 id="production-recommendations">Production Recommendations</h2>
<h3 id="start-with-three-core-tags">Start with Three Core Tags</h3>
<p>Don't try to govern 20 tags immediately. Start with:<br />
1. <strong>Application</strong> or <strong>Workload</strong> - What is this resource for?<br />
2. <strong>Environment</strong> - Production, Development, Test<br />
3. <strong>CostCenter</strong> or <strong>Owner</strong> - Who pays for this?</p>
<p>Add more tags later as your governance matures.</p>
<h3 id="use-finops-toolkit-for-tag-monitoring-2025-update">Use FinOps Toolkit for Tag Monitoring (2025 Update)</h3>
<p>Once your policies are working, deploy the <strong>FinOps Toolkit Governance Workbook</strong> to visualize tag compliance across your environment.</p>
<p><strong>What it shows:</strong><br />
- Tag coverage percentage by subscription<br />
- Resources missing required tags<br />
- Tag value consistency issues<br />
- Cost allocation by properly tagged resources</p>
<p><strong>Deploy it:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Install FinOps PowerShell module</span>
<span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">FinOpsToolkit</span>

<span class="c"># Deploy Governance Workbook</span>
<span class="nb">New-FinOpsWorkbook</span> <span class="n">-Name</span> <span class="s2">&quot;governance-workbook&quot;</span> <span class="n">-ResourceGroupName</span> <span class="s2">&quot;finops-hub-rg&quot;</span>
</code></pre></div>

<p>The Governance Workbook integrates with your Policy compliance data and Cost Management to show the business impact of proper tagging. This is way more effective than staring at Policy compliance stats.</p>
<p><strong>Resource:</strong> <a href="https://learn.microsoft.com/en-us/cloud-computing/finops/toolkit/workbooks/governance">FinOps Toolkit Governance Workbook</a></p>
<h3 id="enable-focus-exports-for-cross-cloud-reporting">Enable FOCUS Exports for Cross-Cloud Reporting</h3>
<p>Azure now supports the <strong>FinOps Open Cost &amp; Usage Specification (FOCUS)</strong> format. Your tags automatically flow into FOCUS exports, enabling standardized cost reporting across Azure, AWS, and GCP.</p>
<p><strong>Why this matters:</strong> If you're in a multi-cloud environment (or might be someday), FOCUS lets you use the same cost allocation model across all clouds. Your tag governance work pays dividends beyond Azure.</p>
<p><strong>Setup:</strong><br />
1. Navigate to <strong>Cost Management &gt; Exports</strong><br />
2. Create new export<br />
3. Select <strong>FOCUS 1.0</strong> as the schema<br />
4. Your tags appear as columns in the export</p>
<h3 id="use-deny-effect-for-critical-tags">Use Deny Effect for Critical Tags</h3>
<p>For tags that MUST have specific values (like Environment: Production, Development, Test), use a <code>deny</code> effect policy instead of <code>modify</code>.</p>
<p><strong>Why</strong>: Prevents users from creating resources with invalid tag values.</p>
<h3 id="support-tags-with-spaces-2025-feature">Support Tags with Spaces (2025 Feature)</h3>
<p>Azure Policy now supports <strong>"promoted tags"</strong> - tags with spaces in the key name. Previously, tag keys like <code>Cost Center</code> would break policies. Now they work fine.</p>
<p>If you're migrating from on-premises systems that use spaces in tag names, you don't need to rename everything anymore.</p>
<h3 id="document-your-tag-standards">Document Your Tag Standards</h3>
<p>Create a wiki page or README explaining:<br />
- What each tag means<br />
- Valid values for each tag<br />
- Examples of correct tagging</p>
<p>Nobody reads documentation, but at least you have it when someone asks.</p>
<h3 id="monitor-compliance-dashboard">Monitor Compliance Dashboard</h3>
<p>Check <strong>Policy &gt; Compliance</strong> weekly to identify:<br />
- Resources that aren't compliant<br />
- Subscriptions with low compliance rates<br />
- Policy definitions that aren't working as expected</p>
<h3 id="watch-for-resource-graph-limits">Watch for Resource Graph Limits</h3>
<p>Azure Resource Graph queries are limited to <strong>10,000 results</strong>. In large environments (10K+ resources), this can cause tag remediation to fail silently.</p>
<p><strong>Solution:</strong> Filter remediation by management group or subscription instead of running tenant-wide. Break large remediation tasks into smaller chunks:</p>
<div class="codehilite"><pre><span></span><code><span class="c"># Instead of remediating all resources at once</span>
<span class="c"># Break it down by subscription</span>
<span class="nv">$subs</span> <span class="p">=</span> <span class="nb">Get-AzSubscription</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$sub</span> <span class="k">in</span> <span class="nv">$subs</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Start-AzPolicyRemediation</span> <span class="n">-PolicyAssignmentId</span> <span class="nv">$policyId</span> <span class="n">-Scope</span> <span class="s2">&quot;/subscriptions/</span><span class="p">$(</span><span class="nv">$sub</span><span class="p">.</span><span class="n">Id</span><span class="p">)</span><span class="s2">&quot;</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="alternative-use-deny-instead-of-modify">Alternative: Use Deny Instead of Modify</h2>
<p>If you want to FORCE users to tag resources correctly during creation, use the <code>deny</code> effect instead of <code>modify</code>.</p>
<p><strong>Modify Effect</strong> (what we used):<br />
- Automatically applies tags<br />
- Users can create resources without thinking about tags<br />
- Good for user experience</p>
<p><strong>Deny Effect</strong>:<br />
- Blocks resource creation until required tags are provided<br />
- Forces users to think about tagging<br />
- Good for strict compliance</p>
<p><strong>My recommendation</strong>: Start with <code>modify</code> to reduce friction, then switch to <code>deny</code> for critical tags once users understand the tagging model.</p>
<h2 id="key-takeaways">Key Takeaways</h2>
<ol>
<li><strong>Custom policies beat built-in</strong>: Customize the logic to check tag existence, not values</li>
<li><strong>Initiatives make management easier</strong>: Group related policies instead of assigning individually</li>
<li><strong>Management group scope scales</strong>: One assignment governs all subscriptions below</li>
<li><strong>Tag inheritance is automatic</strong>: Resource groups pass tags to child resources</li>
<li><strong>Remediation handles existing resources</strong>: Don't manually tag 10,000 resources</li>
</ol>
<h2 id="what-s-next">What's Next?</h2>
<p>You now have basic tag governance working. Next steps:</p>
<ol>
<li><strong>Add more tags</strong> as your FinOps maturity grows</li>
<li><strong>Export compliance reports</strong> for leadership</li>
<li><strong>Integrate with Cost Management</strong> for chargeback</li>
<li><strong>Create Azure Workbooks</strong> to visualize tag coverage</li>
</ol>
<p>Tag governance isn't exciting, but it's the foundation for cost allocation, security ownership, and operational accountability at scale. Get this right, and everything else gets easier.</p>
<hr />
<hr />
<h3 id="auto-deny-the-unknowns">üîç Auto-Deny the "Unknowns"</h3>
<p>Don't just audit. Block bad financial data at the door with this policy snippet.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Deny deployment if Department tag causes &quot;Unknown&quot; financial route</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;if&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tags[&#39;Department&#39;]&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;equals&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Unknown&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;then&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;deny&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h3 id="policy-needs-people">üõë Policy Needs People</h3>
<p>A 'Deny' policy stops deployment, but who handles the support ticket?<br />
<strong><a href="https://davidnoob.gumroad.com/l/ifojm?ref=cost-batch-tag-policy">Download the Azure RACI Matrix</a></strong> to define the 'Policy Exception Approver' role.</p>
<div class="downloads" style="text-align: center; margin-top: 2rem;">
  <a class="btn" href="https://davidnoob.gumroad.com/l/ifojm?ref=cost-batch-tag-policy" style="font-size: 1.2em; padding: 15px 30px; background-color: #0078d4; color: white;">Get the Governance RACI</a>
  <div class="preview-block" style="margin-top: 10px; font-size: 0.9em; color: #555;">
     <span>‚úÖ Roles Included</span> ‚Ä¢ <span>üí≤ Price: $29</span> ‚Ä¢ <span>üìä Excel Format</span>
  </div>
</div>

<p><em>All policies and scripts from this post are available in the <a href="https://github.com/dswann101164">Azure Tag Governance repo on GitHub</a>.</em></p>
  </div>

  
  <section class="starter-kit-callout" style="
    max-width: 800px;
    margin: 3rem auto 2rem;
    padding: 2rem;
    border-radius: 12px;
    background: var(--bg-light);
    border: 1px solid var(--border);
    text-align: left;
  ">
    <h3 style="margin-top: 0;">Azure Admin Starter Kit (Free Download)</h3>
    <p style="margin-bottom: 1rem;">
      Get my KQL cheat sheet, 50 Windows + 50 Linux commands, and an Azure RACI template in one free bundle.
    </p>
    <a href="/blog/starter-kit/" class="btn">Get the Starter Kit ‚Üí</a>
  </section>

  
  <aside class="email-capture" style="max-width: 800px; margin: 4rem auto; padding: 3rem; background: linear-gradient(135deg, #0078d4 0%, #005a9e 100%); border-radius: 12px; text-align: center; color: white;">
    <h3 style="margin-top: 0; color: white; font-size: 1.75rem;">Get Azure operational guides in your inbox</h3>
    <p style="margin: 1rem 0 2rem; font-size: 1.1rem; color: white;">Weekly tips from managing 44 Azure subscriptions. No marketing BS.</p>
    
    <form action="https://app.kit.com/forms/8896829/subscriptions" method="post" style="max-width: 500px; margin: 0 auto; display: flex; gap: 0.75rem; flex-wrap: wrap; justify-content: center;">
      <input type="email" 
             name="email_address" 
             placeholder="your@email.com" 
             required 
             style="flex: 1; min-width: 250px; padding: 0.875rem 1rem; border: none; border-radius: 8px; font-size: 1rem; color: #333;">
      <button type="submit" 
              style="padding: 0.875rem 2rem; background: white; color: #0078d4; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; white-space: nowrap; font-size: 1rem; transition: all 0.2s;">
        Subscribe
      </button>
    </form>
    
    <p style="margin: 1.5rem 0 0; font-size: 0.9rem; opacity: 0.9; color: white;">
      Join 500+ Azure admins. Unsubscribe anytime.
    </p>
  </aside>

  
  
  <aside class="related-posts" style="max-width: 800px; margin: 3rem auto; padding: 2rem; background: var(--bg-light); border-radius: 12px;">
    <h3 style="margin-top: 0;">Related Posts</h3>
    <ul style="list-style: none; padding: 0;">
      
      <li style="margin: 1rem 0;">
        <a href="/blog/resource-tags-100k-problem/" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">The $100k Tag Problem: Calculating Hidden Azure Costs (2025)</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-11-24</span>
        </a>
      </li>
      
      <li style="margin: 1rem 0;">
        <a href="/blog/azure-hybrid-benefit-complete/" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">Azure Hybrid Benefit Audit Guide: Avoid the $50K Licensing Mistake (2025)</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-12-11</span>
        </a>
      </li>
      
      <li style="margin: 1rem 0;">
        <a href="/blog/azure-chargeback-tags-model/" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">Azure Chargeback Tags 2025: The 6 Tags That Actually Work</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-10-16</span>
        </a>
      </li>
      
    </ul>
  </aside>
  

  
  
  
    <!-- CTA: FinOps Resources -->
<div class="cta-block" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 2rem; border-radius: 8px; margin: 3rem 0; text-align: center; color: white;">
  <h3 style="margin: 0 0 1rem; font-size: 1.75rem; color: white;">üí∞ Stop Guessing at Azure Costs</h3>
  <p style="margin: 0 0 1.5rem; font-size: 1.1rem; line-height: 1.6;">
    Get the <strong>Azure FinOps Framework</strong> with cost allocation templates, tag governance policies, 
    and showback dashboards that finance actually understands.
  </p>
  <a href="/static/downloads/Azure-Integration-Assessment-Framework.xlsx" 
     download
     style="display: inline-block; padding: 0.75rem 2rem; background: white; color: #667eea; text-decoration: none; border-radius: 6px; font-weight: 700; font-size: 1.1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transition: all 0.3s ease;"
     onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,0,0,0.2)'"
     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'">
    Download FinOps Framework
  </a>
  <p style="margin: 1rem 0 0; font-size: 0.9rem; opacity: 0.9;">
    Excel template ‚Ä¢ KQL queries included ‚Ä¢ No email required
  </p>
</div>
  

  
  <nav class="post-nav">
    
      <a href="/blog/azure-icons-reference/">
        <span style="opacity: 0.7; font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">‚Üê Previous</span>
        <strong>Azure Icons Reference: 284 Official Architecture Icons</strong>
      </a>
    
    
      <a href="/blog/terraform-azure-devops-cicd-series-index/" style="text-align: right;">
        <span style="opacity: 0.7; font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">Next ‚Üí</span>
        <strong>Enterprise-Grade Terraform CI/CD in Azure DevOps - Complete Series</strong>
      </a>
    
  </nav>

</article>

    </div>
  </main>

  <footer class="site-footer">
    <div class="wrap">
      
      <!-- Featured Bundle Promotion - TEMPORARILY DISABLED
      <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 2rem; border-radius: 8px; margin-bottom: 2rem; text-align: center; color: white;">
        <h3 style="color: white; margin: 0 0 0.75rem 0; font-size: 1.5rem;">üì¶ Enterprise Azure Operations Bundle</h3>
        <p style="font-size: 1.05rem; margin: 0 0 1rem 0; opacity: 0.95;">
          Get all 4 digital products for <strong style="font-size: 1.25rem;">$97</strong> <span style="text-decoration: line-through; opacity: 0.7;">($86 separately)</span>
        </p>
        <ul style="list-style: none; padding: 0; margin: 1rem 0 1.5rem; text-align: left; max-width: 500px; margin-left: auto; margin-right: auto; font-size: 0.95rem;">
          <li style="padding: 0.35rem 0;">‚úîÔ∏è Azure AI FinOps Query Pack (12 production KQL queries)</li>
          <li style="padding: 0.35rem 0;">‚úîÔ∏è Azure Migration Assessment Pro (55-question framework)</li>
          <li style="padding: 0.35rem 0;">‚úîÔ∏è Azure CAF Operations RACI Pro (Governance matrix)</li>
          <li style="padding: 0.35rem 0;">‚úîÔ∏è Enterprise Azure Inventory KQL Pack (Tested on 30K+ resources)</li>
        </ul>
        <a href="https://davidnoob.gumroad.com/l/azure-ops-bundle" 
           style="display: inline-block; padding: 0.875rem 2rem; background: white; color: #667eea; text-decoration: none; border-radius: 6px; font-weight: 700; font-size: 1.05rem; box-shadow: 0 4px 12px rgba(0,0,0,0.2);" 
           target="_blank" rel="noopener">
          Get the Bundle ‚Üí
        </a>
        <p style="margin: 1rem 0 0; font-size: 0.85rem; opacity: 0.9;">
          Instant digital delivery ‚Ä¢ Lifetime updates ‚Ä¢ Money-back guarantee
        </p>
      </div>
      -->
      
      <p>&copy; 2026 Azure Noob ‚Äî Don&#39;t be a Noob</p>
      <p style="margin-top: 0.5rem; font-size: 0.9rem;">
        <a href="/rss.xml" title="Subscribe via RSS">RSS Feed</a> ¬∑ 
        <a href="https://github.com/dswann101164" target="_blank" rel="noopener">GitHub</a>
      </p>
      <p style="margin-top: 1.5rem; font-size: 0.85rem; opacity: 0.7; font-style: italic;">
        "Trust in the Lord with all your heart, and lean not on your own understanding;<br>
        in all your ways acknowledge Him, and He will make your paths straight" ‚Äî Proverbs 3:5-6
      </p>
    </div>
  </footer>

  <!-- Copy code functionality -->
  <script src="/static/copy-code.js"></script>

  <!-- Exit-Intent Popup -->
  <div id="exit-popup" class="exit-popup" style="display: none;">
    <div class="exit-popup-content">
      <button class="exit-popup-close" onclick="closeExitPopup()">&times;</button>
      <h2>Wait! Before You Go...</h2>
      <p class="exit-popup-subtitle">Get the <strong>FREE Azure Admin Starter Kit</strong></p>
      <ul class="exit-popup-benefits">
        <li>‚úì 15 Essential KQL Queries</li>
        <li>‚úì 50 Windows Commands</li>
        <li>‚úì 50 Linux Commands</li>
      </ul>
      <form id="exit-popup-form" class="exit-popup-form">
        <input type="email" id="popup-email" placeholder="Enter your email" required>
        <button type="submit" class="exit-popup-submit">Send Me The Free Kit</button>
      </form>
      <p class="exit-popup-privacy">We'll also notify you about new tools & guides. Unsubscribe anytime.</p>
    </div>
  </div>

  <style>
  .exit-popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .exit-popup-content {
    background: white;
    padding: 2.5rem;
    border-radius: 12px;
    max-width: 500px;
    width: 90%;
    position: relative;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: slideUp 0.3s ease;
  }

  @keyframes slideUp {
    from { transform: translateY(50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .exit-popup-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    font-size: 2rem;
    cursor: pointer;
    color: #999;
    line-height: 1;
  }

  .exit-popup-close:hover {
    color: #333;
  }

  .exit-popup h2 {
    margin: 0 0 0.5rem 0;
    color: #0078d4;
    font-size: 2rem;
  }

  .exit-popup-subtitle {
    font-size: 1.2rem;
    margin: 0 0 1.5rem 0;
  }

  .exit-popup-benefits {
    list-style: none;
    padding: 0;
    margin: 1.5rem 0;
  }

  .exit-popup-benefits li {
    padding: 0.5rem 0;
    font-size: 1.1rem;
  }

  .exit-popup-form {
    margin: 1.5rem 0;
  }

  .exit-popup-form input[type="email"] {
    width: 100%;
    padding: 1rem;
    border: 2px solid #ddd;
    border-radius: 6px;
    font-size: 1rem;
    margin-bottom: 1rem;
  }

  .exit-popup-form input[type="email"]:focus {
    outline: none;
    border-color: #0078d4;
  }

  .exit-popup-submit {
    width: 100%;
    padding: 1rem 2rem;
    background: #0078d4;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 1.1rem;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s;
  }

  .exit-popup-submit:hover {
    background: #005a9e;
  }

  .exit-popup-privacy {
    font-size: 0.85rem;
    color: #666;
    margin-top: 1rem;
    text-align: center;
  }
  </style>

  <script>
  // Exit-intent detection
  let exitPopupShown = false;
  let mouseY = 0;

  document.addEventListener('mousemove', (e) => {
    mouseY = e.clientY;
  });

  document.addEventListener('mouseout', (e) => {
    // If mouse leaves through top of viewport and popup hasn't been shown
    if (!exitPopupShown && e.clientY <= 0 && mouseY <= 100) {
      // Check if user has seen it before (session storage)
      if (!sessionStorage.getItem('exitPopupSeen')) {
        showExitPopup();
      }
    }
  });

  function showExitPopup() {
    exitPopupShown = true;
    document.getElementById('exit-popup').style.display = 'flex';
    sessionStorage.setItem('exitPopupSeen', 'true');
  }

  function closeExitPopup() {
    document.getElementById('exit-popup').style.display = 'none';
  }

  // Handle form submission
  document.getElementById('exit-popup-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('popup-email').value;
    
    // Send to Kit (ConvertKit)
    try {
      const FORM_ID = '8896829'; // Your Kit Form ID
      
      const response = await fetch(`https://api.convertkit.com/v3/forms/${FORM_ID}/subscribe`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          email: email
        })
      });
      
      if (response.ok) {
        console.log('‚úÖ Email captured to Kit:', email);
      }
      
      closeExitPopup();
      
      // Track in Google Analytics
      if (typeof gtag !== 'undefined') {
        gtag('event', 'signup', {
          'event_category': 'email',
          'event_label': 'exit_popup',
          'value': email
        });
      }
      
      // Redirect to starter kit page
      window.location.href = '/blog/starter-kit/';
      
    } catch (error) {
      console.error('Error:', error);
      // Still redirect even if tracking fails
      window.location.href = '/blog/starter-kit/';
    }
  });

  // Close on background click
  document.getElementById('exit-popup').addEventListener('click', (e) => {
    if (e.target.id === 'exit-popup') {
      closeExitPopup();
    }
  });
  </script>
</body>
</html>