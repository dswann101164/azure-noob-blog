<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  

  <!-- Primary SEO -->
  <title>Azure Noob</title>
  <meta name="description" content="Don&#39;t be a Noob">
  <link rel="canonical" href="https://azure-noob.com" />

  <!-- Favicons -->
  <link rel="icon" href="../../static/images/logo.png">

  <!-- Open Graph -->
  <meta property="og:title" content="Azure Noob">
  <meta property="og:description" content="Don&#39;t be a Noob">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://azure-noob.com">
  <meta property="og:image" content="../../static/images/hero/cloud-wars.png">

  

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Azure Noob">
  <meta name="twitter:description" content="Don&#39;t be a Noob">
  <meta name="twitter:image" content="../../static/images/hero/cloud-wars.png">

  <!-- Styles -->
  <link rel="stylesheet" href="../../static/styles.css">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZNHGEB0BNZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-ZNHGEB0BNZ');
  </script>
</head>
<body>
  <header class="site-header">
    <div class="wrap nav-wrap">
      <div class="brand-block">
        <a href="../../index.html" class="brand-link">
          <img src="../../static/images/logo.png" alt="Azure Noob logo" class="logo">
        </a>
        <span class="brand-text">
          <small>Official Website of</small>
          <strong>Azure Noob</strong>
        </span>
      </div>
      <nav class="nav">
        <a href="../../index.html">Home</a>
        <a href="../index.html">Blog</a>
        <a href="../../about/index.html">About</a>
        <a href="../../tags/index.html">Tags</a>
        <a href="../../search/index.html">Search</a>
      </nav>
    </div>
  </header>

  <main class="site-content">
    <div class="wrap">
      
<article class="post">

  
  
    
    <div class="hero">
      <img src="../../static/images/hero/azure-soc2-activity-log.svg" alt="The Missing SOC 2 Guide: Azure Activity Log Setup (Grill Assembly Manual Edition)">
    </div>
  

  <header class="post-header">
    <h1>The Missing SOC 2 Guide: Azure Activity Log Setup (Grill Assembly Manual Edition)</h1>
    <p class="muted">
      2025-10-27 ¬∑ ~26 min read
    </p>
    
    
    <ul class="tags-list">
      
      <li><a href="../../tags/Azure/index.html" class="tag-badge">Azure</a></li>
      
      <li><a href="../../tags/SOC2/index.html" class="tag-badge">SOC2</a></li>
      
      <li><a href="../../tags/Compliance/index.html" class="tag-badge">Compliance</a></li>
      
      <li><a href="../../tags/Monitoring/index.html" class="tag-badge">Monitoring</a></li>
      
      <li><a href="../../tags/Activity%20Logs/index.html" class="tag-badge">Activity Logs</a></li>
      
    </ul>
    
    
    
      <p class="summary">Every guide says &#39;configure diagnostic settings.&#39; Nobody shows you which button to click. Here&#39;s the step-by-step tutorial that actually works, written for someone who&#39;s never done this before.</p>
    
  </header>

  
  <p class="post-actions" style="margin:.5rem 0 0; text-align: center;">
    <button class="btn"
            onclick="window.print(); return false;"
            title="Print this page"
            aria-label="Print this page"
            style="cursor: pointer; background: none; border: 2px solid var(--azure-blue);">
      üñ®Ô∏è Print this page
    </button>
  </p>

  
  <div class="post-body">
    <p>Last week I published <a href="/blog/azure-audit-gap-nobody-talks-about/">The Azure Audit Gap Nobody Talks About</a>. The response was overwhelming: "This is great, but WHERE DO I START?"</p>
<p>Every Azure SOC 2 guide I've found says the same thing: "Configure diagnostic settings for Activity Logs to meet SOC 2 requirements."</p>
<p>Cool. <strong>Which button do I click?</strong></p>
<p>Nobody tells you. It's like buying a grill from Home Depot and the instructions say "assemble the grill" with no pictures, no step numbers, no "insert bolt D into hole E."</p>
<p>Here's the grill assembly manual version. Follow these steps, and in 30 minutes you'll have SOC 2-compliant Activity Log retention. No guessing. No "figure it out yourself." Just click what I tell you to click.</p>
<h2>What You're Actually Setting Up</h2>
<p><strong>The problem:</strong> Azure keeps Activity Logs for 90 days. SOC 2 requires 12+ months. When your auditor asks "who deleted this storage account in March?" six months later, you have nothing.</p>
<p><strong>The solution:</strong> Export Activity Logs to two places:<br />
1. <strong>Log Analytics Workspace</strong> - Query logs for 12+ months using KQL<br />
2. <strong>Storage Account</strong> - Archive logs for 7 years (cheap long-term storage)</p>
<p><strong>Time required:</strong> 30 minutes to set up, 5 minutes to verify</p>
<p><strong>What you need:</strong><br />
- Azure account with Owner or Contributor permissions on a subscription<br />
- 30 minutes of your time<br />
- Coffee (you'll wait 15 minutes for logs to sync)</p>
<p><strong>Cost:</strong> $7-15/month for small environments, $60-170/month for medium, $730-950/month for enterprise</p>
<p>Let's do this.</p>
<hr />
<h2>Part 1: Create Log Analytics Workspace (10 minutes)</h2>
<p>This is where you'll run KQL queries to answer audit questions like "who did what when?"</p>
<h3>Step 1: Open Azure Portal and Search</h3>
<ol>
<li>Go to <strong>portal.azure.com</strong> in your browser</li>
<li>Sign in with your Azure account</li>
<li>Look at the <strong>search bar at the very top</strong> - it says "Search resources, services, and docs (G+/)"</li>
<li>Click in that search bar</li>
<li>Type: <code>log analytics workspaces</code></li>
<li>Click <strong>"Log Analytics workspaces"</strong> in the dropdown results (has a database icon)</li>
</ol>
<p><strong>You should see:</strong> A page titled "Log Analytics workspaces" with a list of existing workspaces (might be empty if this is your first one)</p>
<p><strong>If you see an error:</strong> Check if you're signed in to the correct subscription. Click your profile icon (top right) to verify.</p>
<hr />
<h3>Step 2: Create New Workspace</h3>
<ol>
<li>Look at the top-left of the page</li>
<li>Click the <strong>"+ Create"</strong> button (blue button with a plus sign)</li>
</ol>
<p><strong>You should see:</strong> A new page opens titled "Create Log Analytics workspace" with tabs at the top: Basics, Tags, Review + create</p>
<hr />
<h3>Step 3: Fill in the Basics Tab</h3>
<p>You're on the <strong>"Basics"</strong> tab. Fill in these fields:</p>
<p><strong>Subscription:</strong><br />
- Click the dropdown<br />
- Select your subscription (if you only have one, it's already selected)<br />
- <strong>Write this down on paper:</strong> <strong><em>_</em></strong><strong><em>_</em></strong>___ (you'll need it in Part 3)</p>
<p><strong>Resource Group:</strong><br />
- Click the dropdown<br />
- Do you see a resource group for governance/compliance stuff? Use that.<br />
- If not (or you're starting fresh):<br />
  - Click <strong>"Create new"</strong> below the dropdown<br />
  - A popup appears<br />
  - Type exactly: <code>soc2-compliance-rg</code><br />
  - Click <strong>"OK"</strong><br />
- <strong>Write this down:</strong> <strong><em>_</em></strong><strong><em>_</em></strong>___</p>
<p><strong>Name:</strong><br />
- Type: <code>soc2-audit-logs</code><br />
- <strong>If Azure says "Name not available"</strong> (red error):<br />
  - Add random numbers: <code>soc2-audit-logs-847</code><br />
  - Keep trying different numbers until you get a green checkmark<br />
- <strong>Write this name down:</strong> <strong><em>_</em></strong><strong><em>_</em></strong>___ (critical - you need this in Part 3)</p>
<p><strong>Region:</strong><br />
- Click the dropdown<br />
- Pick any region (I use "East US" but it doesn't really matter)<br />
- <strong>Write this down:</strong> <strong><em>_</em></strong><strong><em>_</em></strong>___</p>
<p><strong>Pricing tier:</strong><br />
- Leave as <strong>"Pay-as-you-go"</strong> (this is correct, don't change it)</p>
<p><strong>You should see:</strong> All fields filled in, no red error messages</p>
<hr />
<h3>Step 4: Set Retention Period</h3>
<p>This is critical for SOC 2 compliance.</p>
<ol>
<li>Click the <strong>"Pricing tier"</strong> tab at the top (next to "Basics")</li>
<li>You should see a section labeled <strong>"Data retention"</strong></li>
<li>Look for a slider or input box</li>
<li><strong>Set it to 365 days</strong> (drag slider right, or type <code>365</code> in the box)</li>
</ol>
<p><strong>Why 365 days?</strong> SOC 2 requires minimum 12 months. This is the cheapest option that meets compliance. Going higher (730 days = 2 years) costs more but gives you safety margin.</p>
<p><strong>You should see:</strong> "365" displayed clearly</p>
<hr />
<h3>Step 5: Skip Tags, Create the Workspace</h3>
<ol>
<li>Click <strong>"Review + create"</strong> button at the bottom left (skip the Tags tab - you can add tags later)</li>
<li><strong>Wait 5 seconds</strong> - Azure validates your settings</li>
<li><strong>You should see:</strong> Green checkmark with "Validation passed"</li>
<li><strong>If you see a red X:</strong> Read the error message. Most common issues:</li>
<li>Name already taken ‚Üí Go back to Step 3, pick different name</li>
<li>No permissions ‚Üí Contact your Azure admin, you need Owner or Contributor role</li>
<li>Click the <strong>"Create"</strong> button at the bottom left</li>
<li><strong>Wait 1-2 minutes</strong> - You'll see a blue "Deployment in progress" spinner</li>
</ol>
<p><strong>You should see:</strong> Green checkmark saying "Your deployment is complete"</p>
<hr />
<h3>Step 6: Verify It Worked</h3>
<ol>
<li>Click the <strong>"Go to resource"</strong> button (it appears after deployment completes)</li>
<li>You're now looking at your workspace dashboard</li>
</ol>
<p><strong>You should see:</strong><br />
- Page title at the top shows your workspace name (like "soc2-audit-logs")<br />
- Green "Succeeded" status<br />
- Information like Resource group, Subscription ID, Location</p>
<p><strong>Write down these three things:</strong><br />
- Workspace name: <strong><em>_</em></strong><strong><em>_</em></strong><strong><em><br />
- Resource group: s</em></strong><strong><em>_</em></strong><strong><em>_</em></strong> (should be soc2-compliance-rg)<br />
- Subscription: <strong><em>_</em></strong><strong><em>_</em></strong>___ (should match what you picked earlier)</p>
<p><strong>Checkpoint:</strong> You now have a Log Analytics Workspace. This is where Activity Logs will be stored for 365 days and where you'll run queries. ‚úì</p>
<hr />
<h2>Part 2: Create Storage Account (10 minutes)</h2>
<p>This is your cheap long-term archive for 7-year retention. Costs pennies compared to Log Analytics.</p>
<h3>Step 7: Search for Storage Accounts</h3>
<ol>
<li>Click the <strong>search bar</strong> at the very top of the page</li>
<li>Type: <code>storage accounts</code></li>
<li>Click <strong>"Storage accounts"</strong> in the dropdown (has a box/container icon)</li>
</ol>
<p><strong>You should see:</strong> "Storage accounts" page with a list of storage accounts (might be empty)</p>
<hr />
<h3>Step 8: Create New Storage Account</h3>
<ol>
<li>Look at the top-left</li>
<li>Click <strong>"+ Create"</strong> button (blue button with plus sign)</li>
</ol>
<p><strong>You should see:</strong> "Create a storage account" form with multiple tabs</p>
<hr />
<h3>Step 9: Fill in Basics</h3>
<p>You're on the "Basics" tab. Fill these in:</p>
<p><strong>Subscription:</strong><br />
- Select the <strong>same subscription</strong> you used in Part 1</p>
<p><strong>Resource group:</strong><br />
- Click dropdown<br />
- Select <strong>"soc2-compliance-rg"</strong> (the one you created or used in Part 1)</p>
<p><strong>Storage account name:</strong><br />
- Type: <code>soc2archive</code> + today's date<br />
- Example: <code>soc2archive20251027</code><br />
- <strong>Rules:</strong> Must be lowercase, 3-24 characters, numbers and letters only, no spaces, no dashes, no underscores<br />
- <strong>If "Name not available":</strong> Try <code>soc2logs20251027</code> or add your initials<br />
- <strong>Write this name down:</strong> <strong><em>_</em></strong><strong><em>_</em></strong>___</p>
<p><strong>Region:</strong><br />
- Select <strong>the same region</strong> you used for the workspace in Part 1 (probably "East US")</p>
<p><strong>Performance:</strong><br />
- Leave as <strong>"Standard"</strong> (should be pre-selected)<br />
- Don't change to Premium (costs 10x more, unnecessary for logs)</p>
<p><strong>Redundancy:</strong><br />
- Click the dropdown<br />
- Select <strong>"Locally-redundant storage (LRS)"</strong><br />
- Why? Cheapest option ($0.02/GB/month). You don't need geo-redundancy for archived logs.</p>
<p><strong>You should see:</strong> All fields filled, no red errors</p>
<hr />
<h3>Step 10: Create the Storage Account</h3>
<ol>
<li>Click <strong>"Review"</strong> button at the bottom left (skip Advanced, Networking, Data protection, Encryption, Tags tabs)</li>
<li>Wait 5 seconds for validation</li>
<li><strong>You should see:</strong> "Validation passed" with green checkmark</li>
<li>Click <strong>"Create"</strong> button at the bottom left</li>
<li><strong>Wait 2 minutes</strong> - Deployment runs</li>
</ol>
<p><strong>You should see:</strong> "Your deployment is complete" with green checkmark</p>
<ol>
<li>Click <strong>"Go to resource"</strong> button</li>
</ol>
<p><strong>You should see:</strong> Storage account overview page with your storage account name at the top</p>
<p><strong>Write down:</strong><br />
- Storage account name: <strong><em>_</em></strong><strong><em>_</em></strong>___ (like soc2archive20251027)<br />
- Resource group: soc2-compliance-rg<br />
- Location: (should match workspace region)</p>
<p><strong>Checkpoint:</strong> You now have a Storage Account for 7-year log archive. ‚úì</p>
<hr />
<h2>Part 3: Export Activity Logs (10 minutes)</h2>
<p>Now you connect the dots: tell Azure to send Activity Logs to both places you just created.</p>
<h3>Step 11: Open Activity Log Settings</h3>
<ol>
<li>Click the <strong>search bar</strong> at the very top of the page</li>
<li>Type: <code>activity log</code></li>
<li>Click <strong>"Activity Log"</strong> in the dropdown (has a clock icon)</li>
</ol>
<p><strong>You should see:</strong> A page showing recent Azure activities - a table with columns like "Time," "Resource," "Operation," "Status"</p>
<ol>
<li>Look at the <strong>left sidebar</strong> (dark blue vertical area on the left side of the page)</li>
<li>Scroll down about halfway</li>
<li>Find and click <strong>"Export Activity Logs"</strong></li>
</ol>
<p><strong>You should see:</strong> Page titled "Diagnostic settings" at the top</p>
<p><strong>What you might see:</strong><br />
- Empty page saying "No diagnostic settings defined yet" (this is fine - you're setting it up now)<br />
- OR existing settings in a table (like "AzureKeyVault" - ignore these, you're adding a new one)</p>
<hr />
<h3>Step 12: Create New Diagnostic Setting</h3>
<ol>
<li>Look at the top of the page</li>
<li>Click <strong>"+ Add diagnostic setting"</strong> button (blue button near the top)</li>
</ol>
<p><strong>You should see:</strong> A form opens on the right side with lots of checkboxes, dropdowns, and options</p>
<hr />
<h3>Step 13: Name Your Setting</h3>
<p>Look at the very top of the form. You'll see <strong>"Diagnostic setting name"</strong> field.</p>
<p>Type exactly: <code>soc2-activity-logs</code></p>
<p><strong>Why this name?</strong> When your auditor asks "show me your Activity Log exports," you can instantly point to "soc2-activity-logs" in the list. Makes your life easier during audits.</p>
<hr />
<h3>Step 14: Select ALL Log Categories</h3>
<p>This is critical. Don't skip any boxes.</p>
<p>Scroll down to the <strong>"Logs"</strong> section. You'll see a list of categories with checkboxes.</p>
<p><strong>Check EVERY SINGLE BOX (all 8):</strong></p>
<ul>
<li>‚òë <strong>Administrative</strong></li>
<li>‚òë <strong>Security</strong></li>
<li>‚òë <strong>ServiceHealth</strong></li>
<li>‚òë <strong>Alert</strong></li>
<li>‚òë <strong>Recommendation</strong></li>
<li>‚òë <strong>Policy</strong></li>
<li>‚òë <strong>Autoscale</strong></li>
<li>‚òë <strong>ResourceHealth</strong></li>
</ul>
<p><strong>Why all 8?</strong> Here's what each one gives you:<br />
- <strong>Administrative:</strong> Who created/deleted/modified resources (critical for SOC 2 CC6.1)<br />
- <strong>Security:</strong> Security alerts, policy violations<br />
- <strong>ServiceHealth:</strong> Azure outages that might have affected your resources<br />
- <strong>Alert:</strong> Monitoring alerts that fired<br />
- <strong>Recommendation:</strong> Azure Advisor recommendations<br />
- <strong>Policy:</strong> Azure Policy violations (governance failures)<br />
- <strong>Autoscale:</strong> Autoscaling events (capacity changes)<br />
- <strong>ResourceHealth:</strong> Resource health status changes</p>
<p>SOC 2 auditors ask random questions like:<br />
- "Show me when this resource failed" (ResourceHealth)<br />
- "Who changed this security setting?" (Administrative + Security)<br />
- "What alerts fired during this incident?" (Alert)<br />
- "Were there any policy violations?" (Policy)</p>
<p>If you only check some boxes, you'll miss data you need later during the audit.</p>
<p><strong>Double-check:</strong> All 8 boxes should have checkmarks. Scroll through the list to verify.</p>
<hr />
<h3>Step 15: Configure Log Analytics Destination</h3>
<p>Scroll down to the <strong>"Destination details"</strong> section.</p>
<p><strong>First destination: Log Analytics (for queries)</strong></p>
<ol>
<li>Find and <strong>check the box</strong> next to <strong>"Send to Log Analytics workspace"</strong></li>
<li>Two new dropdowns appear below it:</li>
</ol>
<p><strong>Subscription dropdown:</strong><br />
- Click it<br />
- Select your subscription (same one you've been using)<br />
- Should match what you wrote down in Step 3</p>
<p><strong>Log Analytics workspace dropdown:</strong><br />
- Click it<br />
- Select <strong>"soc2-audit-logs"</strong> (the workspace you created in Part 1)<br />
- <strong>If you don't see it:</strong> Something went wrong in Part 1. Go back to Step 6, verify the workspace exists.</p>
<p><strong>You should see:</strong> Both dropdowns filled in, no red errors</p>
<hr />
<h3>Step 16: Configure Storage Account Destination</h3>
<p>Still in the <strong>"Destination details"</strong> section, right below where you just were.</p>
<p><strong>Second destination: Storage Account (for 7-year archive)</strong></p>
<ol>
<li>Find and <strong>check the box</strong> next to <strong>"Archive to a storage account"</strong></li>
<li>Three new fields appear:</li>
</ol>
<p><strong>Subscription dropdown:</strong><br />
- Click it<br />
- Select your subscription (same as before)</p>
<p><strong>Storage account dropdown:</strong><br />
- Click it<br />
- Select your storage account: <strong>"soc2archive20251027"</strong> (or whatever you named it in Part 2)<br />
- <strong>If you don't see it:</strong> Go back to Step 12, verify the storage account exists</p>
<p><strong>Retention (days) field:</strong><br />
- Click in the box<br />
- Delete any existing number<br />
- Type: <code>2555</code><br />
- <strong>Why 2555?</strong> That's 7 years (7 √ó 365 = 2,555 days). SOC 2 often wants this. SOX requires it. Better to have it and not need it than vice versa.</p>
<p><strong>You should see:</strong> All three fields filled in correctly</p>
<p><strong>Visual check:</strong> You should now have TWO checked destinations:<br />
- ‚òë Send to Log Analytics workspace (with workspace selected)<br />
- ‚òë Archive to a storage account (with storage account selected and 2555 days)</p>
<hr />
<h3>Step 17: Save It</h3>
<ol>
<li><strong>Look at the very top</strong> of the form (might need to scroll up)</li>
<li>Find the <strong>"Save"</strong> button (top-left area, near the X button)</li>
<li>Click <strong>"Save"</strong></li>
<li><strong>Wait 10 seconds</strong> - Azure is saving your configuration</li>
</ol>
<p><strong>You should see:</strong><br />
- Green notification in the top-right saying "Successfully saved diagnostic setting 'soc2-activity-logs'"<br />
- The form closes<br />
- You're back at the "Diagnostic settings" page<br />
- You should now see "soc2-activity-logs" in the table</p>
<p><strong>If you see a red error instead:</strong></p>
<p>Most common issues:<br />
- <strong>"Insufficient permissions"</strong> ‚Üí You need Owner or Contributor role on the subscription. Contact your Azure admin.<br />
- <strong>"Storage account not found"</strong> ‚Üí Go back to Step 16, double-check you selected the correct storage account<br />
- <strong>"Workspace not found"</strong> ‚Üí Go back to Step 15, verify the workspace name</p>
<p><strong>Checkpoint:</strong> Activity Logs are now being exported to both Log Analytics (365 days) and Storage (7 years). ‚úì</p>
<hr />
<hr />
<h2>CRITICAL: Verify Your Configuration (Before Testing Queries)</h2>
<p><strong>The problem your screenshot revealed:</strong> The diagnostic settings list view shows a setting exists, but doesn't prove what categories are enabled.</p>
<h3>Step 2a: Verify Categories Are Actually Enabled</h3>
<p><strong>Don't trust the list view.</strong> You need to click "Edit setting" to see the actual configuration.</p>
<p><strong>Portal verification (DO THIS NOW):</strong></p>
<ol>
<li>Navigate to your diagnostic settings:</li>
<li><strong>For Activity Logs:</strong> Monitor ‚Üí Activity Log ‚Üí Diagnostic settings</li>
<li>
<p><strong>For Azure AD:</strong> Azure Active Directory ‚Üí Diagnostic settings</p>
</li>
<li>
<p>You'll see your diagnostic setting in a table (like "soc2-activity-logs" or "export-azuread-to-law")</p>
</li>
<li>
<p><strong>Click on the setting name</strong> (not Edit, just click the name to open it)</p>
</li>
<li>
<p><strong>Scroll to the Logs section</strong> and verify checkboxes:</p>
</li>
</ol>
<p><strong>For Activity Logs - ALL 8 must be checked:</strong></p>
<div class="codehilite"><pre><span></span><code>‚òë Administrative
‚òë Security
‚òë ServiceHealth
‚òë Alert
‚òë Recommendation
‚òë Policy
‚òë Autoscale
‚òë ResourceHealth
</code></pre></div>

<p><strong>For Azure AD - ALL 5 must be checked:</strong></p>
<div class="codehilite"><pre><span></span><code>‚òë AuditLogs
‚òë SignInLogs
‚òë NonInteractiveUserSignInLogs
‚òë ServicePrincipalSignInLogs
‚òë ManagedIdentitySignInLogs
</code></pre></div>

<ol>
<li>
<p><strong>Verify destination</strong> shows your Log Analytics workspace</p>
</li>
<li>
<p><strong>Take a screenshot of this screen</strong> - This is what auditors want, not the list view</p>
</li>
</ol>
<p><strong>If any boxes are unchecked:</strong><br />
- Click "Edit"<br />
- Check the missing boxes<br />
- Click "Save"<br />
- Wait 15 minutes<br />
- Recheck</p>
<h3>PowerShell Verification (Proves Configuration)</h3>
<p>This exports exactly what's configured - run this and save the output:</p>
<p><strong>For Activity Logs:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Get subscription diagnostic settings</span>
<span class="nv">$subscriptionId</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Get-AzContext</span><span class="p">).</span><span class="n">Subscription</span><span class="p">.</span><span class="n">Id</span>
<span class="nv">$diagnosticSettings</span> <span class="p">=</span> <span class="nb">Get-AzDiagnosticSetting</span> <span class="n">-ResourceId</span> <span class="s2">&quot;/subscriptions/$subscriptionId&quot;</span>

<span class="c"># Show what&#39;s actually configured</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$setting</span> <span class="k">in</span> <span class="nv">$diagnosticSettings</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">=== Diagnostic Setting: </span><span class="p">$(</span><span class="nv">$setting</span><span class="p">.</span><span class="n">Name</span><span class="p">)</span><span class="s2"> ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>

    <span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">Enabled Categories:&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$log</span> <span class="k">in</span> <span class="nv">$setting</span><span class="p">.</span><span class="n">Logs</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$status</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$log</span><span class="p">.</span><span class="n">Enabled</span><span class="p">)</span> <span class="p">{</span> <span class="s2">&quot;‚úì&quot;</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="s2">&quot;‚úó&quot;</span> <span class="p">}</span>
        <span class="nv">$color</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$log</span><span class="p">.</span><span class="n">Enabled</span><span class="p">)</span> <span class="p">{</span> <span class="s2">&quot;Green&quot;</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="s2">&quot;Red&quot;</span> <span class="p">}</span>
        <span class="nb">Write-Host</span> <span class="s2">&quot;  $status </span><span class="p">$(</span><span class="nv">$log</span><span class="p">.</span><span class="n">Category</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="nv">$color</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$setting</span><span class="p">.</span><span class="n">WorkspaceId</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">‚úì Sending to Log Analytics&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>For Azure AD:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Check Azure AD diagnostic settings</span>
<span class="nb">Connect-MgGraph</span> <span class="n">-Scopes</span> <span class="s2">&quot;AuditLog.Read.All&quot;</span>
<span class="nv">$uri</span> <span class="p">=</span> <span class="s2">&quot;https://graph.microsoft.com/beta/auditLogs/directoryAudits/diagnosticSettings&quot;</span>
<span class="nv">$settings</span> <span class="p">=</span> <span class="nb">Invoke-MgGraphRequest</span> <span class="n">-Method</span> <span class="n">GET</span> <span class="n">-Uri</span> <span class="nv">$uri</span>

<span class="c"># Show configured categories</span>
<span class="nv">$settings</span><span class="p">.</span><span class="n">value</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
    <span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">=== </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="s2"> ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
    <span class="nv">$_</span><span class="p">.</span><span class="n">logs</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
        <span class="nv">$status</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$_</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span> <span class="p">{</span> <span class="s2">&quot;‚úì&quot;</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="s2">&quot;‚úó&quot;</span> <span class="p">}</span>
        <span class="nb">Write-Host</span> <span class="s2">&quot;  $status </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">category</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="p">$(</span><span class="k">if</span> <span class="p">(</span><span class="nv">$_</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span> <span class="p">{</span> <span class="s2">&quot;Green&quot;</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="s2">&quot;Red&quot;</span> <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Save this output</strong> - It's proof of configuration for auditors.</p>
<p><strong>What you should see:</strong><br />
- ALL categories show ‚úì (green checkmark)<br />
- Workspace ID displayed<br />
- If any show ‚úó (red X), go back and fix the configuration</p>
<p><strong>Export for compliance documentation:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c"># Create timestamped proof</span>
<span class="nv">$timestamp</span> <span class="p">=</span> <span class="nb">Get-Date</span> <span class="n">-Format</span> <span class="s2">&quot;yyyy-MM-dd-HHmm&quot;</span>
<span class="nv">$diagnosticSettings</span> <span class="p">|</span> <span class="nb">ConvertTo-Json</span> <span class="n">-Depth</span> <span class="n">10</span> <span class="p">|</span> 
    <span class="nb">Out-File</span> <span class="s2">&quot;diagnostic-settings-proof-$timestamp.json&quot;</span>

<span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">Configuration proof saved: diagnostic-settings-proof-$timestamp.json&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</code></pre></div>

<p><strong>This file proves:</strong><br />
1. What you configured<br />
2. When you verified it<br />
3. Which categories are enabled<br />
4. Where logs are going</p>
<p><strong>Save these monthly</strong> - Creates audit trail showing continuous compliance.</p>
<hr />
<h2>Part 4: Verify It's Working (Critical - Don't Skip)</h2>
<p>This is how you know it actually worked. I've seen people skip this step and discover 6 months later during an audit that logs weren't being exported.</p>
<h3>Step 18: Wait 15 Minutes (Seriously)</h3>
<p>Set a timer. Go grab coffee. Check your email. Walk around the block.</p>
<p>Azure needs 15-30 minutes to start sending Activity Log data to Log Analytics. First sync is always slow.</p>
<p><strong>Do not skip the wait.</strong> If you check immediately, you'll see no results and panic unnecessarily.</p>
<hr />
<h3>Step 19: Open Log Analytics Query Editor</h3>
<p>After your 15-minute coffee break:</p>
<ol>
<li>Click the <strong>search bar</strong> at the top of the portal</li>
<li>Type: <code>log analytics workspaces</code></li>
<li>Click <strong>"Log Analytics workspaces"</strong></li>
<li>Find and click your workspace: <strong>"soc2-audit-logs"</strong></li>
</ol>
<p><strong>You should see:</strong> Your workspace overview page</p>
<ol>
<li>Look at the <strong>left sidebar</strong></li>
<li>Find and click <strong>"Logs"</strong> (about halfway down, has a chart/graph icon)</li>
</ol>
<p><strong>If a tutorial popup appears:</strong><br />
- It says "Get Started with Log Analytics" or similar<br />
- Click <strong>"Get Started"</strong> button<br />
- Then immediately click the <strong>X</strong> in the top-right to close it<br />
- You don't need the tutorial right now</p>
<p><strong>You should see:</strong> A query window with:<br />
- A large white text box (this is where you type queries)<br />
- A blinking cursor in the box<br />
- A blue "Run" button above the box<br />
- A list of tables on the left (you might see "AzureActivity" in the list)</p>
<hr />
<h3>Step 20: Run Your First Test Query</h3>
<p>This query checks if Activity Logs are arriving.</p>
<ol>
<li><strong>Click in the query window</strong> (the white text box)</li>
<li><strong>Delete any existing text</strong> if there is any</li>
<li><strong>Type this exactly</strong> (or copy/paste):</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="n">AzureActivity</span>
<span class="p">|</span><span class="w"> </span><span class="k">take</span><span class="w"> </span><span class="mi">10</span>
</code></pre></div>

<p><strong>What this does:</strong> Gets 10 recent Activity Log entries. Simple test to see if data is flowing.</p>
<ol>
<li>Press <strong>Shift + Enter</strong> on your keyboard (or click the blue <strong>"Run"</strong> button)</li>
<li><strong>Wait 5-10 seconds</strong> - Query is running</li>
</ol>
<p><strong>YOU SHOULD SEE:</strong></p>
<p>A table appears below the query window with:<br />
- 10 rows of data<br />
- Columns like "TimeGenerated," "Caller," "OperationName," "ResourceId," "ActivityStatusValue"<br />
- TimeGenerated dates should be recent (within the last few hours)<br />
- Caller shows email addresses or service principals<br />
- OperationName shows things like "MICROSOFT.RESOURCES/SUBSCRIPTIONS/RESOURCEGROUPS/WRITE"</p>
<p><strong>If you see this:</strong> ‚úÖ <strong>SUCCESS! Your Activity Logs are flowing correctly.</strong></p>
<p><strong>IF YOU SEE "No results found" or empty table:</strong></p>
<p>Don't panic. Try these steps in order:</p>
<ol>
<li>
<p><strong>Check the time range</strong> - Look above the query window. You might see "Time range: Last 24 hours" or similar. Change it to "Last 7 days" and run again.</p>
</li>
<li>
<p><strong>Wait another 15 minutes</strong> - First sync can take 30-45 minutes total. Set another timer. Check again.</p>
</li>
<li>
<p><strong>Generate some activity</strong> - Create a test resource group:</p>
</li>
<li>Search for "resource groups"</li>
<li>Click "+ Create"</li>
<li>Fill in: Name = "test-soc2", Region = East US</li>
<li>Click "Review + create" then "Create"</li>
<li>Wait 5 minutes</li>
<li>
<p>Run the query again</p>
</li>
<li>
<p><strong>Still nothing after 60 minutes total?</strong> Something's wrong. Go back to Part 3:</p>
</li>
<li>Step 14: Verify ALL 8 boxes are checked (especially "Administrative")</li>
<li>Step 15: Verify correct workspace selected</li>
<li>Step 17: Verify you saw the green "Successfully saved" message</li>
</ol>
<hr />
<h3>Step 21: Check Retention (Proves Logs Are Staying)</h3>
<p>This query shows how many days of logs you have.</p>
<p>In the query window, <strong>delete the previous query</strong> and type this:</p>
<div class="codehilite"><pre><span></span><code><span class="n">AzureActivity</span>
<span class="p">|</span><span class="w"> </span><span class="k">summarize</span><span class="w"> </span>
<span class="w">    </span><span class="n">OldestLog</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">TimeGenerated</span><span class="p">),</span>
<span class="w">    </span><span class="n">NewestLog</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">TimeGenerated</span><span class="p">),</span>
<span class="w">    </span><span class="n">DaysCovered</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">datetime_diff</span><span class="p">(</span><span class="s">&#39;day&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">TimeGenerated</span><span class="p">),</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">TimeGenerated</span><span class="p">))</span>
</code></pre></div>

<p>Press <strong>Shift + Enter</strong> to run it.</p>
<p><strong>YOU SHOULD SEE:</strong></p>
<p>A table with 1 row showing:<br />
- <strong>OldestLog:</strong> Earliest Activity Log you have (probably today or yesterday)<br />
- <strong>NewestLog:</strong> Most recent Activity Log (probably a few minutes ago)<br />
- <strong>DaysCovered:</strong> 0 or 1 (since you just set this up)</p>
<p><strong>This is normal.</strong> You just configured this. You don't have 365 days of logs yet.</p>
<p><strong>IMPORTANT - Mark Your Calendar:</strong></p>
<ul>
<li><strong>In 7 days:</strong> Run this query again. DaysCovered should be ~7.</li>
<li><strong>In 30 days:</strong> Run it again. DaysCovered should be ~30.</li>
<li><strong>In 90 days:</strong> Run it again. DaysCovered should be ~90.</li>
<li><strong>In 365 days:</strong> Run it again. DaysCovered should be ~365.</li>
</ul>
<p><strong>When DaysCovered hits 365, you're officially SOC 2 compliant for Activity Log retention.</strong> ‚úì</p>
<p>Save this query somewhere (OneNote, wiki, Confluence) so you can run it quarterly.</p>
<hr />
<h3>Step 22: Test a Real Audit Query</h3>
<p>Let's make sure you can actually answer audit questions.</p>
<p>Try this query that finds resource deletions (common audit question):</p>
<div class="codehilite"><pre><span></span><code><span class="n">AzureActivity</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="w"> </span><span class="p">&gt;=</span><span class="w"> </span><span class="n">ago</span><span class="p">(</span><span class="mi">7</span><span class="n">d</span><span class="p">)</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">OperationName</span><span class="w"> </span><span class="k">contains</span><span class="w"> </span><span class="s">&quot;DELETE&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">ActivityStatusValue</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;Success&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="p">,</span><span class="w"> </span><span class="n">Caller</span><span class="p">,</span><span class="w"> </span><span class="n">ResourceId</span><span class="p">,</span><span class="w"> </span><span class="n">ResourceGroup</span><span class="p">,</span><span class="w"> </span><span class="n">OperationName</span>
<span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="w"> </span><span class="n">desc</span>
</code></pre></div>

<p><strong>What this does:</strong> Shows all successful resource deletions in the last 7 days, who did it, and what they deleted.</p>
<p><strong>YOU SHOULD SEE:</strong></p>
<p>Either:<br />
- <strong>A table with rows</strong> (if anyone deleted resources recently) - Shows when, who, and what was deleted<br />
- <strong>OR "No results found"</strong> (if nobody deleted anything) - This is fine, means no deletions</p>
<p><strong>If you see results:</strong> Great! You can now answer the audit question "Show me all resource deletions in Q3 2025."</p>
<p><strong>Save this query</strong> - You'll use it during audits.</p>
<hr />
<h2>What You Can Do Now</h2>
<p>You just set up SOC 2-compliant Activity Log retention. Here's what this enables:</p>
<h3>Audit Question 1: "Who created storage account 'proddata001' on September 15, 2025?"</h3>
<div class="codehilite"><pre><span></span><code><span class="n">AzureActivity</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="p">(</span><span class="k">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">-</span><span class="mi">09</span><span class="p">-</span><span class="mi">15</span><span class="p">)</span><span class="w"> </span><span class="err">..</span><span class="w"> </span><span class="k">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">-</span><span class="mi">09</span><span class="p">-</span><span class="mi">16</span><span class="p">))</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">ResourceId</span><span class="w"> </span><span class="k">contains</span><span class="w"> </span><span class="s">&quot;proddata001&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">OperationName</span><span class="w"> </span><span class="k">contains</span><span class="w"> </span><span class="s">&quot;CREATE&quot;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">OperationName</span><span class="w"> </span><span class="k">contains</span><span class="w"> </span><span class="s">&quot;WRITE&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">ActivityStatusValue</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;Success&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="p">,</span><span class="w"> </span><span class="n">Caller</span><span class="p">,</span><span class="w"> </span><span class="n">OperationName</span><span class="p">,</span><span class="w"> </span><span class="n">ResourceId</span>
</code></pre></div>

<p><strong>Answer:</strong> The Caller column shows who did it. TimeGenerated shows exactly when.</p>
<hr />
<h3>Audit Question 2: "Show me all resource deletions in the last 90 days"</h3>
<div class="codehilite"><pre><span></span><code><span class="n">AzureActivity</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="w"> </span><span class="p">&gt;=</span><span class="w"> </span><span class="n">ago</span><span class="p">(</span><span class="mi">90</span><span class="n">d</span><span class="p">)</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">OperationName</span><span class="w"> </span><span class="k">contains</span><span class="w"> </span><span class="s">&quot;DELETE&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">ActivityStatusValue</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;Success&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="p">,</span><span class="w"> </span><span class="n">Caller</span><span class="p">,</span><span class="w"> </span><span class="n">ResourceId</span><span class="p">,</span><span class="w"> </span><span class="n">ResourceGroup</span>
<span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="w"> </span><span class="n">desc</span>
</code></pre></div>

<p><strong>Answer:</strong> Every row is a deletion. Export to Excel for the auditor.</p>
<hr />
<h3>Audit Question 3: "What changes did john.doe@company.com make last month?"</h3>
<div class="codehilite"><pre><span></span><code><span class="n">AzureActivity</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">Caller</span><span class="w"> </span><span class="k">contains</span><span class="w"> </span><span class="s">&quot;john.doe@company.com&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="w"> </span><span class="p">&gt;=</span><span class="w"> </span><span class="n">ago</span><span class="p">(</span><span class="mi">30</span><span class="n">d</span><span class="p">)</span>
<span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="p">,</span><span class="w"> </span><span class="n">ResourceGroup</span><span class="p">,</span><span class="w"> </span><span class="n">ResourceId</span><span class="p">,</span><span class="w"> </span><span class="n">OperationName</span><span class="p">,</span><span class="w"> </span><span class="n">ActivityStatusValue</span>
<span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="w"> </span><span class="n">desc</span>
</code></pre></div>

<p><strong>Answer:</strong> Complete audit trail of everything this user did.</p>
<hr />
<h3>Audit Question 4: "Were there any policy violations in Q2 2025?"</h3>
<div class="codehilite"><pre><span></span><code><span class="n">AzureActivity</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="p">(</span><span class="k">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">-</span><span class="mi">04</span><span class="p">-</span><span class="mi">01</span><span class="p">)</span><span class="w"> </span><span class="err">..</span><span class="w"> </span><span class="k">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">-</span><span class="mi">06</span><span class="p">-</span><span class="mi">30</span><span class="p">))</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">CategoryValue</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;Policy&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">ActivityStatusValue</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;Failure&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="p">,</span><span class="w"> </span><span class="n">Caller</span><span class="p">,</span><span class="w"> </span><span class="n">OperationName</span><span class="p">,</span><span class="w"> </span><span class="n">Properties</span>
<span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="w"> </span><span class="n">desc</span>
</code></pre></div>

<p><strong>Answer:</strong> Every policy failure, who triggered it, when.</p>
<hr />
<h2>Cost Breakdown</h2>
<p><strong>What this setup actually costs:</strong></p>
<h3>Small Environment (1-3 subscriptions)</h3>
<ul>
<li><strong>Log Analytics:</strong> ~$2-10/month</li>
<li>First 5GB/month is free</li>
<li>After that: $2.76/GB ingested + $0.12/GB/month retention</li>
<li>Small environments generate 1-3GB/month of Activity Logs</li>
<li><strong>Storage Account:</strong> ~$2-5/month</li>
<li>Cool tier: $0.01/GB/month</li>
<li>7 years of logs ‚âà 200-500GB total = $2-5/month</li>
<li><strong>Total: $4-15/month</strong></li>
</ul>
<h3>Medium Environment (10-20 subscriptions)</h3>
<ul>
<li><strong>Log Analytics:</strong> ~$50-150/month</li>
<li>20-50GB/month ingested</li>
<li><strong>Storage Account:</strong> ~$10-20/month</li>
<li>1-2TB archived</li>
<li><strong>Total: $60-170/month</strong></li>
</ul>
<h3>Enterprise (40+ subscriptions, like mine)</h3>
<ul>
<li><strong>Log Analytics:</strong> ~$700-900/month</li>
<li>250-300GB/month ingested</li>
<li>Multiple environments, lots of activity</li>
<li><strong>Storage Account:</strong> ~$30-50/month</li>
<li>3-5TB archived over 7 years</li>
<li><strong>Total: $730-950/month</strong></li>
</ul>
<p><strong>ROI Check:</strong><br />
- One failed SOC 2 audit finding: $50,000-$500,000 in remediation costs + penalties<br />
- One security breach investigation without logs: $100,000+ in forensics consulting<br />
- This solution: $48-11,400/year</p>
<p>No-brainer.</p>
<hr />
<h2>Common Mistakes to Avoid</h2>
<h3>Mistake 1: Only Checking "Administrative" in Step 14</h3>
<p><strong>Why it's wrong:</strong> You'll miss Security logs, Policy violations, and other categories auditors ask for.</p>
<p><strong>Fix:</strong> Check all 8 boxes. Every single one matters.</p>
<hr />
<h3>Mistake 2: Skipping Part 4 (Verification)</h3>
<p><strong>Why it's wrong:</strong> You won't know if it's working until the audit, when it's too late to fix.</p>
<p><strong>Fix:</strong> Actually run the test queries. Verify you see results. Check again in 7 days, 30 days, 90 days.</p>
<hr />
<h3>Mistake 3: Setting Retention to 30 or 90 Days</h3>
<p><strong>Why it's wrong:</strong> SOC 2 requires 12+ months minimum. Setting 90 days means you fail compliance.</p>
<p><strong>Fix:</strong> Set Log Analytics retention to 365 days (Step 4). Set Storage retention to 2,555 days (Step 16).</p>
<hr />
<h3>Mistake 4: Not Documenting What You Did</h3>
<p><strong>Why it's wrong:</strong> When your coworker asks "where are our Activity Logs?" in 6 months, nobody remembers.</p>
<p><strong>Fix:</strong> Create a one-page doc:<br />
- Workspace name: soc2-audit-logs<br />
- Storage account: soc2archive20251027<br />
- Retention: 365 days (LAW), 7 years (Storage)<br />
- Configured by: [your name]<br />
- Date: [today's date]<br />
- Purpose: SOC 2 CC6.1, CC6.7 compliance</p>
<p>Save it in SharePoint, Confluence, or your internal wiki.</p>
<hr />
<h3>Mistake 5: Thinking This Covers Azure AD</h3>
<p><strong>Why it's wrong:</strong> This guide covers Activity Logs (ARM resources like VMs, storage, networks). Azure AD logs (users, app registrations, sign-ins) are a completely separate system.</p>
<p><strong>Fix:</strong> You still need to configure Azure AD diagnostic settings separately. That's a different guide (coming next week).</p>
<hr />
<h2>What's Next</h2>
<p>You just set up <strong>Activity Logs</strong> (ARM resources - VMs, storage accounts, networks).</p>
<p><strong>You're 50% done with SOC 2 logging compliance.</strong></p>
<p>The other 50% is <strong>Azure AD Audit Logs</strong> (identity layer):<br />
- User sign-ins<br />
- App registration creation<br />
- Admin consent grants<br />
- Role assignments<br />
- Password resets</p>
<p>That's a separate system with different configuration. I'll cover that in next week's post.</p>
<p>For now, you're compliant with:<br />
- <strong>SOC 2 CC6.1</strong> (Logical Access Controls) - You can prove who accessed what<br />
- <strong>SOC 2 CC6.7</strong> (System Monitoring) - You have 12+ months of monitoring data</p>
<hr />
<h2>Quick Reference Card</h2>
<p>Copy this, print it, stick it on your desk:</p>
<p><strong>Activity Log Setup - Quick Facts</strong></p>
<ul>
<li><strong>Workspace:</strong> soc2-audit-logs (365 days)</li>
<li><strong>Storage:</strong> soc2archive[date] (7 years)</li>
<li><strong>Diagnostic Setting:</strong> soc2-activity-logs</li>
<li><strong>All 8 categories:</strong> ‚úì checked</li>
<li><strong>Test Query:</strong> <code>AzureActivity | take 10</code></li>
<li><strong>Retention Check:</strong> Run quarterly (check DaysCovered)</li>
<li><strong>Cost:</strong> $4-15/month (small), $60-170/month (medium), $730-950/month (enterprise)</li>
<li><strong>Compliant with:</strong> SOC 2 CC6.1, CC6.7</li>
</ul>
<hr />
<h2>The Real Takeaway</h2>
<p>This is the guide nobody wrote. Every SOC 2 Azure article says "configure diagnostic settings." None show you how.</p>
<p>Now you know. Every button, every dropdown, every checkbox, every KQL query you need.</p>
<p>Next time your auditor asks "show me who deleted this resource in March," you'll have an answer in 30 seconds instead of panic-calling your Azure admin.</p>
<p>That's the difference between passing and failing the audit.</p>
<p><strong>Questions? Stuck on a step? Email me at contact@azure-noob.com or drop a comment below.</strong></p>
<p>And if you found this useful, share it with your compliance team. They'll thank you when audit season rolls around.</p>
  </div>

  
  
  <aside class="related-posts" style="max-width: 800px; margin: 3rem auto; padding: 2rem; background: var(--bg-light); border-radius: 12px;">
    <h3 style="margin-top: 0;">Related Posts</h3>
    <ul style="list-style: none; padding: 0;">
      
      <li style="margin: 1rem 0;">
        <a href="../soc2-azure-ad-audit-logs-step-by-step/index.html" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">SOC 2 Audit Prep Part 2: Azure AD Audit Log Retention Setup (Step-by-Step)</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-10-27</span>
        </a>
      </li>
      
      <li style="margin: 1rem 0;">
        <a href="../azure-audit-gap-nobody-talks-about/index.html" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">The Azure Audit Gap Nobody Talks About: Why Your 90-Day Logs Won&#39;t Survive a 7-Year Audit</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-10-26</span>
        </a>
      </li>
      
      <li style="margin: 1rem 0;">
        <a href="../azure-ai-30-day-test/index.html" style="display: block; padding: 1rem; background: white; border-radius: 8px; border: 1px solid var(--border); transition: all 0.2s ease;">
          <span class="related-title" style="font-weight: 700; display: block; color: var(--text-dark);">I Spent 30 Days Testing Azure AI in a Regulated Environment. Here&#39;s What Actually Works.</span>
          <span class="related-meta" style="color: var(--text-muted); font-size: 0.9rem;">2025-10-17</span>
        </a>
      </li>
      
    </ul>
  </aside>
  

  
  <nav class="post-nav">
    
      <a href="../soc2-azure-ad-audit-logs-step-by-step/index.html">
        <span style="opacity: 0.7; font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">‚Üê Previous</span>
        <strong>SOC 2 Audit Prep Part 2: Azure AD Audit Log Retention Setup (Step-by-Step)</strong>
      </a>
    
    
      <a href="../kql-query-library-git/index.html" style="text-align: right;">
        <span style="opacity: 0.7; font-size: 0.85rem; display: block; margin-bottom: 0.25rem;">Next ‚Üí</span>
        <strong>Stop Losing Your KQL Queries: The Git-Based Query Library Nobody Told You About</strong>
      </a>
    
  </nav>

</article>

    </div>
  </main>

  <!-- EMAIL CAPTURE SECTION -->
  <section class="email-signup" id="subscribe">
    <div class="wrap">
      <h3>Get Azure tips in your inbox</h3>
      <p>Join Azure pros getting practical KQL queries, cost optimization tips, and real-world solutions.</p>
      <script async data-uid="3dfad5c743" src="https://azure-noob.kit.com/3dfad5c743/index.js"></script>
    </div>
  </section>

  <footer class="site-footer">
    <div class="wrap">
      <p>&copy; 2025 Azure Noob ‚Äî Don&#39;t be a Noob</p>
    </div>
  </footer>

  <!-- Copy code functionality -->
  <script src="../../static/copy-code.js"></script>
</body>
</html>